if(!window.pc){window.pc={}}pc.packed=true;window.gamecore={hasOwn:Object.prototype.hasOwnProperty,isFunction:function(b){return !!(b&&b.constructor&&b.call&&b.apply)},isWindow:function(b){return !!(b&&b.setInterval)},isArray:Array.isArray||function(b){return(b.constructor===Array)},isString:function(b){return(typeof b=="string")},isObject:function(b){return b===Object(b)},isPlainObject:function(d){if(!d||this.isObject(d)||d.nodeType||this.isWindow(d)){return false}try{if(d.constructor&&!this.hasOwn.call(d,"constructor")&&!this.hasOwn.call(d.constructor.prototype,"isPrototypeOf")){return false}}catch(c){return false}var b;for(b in d){}return b===undefined||this.hasOwn.call(d,b)},extend:function(){var l,d,b,c,h,j,g=arguments[0]||{},f=1,e=arguments.length,k=false;if(typeof g==="boolean"){k=g;g=arguments[1]||{};f=2}if(typeof g!=="object"&&!gamecore.isFunction(g)){g={}}if(e===f){g=this;--f}for(;f<e;f++){if((l=arguments[f])!=null){for(d in l){b=g[d];c=l[d];if(g===c){continue}if(k&&c&&(this.isPlainObject(c)||(h=this.isArray(c)))){if(h){h=false;j=b&&this.isArray(b)?b:[]}else{j=b&&this.isPlainObject(b)?b:{}}g[d]=this.extend(k,j,c)}else{if(c!==undefined){g[d]=c}}}}}return g}};gamecore.push=Array.prototype.push;gamecore.merge=function(f,d){var e=f.length,c=0;if(typeof d.length==="number"){for(var b=d.length;c<b;c++){f[e++]=d[c]}}else{while(d[c]!==undefined){f[e++]=d[c++]}}f.length=e;return f};gamecore.makeArray=function(d,c){var b=c||[];if(d!=null){if(d.length==null||gamecore.isString(d)||gamecore.isFunction(d)||gamecore.isWindow(d)){gamecore.push.call(b,d)}else{gamecore.merge(b,d)}}return b};gamecore.each=function(e,h,d){var c,f=0,g=e.length,b=g===undefined||gamecore.isFunction(e);if(d){if(b){for(c in e){if(h.apply(e[c],d)===false){break}}}else{for(;f<g;){if(h.apply(e[f++],d)===false){break}}}}else{if(b){for(c in e){if(h.call(e[c],c,e[c])===false){break}}}else{for(;f<g;){if(h.call(e[f],f,e[f++])===false){break}}}}return e};gamecore._flagsCache={};gamecore.createFlags=function(b){var c=gamecore._flagsCache[b]={},d,e;b=b.split(/\s+/);for(d=0,e=b.length;d<e;d++){c[b[d]]=true}return c};gamecore.Callbacks=function(d){d=d?(gamecore._flagsCache[d]||gamecore.createFlags(d)):{};var i=[],j=[],e,f,c,g,h,l=function(m){var n,p,o,q;for(n=0,p=m.length;n<p;n++){o=m[n];if(gamecore.isArray(o)){l(o)}else{if(gamecore.isFunction(o)){if(!d.unique||!k.has(o)){i.push(o)}}}}},b=function(n,m){m=m||[];e=!d.memory||[n,m];f=true;h=c||0;c=0;g=i.length;for(;i&&h<g;h++){if(i[h].apply(n,m)===false&&d.stopOnFalse){e=true;break}}f=false;if(i){if(!d.once){if(j&&j.length){e=j.shift();k.fireWith(e[0],e[1])}}else{if(e===true){k.disable()}else{i=[]}}}},k={add:function(){if(i){var m=i.length;l(arguments);if(f){g=i.length}else{if(e&&e!==true){c=m;b(e[0],e[1])}}}return this},remove:function(){if(i){var m=arguments,o=0,p=m.length;for(;o<p;o++){for(var n=0;n<i.length;n++){if(m[o]===i[n]){if(f){if(n<=g){g--;if(n<=h){h--}}}i.splice(n--,1);if(d.unique){break}}}}}return this},has:function(n){if(i){var m=0,o=i.length;for(;m<o;m++){if(n===i[m]){return true}}}return false},empty:function(){i=[];return this},disable:function(){i=j=e=undefined;return this},disabled:function(){return !i},lock:function(){j=undefined;if(!e||e===true){k.disable()}return this},locked:function(){return !j},fireWith:function(n,m){if(j){if(f){if(!d.once){j.push([n,m])}}else{if(!(d.once&&e)){b(n,m)}}}return this},fire:function(){k.fireWith(this,arguments);return this},fired:function(){return !!e}};return k};gamecore.extend({Deferred:function(f){var e=gamecore.Callbacks("once memory"),d=gamecore.Callbacks("once memory"),c=gamecore.Callbacks("memory"),b="pending",h={resolve:e,reject:d,notify:c},j={done:e.add,fail:d.add,progress:c.add,state:function(){return b},isResolved:e.fired,isRejected:d.fired,then:function(l,k,m){i.done(l).fail(k).progress(m);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(m,l,k){return gamecore.Deferred(function(n){gamecore.each({done:[m,"resolve"],fail:[l,"reject"],progress:[k,"notify"]},function(p,s){var o=s[0],r=s[1],q;if(gamecore.isFunction(o)){i[p](function(){q=o.apply(this,arguments);if(q&&gamecore.isFunction(q.promise)){q.promise().then(n.resolve,n.reject,n.notify)}else{n[r+"With"](this===i?n:this,[q])}})}else{i[p](n[r])}})}).promise()},promise:function(l){if(l==null){l=j}else{for(var k in j){l[k]=j[k]}}return l}},i=j.promise({}),g;for(g in h){i[g]=h[g].fire;i[g+"With"]=h[g].fireWith}i.done(function(){b="resolved"},d.disable,c.lock).fail(function(){b="rejected"},e.disable,c.lock);if(f){f.call(i,i)}return i},when:function(j){var b=[].slice;var f=b.call(arguments,0),d=0,c=f.length,k=new Array(c),e=c,g=c,l=c<=1&&j&&gamecore.isFunction(j.promise)?j:gamecore.Deferred(),n=l.promise();function m(o){return function(i){f[o]=arguments.length>1?b.call(arguments,0):i;if(!(--e)){l.resolveWith(l,f)}}}function h(o){return function(i){k[o]=arguments.length>1?b.call(arguments,0):i;l.notifyWith(n,k)}}if(c>1){for(;d<c;d++){if(f[d]&&f[d].promise&&gamecore.isFunction(f[d].promise)){f[d].promise().then(m(d),l.reject,h(d))}else{--e}}if(!e){l.resolveWith(l,f)}}else{if(l!==j){l.resolveWith(l,c?[j]:[])}}return n}});(function(e){var c={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},g=function(j,i,h){return j[i]||(h&&(j[i]={}))},d=function(i){var h=typeof i;return h&&(h=="function"||h=="object")},b=function(m,r,s){var k=m?m.split(c.dot):[],j=k.length,h=e.isArray(r)?r:[r||window],n,o,l,q=0,p;if(j==0){return h[0]}while(n=h[q++]){for(l=0;l<j-1&&d(n);l++){n=g(n,k[l],s)}if(d(n)){o=g(n,k[l],s);if(o!==undefined){if(s===false){delete n[k[l]]}return o}}}},f=e.String={getObject:b,capitalize:function(i,h){return i.charAt(0).toUpperCase()+i.substr(1)},camelize:function(h){h=f.classize(h);return h.charAt(0).toLowerCase()+h.substr(1)},classize:function(j,l){var k=j.split(c.undHash),h=0;for(;h<k.length;h++){k[h]=f.capitalize(k[h])}return k.join(l||"")},niceName:function(h){return f.classize(h," ")},underscore:function(h){return h.replace(c.colons,"/").replace(c.words,"$1_$2").replace(c.lowUp,"$1_$2").replace(c.dash,"_").toLowerCase()},sub:function(i,j,h){var k=[];k.push(i.replace(c.replacer,function(o,l){var m=b(l,j,typeof h=="boolean"?!h:h),n=typeof m;if((n==="object"||n==="function")&&n!==null){k.push(m);return""}else{return""+m}}));return k.length<=1?k[0]:k}}})(gamecore);(function(k){var f=false,b=k.makeArray,c=k.isFunction,g=k.isArray,i=k.extend,l=function(n){if(!n||typeof(n)!="object"){return n}if(n instanceof Array){var q=[];for(var p=0;p<n.length;p++){q[p]=l(n[p])}return q}else{var m={};for(var o in n){m[o]=l(n[o])}return m}},e=function(m,n){return m.concat(b(n))},j=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,d=function(p,m,o){o=o||p;for(var n in p){o[n]=c(p[n])&&c(m[n])&&j.test(p[n])?(function(q,r){return function(){var t=this._super,s;this._super=m[q];s=r.apply(this,arguments);this._super=t;return s}})(n,p[n]):p[n]}},h=k.Class=function(){if(arguments.length){return h.extend.apply(h,arguments)}};i(h,{callback:function(n){var o=b(arguments),m;n=o.shift();if(!g(n)){n=[n]}m=this;return function p(){var u=e(o,arguments),q,s=n.length,t=0,r;for(;t<s;t++){r=n[t];if(!r){continue}q=typeof r=="string";if(q&&m._set_called){m.called=r}u=(q?m[r]:r).apply(m,u||[]);if(t<s-1){u=!g(u)||u._use_call?[u]:u}}return u}},getObject:k.String.getObject,newInstance:function(){var n=this.rawInstance();var m;if(n.setup){m=n.setup.apply(n,arguments)}for(var o in n.__proto__){n[o]=l(n[o])}if(n.init){n.init.apply(n,g(m)?m:arguments)}return n},setup:function(m,n){this.defaults=i(true,{},m.defaults,this.defaults);if(this._types==undefined){this._types=[]}this._types.push(this.fullName);if(this._fullTypeName==undefined){this._fullTypeName="|"}this._fullTypeName+=this.fullName+"|";return arguments},rawInstance:function(){f=true;var m=new this();f=false;return m},extend:function(o,t,r){if(typeof o!="string"){r=t;t=o;o=null}if(!r){r=t;t=null}r=r||{};var s=this,x=this.prototype,n,v,p,w;this.isA=function(y){return this._fullTypeName.indexOf("|"+y+"|")!=-1};f=true;w=new this();f=false;d(r,x,w);function m(){if(f){return}if(this.constructor!==m&&arguments.length){return arguments.callee.extend.apply(arguments.callee,arguments)}else{return this.Class.newInstance.apply(this.Class,arguments)}}for(n in this){if(this.hasOwnProperty(n)){m[n]=l(this[n])}}d(t,this,m);if(o){var q=o.split(/\./);var v=q.pop();if(q.length>0){current=h.getObject(q.join("."),window,true),p=current}current[v]=m}i(m,{prototype:w,namespace:p,shortName:v,constructor:m,fullName:o});m.prototype.Class=m.prototype.constructor=m;var u=m.setup.apply(m,e([s],arguments));if(m.init){m.init.apply(m,u||[])}return m}});h.prototype.callback=h.callback})(gamecore);gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(e,c,d){var b="";if(e){b=":"+e}console.log(this.fullName+b+" ["+c+"] "+d)},warn:function(b){this.log(null,this.WARN,b)},debug:function(b){this.log(null,this.DEBUG,b)},error:function(b){this.log(null,this.ERROR,b)},info:function(b){this.log(null,this.INFO,b)},assert:function(b,c){if(!c){throw b}}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++;this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(b){this.Class.log(this.objectId,this.Class.WARN,b)},debug:function(b){this.Class.log(this.objectId,this.Class.DEBUG,b)},error:function(b){this.Class.log(this.objectId,this.Class.ERROR,b)},info:function(b){this.Class.log(this.objectId,this.Class.INFO,b)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}});gamecore.Hashtable=(function(){var q="function";var o=(typeof Array.prototype.splice==q)?function(t,s){t.splice(s,1)}:function(v,u){var t,w,s;if(u===v.length-1){v.length=u}else{t=v.slice(u+1);v.length=u;for(w=0,s=t.length;w<s;++w){v[u+w]=t[w]}}};function b(u){var s;if(typeof u=="string"){return u}else{if(typeof u.hashCode==q){s=u.hashCode();return(typeof s=="string")?s:b(s)}else{if(typeof u.toString==q){return u.toString()}else{try{return String(u)}catch(t){return Object.prototype.toString.call(u)}}}}}function h(s,t){return s.equals(t)}function f(s,t){return(typeof t.equals==q)?t.equals(s):(s===t)}function d(s){return function(t){if(t===null){throw new Error("null is not a valid "+s)}else{if(typeof t=="undefined"){throw new Error(s+" must not be undefined")}}}}var r=d("key"),m=d("value");function e(v,t,u,s){this[0]=v;this.entries=[];this.addEntry(t,u);if(s!==null){this.getEqualityFunction=function(){return s}}}var i=0,k=1,g=2;function p(s){return function(u){var t=this.entries.length,w,v=this.getEqualityFunction(u);while(t--){w=this.entries[t];if(v(u,w[0])){switch(s){case i:return true;case k:return w;case g:return[t,w[1]]}}}return false}}function l(s){return function(v){var w=v.length;for(var u=0,t=this.entries.length;u<t;++u){v[w+u]=this.entries[u][s]}}}e.prototype={getEqualityFunction:function(s){return(typeof s.equals==q)?h:f},getEntryForKey:p(k),getEntryAndIndexForKey:p(g),removeEntryForKey:function(t){var s=this.getEntryAndIndexForKey(t);if(s){o(this.entries,s[0]);return s[1]}return null},addEntry:function(s,t){this.entries[this.entries.length]=[s,t]},keys:l(0),values:l(1),getEntries:function(t){var v=t.length;for(var u=0,s=this.entries.length;u<s;++u){t[v+u]=this.entries[u].slice(0)}},containsKey:p(i),containsValue:function(t){var s=this.entries.length;while(s--){if(t===this.entries[s][1]){return true}}return false}};function n(t,u){var s=t.length,v;while(s--){v=t[s];if(u===v[0]){return s}}return null}function j(s,t){var u=s[t];return(u&&(u instanceof e))?u:null}function c(u,s){var x=this;var w=[];var v={};var y=(typeof u==q)?u:b;var t=(typeof s==q)?s:null;this.put=function(C,D){r(C);m(D);var E=y(C),F,B,A=null;F=j(v,E);if(F){B=F.getEntryForKey(C);if(B){A=B[1];B[1]=D}else{F.addEntry(C,D)}}else{F=new e(E,C,D,t);w[w.length]=F;v[E]=F}return A};this.get=function(B){r(B);var C=y(B);var D=j(v,C);if(D){var A=D.getEntryForKey(B);if(A){return A[1]}}return null};this.containsKey=function(B){r(B);var A=y(B);var C=j(v,A);return C?C.containsKey(B):false};this.containsValue=function(B){m(B);var A=w.length;while(A--){if(w[A].containsValue(B)){return true}}return false};this.clear=function(){w.length=0;v={}};this.isEmpty=function(){return !w.length};var z=function(A){return function(){var B=[],C=w.length;while(C--){w[C][A](B)}return B}};this.keys=z("keys");this.values=z("values");this.entries=z("getEntries");this.remove=function(C){r(C);var D=y(C),A,B=null;var E=j(v,D);if(E){B=E.removeEntryForKey(C);if(B!==null){if(!E.entries.length){A=n(w,D);o(w,A);delete v[D]}}}return B};this.size=function(){var B=0,A=w.length;while(A--){B+=w[A].entries.length}return B};this.each=function(D){var A=x.entries(),B=A.length,C;while(B--){C=A[B];D(C[0],C[1])}};this.putAll=function(I,D){var C=I.entries();var F,G,E,A,B=C.length;var H=(typeof D==q);while(B--){F=C[B];G=F[0];E=F[1];if(H&&(A=x.get(G))){E=D(G,A,E)}x.put(G,E)}};this.clone=function(){var A=new c(u,s);A.putAll(x);return A};this.toString=function(){var A="";var C=this.keys();for(var B=0;B<C.length;B++){var D=this.get(C[B]);A+=C[B].toString()+" = "+D.toString()+"\n"}return A}}return c})();gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:false,isiPhone4:false,isiPad:false,isiPod:false,isAndroid:false,isTouch:false,isFirefox:false,isChrome:false,isOpera:false,isIE:false,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:false,canPlayOgg:false,canPlayMP3:false,canPlayWav:false,init:function(){this.pixelRatio=window.devicePixelRatio||1;this.isiPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.isiPod=navigator.userAgent.toLowerCase().indexOf("ipod")!=-1;this.isiPhone4=(this.pixelRatio==2&&this.isiPhone);this.isiPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;this.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")!=-1;this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1;this.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")!=-1;this.isOpera=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;this.isTouch="ontouchstart" in document.documentElement;this.isiOS=(this.isiPhone||this.iPad||this.isiPod);if(window.performance!=undefined){this.hasMemoryProfiling=(window.performance.memory)}if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){this.ieVersion=new Number(RegExp.$1);this.isIE=true}var b=new Audio();if(b.canPlayType("audio/ogg")){this.canPlayOgg=true}if(b.canPlayType("audio/mpeg")){this.canPlayMP3=true}if(b.canPlayType("audio/x-wav")){this.canPlayWav=true}this.requestAnimFrame=(function(){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,d){window.setTimeout(e,16,Date.now())};return function(e,d){c.apply(window,[e,d])}})()},canPlay:function(b){if(b.toLowerCase()==="mp3"&&this.canPlayMP3){return true}if(b.toLowerCase()==="ogg"&&this.canPlayOgg){return true}if(b.toLowerCase()==="wav"&&this.canPlayWav){return true}return false},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{});gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(b){this.description=b;this.start();this.Class.history.push(this)},start:function(){this.timeStart=Date.now();this.memStart=gamecore.Device.getUsedHeap()},end:function(){this.timeEnd=Date.now();this.timeDelta=this.timeEnd-this.timeStart;this.memEnd=gamecore.Device.getUsedHeap();if(this.memEnd<this.memStart){this.memDelta=0}else{this.memDelta=this.memEnd-this.memStart}return this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(this.memDelta==0?"unknown":this.memDelta)+" byte(s)"}});gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:true,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}});gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super();this.objToNodeMap=new gamecore.Hashtable()},getNode:function(b){return this.objToNodeMap.get(b.getUniqueId())},addNode:function(c){var b=new gamecore.LinkedNode();b.obj=c;b.prevLinked=null;b.nextLinked=null;b.free=false;this.objToNodeMap.put(c.getUniqueId(),b);return b},add:function(c){var b=this.getNode(c);if(b==null){b=this.addNode(c)}else{if(b.free==false){throw"Attempting to add object: "+c.getUniqueId()+" twice to list "+this.getUniqueId()}b.obj=c;b.free=false;b.nextLinked=null;b.prevLinked=null}if(this.first==null){this.first=b;this.last=b;b.nextLinked=null;b.prevLinked=null}else{if(this.last==null){throw"Hmm, no last in the list -- that shouldn't happen here"}this.last.nextLinked=b;b.prevLinked=this.last;this.last=b;b.nextLinked=null}this.count++;if(this.showDebug){this.dump("after add")}},has:function(c){var b=this.getNode(c);return !(b==null||b.free==true)},moveUp:function(f){this.dump("before move up");var h=this.getNode(f);if(!h){throw"Oops, trying to move an object that isn't in the list"}if(h.prevLinked==null){return}var d=h.prevLinked;var e=d.prevLinked;if(h==this.last){this.last=d}var g=h.nextLinked;if(e){e.nextLinked=h}h.nextLinked=d;h.prevLinked=d.prevLinked;d.nextLinked=g;d.prevLinked=h;if(this.first==d){this.first=h}},moveDown:function(e){var d=this.getNode(e);if(!d){throw"Oops, trying to move an object that isn't in the list"}if(d.nextLinked==null){return}var f=d.nextLinked;this.moveUp(f.obj);if(this.last==f){this.last=d}},sort:function(e){var c=[];var d=this.first;while(d){c.push(d.object());d=d.next()}this.clear();c.sort(e);for(var b=0;b<c.length;b++){this.add(c[b])}},remove:function(c){if(this.showDebug){this.dump("before remove of "+c)}var b=this.getNode(c);if(b==null||b.free==true){return false}if(b.prevLinked!=null){b.prevLinked.nextLinked=b.nextLinked}if(b.nextLinked!=null){b.nextLinked.prevLinked=b.prevLinked}if(b.prevLinked==null){this.first=b.nextLinked}if(b.nextLinked==null){this.last=b.prevLinked}b.free=true;b.prevLinked=null;b.nextLinked=null;this.count--;if(this.showDebug){this.dump("after remove")}return true},clear:function(){var b=this.first;while(b!=null){b.free=true;b=b.nextLinked}this.first=null;this.count=0},length:function(){return this.count},dump:function(c){this.debug("===================="+c+"=====================");var b=this.first;while(b!=null){this.debug("{"+b.obj.toString()+"} previous="+(b.prevLinked?b.prevLinked.obj:"NULL"));b=b.next()}this.debug("===================================");this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}});gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable()},add:function(c,b){var d=this.hashtable.get(c);if(d==null){d=new pc.LinkedList();this.hashtable.put(c,d)}d.add(b)},remove:function(c,b){var d=this.hashtable.get(c);if(d==null){throw"No list for a key in hashlist when removing"}d.remove(b)},get:function(b){return this.hashtable.get(b)}});function printStackTrace(c){c=c||{guess:true};var d=c.e||null,f=!!c.guess;var e=new printStackTrace.implementation(),b=e.run(d);return(f)?e.guessAnonymousFunctions(b):b}printStackTrace.implementation=function(){};printStackTrace.implementation.prototype={run:function(b,c){b=b||this.createException();c=c||this.mode(b);if(c==="other"){return this.other(arguments.callee)}else{return this[c](b)}},createException:function(){try{this.undef()}catch(b){return b}},mode:function(b){if(b["arguments"]&&b.stack){return"chrome"}else{if(typeof b.message==="string"&&typeof window!=="undefined"&&window.opera){if(!b.stacktrace){return"opera9"}if(b.message.indexOf("\n")>-1&&b.message.split("\n").length>b.stacktrace.split("\n").length){return"opera9"}if(!b.stack){return"opera10a"}if(b.stacktrace.indexOf("called from line")<0){return"opera10b"}return"opera11"}else{if(b.stack){return"firefox"}}}return"other"},instrumentFunction:function(c,e,f){c=c||window;var b=c[e];c[e]=function d(){f.call(this,printStackTrace().slice(4));return c[e]._instrumented.apply(this,arguments)};c[e]._instrumented=b},deinstrumentFunction:function(b,c){if(b[c].constructor===Function&&b[c]._instrumented&&b[c]._instrumented.constructor===Function){b[c]=b[c]._instrumented}},chrome:function(c){var b=(c.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");b.pop();return b},firefox:function(b){return b.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(h){var b="{anonymous}",j=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var l=h.stacktrace.split("\n"),m=[];for(var d=0,g=l.length;d<g;d+=2){var f=j.exec(l[d]);if(f){var k=f[4]+":"+f[1]+":"+f[2];var c=f[3]||"global code";c=c.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,b);m.push(c+"@"+k+" -- "+l[d+1].replace(/^\s+/,""))}}return m},opera10b:function(j){var h=/^(.*)@(.+):(\d+)$/;var d=j.stacktrace.split("\n"),c=[];for(var g=0,b=d.length;g<b;g++){var f=h.exec(d[g]);if(f){var k=f[1]?(f[1]+"()"):"global code";c.push(k+"@"+f[2]+":"+f[3])}}return c},opera10a:function(h){var b="{anonymous}",j=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var k=h.stacktrace.split("\n"),l=[];for(var d=0,g=k.length;d<g;d+=2){var f=j.exec(k[d]);if(f){var c=f[3]||b;l.push(c+"()@"+f[2]+":"+f[1]+" -- "+k[d+1].replace(/^\s+/,""))}}return l},opera9:function(k){var f="{anonymous}",j=/Line (\d+).*script (?:in )?(\S+)/i;var d=k.message.split("\n"),c=[];for(var h=2,b=d.length;h<b;h+=2){var g=j.exec(d[h]);if(g){c.push(f+"()@"+g[2]+":"+g[1]+" -- "+d[h+1].replace(/^\s+/,""))}}return c},other:function(h){var c="{anonymous}",g=/function\s*([\w\-$]+)?\s*\(/i,b=[],e,d,f=10;while(h&&h["arguments"]&&b.length<f){e=g.test(h.toString())?RegExp.$1||c:c;d=Array.prototype.slice.call(h["arguments"]||[]);b[b.length]=e+"("+this.stringifyArguments(d)+")";h=h.caller}return b},stringifyArguments:function(d){var c=[];var f=Array.prototype.slice;for(var e=0;e<d.length;++e){var b=d[e];if(b===undefined){c[e]="undefined"}else{if(b===null){c[e]="null"}else{if(b.constructor){if(b.constructor===Array){if(b.length<3){c[e]="["+this.stringifyArguments(b)+"]"}else{c[e]="["+this.stringifyArguments(f.call(b,0,1))+"..."+this.stringifyArguments(f.call(b,-1))+"]"}}else{if(b.constructor===Object){c[e]="#object"}else{if(b.constructor===Function){c[e]="#function"}else{if(b.constructor===String){c[e]='"'+b+'"'}else{if(b.constructor===Number){c[e]=b}}}}}}}}}return c.join(",")},sourceCache:{},ajax:function(b){var c=this.createXMLHTTPObject();if(c){try{c.open("GET",b,false);c.send(null);return c.responseText}catch(d){}}return""},createXMLHTTPObject:function(){var d,b=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var c=0;c<b.length;c++){try{d=b[c]();this.createXMLHTTPObject=b[c];return d}catch(f){}}},isSameDomain:function(b){return typeof location!=="undefined"&&b.indexOf(location.hostname)!==-1},getSource:function(b){if(!(b in this.sourceCache)){this.sourceCache[b]=this.ajax(b).split("\n")}return this.sourceCache[b]},guessAnonymousFunctions:function(l){for(var h=0;h<l.length;++h){var g=/\{anonymous\}\(.*\)@(.*)/,n=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,c=l[h],d=g.exec(c);if(d){var f=n.exec(d[1]);if(f){var e=f[1],b=f[2],k=f[3]||0;if(e&&this.isSameDomain(e)&&b){var j=this.guessAnonymousFunction(e,b,k);l[h]=c.replace("{anonymous}",j)}}}}return l},guessAnonymousFunction:function(d,g,b){var c;try{c=this.findFunctionName(this.getSource(d),g)}catch(f){c="getSource failed with url: "+d+", exception: "+f.toString()}return c},findFunctionName:function(b,f){var h=/function\s+([^(]*?)\s*\(([^)]*)\)/;var l=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;var j=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var c="",n,k=Math.min(f,20),e,d;for(var g=0;g<k;++g){n=b[f-g-1];d=n.indexOf("//");if(d>=0){n=n.substr(0,d)}if(n){c=n+c;e=l.exec(c);if(e&&e[1]){return e[1]}e=h.exec(c);if(e&&e[1]){return e[1]}e=j.exec(c);if(e&&e[1]){return e[1]}}}return"(?)"}};gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable(),totalPooled:0,totalUsed:0,acquire:function(c){var b=this.getPool(c);if(b==undefined||b==null){b=new gamecore.Pool(c,this.INITIAL_POOL_SIZE);this.pools.put(c.fullName,b)}return b.acquire()},release:function(c){var b=this.pools.get(c.Class.fullName);if(b==undefined){throw"Oops, trying to release an object of type "+c.Class.fullName+" but no pool exists. Did you new an object instead of using create."}b.release(c)},getPool:function(b){return this.pools.get(b.fullName)},getStats:function(){var e="";var f=this.pools.keys();for(var d=0;d<f.length;d++){var c=f[d];var b=this.pools.get(c);e+=c+": "+b.getStats()+"\n"}return e}},{freeList:null,expansion:1,traces:null,init:function(c,b){this._super();this.classType=c;this.freeList=[];this.expand(b)},startTracing:function(){if(this.tracing){return}this.tracing=true;if(this.traces){this.traces.clear()}else{this.traces=new gamecore.Hashtable()}},stopTracing:function(){this.tracing=false},expand:function(c){gamecore.Pool.totalPooled+=c;for(var b=0;b<c;b++){this.freeList.push(new this.classType())}},getFreeCount:function(){return this.freeList.length},acquire:function(){if(this.freeList.length<=0){this.expansion=Math.round(this.expansion*1.2)+1;this.expand(this.expansion)}if(this.tracing){var b=printStackTrace();var d=b.length-1;while(b[d].indexOf("Class.addTo")==0&&d>0){d--}var c=this.traces.get(b[d]);if(c==null){this.traces.put(b[d],{value:1})}else{c.value++}}return this.freeList.pop()},release:function(b){this.freeList.push(b)},getStats:function(){var d=this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){d+="TRACING\n";var c=this.traces.keys();for(var b in c){d+=c[b]+" ("+this.traces.get(c[b]).value+")\n"}}return d},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}});gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(c){var b=this.getPool(c);if(b==undefined||b==null){b=new gamecore.DualPool(c,this.INITIAL_POOL_SIZE);this.pools.put(c.fullName,b)}return b.acquire()},getStats:function(){var e="";var f=this.pools.keys();for(var d=0;d<f.length;d++){var c=f[d];var b=this.pools.get(c);e+=c+" (free: "+b.freeList.length()+" used: "+b.usedList.length()+")\n"}return e}},{freeList:null,usedList:null,init:function(c,b){this.classType=c;this.usedList=new gamecore.LinkedList();this.freeList=new gamecore.LinkedList();this.expand(b)},expand:function(c){gamecore.Pool.totalPooled+=c;for(var b=0;b<c;b++){this.freeList.add(new this.classType())}},returnObj:null,acquire:function(){if(this.freeList.first==null){this.expand(Math.round(this.size()/5)+1)}this.returnObj=this.freeList.first.obj;this.freeList.remove(this.returnObj);this.returnObj.destroyed=false;this.usedList.add(this.returnObj);if(this.tracing){var b=printStackTrace();var d=b.length-1;while(b[d].indexOf("Class.addTo")==0&&d>0){d--}var c=this.traces.get(b[d]);if(c==null){this.traces.put(b[d],{value:1})}else{c.value++}}return this.returnObj},release:function(b){this.freeList.add(b);this.usedList.remove(b)},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump();this.info("USED");this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}});gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:false,init:function(){this._super()},release:function(){this.onRelease();gamecore.Pool.release(this)},onRelease:function(){}});gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:false,init:function(){this._super()},release:function(){this.onRelease();gamecore.DualPool.release(this)},onRelease:function(){}});goog={inherits:function(e,d){function f(){}f.prototype=d.prototype;e.superClass_=d.prototype;e.prototype=new f;e.prototype.constructor=e}};goog.debug={};goog.debug.Error=function(b){this.stack=Error().stack||"";b&&(this.message=""+b)};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.string={};goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(d,c){return 0==d.lastIndexOf(c,0)};goog.string.endsWith=function(e,d){var f=e.length-d.length;return 0<=f&&e.indexOf(d,f)==f};goog.string.caseInsensitiveStartsWith=function(d,c){return 0==goog.string.caseInsensitiveCompare(c,d.substr(0,c.length))};goog.string.caseInsensitiveEndsWith=function(d,c){return 0==goog.string.caseInsensitiveCompare(c,d.substr(d.length-c.length,c.length))};goog.string.subs=function(f,e){for(var h=1;h<arguments.length;h++){var g=(""+arguments[h]).replace(/\$/g,"$$$$"),f=f.replace(/\%s/,g)}return f};goog.string.collapseWhitespace=function(b){return b.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmpty=function(b){return/^[\s\xa0]*$/.test(b)};goog.string.isEmptySafe=function(b){return goog.string.isEmpty(goog.string.makeSafe(b))};goog.string.isBreakingWhitespace=function(b){return !/[^\t\n\r ]/.test(b)};goog.string.isAlpha=function(b){return !/[^a-zA-Z]/.test(b)};goog.string.isNumeric=function(b){return !/[^0-9]/.test(b)};goog.string.isAlphaNumeric=function(b){return !/[^a-zA-Z0-9]/.test(b)};goog.string.isSpace=function(b){return" "==b};goog.string.isUnicodeChar=function(b){return 1==b.length&&" "<=b&&"~">=b||"\u0080"<=b&&"\ufffd">=b};goog.string.stripNewlines=function(b){return b.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(b){return b.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(b){return b.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(b){return b.replace(/\xa0|[ \t]+/g," ")};goog.string.collapseBreakingSpaces=function(b){return b.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=function(b){return b.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(b){return b.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(b){return b.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(f,e){var h=(""+f).toLowerCase(),g=(""+e).toLowerCase();return h<g?-1:h==g?0:1};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;goog.string.numerateCompare=function(j,i){if(j==i){return 0}if(!j){return -1}if(!i){return 1}for(var p=j.toLowerCase().match(goog.string.numerateCompareRegExp_),o=i.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(p.length,o.length),m=0;m<n;m++){var l=p[m],k=o[m];if(l!=k){return p=parseInt(l,10),!isNaN(p)&&(o=parseInt(k,10),!isNaN(o)&&p-o)?p-o:l<k?-1:1}}return p.length!=o.length?p.length-o.length:j<i?-1:1};goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/;goog.string.urlEncode=function(b){b=""+b;return !goog.string.encodeUriRegExp_.test(b)?encodeURIComponent(b):b};goog.string.urlDecode=function(b){return decodeURIComponent(b.replace(/\+/g," "))};goog.string.newLineToBr=function(d,c){return d.replace(/(\r\n|\r|\n)/g,c?"<br />":"<br>")};goog.string.htmlEscape=function(d,c){if(c){return d.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;")}if(!goog.string.allRe_.test(d)){return d}-1!=d.indexOf("&")&&(d=d.replace(goog.string.amperRe_,"&amp;"));-1!=d.indexOf("<")&&(d=d.replace(goog.string.ltRe_,"&lt;"));-1!=d.indexOf(">")&&(d=d.replace(goog.string.gtRe_,"&gt;"));-1!=d.indexOf('"')&&(d=d.replace(goog.string.quotRe_,"&quot;"));return d};goog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/\"/g;goog.string.allRe_=/[&<>\"]/;goog.string.unescapeEntities=function(b){return goog.string.contains(b,"&")?"document" in goog.global?goog.string.unescapeEntitiesUsingDom_(b):goog.string.unescapePureXmlEntities_(b):b};goog.string.unescapeEntitiesUsingDom_=function(e){var d={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},f=document.createElement("div");return e.replace(goog.string.HTML_ENTITY_PATTERN_,function(b,i){var h=d[b];if(h){return h}if("#"==i.charAt(0)){var c=Number("0"+i.substr(1));isNaN(c)||(h=String.fromCharCode(c))}h||(f.innerHTML=b+" ",h=f.firstChild.nodeValue.slice(0,-1));return d[b]=h})};goog.string.unescapePureXmlEntities_=function(b){return b.replace(/&([^;]+);/g,function(e,g){switch(g){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==g.charAt(0)){var f=Number("0"+g.substr(1));if(!isNaN(f)){return String.fromCharCode(f)}}return e}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(d,c){return goog.string.newLineToBr(d.replace(/  /g," &#160;"),c)};goog.string.stripQuotes=function(g,f){for(var j=f.length,i=0;i<j;i++){var h=1==j?f:f.charAt(i);if(g.charAt(0)==h&&g.charAt(g.length-1)==h){return g.substring(1,g.length-1)}}return g};goog.string.truncate=function(e,d,f){f&&(e=goog.string.unescapeEntities(e));e.length>d&&(e=e.substring(0,d-3)+"...");f&&(e=goog.string.htmlEscape(e));return e};goog.string.truncateMiddle=function(g,f,j,i){j&&(g=goog.string.unescapeEntities(g));if(i&&g.length>f){i>f&&(i=f);var h=g.length-i,g=g.substring(0,f-i)+"..."+g.substring(h)}else{g.length>f&&(i=Math.floor(f/2),h=g.length-i,g=g.substring(0,i+f%2)+"..."+g.substring(h))}j&&(g=goog.string.htmlEscape(g));return g};goog.string.specialEscapeChars_={"\x00":"\\0","\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};goog.string.quote=function(g){g=""+g;if(g.quote){return g.quote()}for(var f=['"'],j=0;j<g.length;j++){var i=g.charAt(j),h=i.charCodeAt(0);f[j+1]=goog.string.specialEscapeChars_[i]||(31<h&&127>h?i:goog.string.escapeChar(i))}f.push('"');return f.join("")};goog.string.escapeString=function(e){for(var d=[],f=0;f<e.length;f++){d[f]=goog.string.escapeChar(e.charAt(f))}return d.join("")};goog.string.escapeChar=function(e){if(e in goog.string.jsEscapeCache_){return goog.string.jsEscapeCache_[e]}if(e in goog.string.specialEscapeChars_){return goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e]}var d=e,f=e.charCodeAt(0);if(31<f&&127>f){d=e}else{if(256>f){if(d="\\x",16>f||256<f){d+="0"}}else{d="\\u",4096>f&&(d+="0")}d+=f.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[e]=d};goog.string.toMap=function(e){for(var d={},f=0;f<e.length;f++){d[e.charAt(f)]=!0}return d};goog.string.contains=function(d,c){return -1!=d.indexOf(c)};goog.string.removeAt=function(f,e,h){var g=f;0<=e&&(e<f.length&&0<h)&&(g=f.substr(0,e)+f.substr(e+h,f.length-e-h));return g};goog.string.remove=function(e,d){var f=RegExp(goog.string.regExpEscape(d),"");return e.replace(f,"")};goog.string.removeAll=function(e,d){var f=RegExp(goog.string.regExpEscape(d),"g");return e.replace(f,"")};goog.string.regExpEscape=function(b){return(""+b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(d,c){return Array(c+1).join(d)};goog.string.padNumber=function(e,d,f){e=goog.isDef(f)?e.toFixed(f):""+e;f=e.indexOf(".");-1==f&&(f=e.length);return goog.string.repeat("0",Math.max(0,d-f))+e};goog.string.makeSafe=function(b){return null==b?"":""+b};goog.string.buildString=function(b){return Array.prototype.join.call(arguments,"")};goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)};goog.string.compareVersions=function(B,A){for(var z=0,y=goog.string.trim(""+B).split("."),x=goog.string.trim(""+A).split("."),w=Math.max(y.length,x.length),v=0;0==z&&v<w;v++){var u=y[v]||"",t=x[v]||"",s=RegExp("(\\d*)(\\D*)","g"),r=RegExp("(\\d*)(\\D*)","g");do{var q=s.exec(u)||["","",""],o=r.exec(t)||["","",""];if(0==q[0].length&&0==o[0].length){break}var z=0==q[1].length?0:parseInt(q[1],10),p=0==o[1].length?0:parseInt(o[1],10),z=goog.string.compareElements_(z,p)||goog.string.compareElements_(0==q[2].length,0==o[2].length)||goog.string.compareElements_(q[2],o[2])}while(0==z)}return z};goog.string.compareElements_=function(d,c){return d<c?-1:d>c?1:0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(e){for(var d=0,f=0;f<e.length;++f){d=31*d+e.charCodeAt(f),d%=goog.string.HASHCODE_MAX_}return d};goog.string.uniqueStringCounter_=2147483648*Math.random()|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};goog.string.toNumber=function(d){var c=Number(d);return 0==c&&goog.string.isEmpty(d)?NaN:c};goog.string.toCamelCaseCache_={};goog.string.toCamelCase=function(b){return goog.string.toCamelCaseCache_[b]||(goog.string.toCamelCaseCache_[b]=(""+b).replace(/\-([a-z])/g,function(d,e){return e.toUpperCase()}))};goog.string.toSelectorCaseCache_={};goog.string.toSelectorCase=function(b){return goog.string.toSelectorCaseCache_[b]||(goog.string.toSelectorCaseCache_[b]=(""+b).replace(/([A-Z])/g,"-$1").toLowerCase())};goog.array={};goog.NATIVE_ARRAY_PROTOTYPES=!0;goog.array.peek=function(b){return b[b.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,d,f)}:function(e,d,f){f=null==f?0:0>f?Math.max(0,e.length+f):f;if(goog.isString(e)){return !goog.isString(d)||1!=d.length?-1:e.indexOf(d,f)}for(;f<e.length;f++){if(f in e&&e[f]===d){return f}}return -1};goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,d,null==f?e.length-1:f)}:function(e,d,f){f=null==f?e.length-1:f;0>f&&(f=Math.max(0,e.length+f));if(goog.isString(e)){return !goog.isString(d)||1!=d.length?-1:e.lastIndexOf(d,f)}for(;0<=f;f--){if(f in e&&e[f]===d){return f}}return -1};goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(e,d,f){goog.array.ARRAY_PROTOTYPE_.forEach.call(e,d,f)}:function(h,g,l){for(var k=h.length,j=goog.isString(h)?h.split(""):h,i=0;i<k;i++){i in j&&g.call(l,j[i],i,h)}};goog.array.forEachRight=function(g,f,j){for(var i=g.length,h=goog.isString(g)?g.split(""):g,i=i-1;0<=i;--i){i in h&&f.call(j,h[i],i,g)}};goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.filter.call(e,d,f)}:function(r,q,p){for(var o=r.length,n=[],m=0,l=goog.isString(r)?r.split(""):r,k=0;k<o;k++){if(k in l){var j=l[k];q.call(p,j,k,r)&&(n[m++]=j)}}return n};goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.map.call(e,d,f)}:function(i,h,n){for(var m=i.length,l=Array(m),k=goog.isString(i)?i.split(""):i,j=0;j<m;j++){j in k&&(l[j]=h.call(n,k[j],j,i))}return l};goog.array.reduce=function(g,f,j,i){if(g.reduce){return i?g.reduce(goog.bind(f,i),j):g.reduce(f,j)}var h=j;goog.array.forEach(g,function(d,b){h=f.call(i,h,d,b,g)});return h};goog.array.reduceRight=function(g,f,j,i){if(g.reduceRight){return i?g.reduceRight(goog.bind(f,i),j):g.reduceRight(f,j)}var h=j;goog.array.forEachRight(g,function(d,b){h=f.call(i,h,d,b,g)});return h};goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.some.call(e,d,f)}:function(h,g,l){for(var k=h.length,j=goog.isString(h)?h.split(""):h,i=0;i<k;i++){if(i in j&&g.call(l,j[i],i,h)){return !0}}return !1};goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(e,d,f){return goog.array.ARRAY_PROTOTYPE_.every.call(e,d,f)}:function(h,g,l){for(var k=h.length,j=goog.isString(h)?h.split(""):h,i=0;i<k;i++){if(i in j&&!g.call(l,j[i],i,h)){return !1}}return !0};goog.array.find=function(e,d,f){d=goog.array.findIndex(e,d,f);return 0>d?null:goog.isString(e)?e.charAt(d):e[d]};goog.array.findIndex=function(h,g,l){for(var k=h.length,j=goog.isString(h)?h.split(""):h,i=0;i<k;i++){if(i in j&&g.call(l,j[i],i,h)){return i}}return -1};goog.array.findRight=function(e,d,f){d=goog.array.findIndexRight(e,d,f);return 0>d?null:goog.isString(e)?e.charAt(d):e[d]};goog.array.findIndexRight=function(g,f,j){for(var i=g.length,h=goog.isString(g)?g.split(""):g,i=i-1;0<=i;i--){if(i in h&&f.call(j,h[i],i,g)){return i}}return -1};goog.array.contains=function(d,c){return 0<=goog.array.indexOf(d,c)};goog.array.isEmpty=function(b){return 0==b.length};goog.array.clear=function(d){if(!goog.isArray(d)){for(var c=d.length-1;0<=c;c--){delete d[c]}}d.length=0};goog.array.insert=function(d,c){goog.array.contains(d,c)||d.push(c)};goog.array.insertAt=function(e,d,f){goog.array.splice(e,f,0,d)};goog.array.insertArrayAt=function(e,d,f){goog.partial(goog.array.splice,e,f,0).apply(null,d)};goog.array.insertBefore=function(f,e,h){var g;2==arguments.length||0>(g=goog.array.indexOf(f,h))?f.push(e):goog.array.insertAt(f,e,g)};goog.array.remove=function(f,e){var h=goog.array.indexOf(f,e),g;(g=0<=h)&&goog.array.removeAt(f,h);return g};goog.array.removeAt=function(d,c){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(d,c,1).length};goog.array.removeIf=function(e,d,f){d=goog.array.findIndex(e,d,f);return 0<=d?(goog.array.removeAt(e,d),!0):!1};goog.array.concat=function(b){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.clone=function(f){if(goog.isArray(f)){return goog.array.concat(f)}for(var e=[],h=0,g=f.length;h<g;h++){e[h]=f[h]}return e};goog.array.toArray=function(b){return goog.isArray(b)?goog.array.concat(b):goog.array.clone(b)};goog.array.extend=function(j,i){for(var p=1;p<arguments.length;p++){var o=arguments[p],n;if(goog.isArray(o)||(n=goog.isArrayLike(o))&&o.hasOwnProperty("callee")){j.push.apply(j,o)}else{if(n){for(var m=j.length,l=o.length,k=0;k<l;k++){j[m+k]=o[k]}}else{j.push(o)}}}};goog.array.splice=function(f,e,h,g){return goog.array.ARRAY_PROTOTYPE_.splice.apply(f,goog.array.slice(arguments,1))};goog.array.slice=function(e,d,f){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(e,d):goog.array.ARRAY_PROTOTYPE_.slice.call(e,d,f)};goog.array.removeDuplicates=function(j,i){for(var p=i||j,o={},n=0,m=0;m<j.length;){var l=j[m++],k=goog.isObject(l)?"o"+goog.getUid(l):(typeof l).charAt(0)+l;Object.prototype.hasOwnProperty.call(o,k)||(o[k]=!0,p[n++]=l)}p.length=n};goog.array.binarySearch=function(e,d,f){return goog.array.binarySearch_(e,f||goog.array.defaultCompare,!1,d)};goog.array.binarySelect=function(e,d,f){return goog.array.binarySearch_(e,d,!0,void 0,f)};goog.array.binarySearch_=function(t,s,r,q,p){for(var o=0,n=t.length,m;o<n;){var l=o+n>>1,k;k=r?s.call(p,t[l],l,t):s(q,t[l]);0<k?o=l+1:(n=l,m=!k)}return m?o:~o};goog.array.sort=function(d,c){goog.array.ARRAY_PROTOTYPE_.sort.call(d,c||goog.array.defaultCompare)};goog.array.stableSort=function(f,e){for(var h=0;h<f.length;h++){f[h]={index:h,value:f[h]}}var g=e||goog.array.defaultCompare;goog.array.sort(f,function(d,c){return g(d.value,c.value)||d.index-c.index});for(h=0;h<f.length;h++){f[h]=f[h].value}};goog.array.sortObjectsByKey=function(f,e,h){var g=h||goog.array.defaultCompare;goog.array.sort(f,function(b,d){return g(b[e],d[e])})};goog.array.isSorted=function(g,f,j){for(var f=f||goog.array.defaultCompare,i=1;i<g.length;i++){var h=f(g[i-1],g[i]);if(0<h||0==h&&j){return !1}}return !0};goog.array.equals=function(g,f,j){if(!goog.isArrayLike(g)||!goog.isArrayLike(f)||g.length!=f.length){return !1}for(var i=g.length,j=j||goog.array.defaultCompareEquality,h=0;h<i;h++){if(!j(g[h],f[h])){return !1}}return !0};goog.array.compare=function(e,d,f){return goog.array.equals(e,d,f)};goog.array.compare3=function(h,g,l){for(var l=l||goog.array.defaultCompare,k=Math.min(h.length,g.length),j=0;j<k;j++){var i=l(h[j],g[j]);if(0!=i){return i}}return goog.array.defaultCompare(h.length,g.length)};goog.array.defaultCompare=function(d,c){return d>c?1:d<c?-1:0};goog.array.defaultCompareEquality=function(d,c){return d===c};goog.array.binaryInsert=function(e,d,f){f=goog.array.binarySearch(e,d,f);return 0>f?(goog.array.insertAt(e,d,-(f+1)),!0):!1};goog.array.binaryRemove=function(e,d,f){d=goog.array.binarySearch(e,d,f);return 0<=d?goog.array.removeAt(e,d):!1};goog.array.bucket=function(h,g){for(var l={},k=0;k<h.length;k++){var j=h[k],i=g(j,k,h);goog.isDef(i)&&(l[i]||(l[i]=[])).push(j)}return l};goog.array.repeat=function(f,e){for(var h=[],g=0;g<e;g++){h[g]=f}return h};goog.array.flatten=function(f){for(var e=[],h=0;h<arguments.length;h++){var g=arguments[h];goog.isArray(g)?e.push.apply(e,goog.array.flatten.apply(null,g)):e.push(g)}return e};goog.array.rotate=function(d,c){d.length&&(c%=d.length,0<c?goog.array.ARRAY_PROTOTYPE_.unshift.apply(d,d.splice(-c,c)):0>c&&goog.array.ARRAY_PROTOTYPE_.push.apply(d,d.splice(0,-c)));return d};goog.array.zip=function(h){if(!arguments.length){return[]}for(var g=[],l=0;;l++){for(var k=[],j=0;j<arguments.length;j++){var i=arguments[j];if(l>=i.length){return g}k.push(i[l])}g.push(k)}};goog.array.shuffle=function(h,g){for(var l=g||Math.random,k=h.length-1;0<k;k--){var j=Math.floor(l()*(k+1)),i=h[k];h[k]=h[j];h[j]=i}};goog.structs={};goog.structs.Queue=function(){this.elements_=[]};goog.structs.Queue.prototype.head_=0;goog.structs.Queue.prototype.tail_=0;goog.structs.Queue.prototype.enqueue=function(b){this.elements_[this.tail_++]=b};goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var b=this.elements_[this.head_];delete this.elements_[this.head_];this.head_++;return b}};goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]};goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_};goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_};goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0};goog.structs.Queue.prototype.contains=function(b){return goog.array.contains(this.elements_,b)};goog.structs.Queue.prototype.remove=function(b){b=goog.array.indexOf(this.elements_,b);if(0>b){return !1}b==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,b),this.tail_--);return !0};goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};var Box2D={Common:{}};Box2D.Common.Math={};Box2D.Common.Math.b2Vec2=function(d,c){this.x=d;this.y=c};Box2D.Common.Math.b2Vec2._freeCache=[];Box2D.Common.Math.b2Vec2.Get=function(e,d){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var f=Box2D.Common.Math.b2Vec2._freeCache.pop();f.Set(e,d);return f}return new Box2D.Common.Math.b2Vec2(e,d)};Box2D.Common.Math.b2Vec2.Free=function(b){null!=b&&(Box2D.Common.Math.b2Vec2._freeCache.push(b))};Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.y=this.x=0};Box2D.Common.Math.b2Vec2.prototype.Set=function(d,c){this.x=d;this.y=c};Box2D.Common.Math.b2Vec2.prototype.SetV=function(b){this.x=b.x;this.y=b.y};Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)};Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)};Box2D.Common.Math.b2Vec2.prototype.Add=function(b){this.x+=b.x;this.y+=b.y};Box2D.Common.Math.b2Vec2.prototype.Subtract=function(b){this.x-=b.x;this.y-=b.y};Box2D.Common.Math.b2Vec2.prototype.Multiply=function(b){this.x*=b;this.y*=b};Box2D.Common.Math.b2Vec2.prototype.MulM=function(d){var c=this.x;this.x=d.col1.x*c+d.col2.x*this.y;this.y=d.col1.y*c+d.col2.y*this.y};Box2D.Common.Math.b2Vec2.prototype.MulTM=function(d){var c=this.x*d.col1.x+this.y*d.col1.y;this.y=this.x*d.col2.x+this.y*d.col2.y;this.x=c};Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(d){var c=this.x;this.x=d*this.y;this.y=-d*c};Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(d){var c=this.x;this.x=-d*this.y;this.y=d*c};Box2D.Common.Math.b2Vec2.prototype.MinV=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y)};Box2D.Common.Math.b2Vec2.prototype.MaxV=function(b){this.x=Math.max(this.x,b.x);this.y=Math.max(this.y,b.y)};Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y)};Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())};Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var d=this.Length();if(d<Number.MIN_VALUE){return 0}var c=1/d;this.x*=c;this.y*=c;return d};Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)};Box2D.Common.b2Settings={};Box2D.Common.b2Settings.b2MixFriction=function(d,c){return Math.sqrt(d*c)};Box2D.Common.b2Settings.b2MixRestitution=function(d,c){return d>c?d:c};Box2D.Common.b2Settings.b2Assert=function(b){if(!b){throw"Assertion Failed"}};Box2D.Common.b2Settings.VERSION="2.1a-playcraft";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI;Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=0.5*Math.PI;Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=0.01;Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI;Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance;Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE;Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0);this.col2=Box2D.Common.Math.b2Vec2.Get(0,0);this.SetIdentity()};Box2D.Common.Math.b2Mat22._freeCache=[];Box2D.Common.Math.b2Mat22.Get=function(){if(0<Box2D.Common.Math.b2Mat22._freeCache.length){var b=Box2D.Common.Math.b2Mat22._freeCache.pop();b.SetZero();return b}return new Box2D.Common.Math.b2Mat22};Box2D.Common.Math.b2Mat22.Free=function(b){null!=b&&(Box2D.Common.Math.b2Mat22._freeCache.push(b))};Box2D.Common.Math.b2Mat22.FromAngle=function(d){var c=Box2D.Common.Math.b2Mat22.Get();c.Set(d);return c};Box2D.Common.Math.b2Mat22.FromVV=function(e,d){var f=Box2D.Common.Math.b2Mat22.Get();f.SetVV(e,d);return f};Box2D.Common.Math.b2Mat22.prototype.Set=function(d){var c=Math.cos(d),d=Math.sin(d);this.col1.Set(c,d);this.col2.Set(-d,c)};Box2D.Common.Math.b2Mat22.prototype.SetVV=function(d,c){this.col1.SetV(d);this.col2.SetV(c)};Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var b=Box2D.Common.Math.b2Mat22.Get();b.SetM(this);return b};Box2D.Common.Math.b2Mat22.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};Box2D.Common.Math.b2Mat22.prototype.AddM=function(b){this.col1.Add(b.col1);this.col2.Add(b.col2)};Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0);this.col2.Set(0,1)};Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0);this.col2.Set(0,0)};Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(d){var c=this.col1.x*this.col2.y-this.col2.x*this.col1.y;0!==c&&(c=1/c);d.col1.x=c*this.col2.y;d.col2.x=-c*this.col2.x;d.col1.y=-c*this.col1.y;d.col2.y=c*this.col1.x;return d};Box2D.Common.Math.b2Mat22.prototype.Solve=function(f,e,h){var g=this.col1.x*this.col2.y-this.col2.x*this.col1.y;0!==g&&(g=1/g);f.x=g*(this.col2.y*e-this.col2.x*h);f.y=g*(this.col1.x*h-this.col1.y*e);return f};Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};Box2D.Common.Math.b2Math={};Box2D.Common.Math.b2Math.Dot=function(d,c){return d.x*c.x+d.y*c.y};Box2D.Common.Math.b2Math.CrossVV=function(d,c){return d.x*c.y-d.y*c.x};Box2D.Common.Math.b2Math.CrossVF=function(d,c){return Box2D.Common.Math.b2Vec2.Get(c*d.y,-c*d.x)};Box2D.Common.Math.b2Math.CrossFV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(-d*c.y,d*c.x)};Box2D.Common.Math.b2Math.MulMV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(d.col1.x*c.x+d.col2.x*c.y,d.col1.y*c.x+d.col2.y*c.y)};Box2D.Common.Math.b2Math.MulTMV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(c,d.col1),Box2D.Common.Math.b2Math.Dot(c,d.col2))};Box2D.Common.Math.b2Math.MulX=function(e,d){var f=Box2D.Common.Math.b2Math.MulMV(e.R,d);f.x+=e.position.x;f.y+=e.position.y;return f};Box2D.Common.Math.b2Math.MulXT=function(f,e){var h=Box2D.Common.Math.b2Math.SubtractVV(e,f.position),g=h.x*f.R.col1.x+h.y*f.R.col1.y;h.y=h.x*f.R.col2.x+h.y*f.R.col2.y;h.x=g;return h};Box2D.Common.Math.b2Math.AddVV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(d.x+c.x,d.y+c.y)};Box2D.Common.Math.b2Math.SubtractVV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(d.x-c.x,d.y-c.y)};Box2D.Common.Math.b2Math.Distance=function(d,c){return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(d,c))};Box2D.Common.Math.b2Math.DistanceSquared=function(f,e){var h=f.x-e.x,g=f.y-e.y;return h*h+g*g};Box2D.Common.Math.b2Math.MulFV=function(d,c){return Box2D.Common.Math.b2Vec2.Get(d*c.x,d*c.y)};Box2D.Common.Math.b2Math.AddMM=function(g,f){var j=Box2D.Common.Math.b2Math.AddVV(g.col1,f.col1),i=Box2D.Common.Math.b2Math.AddVV(g.col2,f.col2),h=Box2D.Common.Math.b2Mat22.FromVV(j,i);Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);return h};Box2D.Common.Math.b2Math.MulMM=function(g,f){var j=Box2D.Common.Math.b2Math.MulMV(g,f.col1),i=Box2D.Common.Math.b2Math.MulMV(g,f.col2),h=Box2D.Common.Math.b2Mat22.FromVV(j,i);Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);return h};Box2D.Common.Math.b2Math.MulTMM=function(g,f){var j=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(g.col1,f.col1),Box2D.Common.Math.b2Math.Dot(g.col2,f.col1)),i=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(g.col1,f.col2),Box2D.Common.Math.b2Math.Dot(g.col2,f.col2)),h=Box2D.Common.Math.b2Mat22.FromVV(j,i);Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);return h};Box2D.Common.Math.b2Math.AbsV=function(b){return Box2D.Common.Math.b2Vec2.Get(Math.abs(b.x),Math.abs(b.y))};Box2D.Common.Math.b2Math.AbsM=function(e){var d=Box2D.Common.Math.b2Math.AbsV(e.col1),e=Box2D.Common.Math.b2Math.AbsV(e.col2),f=Box2D.Common.Math.b2Mat22.FromVV(d,e);Box2D.Common.Math.b2Vec2.Free(d);Box2D.Common.Math.b2Vec2.Free(e);return f};Box2D.Common.Math.b2Math.Clamp=function(e,d,f){return e<d?d:e>f?f:e};Box2D.Common.Math.b2Math.ClampV=function(f,e,h){var g=Box2D.Common.Math.b2Math.Clamp(f.x,e.x,h.x),f=Box2D.Common.Math.b2Math.Clamp(f.y,e.y,h.y);return Box2D.Common.Math.b2Vec2.Get(g,f)};Box2D.Dynamics={};Box2D.Dynamics.Joints={};Box2D.Dynamics.Joints.b2JointEdge=function(){};Box2D.Dynamics.Joints.b2Joint=function(b){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge;this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge;this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Common.b2Settings.b2Assert(b.bodyA!=b.bodyB);this.m_type=b.type;this.m_next=this.m_prev=null;this.m_bodyA=b.bodyA;this.m_bodyB=b.bodyB;this.m_collideConnected=b.collideConnected};Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type};Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null};Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null};Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(){return null};Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(){return 0};Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA};Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB};Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next};Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};Box2D.Dynamics.Joints.b2Joint.Create=function(b){return b.Create()};Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(){};Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(){};Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){};Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(){return !1};Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3;Box2D.Dynamics.Joints.b2LineJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_K=new Box2D.Common.Math.b2Mat22;this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_localXAxis1.SetV(b.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};goog.inherits(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),b*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(b){void 0===b&&(b=0);return b*this.m_impulse.y};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var f=this.m_bodyA,e=this.m_bodyB,h=f.GetWorldPoint(this.m_localAnchor1),g=e.GetWorldPoint(this.m_localAnchor2),e=g.x-h.x,h=g.y-h.y,f=f.GetWorldVector(this.m_localXAxis1);return f.x*e+f.y*h};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var v=this.m_bodyA,u=this.m_bodyB,t;t=v.m_xf.R;var s=this.m_localAnchor1.x-v.m_sweep.localCenter.x,r=this.m_localAnchor1.y-v.m_sweep.localCenter.y,q=t.col1.x*s+t.col2.x*r,r=t.col1.y*s+t.col2.y*r,s=q;t=u.m_xf.R;var p=this.m_localAnchor2.x-u.m_sweep.localCenter.x,o=this.m_localAnchor2.y-u.m_sweep.localCenter.y,q=t.col1.x*p+t.col2.x*o,o=t.col1.y*p+t.col2.y*o,p=q;t=u.m_sweep.c.x+p-(v.m_sweep.c.x+s);var q=u.m_sweep.c.y+o-(v.m_sweep.c.y+r),n=v.GetWorldVector(this.m_localXAxis1),m=v.m_linearVelocity,l=u.m_linearVelocity,v=v.m_angularVelocity,u=u.m_angularVelocity;return t*-v*n.y+q*v*n.x+(n.x*(l.x+-u*o-m.x- -v*r)+n.y*(l.y+u*p-m.y-v*s))};Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit};Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=b};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation};Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(d,c){void 0===d&&(d=0);void 0===c&&(c=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=d;this.m_upperTranslation=c};Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor};Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=b};Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(b){void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=b};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(b){void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=b};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse};Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(t){var s=this.m_bodyA,r=this.m_bodyB,q,p=0;this.m_localCenterA.SetV(s.GetLocalCenter());this.m_localCenterB.SetV(r.GetLocalCenter());var o=s.GetTransform();r.GetTransform();q=s.m_xf.R;var n=this.m_localAnchor1.x-this.m_localCenterA.x,m=this.m_localAnchor1.y-this.m_localCenterA.y,p=q.col1.x*n+q.col2.x*m,m=q.col1.y*n+q.col2.y*m,n=p;q=r.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,k=this.m_localAnchor2.y-this.m_localCenterB.y,p=q.col1.x*l+q.col2.x*k,k=q.col1.y*l+q.col2.y*k,l=p;q=r.m_sweep.c.x+l-s.m_sweep.c.x-n;p=r.m_sweep.c.y+k-s.m_sweep.c.y-m;this.m_invMassA=s.m_invMass;this.m_invMassB=r.m_invMass;this.m_invIA=s.m_invI;this.m_invIB=r.m_invI;this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(o.R,this.m_localXAxis1));this.m_a1=(q+n)*this.m_axis.y-(p+m)*this.m_axis.x;this.m_a2=l*this.m_axis.y-k*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(o.R,this.m_localYAxis1));this.m_s1=(q+n)*this.m_perp.y-(p+m)*this.m_perp.x;this.m_s2=l*this.m_perp.y-k*this.m_perp.x;o=this.m_invMassA;n=this.m_invMassB;m=this.m_invIA;l=this.m_invIB;this.m_K.col1.x=o+n+m*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2;this.m_K.col1.y=m*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=o+n+m*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2;this.m_enableLimit?(q=this.m_axis.x*q+this.m_axis.y*p,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;!1==this.m_enableMotor&&(this.m_motorImpulse=0);t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,q=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,p=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,o=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,s.m_linearVelocity.x-=this.m_invMassA*t,s.m_linearVelocity.y-=this.m_invMassA*q,s.m_angularVelocity-=this.m_invIA*p,r.m_linearVelocity.x+=this.m_invMassB*t,r.m_linearVelocity.y+=this.m_invMassB*q,r.m_angularVelocity+=this.m_invIB*o):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(v){var u=this.m_bodyA,t=this.m_bodyB,s=u.m_linearVelocity,r=u.m_angularVelocity,q=t.m_linearVelocity,p=t.m_angularVelocity,o=0,n=0,m=0,l=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(q.x-s.x)+this.m_axis.y*(q.y-s.y)+this.m_a2*p-this.m_a1*r)),o=this.m_motorImpulse,v=v.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+l,-v,v),l=this.m_motorImpulse-o,o=l*this.m_axis.x,n=l*this.m_axis.y,m=l*this.m_a1,l*=this.m_a2,s.x-=this.m_invMassA*o,s.y-=this.m_invMassA*n,r-=this.m_invIA*m,q.x+=this.m_invMassB*o,q.y+=this.m_invMassB*n,p+=this.m_invIB*l);n=this.m_perp.x*(q.x-s.x)+this.m_perp.y*(q.y-s.y)+this.m_s2*p-this.m_s1*r;this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(v=this.m_axis.x*(q.x-s.x)+this.m_axis.y*(q.y-s.y)+this.m_a2*p-this.m_a1*r,o=this.m_impulse.Copy(),m=Box2D.Common.Math.b2Vec2.Get(0,0),v=this.m_K.Solve(m,-n,-v),Box2D.Common.Math.b2Vec2.Free(m),this.m_impulse.Add(v),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),n=-n-(this.m_impulse.y-o.y)*this.m_K.col2.x,m=0,m=0!=this.m_K.col1.x?n/this.m_K.col1.x+o.x:o.x,this.m_impulse.x=m,v.x=this.m_impulse.x-o.x,v.y=this.m_impulse.y-o.y,Box2D.Common.Math.b2Vec2.Free(o),o=v.x*this.m_perp.x+v.y*this.m_axis.x,n=v.x*this.m_perp.y+v.y*this.m_axis.y,m=v.x*this.m_s1+v.y*this.m_a1,l=v.x*this.m_s2+v.y*this.m_a2):(v=0,v=0!=this.m_K.col1.x?-n/this.m_K.col1.x:0,this.m_impulse.x+=v,o=v*this.m_perp.x,n=v*this.m_perp.y,m=v*this.m_s1,l=v*this.m_s2);s.x-=this.m_invMassA*o;s.y-=this.m_invMassA*n;r-=this.m_invIA*m;q.x+=this.m_invMassB*o;q.y+=this.m_invMassB*n;p+=this.m_invIB*l;u.m_linearVelocity.SetV(s);u.m_angularVelocity=r;t.m_linearVelocity.SetV(q);t.m_angularVelocity=p};Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(){var H=this.m_bodyA,G=this.m_bodyB,F=H.m_sweep.c,E=H.m_sweep.a,D=G.m_sweep.c,C=G.m_sweep.a,B,A=0,z=0,y=0,x=0,w=B=0,u=0,z=!1,v=0,t=Box2D.Common.Math.b2Mat22.FromAngle(E),y=Box2D.Common.Math.b2Mat22.FromAngle(C);B=t;var u=this.m_localAnchor1.x-this.m_localCenterA.x,s=this.m_localAnchor1.y-this.m_localCenterA.y,A=B.col1.x*u+B.col2.x*s,s=B.col1.y*u+B.col2.y*s,u=A;B=y;y=this.m_localAnchor2.x-this.m_localCenterB.x;x=this.m_localAnchor2.y-this.m_localCenterB.y;A=B.col1.x*y+B.col2.x*x;x=B.col1.y*y+B.col2.y*x;y=A;B=D.x+y-F.x-u;A=D.y+x-F.y-s;if(this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(t,this.m_localXAxis1);this.m_a1=(B+u)*this.m_axis.y-(A+s)*this.m_axis.x;this.m_a2=y*this.m_axis.y-x*this.m_axis.x;var r=this.m_axis.x*B+this.m_axis.y*A;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(v=Box2D.Common.Math.b2Math.Clamp(r,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),w=Math.abs(r),z=!0):r<=this.m_lowerTranslation?(v=Box2D.Common.Math.b2Math.Clamp(r-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),w=this.m_lowerTranslation-r,z=!0):r>=this.m_upperTranslation&&(v=Box2D.Common.Math.b2Math.Clamp(r-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),w=r-this.m_upperTranslation,z=!0)}this.m_perp=Box2D.Common.Math.b2Math.MulMV(t,this.m_localYAxis1);this.m_s1=(B+u)*this.m_perp.y-(A+s)*this.m_perp.x;this.m_s2=y*this.m_perp.y-x*this.m_perp.x;t=Box2D.Common.Math.b2Vec2.Get(0,0);s=this.m_perp.x*B+this.m_perp.y*A;w=Math.max(w,Math.abs(s));u=0;z?(z=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,this.m_K.col1.x=z+y+x*this.m_s1*this.m_s1+B*this.m_s2*this.m_s2,this.m_K.col1.y=x*this.m_s1*this.m_a1+B*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=z+y+x*this.m_a1*this.m_a1+B*this.m_a2*this.m_a2,this.m_K.Solve(t,-s,-v)):(z=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,v=z+y+x*this.m_s1*this.m_s1+B*this.m_s2*this.m_s2,t.x=0!=v?-s/v:0,t.y=0);v=t.x*this.m_perp.x+t.y*this.m_axis.x;z=t.x*this.m_perp.y+t.y*this.m_axis.y;s=t.x*this.m_s1+t.y*this.m_a1;t=t.x*this.m_s2+t.y*this.m_a2;F.x-=this.m_invMassA*v;F.y-=this.m_invMassA*z;E-=this.m_invIA*s;D.x+=this.m_invMassB*v;D.y+=this.m_invMassB*z;C+=this.m_invIB*t;H.m_sweep.a=E;G.m_sweep.a=C;H.SynchronizeTransform();G.SynchronizeTransform();return w<=Box2D.Common.b2Settings.b2_linearSlop&&u<=Box2D.Common.b2Settings.b2_angularSlop};Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint;this.bodyB=this.bodyA=null;this.collideConnected=!1};Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};goog.inherits(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(f,e,h,g){this.bodyA=f;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(h);this.localAnchorB=this.bodyB.GetLocalPoint(h);this.localAxisA=this.bodyA.GetLocalVector(g)};Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)};Box2D.Collision={};Box2D.Collision.b2DistanceProxy=function(){this.m_radius=this.m_count=0;this.m_vertices=[]};Box2D.Collision.b2DistanceProxy.prototype.SetValues=function(e,d,f){this.m_count=e;this.m_radius=d;this.m_vertices=f};Box2D.Collision.b2DistanceProxy.prototype.Set=function(b){b.SetDistanceProxy(this)};Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(g){for(var f=0,j=this.m_vertices[0].x*g.x+this.m_vertices[0].y*g.y,i=1;i<this.m_count;i++){var h=this.m_vertices[i].x*g.x+this.m_vertices[i].y*g.y;h>j&&(f=i,j=h)}return f};Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(b){return this.m_vertices[this.GetSupport(b)]};Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count};Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(b){void 0===b&&(b=0);Box2D.Common.b2Settings.b2Assert(0<=b&&b<this.m_count);return this.m_vertices[b]};Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0);this.c0=Box2D.Common.Math.b2Vec2.Get(0,0);this.c=Box2D.Common.Math.b2Vec2.Get(0,0);this.t0=this.a=this.a0=null};Box2D.Common.Math.b2Sweep.prototype.Set=function(b){this.localCenter.SetV(b.localCenter);this.c0.SetV(b.c0);this.c.SetV(b.c);this.a0=b.a0;this.a=b.a;this.t0=b.t0};Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var b=new Box2D.Common.Math.b2Sweep;b.localCenter.SetV(this.localCenter);b.c0.SetV(this.c0);b.c.SetV(this.c);b.a0=this.a0;b.a=this.a;b.t0=this.t0;return b};Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(e,d){void 0===d&&(d=0);e.position.x=(1-d)*this.c0.x+d*this.c.x;e.position.y=(1-d)*this.c0.y+d*this.c.y;e.R.Set((1-d)*this.a0+d*this.a);var f=e.R;e.position.x-=f.col1.x*this.localCenter.x+f.col2.x*this.localCenter.y;e.position.y-=f.col1.y*this.localCenter.x+f.col2.y*this.localCenter.y};Box2D.Common.Math.b2Sweep.prototype.Advance=function(d){void 0===d&&(d=0);if(this.t0<d&&1-this.t0>Number.MIN_VALUE){var c=(d-this.t0)/(1-this.t0);this.c0.x=(1-c)*this.c0.x+c*this.c.x;this.c0.y=(1-c)*this.c0.y+c*this.c.y;this.a0=(1-c)*this.a0+c*this.a;this.t0=d}};Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy;this.proxyB=new Box2D.Collision.b2DistanceProxy;this.sweepA=new Box2D.Common.Math.b2Sweep;this.sweepB=new Box2D.Common.Math.b2Sweep};Box2D.Common.Math.b2Vec3=function(e,d,f){this.x=e;this.y=d;this.z=f};Box2D.Common.Math.b2Vec3._freeCache=[];Box2D.Common.Math.b2Vec3.Get=function(f,e,h){if(0<Box2D.Common.Math.b2Vec3._freeCache.length){var g=Box2D.Common.Math.b2Vec3._freeCache.pop();g.Set(f,e,h);return g}return new Box2D.Common.Math.b2Vec3(f,e,h)};Box2D.Common.Math.b2Vec3.Free=function(b){null!=b&&(Box2D.Common.Math.b2Vec3._freeCache.push(b))};Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.z=this.y=this.x=0};Box2D.Common.Math.b2Vec3.prototype.Set=function(e,d,f){this.x=e;this.y=d;this.z=f};Box2D.Common.Math.b2Vec3.prototype.SetV=function(b){this.x=b.x;this.y=b.y;this.z=b.z};Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec3.Get(-this.x,-this.y,-this.z)};Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return Box2D.Common.Math.b2Vec3.Get(this.x,this.y,this.z)};Box2D.Common.Math.b2Vec3.prototype.Add=function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z};Box2D.Common.Math.b2Vec3.prototype.Subtract=function(b){this.x-=b.x;this.y-=b.y;this.z-=b.z};Box2D.Common.Math.b2Vec3.prototype.Multiply=function(b){this.x*=b;this.y*=b;this.z*=b};Box2D.Common.Math.b2Mat33=function(e,d,f){this.col1=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.col2=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.col3=Box2D.Common.Math.b2Vec3.Get(0,0,0);e&&this.col1.SetV(e);d&&this.col2.SetV(d);f&&this.col3.SetV(f)};Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(e,d,f){this.col1.SetV(e);this.col2.SetV(d);this.col3.SetV(f)};Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)};Box2D.Common.Math.b2Mat33.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2);this.col3.SetV(b.col3)};Box2D.Common.Math.b2Mat33.prototype.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col1.z+=b.col1.z;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y;this.col2.z+=b.col2.z;this.col3.x+=b.col3.x;this.col3.y+=b.col3.y;this.col3.z+=b.col3.z};Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0);this.col2.Set(0,1,0);this.col3.Set(0,0,1)};Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0);this.col2.Set(0,0,0);this.col3.Set(0,0,0)};Box2D.Common.Math.b2Mat33.prototype.Solve22=function(j,i,p){var o=this.col1.x,n=this.col2.x,m=this.col1.y,l=this.col2.y,k=o*l-n*m;0!=k&&(k=1/k);j.x=k*(l*i-n*p);j.y=k*(o*p-m*i);return j};Box2D.Common.Math.b2Mat33.prototype.Solve33=function(B,A,z,y){var x=this.col1.x,w=this.col1.y,v=this.col1.z,u=this.col2.x,t=this.col2.y,s=this.col2.z,r=this.col3.x,q=this.col3.y,o=this.col3.z,p=x*(t*o-s*q)+w*(s*r-u*o)+v*(u*q-t*r);0!=p&&(p=1/p);B.x=p*(A*(t*o-s*q)+z*(s*r-u*o)+y*(u*q-t*r));B.y=p*(x*(z*o-y*q)+w*(y*r-A*o)+v*(A*q-z*r));B.z=p*(x*(t*y-s*z)+w*(s*A-u*y)+v*(u*z-t*A));return B};Box2D.Dynamics.Joints.b2PrismaticJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_K=new Box2D.Common.Math.b2Mat33;this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_localXAxis1.SetV(b.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=b.lowerTranslation;this.m_upperTranslation=b.upperTranslation;this.m_maxMotorForce=b.maxMotorForce;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),b*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(b){void 0===b&&(b=0);return b*this.m_impulse.y};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var g=this.m_bodyA,f=this.m_bodyB,j=g.GetWorldPoint(this.m_localAnchor1),i=f.GetWorldPoint(this.m_localAnchor2),f=i.x-j.x,h=i.y-j.y;Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);g=g.GetWorldVector(this.m_localXAxis1);j=g.x*f+g.y*h;Box2D.Common.Math.b2Vec2.Free(g);return j};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var v=this.m_bodyA,u=this.m_bodyB,t;t=v.m_xf.R;var s=this.m_localAnchor1.x-v.m_sweep.localCenter.x,r=this.m_localAnchor1.y-v.m_sweep.localCenter.y,q=t.col1.x*s+t.col2.x*r,r=t.col1.y*s+t.col2.y*r,s=q;t=u.m_xf.R;var p=this.m_localAnchor2.x-u.m_sweep.localCenter.x,o=this.m_localAnchor2.y-u.m_sweep.localCenter.y,q=t.col1.x*p+t.col2.x*o,o=t.col1.y*p+t.col2.y*o,p=q,q=u.m_sweep.c.x+p-(v.m_sweep.c.x+s),n=u.m_sweep.c.y+o-(v.m_sweep.c.y+r);t=v.GetWorldVector(this.m_localXAxis1);var m=v.m_linearVelocity,l=u.m_linearVelocity,v=v.m_angularVelocity,u=u.m_angularVelocity,s=q*-v*t.y+n*v*t.x+(t.x*(l.x+-u*o-m.x- -v*r)+t.y*(l.y+u*p-m.y-v*s));Box2D.Common.Math.b2Vec2.Free(t);return s};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=b};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(d,c){void 0===d&&(d=0);void 0===c&&(c=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=d;this.m_upperTranslation=c};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(b){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=b};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(b){void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=b};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(b){void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=b};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(v){var u=this.m_bodyA,t=this.m_bodyB,s,r=0;this.m_localCenterA.SetV(u.GetLocalCenter());this.m_localCenterB.SetV(t.GetLocalCenter());var q=u.GetTransform();s=u.m_xf.R;var p=this.m_localAnchor1.x-this.m_localCenterA.x,o=this.m_localAnchor1.y-this.m_localCenterA.y,r=s.col1.x*p+s.col2.x*o,o=s.col1.y*p+s.col2.y*o,p=r;s=t.m_xf.R;var n=this.m_localAnchor2.x-this.m_localCenterB.x,m=this.m_localAnchor2.y-this.m_localCenterB.y,r=s.col1.x*n+s.col2.x*m,m=s.col1.y*n+s.col2.y*m,n=r;s=t.m_sweep.c.x+n-u.m_sweep.c.x-p;r=t.m_sweep.c.y+m-u.m_sweep.c.y-o;this.m_invMassA=u.m_invMass;this.m_invMassB=t.m_invMass;this.m_invIA=u.m_invI;this.m_invIB=t.m_invI;var l=Box2D.Common.Math.b2Math.MulMV(q.R,this.m_localXAxis1);this.m_axis.SetV(l);Box2D.Common.Math.b2Vec2.Free(l);this.m_a1=(s+p)*this.m_axis.y-(r+o)*this.m_axis.x;this.m_a2=n*this.m_axis.y-m*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);q=Box2D.Common.Math.b2Math.MulMV(q.R,this.m_localYAxis1);this.m_perp.SetV(q);Box2D.Common.Math.b2Vec2.Free(q);this.m_s1=(s+p)*this.m_perp.y-(r+o)*this.m_perp.x;this.m_s2=n*this.m_perp.y-m*this.m_perp.x;p=this.m_invMassA;o=this.m_invMassB;n=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=p+o+n*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=n*this.m_s1+m*this.m_s2;this.m_K.col1.z=n*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=n+m;this.m_K.col2.z=n*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=p+o+n*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*r,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):s>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;!1==this.m_enableMotor&&(this.m_motorImpulse=0);v.warmStarting?(this.m_impulse.x*=v.dtRatio,this.m_impulse.y*=v.dtRatio,this.m_motorImpulse*=v.dtRatio,v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,r=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,p=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,u.m_linearVelocity.x-=this.m_invMassA*v,u.m_linearVelocity.y-=this.m_invMassA*s,u.m_angularVelocity-=this.m_invIA*r,t.m_linearVelocity.x+=this.m_invMassB*v,t.m_linearVelocity.y+=this.m_invMassB*s,t.m_angularVelocity+=this.m_invIB*p):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(v){var u=this.m_bodyA,t=this.m_bodyB,s=u.m_linearVelocity,r=u.m_angularVelocity,q=t.m_linearVelocity,p=t.m_angularVelocity,o=0,n=0,m=0,l=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(q.x-s.x)+this.m_axis.y*(q.y-s.y)+this.m_a2*p-this.m_a1*r)),o=this.m_motorImpulse,v=v.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+l,-v,v),l=this.m_motorImpulse-o,o=l*this.m_axis.x,n=l*this.m_axis.y,m=l*this.m_a1,l*=this.m_a2,s.x-=this.m_invMassA*o,s.y-=this.m_invMassA*n,r-=this.m_invIA*m,q.x+=this.m_invMassB*o,q.y+=this.m_invMassB*n,p+=this.m_invIB*l);m=this.m_perp.x*(q.x-s.x)+this.m_perp.y*(q.y-s.y)+this.m_s2*p-this.m_s1*r;n=p-r;this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(l=this.m_axis.x*(q.x-s.x)+this.m_axis.y*(q.y-s.y)+this.m_a2*p-this.m_a1*r,o=this.m_impulse.Copy(),v=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_K.Solve33(v,-m,-n,-l),this.m_impulse.Add(v),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),m=-m-(this.m_impulse.z-o.z)*this.m_K.col3.x,n=-n-(this.m_impulse.z-o.z)*this.m_K.col3.y,l=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(l,m,n),l.x+=o.x,l.y+=o.y,this.m_impulse.x=l.x,this.m_impulse.y=l.y,Box2D.Common.Math.b2Vec2.Free(l),v.x=this.m_impulse.x-o.x,v.y=this.m_impulse.y-o.y,v.z=this.m_impulse.z-o.z,o=v.x*this.m_perp.x+v.z*this.m_axis.x,n=v.x*this.m_perp.y+v.z*this.m_axis.y,m=v.x*this.m_s1+v.y+v.z*this.m_a1,l=v.x*this.m_s2+v.y+v.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(v)):(v=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(v,-m,-n),this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,o=v.x*this.m_perp.x,n=v.x*this.m_perp.y,m=v.x*this.m_s1+v.y,l=v.x*this.m_s2+v.y,Box2D.Common.Math.b2Vec2.Free(v));s.x-=this.m_invMassA*o;s.y-=this.m_invMassA*n;r-=this.m_invIA*m;q.x+=this.m_invMassB*o;q.y+=this.m_invMassB*n;p+=this.m_invIB*l;u.m_linearVelocity.SetV(s);u.m_angularVelocity=r;t.m_linearVelocity.SetV(q);t.m_angularVelocity=p};Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var H=this.m_bodyA,G=this.m_bodyB,F=H.m_sweep.c,E=H.m_sweep.a,D=G.m_sweep.c,C=G.m_sweep.a,B=0,A=0,z=0,y=B=0,x=0,w=0,A=!1,u=0,v=Box2D.Common.Math.b2Mat22.FromAngle(E),w=this.m_localAnchor1.x-this.m_localCenterA.x,t=this.m_localAnchor1.y-this.m_localCenterA.y,B=v.col1.x*w+v.col2.x*t,t=v.col1.y*w+v.col2.y*t;Box2D.Common.Math.b2Mat22.Free(v);var w=B,y=Box2D.Common.Math.b2Mat22.FromAngle(C),s=this.m_localAnchor2.x-this.m_localCenterB.x,z=this.m_localAnchor2.y-this.m_localCenterB.y,B=y.col1.x*s+y.col2.x*z,z=y.col1.y*s+y.col2.y*z;Box2D.Common.Math.b2Mat22.Free(y);s=B;B=D.x+s-F.x-w;y=D.y+z-F.y-t;if(this.m_enableLimit){Box2D.Common.Math.b2Vec2.Free(this.m_axis);this.m_axis=Box2D.Common.Math.b2Math.MulMV(v,this.m_localXAxis1);this.m_a1=(B+w)*this.m_axis.y-(y+t)*this.m_axis.x;this.m_a2=s*this.m_axis.y-z*this.m_axis.x;var r=this.m_axis.x*B+this.m_axis.y*y;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(u=Box2D.Common.Math.b2Math.Clamp(r,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),x=Math.abs(r),A=!0):r<=this.m_lowerTranslation?(u=Box2D.Common.Math.b2Math.Clamp(r-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-r,A=!0):r>=this.m_upperTranslation&&(u=Box2D.Common.Math.b2Math.Clamp(r-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),x=r-this.m_upperTranslation,A=!0)}Box2D.Common.Math.b2Vec2.Free(this.m_perp);this.m_perp=Box2D.Common.Math.b2Math.MulMV(v,this.m_localYAxis1);this.m_s1=(B+w)*this.m_perp.y-(y+t)*this.m_perp.x;this.m_s2=s*this.m_perp.y-z*this.m_perp.x;v=Box2D.Common.Math.b2Vec3.Get(0,0,0);t=this.m_perp.x*B+this.m_perp.y*y;s=C-E-this.m_refAngle;x=Math.max(x,Math.abs(t));w=Math.abs(s);A?(A=this.m_invMassA,z=this.m_invMassB,B=this.m_invIA,y=this.m_invIB,this.m_K.col1.x=A+z+B*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=B*this.m_s1+y*this.m_s2,this.m_K.col1.z=B*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=B+y,this.m_K.col2.z=B*this.m_a1+y*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=A+z+B*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve33(v,-t,-s,-u)):(A=this.m_invMassA,z=this.m_invMassB,B=this.m_invIA,y=this.m_invIB,u=B*this.m_s1+y*this.m_s2,r=B+y,this.m_K.col1.Set(A+z+B*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,u,0),this.m_K.col2.Set(u,r,0),u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(u,-t,-s),v.x=u.x,v.y=u.y,Box2D.Common.Math.b2Vec2.Free(u),v.z=0);u=v.x*this.m_perp.x+v.z*this.m_axis.x;A=v.x*this.m_perp.y+v.z*this.m_axis.y;t=v.x*this.m_s1+v.y+v.z*this.m_a1;s=v.x*this.m_s2+v.y+v.z*this.m_a2;Box2D.Common.Math.b2Vec3.Free(v);F.x-=this.m_invMassA*u;F.y-=this.m_invMassA*A;E-=this.m_invIA*t;D.x+=this.m_invMassB*u;D.y+=this.m_invMassB*A;C+=this.m_invIB*s;H.m_sweep.a=E;G.m_sweep.a=C;H.SynchronizeTransform();G.SynchronizeTransform();return x<=Box2D.Common.b2Settings.b2_linearSlop&&w<=Box2D.Common.b2Settings.b2_angularSlop};Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(f,e,h,g){this.bodyA=f;this.bodyB=e;this.localAnchorA=this.bodyA.GetLocalPoint(h);this.localAnchorB=this.bodyB.GetLocalPoint(h);this.localAxisA=this.bodyA.GetLocalVector(g);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)};Box2D.Dynamics.Joints.b2WeldJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass=new Box2D.Common.Math.b2Mat33;this.m_localAnchorA.SetV(b.localAnchorA);this.m_localAnchorB.SetV(b.localAnchorB);this.m_referenceAngle=b.referenceAngle};goog.inherits(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(b){return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse.x,b*this.m_impulse.y)};Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(b){return b*this.m_impulse.z};Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(v){var u,t=0,s=this.m_bodyA,r=this.m_bodyB;u=s.m_xf.R;var q=this.m_localAnchorA.x-s.m_sweep.localCenter.x,p=this.m_localAnchorA.y-s.m_sweep.localCenter.y,t=u.col1.x*q+u.col2.x*p,p=u.col1.y*q+u.col2.y*p,q=t;u=r.m_xf.R;var o=this.m_localAnchorB.x-r.m_sweep.localCenter.x,n=this.m_localAnchorB.y-r.m_sweep.localCenter.y,t=u.col1.x*o+u.col2.x*n,n=u.col1.y*o+u.col2.y*n,o=t;u=s.m_invMass;var t=r.m_invMass,m=s.m_invI,l=r.m_invI;this.m_mass.col1.x=u+t+p*p*m+n*n*l;this.m_mass.col2.x=-p*q*m-n*o*l;this.m_mass.col3.x=-p*m-n*l;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=u+t+q*q*m+o*o*l;this.m_mass.col3.y=q*m+o*l;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+l;v.warmStarting?(this.m_impulse.x*=v.dtRatio,this.m_impulse.y*=v.dtRatio,this.m_impulse.z*=v.dtRatio,s.m_linearVelocity.x-=u*this.m_impulse.x,s.m_linearVelocity.y-=u*this.m_impulse.y,s.m_angularVelocity-=m*(q*this.m_impulse.y-p*this.m_impulse.x+this.m_impulse.z),r.m_linearVelocity.x+=t*this.m_impulse.x,r.m_linearVelocity.y+=t*this.m_impulse.y,r.m_angularVelocity+=l*(o*this.m_impulse.y-n*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(){var J,I=0,H=this.m_bodyA,G=this.m_bodyB,F=H.m_linearVelocity,E=H.m_angularVelocity,D=G.m_linearVelocity,C=G.m_angularVelocity,B=H.m_invMass,A=G.m_invMass,z=H.m_invI,y=G.m_invI;J=H.m_xf.R;var w=this.m_localAnchorA.x-H.m_sweep.localCenter.x,x=this.m_localAnchorA.y-H.m_sweep.localCenter.y,I=J.col1.x*w+J.col2.x*x,x=J.col1.y*w+J.col2.y*x,w=I;J=G.m_xf.R;var v=this.m_localAnchorB.x-G.m_sweep.localCenter.x,u=this.m_localAnchorB.y-G.m_sweep.localCenter.y,I=J.col1.x*v+J.col2.x*u,u=J.col1.y*v+J.col2.y*u,v=I;J=D.x-C*u-F.x+E*x;var I=D.y+C*v-F.y-E*w,t=C-E,s=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(s,-J,-I,-t);this.m_impulse.Add(s);F.x-=B*s.x;F.y-=B*s.y;E-=z*(w*s.y-x*s.x+s.z);D.x+=A*s.x;D.y+=A*s.y;C+=y*(v*s.y-u*s.x+s.z);Box2D.Common.Math.b2Vec3.Free(s);H.m_angularVelocity=E;G.m_angularVelocity=C};Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(){var F,E=0,D=this.m_bodyA,C=this.m_bodyB;F=D.m_xf.R;var B=this.m_localAnchorA.x-D.m_sweep.localCenter.x,A=this.m_localAnchorA.y-D.m_sweep.localCenter.y,E=F.col1.x*B+F.col2.x*A,A=F.col1.y*B+F.col2.y*A,B=E;F=C.m_xf.R;var z=this.m_localAnchorB.x-C.m_sweep.localCenter.x,y=this.m_localAnchorB.y-C.m_sweep.localCenter.y,E=F.col1.x*z+F.col2.x*y,y=F.col1.y*z+F.col2.y*y,z=E;F=D.m_invMass;var E=C.m_invMass,x=D.m_invI,w=C.m_invI,v=C.m_sweep.c.x+z-D.m_sweep.c.x-B,u=C.m_sweep.c.y+y-D.m_sweep.c.y-A,s=C.m_sweep.a-D.m_sweep.a-this.m_referenceAngle,t=10*Box2D.Common.b2Settings.b2_linearSlop,r=Math.sqrt(v*v+u*u),q=Math.abs(s);r>t&&(x*=1,w*=1);this.m_mass.col1.x=F+E+A*A*x+y*y*w;this.m_mass.col2.x=-A*B*x-y*z*w;this.m_mass.col3.x=-A*x-y*w;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=F+E+B*B*x+z*z*w;this.m_mass.col3.y=B*x+z*w;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=x+w;t=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(t,-v,-u,-s);D.m_sweep.c.x-=F*t.x;D.m_sweep.c.y-=F*t.y;D.m_sweep.a-=x*(B*t.y-A*t.x+t.z);C.m_sweep.c.x+=E*t.x;C.m_sweep.c.y+=E*t.y;C.m_sweep.a+=w*(z*t.y-y*t.x+t.z);Box2D.Common.Math.b2Vec3.Free(t);D.SynchronizeTransform();C.SynchronizeTransform();return r<=Box2D.Common.b2Settings.b2_linearSlop&&q<=Box2D.Common.b2Settings.b2_angularSlop};Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint;this.referenceAngle=0};goog.inherits(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(e,d,f){this.bodyA=e;this.bodyB=d;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(f));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(f));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)};Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0);this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0);this.distance=0};Box2D.Collision.b2SimplexVertex=function(){this.wA=Box2D.Common.Math.b2Vec2.Get(0,0);this.wB=Box2D.Common.Math.b2Vec2.Get(0,0);this.w=Box2D.Common.Math.b2Vec2.Get(0,0);this.indexB=this.indexA=this.a=0};Box2D.Collision.b2SimplexVertex.prototype.Set=function(b){this.wA.SetV(b.wA);this.wB.SetV(b.wB);this.w.SetV(b.w);this.a=b.a;this.indexA=b.indexA;this.indexB=b.indexB};Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex;this.m_v2=new Box2D.Collision.b2SimplexVertex;this.m_v3=new Box2D.Collision.b2SimplexVertex;this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]};Box2D.Collision.b2Simplex._freeCache=[];Box2D.Collision.b2Simplex.Get=function(){if(0<Box2D.Collision.b2Simplex._freeCache.length){for(var e=Box2D.Collision.b2Simplex._freeCache.pop(),d=0;d<e.m_vertices.length;d++){var f=e.m_vertices[d];null!=f.wA&&f.wA.Set(0,0);null!=f.wB&&f.wB.Set(0,0);null!=f.w&&f.w.Set(0,0);f.indexA=0;f.indexB=0;f.a=0}return e}return new Box2D.Collision.b2Simplex};Box2D.Collision.b2Simplex.Free=function(b){null!=b&&Box2D.Collision.b2Simplex._freeCache.push(b)};Box2D.Collision.b2Simplex.prototype.ReadCache=function(t,s,r,q,p){Box2D.Common.b2Settings.b2Assert(0<=t.count&&3>=t.count);var o,n;this.m_count=t.count;for(var m=this.m_vertices,l=0;l<this.m_count;l++){var k=m[l];k.indexA=t.indexA[l];k.indexB=t.indexB[l];o=s.GetVertex(k.indexA);n=q.GetVertex(k.indexB);Box2D.Common.Math.b2Vec2.Free(k.wA);Box2D.Common.Math.b2Vec2.Free(k.wB);Box2D.Common.Math.b2Vec2.Free(k.w);k.wA=Box2D.Common.Math.b2Math.MulX(r,o);k.wB=Box2D.Common.Math.b2Math.MulX(p,n);k.w=Box2D.Common.Math.b2Math.SubtractVV(k.wB,k.wA);k.a=0}if(1<this.m_count&&(t=t.metric,o=this.GetMetric(),o<0.5*t||2*t<o||o<Number.MIN_VALUE)){this.m_count=0}0==this.m_count&&(k=m[0],k.indexA=0,k.indexB=0,o=s.GetVertex(0),n=q.GetVertex(0),Box2D.Common.Math.b2Vec2.Free(k.wA),Box2D.Common.Math.b2Vec2.Free(k.wB),Box2D.Common.Math.b2Vec2.Free(k.w),k.wA=Box2D.Common.Math.b2Math.MulX(r,o),k.wB=Box2D.Common.Math.b2Math.MulX(p,n),k.w=Box2D.Common.Math.b2Math.SubtractVV(k.wB,k.wA),this.m_count=1)};Box2D.Collision.b2Simplex.prototype.WriteCache=function(e){e.metric=this.GetMetric();e.count=this.m_count;for(var d=this.m_vertices,f=0;f<this.m_count;f++){e.indexA[f]=d[f].indexA,e.indexB[f]=d[f].indexB}};Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count){return this.m_v1.w.GetNegative()}if(2==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),d=this.m_v1.w.GetNegative(),f=Box2D.Common.Math.b2Math.CrossVV(e,d);Box2D.Common.Math.b2Vec2.Free(d);d=null;d=0<f?Box2D.Common.Math.b2Math.CrossFV(1,e):Box2D.Common.Math.b2Math.CrossVF(e,1);Box2D.Common.Math.b2Vec2.Free(e);return d}Box2D.Common.b2Settings.b2Assert(!1);return Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){if(1==this.m_count){return this.m_v1.w}if(2==this.m_count){return Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y)}Box2D.Common.b2Settings.b2Assert(!1);return Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(d,c){1==this.m_count?(d.SetV(this.m_v1.wA),c.SetV(this.m_v1.wB)):2==this.m_count?(d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,c.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,c.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count?(c.x=d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,c.y=d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y):Box2D.Common.b2Settings.b2Assert(!1)};Box2D.Collision.b2Simplex.prototype.GetMetric=function(){if(1==this.m_count){return 0}if(2==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w),d=e.Length();Box2D.Common.Math.b2Vec2.Free(e);return d}if(3==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),f=Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w),d=Box2D.Common.Math.b2Math.CrossVV(e,f);Box2D.Common.Math.b2Vec2.Free(e);Box2D.Common.Math.b2Vec2.Free(f);return d}Box2D.Common.b2Settings.b2Assert(!1);return 0};Box2D.Collision.b2Simplex.prototype.Solve2=function(){var e=this.m_v1.w,d=this.m_v2.w,f=Box2D.Common.Math.b2Math.SubtractVV(d,e),e=-(e.x*f.x+e.y*f.y);0>=e?(Box2D.Common.Math.b2Vec2.Free(f),this.m_count=this.m_v1.a=1):(d=d.x*f.x+d.y*f.y,Box2D.Common.Math.b2Vec2.Free(f),0>=d?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(f=1/(d+e),this.m_v1.a=d*f,this.m_v2.a=e*f,this.m_count=2))};Box2D.Collision.b2Simplex.prototype.Solve3=function(){var v=this.m_v1.w,u=this.m_v2.w,t=this.m_v3.w,s=Box2D.Common.Math.b2Math.SubtractVV(u,v),r=Box2D.Common.Math.b2Math.Dot(v,s),q=Box2D.Common.Math.b2Math.Dot(u,s),r=-r,p=Box2D.Common.Math.b2Math.SubtractVV(t,v),o=Box2D.Common.Math.b2Math.Dot(v,p),n=Box2D.Common.Math.b2Math.Dot(t,p),m=Box2D.Common.Math.b2Math.CrossVV(s,p);Box2D.Common.Math.b2Vec2.Free(s);Box2D.Common.Math.b2Vec2.Free(p);var s=-o,o=Box2D.Common.Math.b2Math.SubtractVV(t,u),l=Box2D.Common.Math.b2Math.Dot(u,o),p=Box2D.Common.Math.b2Math.Dot(t,o);Box2D.Common.Math.b2Vec2.Free(o);o=-l;l=m*Box2D.Common.Math.b2Math.CrossVV(u,t);t=m*Box2D.Common.Math.b2Math.CrossVV(t,v);v=m*Box2D.Common.Math.b2Math.CrossVV(v,u);0>=r&&0>=s?this.m_count=this.m_v1.a=1:0<q&&0<r&&0>=v?(n=1/(q+r),this.m_v1.a=q*n,this.m_v2.a=r*n,this.m_count=2):0<n&&0<s&&0>=t?(q=1/(n+s),this.m_v1.a=n*q,this.m_v3.a=s*q,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=q&&0>=o?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=n&&0>=p?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<p&&0<o&&0>=l?(q=1/(p+o),this.m_v2.a=p*q,this.m_v3.a=o*q,this.m_count=2,this.m_v1.Set(this.m_v3)):(q=1/(l+t+v),this.m_v1.a=l*q,this.m_v2.a=t*q,this.m_v3.a=v*q,this.m_count=3)};Box2D.Collision.b2Distance={};Box2D.Collision.b2Distance.Distance=function(r,q,p){var o=Box2D.Collision.b2Simplex.Get();o.ReadCache(q,p.proxyA,p.transformA,p.proxyB,p.transformB);(1>o.m_count||3<o.m_count)&&Box2D.Common.b2Settings.b2Assert(!1);for(var n=0;20>n;){for(var m=[],l=0;l<o.m_count;l++){m[l]={},m[l].indexA=o.m_vertices[l].indexA,m[l].indexB=o.m_vertices[l].indexB}2==o.m_count?o.Solve2():3==o.m_count&&o.Solve3();if(3==o.m_count){break}l=o.GetSearchDirection();if(l.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED){Box2D.Common.Math.b2Vec2.Free(l);break}Box2D.Common.Math.b2Vec2.Free(o.m_vertices[o.m_count].wA);Box2D.Common.Math.b2Vec2.Free(o.m_vertices[o.m_count].wB);Box2D.Common.Math.b2Vec2.Free(o.m_vertices[o.m_count].w);var k=l.GetNegative(),j=Box2D.Common.Math.b2Math.MulTMV(p.transformA.R,k);Box2D.Common.Math.b2Vec2.Free(k);o.m_vertices[o.m_count].indexA=p.proxyA.GetSupport(j);Box2D.Common.Math.b2Vec2.Free(j);o.m_vertices[o.m_count].wA=Box2D.Common.Math.b2Math.MulX(p.transformA,p.proxyA.GetVertex(o.m_vertices[o.m_count].indexA));k=Box2D.Common.Math.b2Math.MulTMV(p.transformB.R,l);Box2D.Common.Math.b2Vec2.Free(l);o.m_vertices[o.m_count].indexB=p.proxyB.GetSupport(k);Box2D.Common.Math.b2Vec2.Free(k);o.m_vertices[o.m_count].wB=Box2D.Common.Math.b2Math.MulX(p.transformB,p.proxyB.GetVertex(o.m_vertices[o.m_count].indexB));o.m_vertices[o.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(o.m_vertices[o.m_count].wB,o.m_vertices[o.m_count].wA);n++;k=!1;for(l=0;l<m.length;l++){if(o.m_vertices[o.m_count].indexA==m[l].indexA&&o.m_vertices[o.m_count].indexB==m[l].indexB){k=!0;break}}if(k){break}o.m_count++}o.GetWitnessPoints(r.pointA,r.pointB);n=Box2D.Common.Math.b2Math.SubtractVV(r.pointA,r.pointB);r.distance=n.Length();Box2D.Common.Math.b2Vec2.Free(n);o.WriteCache(q);Box2D.Collision.b2Simplex.Free(o);p.useRadii&&(q=p.proxyA.m_radius,p=p.proxyB.m_radius,r.distance>q+p&&r.distance>Number.MIN_VALUE?(r.distance-=q+p,o=Box2D.Common.Math.b2Math.SubtractVV(r.pointB,r.pointA),o.Normalize(),r.pointA.x+=q*o.x,r.pointA.y+=q*o.y,r.pointB.x-=p*o.x,r.pointB.y-=p*o.y,Box2D.Common.Math.b2Vec2.Free(o)):(p=Box2D.Common.Math.b2Vec2.Get(0,0),p.x=0.5*(r.pointA.x+r.pointB.x),p.y=0.5*(r.pointA.y+r.pointB.y),r.pointA.x=r.pointB.x=p.x,r.pointA.y=r.pointB.y=p.y,r.distance=0,Box2D.Common.Math.b2Vec2.Free(p)))};Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0];this.indexB=[0,0,0]};Box2D.Collision.b2DistanceInput=function(){this.useRadii=!1;this.transformB=this.transformA=this.proxyB=this.proxyA=null};Box2D.Collision.Shapes={};Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop};Box2D.Collision.Shapes.b2Shape.prototype.Set=function(b){this.m_radius=b.m_radius};Box2D.Collision.Shapes.b2Shape.TestOverlap=function(g,f,j,i){var h=new Box2D.Collision.b2DistanceInput;h.proxyA=new Box2D.Collision.b2DistanceProxy;h.proxyA.Set(g);h.proxyB=new Box2D.Collision.b2DistanceProxy;h.proxyB.Set(j);h.transformA=f;h.transformB=i;h.useRadii=!0;g=new Box2D.Collision.b2SimplexCache;g.count=0;f=new Box2D.Collision.b2DistanceOutput;Box2D.Collision.b2Distance.Distance(f,g,h);Box2D.Common.Math.b2Vec2.Free(f.pointA);Box2D.Common.Math.b2Vec2.Free(f.pointB);return f.distance<10*Number.MIN_VALUE};Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2CircleShape=function(b){Box2D.Collision.Shapes.b2Shape.call(this);this.m_radius=b;this.m_radiusSquared=b*b;this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_vertices=[this.m_p]};goog.inherits(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape);Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME};Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var b=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);b.Set(this);return b};Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(b){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,b);b instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(b.m_p)};Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(f,e){var h=e.x-(f.position.x+(f.R.col1.x*this.m_p.x+f.R.col2.x*this.m_p.y)),g=e.y-(f.position.y+(f.R.col1.y*this.m_p.x+f.R.col2.y*this.m_p.y));return h*h+g*g<=this.m_radiusSquared};Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(r,q,p){var o=p.R,n=q.p1.x-(p.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y)),p=q.p1.y-(p.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y)),o=q.p2.x-q.p1.x,m=q.p2.y-q.p1.y,l=n*o+p*m,k=o*o+m*m,j=l*l-k*(n*n+p*p-this.m_radiusSquared);if(0>j||k<Number.MIN_VALUE){return !1}l=-(l+Math.sqrt(j));return 0<=l&&l<=q.maxFraction*k?(l/=k,r.fraction=l,r.normal.x=n+l*o,r.normal.y=p+l*m,r.normal.Normalize(),!0):!1};Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(f,e){var h=e.R,g=e.position.x+(h.col1.x*this.m_p.x+h.col2.x*this.m_p.y),h=e.position.y+(h.col1.y*this.m_p.x+h.col2.y*this.m_p.y);f.lowerBound.Set(g-this.m_radius,h-this.m_radius);f.upperBound.Set(g+this.m_radius,h+this.m_radius)};Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(e,d){var f=d*Math.PI*this.m_radiusSquared;e.SetV(f,this.m_p,f*(0.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y)))};Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(g,f,j,i){var j=Box2D.Common.Math.b2Math.MulX(j,this.m_p),h=-(Box2D.Common.Math.b2Math.Dot(g,j)-f);if(h<-this.m_radius+Number.MIN_VALUE){return Box2D.Common.Math.b2Vec2.Free(j),0}if(h>this.m_radius){return Box2D.Common.Math.b2Vec2.Free(j),i.SetV(j),Math.PI*this.m_radiusSquared}f=h*h;h=this.m_radiusSquared*(Math.asin(h/this.m_radius)+Math.PI/2)+h*Math.sqrt(this.m_radiusSquared-f);f=-2/3*Math.pow(this.m_radiusSquared-f,1.5)/h;i.x=j.x+g.x*f;i.y=j.y+g.y*f;Box2D.Common.Math.b2Vec2.Free(j);return h};Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(b){b.SetValues(1,this.m_radius,this.m_vertices)};Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p};Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(b){this.m_p.SetV(b)};Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius};Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(b){this.m_radius=b;this.m_radiusSquared=b*b};Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape";Box2D.Consts={};Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE;Box2D.Collision.b2AABB=function(){this.lowerBound=Box2D.Common.Math.b2Vec2.Get(0,0);this.upperBound=Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Collision.b2AABB._freeCache=[];Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var b=Box2D.Collision.b2AABB._freeCache.pop();b.SetZero();return b}return new Box2D.Collision.b2AABB};Box2D.Collision.b2AABB.Free=function(b){null!=b&&(Box2D.Collision.b2AABB._freeCache.push(b))};Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound.Set(0,0);this.upperBound.Set(0,0)};Box2D.Collision.b2AABB.prototype.IsValid=function(){return 0>this.upperBound.x-this.lowerBound.x||0>this.upperBound.y-this.lowerBound.y?!1:this.lowerBound.IsValid()&&this.upperBound.IsValid()};Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};Box2D.Collision.b2AABB.prototype.SetCenter=function(d){var c=this.GetCenter();this.lowerBound.Subtract(c);this.upperBound.Subtract(c);this.lowerBound.Add(d);this.upperBound.Add(d);Box2D.Common.Math.b2Vec2.Free(c)};Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};Box2D.Collision.b2AABB.prototype.Contains=function(d){var c;return c=(c=(c=(c=this.lowerBound.x<=d.lowerBound.x)&&this.lowerBound.y<=d.lowerBound.y)&&d.upperBound.x<=this.upperBound.x)&&d.upperBound.y<=this.upperBound.y};Box2D.Collision.b2AABB.prototype.RayCast=function(i,h){var n=-Number.MAX_VALUE,m=Number.MAX_VALUE,l=h.p2.x-h.p1.x;if(Math.abs(l)<Number.MIN_VALUE){if(h.p1.x<this.lowerBound.x||this.upperBound.x<h.p1.x){return !1}}else{var k=1/l,l=(this.lowerBound.x-h.p1.x)*k,k=(this.upperBound.x-h.p1.x)*k,j=-1;l>k&&(j=l,l=k,k=j,j=1);l>n&&(i.normal.x=j,i.normal.y=0,n=l);m=Math.min(m,k);if(n>m){return !1}}l=h.p2.y-h.p1.y;if(Math.abs(l)<Number.MIN_VALUE){if(h.p1.y<this.lowerBound.y||this.upperBound.y<h.p1.y){return !1}}else{if(k=1/l,l=(this.lowerBound.y-h.p1.y)*k,k*=this.upperBound.y-h.p1.y,j=-1,l>k&&(j=l,l=k,k=j,j=1),l>n&&(i.normal.y=j,i.normal.x=0,n=l),m=Math.min(m,k),n>m){return !1}}i.fraction=n;return !0};Box2D.Collision.b2AABB.prototype.TestOverlap=function(b){return 0<b.lowerBound.x-this.upperBound.x||0<b.lowerBound.y-this.upperBound.y||0<this.lowerBound.x-b.upperBound.x||0<this.lowerBound.y-b.upperBound.y?!1:!0};Box2D.Collision.b2AABB.Combine=function(e,d){var f=Box2D.Collision.b2AABB.Get();f.Combine(e,d);return f};Box2D.Collision.b2AABB.prototype.Combine=function(d,c){this.lowerBound.x=Math.min(d.lowerBound.x,c.lowerBound.x);this.lowerBound.y=Math.min(d.lowerBound.y,c.lowerBound.y);this.upperBound.x=Math.max(d.upperBound.x,c.upperBound.x);this.upperBound.y=Math.max(d.upperBound.y,c.upperBound.y)};Box2D.Dynamics.b2FixtureListNode=function(b){this.fixture=b;this.previous=this.next=null};Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(b){this.next=b};Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(b){this.previous=b};Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next};Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous};Box2D.Collision.b2ContactID=function(){this._incidentVertex=this._incidentEdge=this._referenceEdge=this._key=0};Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key};Box2D.Collision.b2ContactID.prototype.SetKey=function(b){this._key=b;this._referenceEdge=this._key&255;this._incidentEdge=(this._key&65280)>>8&255;this._incidentVertex=(this._key&16711680)>>16&255;this._flip=(this._key&4278190080)>>24&255};Box2D.Collision.b2ContactID.prototype.Set=function(b){this.SetKey(b._key)};Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(b){this._referenceEdge=b;this._key=this._key&4294967040|this._referenceEdge&255};Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(b){this._incidentEdge=b;this._key=this._key&4294902015|this._incidentEdge<<8&65280};Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(b){this._incidentVertex=b;this._key=this._key&4278255615|this._incidentVertex<<16&16711680};Box2D.Collision.b2ContactID.prototype.SetFlip=function(b){this._flip=b;this._key=this._key&16777215|this._flip<<24&4278190080};Box2D.Collision.b2ContactID.prototype.Copy=function(){var b=new Box2D.Collision.b2ContactID;b.Set(this);return b};Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_id=new Box2D.Collision.b2ContactID;this.m_tangentImpulse=this.m_normalImpulse=0};Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.SetKey(0)};Box2D.Collision.b2ManifoldPoint.prototype.Set=function(b){this.m_localPoint.SetV(b.m_localPoint);this.m_normalImpulse=b.m_normalImpulse;this.m_tangentImpulse=b.m_tangentImpulse;this.m_id.Set(b.m_id)};Box2D.Collision.b2DynamicTreeNode=function(b){this.aabb=Box2D.Collision.b2AABB.Get();this.parent=this.child2=this.child1=null;this.fixture=b};Box2D.Collision.b2DynamicTreeNode._freeCache=[];Box2D.Collision.b2DynamicTreeNode.Get=function(d){"undefined"==typeof d&&(d=null);if(0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var c=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();c.fixture=d;c.aabb.SetZero();return c}return new Box2D.Collision.b2DynamicTreeNode(d)};Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.fixture=this.parent=this.child2=this.child1=null;Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)};Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1};Box2D.Collision.b2RayCastInput=function(e,d,f){this.p1=Box2D.Common.Math.b2Vec2.Get(e.x,e.y);this.p2=Box2D.Common.Math.b2Vec2.Get(d.x,d.y);this.maxFraction=f};Box2D.Collision.b2DynamicTree=function(){this.m_root=null;this.m_insertionCount=this.m_path=0};Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(g,f){var j=Box2D.Collision.b2DynamicTreeNode.Get(f),i=Box2D.Common.b2Settings.b2_aabbExtension,h=Box2D.Common.b2Settings.b2_aabbExtension;j.aabb.lowerBound.x=g.lowerBound.x-i;j.aabb.lowerBound.y=g.lowerBound.y-h;j.aabb.upperBound.x=g.upperBound.x+i;j.aabb.upperBound.y=g.upperBound.y+h;this.InsertLeaf(j);return j};Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(b){this.RemoveLeaf(b);b.Destroy()};Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(f,e,h){Box2D.Common.b2Settings.b2Assert(f.IsLeaf());if(f.aabb.Contains(e)){return !1}this.RemoveLeaf(f);var g=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(h.x),h=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(h.y);f.aabb.lowerBound.x=e.lowerBound.x-g;f.aabb.lowerBound.y=e.lowerBound.y-h;f.aabb.upperBound.x=e.upperBound.x+g;f.aabb.upperBound.y=e.upperBound.y+h;this.InsertLeaf(f);return !0};Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(f){if(null!==this.m_root){for(var e=0;e<f;e++){for(var h=this.m_root,g=0;!h.IsLeaf();){h=this.m_path>>g&1?h.child2:h.child1,g=g+1&31}this.m_path++;this.RemoveLeaf(h);this.InsertLeaf(h)}}};Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(b){return b.aabb};Box2D.Collision.b2DynamicTree.prototype.Query=function(g,f,j){if(null!==this.m_root){var i=[];for(i.push(this.m_root);0<i.length;){var h=i.pop();if(h.aabb.TestOverlap(f)){if(h.IsLeaf()){if(!g.call(j,h.fixture)){break}}else{i.push(h.child1),i.push(h.child2)}}}}};Box2D.Collision.b2DynamicTree.prototype.RayCast=function(t,s){if(null!==this.m_root){var r=Box2D.Common.Math.b2Math.SubtractVV(s.p1,s.p2);r.Normalize();var q=Box2D.Common.Math.b2Math.CrossFV(1,r);Box2D.Common.Math.b2Vec2.Free(r);var r=Box2D.Common.Math.b2Math.AbsV(q),p=s.maxFraction,o=s.p1.x+p*(s.p2.x-s.p1.x),p=s.p1.y+p*(s.p2.y-s.p1.y),n=Box2D.Collision.b2AABB.Get();n.lowerBound.x=Math.min(s.p1.x,o);n.lowerBound.y=Math.min(s.p1.y,p);n.upperBound.x=Math.max(s.p1.x,o);n.upperBound.y=Math.max(s.p1.y,p);var m=[];for(m.push(this.m_root);0<m.length;){if(o=m.pop(),o.aabb.TestOverlap(n)){var p=o.aabb.GetCenter(),l=o.aabb.GetExtents(),k=Math.abs(q.x*(s.p1.x-p.x)+q.y*(s.p1.y-p.y))-r.x*l.x-r.y*l.y;Box2D.Common.Math.b2Vec2.Free(p);Box2D.Common.Math.b2Vec2.Free(l);if(!(0<k)){if(o.IsLeaf()){new Box2D.Collision.b2RayCastInput(s.p1,s.p2,s.maxFraction);p=t(s,o.fixture);if(0==p){break}0<p&&(o=s.p1.x+p*(s.p2.x-s.p1.x),p=s.p1.y+p*(s.p2.y-s.p1.y),n.lowerBound.x=Math.min(s.p1.x,o),n.lowerBound.y=Math.min(s.p1.y,p),n.upperBound.x=Math.max(s.p1.x,o),n.upperBound.y=Math.max(s.p1.y,p))}else{m.push(o.child1),m.push(o.child2)}}}}Box2D.Common.Math.b2Vec2.Free(q);Box2D.Common.Math.b2Vec2.Free(r);Box2D.Collision.b2AABB.Free(n)}};Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(f){this.m_insertionCount++;if(null===this.m_root){this.m_root=f,this.m_root.parent=null}else{var e=this.GetBestSibling(f),h=e.parent,g=Box2D.Collision.b2DynamicTreeNode.Get();g.parent=h;g.aabb.Combine(f.aabb,e.aabb);if(h){e.parent.child1==e?h.child1=g:h.child2=g;g.child1=e;g.child2=f;e.parent=g;for(f.parent=g;h&&!h.aabb.Contains(g.aabb);){h.aabb.Combine(h.child1.aabb,h.child2.aabb),g=h,h=h.parent}}else{g.child1=e,g.child2=f,e.parent=g,this.m_root=f.parent=g}}};Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(g){for(var g=g.aabb.GetCenter(),f=this.m_root;!f.IsLeaf();){var j=f.child1,f=f.child2,i=Math.abs((j.aabb.lowerBound.x+j.aabb.upperBound.x)/2-g.x)+Math.abs((j.aabb.lowerBound.y+j.aabb.upperBound.y)/2-g.y),h=Math.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-g.x)+Math.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-g.y),f=i<h?j:f}Box2D.Common.Math.b2Vec2.Free(g);return f};Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(e){if(e==this.m_root){this.m_root=null}else{var d=e.parent,f=d.parent,e=d.child1==e?d.child2:d.child1;if(f){f.child1==d?f.child1=e:f.child2=e;for(e.parent=f;f;){e=f.aabb;f.aabb.Combine(f.child1.aabb,f.child2.aabb);if(e.Contains(f.aabb)){break}f=f.parent}}else{this.m_root=e,e.parent=null}d.Destroy()}};Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0);this.id=new Box2D.Collision.b2ContactID};Box2D.Collision.ClipVertex.prototype.Set=function(b){this.v.SetV(b.v);this.id.Set(b.id)};Box2D.Collision.b2Manifold=function(){this.m_type=this.m_pointCount=0;this.m_points=[];for(var b=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++){this.m_points[b]=new Box2D.Collision.b2ManifoldPoint}this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var b=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++){this.m_points[b].Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};Box2D.Collision.b2Manifold.prototype.Set=function(d){this.m_pointCount=d.m_pointCount;for(var c=0;c<Box2D.Common.b2Settings.b2_maxManifoldPoints;c++){this.m_points[c].Set(d.m_points[c])}this.m_localPlaneNormal.SetV(d.m_localPlaneNormal);this.m_localPoint.SetV(d.m_localPoint);this.m_type=d.m_type};Box2D.Collision.b2Manifold.prototype.Copy=function(){var b=new Box2D.Collision.b2Manifold;b.Set(this);return b};Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4;Box2D.Collision.b2Collision={};Box2D.Collision.b2Collision.ClipSegmentToLine=function(j,i,p,o){var n=0,m=i[0].v,l=i[1].v,k=p.x*m.x+p.y*m.y-o,p=p.x*l.x+p.y*l.y-o;0>=k&&j[n++].Set(i[0]);0>=p&&j[n++].Set(i[1]);0>k*p&&(p=k/(k-p),o=j[n].v,o.x=m.x+p*(l.x-m.x),o.y=m.y+p*(l.y-m.y),j[n].id=0<k?i[0].id:i[1].id,n++);return n};Box2D.Collision.b2Collision.EdgeSeparation=function(z,y,x,w,v){for(var u=y.R.col1.x*z.m_normals[x].x+y.R.col2.x*z.m_normals[x].y,t=y.R.col1.y*z.m_normals[x].x+y.R.col2.y*z.m_normals[x].y,s=v.R.col1.x*u+v.R.col1.y*t,r=v.R.col2.x*u+v.R.col2.y*t,q=0,p=Number.MAX_VALUE,o=0;o<w.m_vertexCount;o++){var m=w.m_vertices[o].x*s+w.m_vertices[o].y*r;m<p&&(p=m,q=o)}return(v.position.x+(v.R.col1.x*w.m_vertices[q].x+v.R.col2.x*w.m_vertices[q].y)-(y.position.x+(y.R.col1.x*z.m_vertices[x].x+y.R.col2.x*z.m_vertices[x].y)))*u+(v.position.y+(v.R.col1.y*w.m_vertices[q].x+v.R.col2.y*w.m_vertices[q].y)-(y.position.y+(y.R.col1.y*z.m_vertices[x].x+y.R.col2.y*z.m_vertices[x].y)))*t};Box2D.Collision.b2Collision.FindMaxSeparation=function(x,w,v,u){for(var t=u.position.x+(u.R.col1.x*v.m_centroid.x+u.R.col2.x*v.m_centroid.y),s=u.position.y+(u.R.col1.y*v.m_centroid.x+u.R.col2.y*v.m_centroid.y),t=t-(w.position.x+(w.R.col1.x*x.m_centroid.x+w.R.col2.x*x.m_centroid.y)),s=s-(w.position.y+(w.R.col1.y*x.m_centroid.x+w.R.col2.y*x.m_centroid.y)),r=t*w.R.col1.x+s*w.R.col1.y,s=t*w.R.col2.x+s*w.R.col2.y,t=0,q=-Number.MAX_VALUE,p=0;p<x.m_vertexCount;++p){var o=x.m_normals[p].x*r+x.m_normals[p].y*s;o>q&&(q=o,t=p)}r=Box2D.Collision.b2Collision.EdgeSeparation(x,w,t,v,u);s=t-1;0>s&&(s=x.m_vertexCount-1);q=Box2D.Collision.b2Collision.EdgeSeparation(x,w,s,v,u);p=t+1;p>=x.m_vertexCount&&(p=0);var o=Box2D.Collision.b2Collision.EdgeSeparation(x,w,p,v,u),n=0,m=0;if(q>r&&q>o){n=s;for(m=q;;){if(t=n-1,0>t&&(t=x.m_vertexCount-1),r=Box2D.Collision.b2Collision.EdgeSeparation(x,w,t,v,u),r>m){n=t,m=r}else{break}}}else{if(o>r){n=p;for(m=o;;){if(t=n+1,t>=x.m_vertexCount&&(t=0),r=Box2D.Collision.b2Collision.EdgeSeparation(x,w,t,v,u),r>m){n=t,m=r}else{break}}}else{n=t,m=r}}return{bestEdge:n,separation:m}};Box2D.Collision.b2Collision.FindIncidentEdge=function(t,s,r,q,p,o){for(var n=r.R.col1.x*s.m_normals[q].x+r.R.col2.x*s.m_normals[q].y,s=r.R.col1.y*s.m_normals[q].x+r.R.col2.y*s.m_normals[q].y,r=o.R.col1.x*n+o.R.col1.y*s,s=o.R.col2.x*n+o.R.col2.y*s,n=r,r=0,m=Number.MAX_VALUE,l=0;l<p.m_vertexCount;l++){var k=n*p.m_normals[l].x+s*p.m_normals[l].y;k<m&&(m=k,r=l)}n=r+1;n>=p.m_vertexCount&&(n=0);t[0].v.x=o.position.x+(o.R.col1.x*p.m_vertices[r].x+o.R.col2.x*p.m_vertices[r].y);t[0].v.y=o.position.y+(o.R.col1.y*p.m_vertices[r].x+o.R.col2.y*p.m_vertices[r].y);t[0].id.SetReferenceEdge(q);t[0].id.SetIncidentEdge(r);t[0].id.SetIncidentVertex(0);t[1].v.x=o.position.x+(o.R.col1.x*p.m_vertices[n].x+o.R.col2.x*p.m_vertices[n].y);t[1].v.y=o.position.y+(o.R.col1.y*p.m_vertices[n].x+o.R.col2.y*p.m_vertices[n].y);t[1].id.SetReferenceEdge(q);t[1].id.SetIncidentEdge(n);t[1].id.SetIncidentVertex(1)};Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]};Box2D.Collision.b2Collision.CollidePolygons=function(B,A,z,y,x){B.m_pointCount=0;var w=A.m_radius+y.m_radius,v=Box2D.Collision.b2Collision.FindMaxSeparation(A,z,y,x);if(!(v.separation>w)){var u=Box2D.Collision.b2Collision.FindMaxSeparation(y,x,A,z);if(!(u.separation>w)){var t=A,s=y,r=z,q=x,o=0,p=v.bestEdge;B.m_type=Box2D.Collision.b2Manifold.e_faceA;u.separation>0.98*v.separation+0.001&&(t=y,s=A,r=x,q=z,p=u.bestEdge,B.m_type=Box2D.Collision.b2Manifold.e_faceB,o=1);A=Box2D.Collision.b2Collision.s_incidentEdge;Box2D.Collision.b2Collision.FindIncidentEdge(A,t,r,p,s,q);s=t.m_vertices[p];t=p+1<t.m_vertexCount?t.m_vertices[p+1]:t.m_vertices[0];Box2D.Collision.b2Collision.s_localTangent.Set(t.x-s.x,t.y-s.y);Box2D.Collision.b2Collision.s_localTangent.Normalize();Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y;Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x;Box2D.Collision.b2Collision.s_planePoint.Set(0.5*(s.x+t.x),0.5*(s.y+t.y));Box2D.Collision.b2Collision.s_tangent.x=r.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+r.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y;Box2D.Collision.b2Collision.s_tangent.y=r.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+r.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y;Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x;Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y;Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y;Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x;Box2D.Collision.b2Collision.s_v11.x=r.position.x+(r.R.col1.x*s.x+r.R.col2.x*s.y);Box2D.Collision.b2Collision.s_v11.y=r.position.y+(r.R.col1.y*s.x+r.R.col2.y*s.y);Box2D.Collision.b2Collision.s_v12.x=r.position.x+(r.R.col1.x*t.x+r.R.col2.x*t.y);Box2D.Collision.b2Collision.s_v12.y=r.position.y+(r.R.col1.y*t.x+r.R.col2.y*t.y);if(!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,A,Box2D.Collision.b2Collision.s_tangent2,-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+w))&&!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+w))){B.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal);B.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint);r=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y;for(p=t=0;p<Box2D.Common.b2Settings.b2_maxManifoldPoints;++p){Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[p].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-r<=w&&(s=Box2D.Collision.b2Collision.s_clipPoints2[p].v.x-q.position.x,A=Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-q.position.y,B.m_points[t].m_localPoint.x=s*q.R.col1.x+A*q.R.col1.y,B.m_points[t].m_localPoint.y=s*q.R.col2.x+A*q.R.col2.y,B.m_points[t].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[p].id),B.m_points[t].m_id.SetFlip(o),t++)}B.m_pointCount=t}}}};Box2D.Collision.b2Collision.CollideCircles=function(h,g,l,k,j){h.m_pointCount=0;var i=j.position.x+(j.R.col1.x*k.m_p.x+j.R.col2.x*k.m_p.y)-(l.position.x+(l.R.col1.x*g.m_p.x+l.R.col2.x*g.m_p.y)),l=j.position.y+(j.R.col1.y*k.m_p.x+j.R.col2.y*k.m_p.y)-(l.position.y+(l.R.col1.y*g.m_p.x+l.R.col2.y*g.m_p.y)),j=g.m_radius+k.m_radius;i*i+l*l>j*j||(h.m_type=Box2D.Collision.b2Manifold.e_circles,h.m_localPoint.SetV(g.m_p),h.m_localPlaneNormal.SetZero(),h.m_pointCount=1,h.m_points[0].m_localPoint.SetV(k.m_p),h.m_points[0].m_id.SetKey(0))};Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(v,u,t,s,r){v.m_pointCount=0;for(var q=r.position.x+(r.R.col1.x*s.m_p.x+r.R.col2.x*s.m_p.y)-t.position.x,p=r.position.y+(r.R.col1.y*s.m_p.x+r.R.col2.y*s.m_p.y)-t.position.y,r=q*t.R.col1.x+p*t.R.col1.y,t=q*t.R.col2.x+p*t.R.col2.y,q=0,p=-Number.MAX_VALUE,o=u.m_radius+s.m_radius,n=0;n<u.m_vertexCount;++n){var m=u.m_normals[n].x*(r-u.m_vertices[n].x)+u.m_normals[n].y*(t-u.m_vertices[n].y);if(m>o){return}m>p&&(p=m,q=n)}m=q+1;m>=u.m_vertexCount&&(m=0);var n=u.m_vertices[q],l=u.m_vertices[m];p<Number.MIN_VALUE?(v.m_pointCount=1,v.m_type=Box2D.Collision.b2Manifold.e_faceA,v.m_localPlaneNormal.SetV(u.m_normals[q]),v.m_localPoint.x=0.5*(n.x+l.x),v.m_localPoint.y=0.5*(n.y+l.y),v.m_points[0].m_localPoint.SetV(s.m_p),v.m_points[0].m_id.SetKey(0)):0>=(r-n.x)*(l.x-n.x)+(t-n.y)*(l.y-n.y)?(r-n.x)*(r-n.x)+(t-n.y)*(t-n.y)>o*o||(v.m_pointCount=1,v.m_type=Box2D.Collision.b2Manifold.e_faceA,v.m_localPlaneNormal.x=r-n.x,v.m_localPlaneNormal.y=t-n.y,v.m_localPlaneNormal.Normalize(),v.m_localPoint.SetV(n),v.m_points[0].m_localPoint.SetV(s.m_p),v.m_points[0].m_id.SetKey(0)):0>=(r-l.x)*(n.x-l.x)+(t-l.y)*(n.y-l.y)?(r-l.x)*(r-l.x)+(t-l.y)*(t-l.y)>o*o||(v.m_pointCount=1,v.m_type=Box2D.Collision.b2Manifold.e_faceA,v.m_localPlaneNormal.x=r-l.x,v.m_localPlaneNormal.y=t-l.y,v.m_localPlaneNormal.Normalize(),v.m_localPoint.SetV(l),v.m_points[0].m_localPoint.SetV(s.m_p),v.m_points[0].m_id.SetKey(0)):(m=0.5*(n.x+l.x),n=0.5*(n.y+l.y),p=(r-m)*u.m_normals[q].x+(t-n)*u.m_normals[q].y,p>o||(v.m_pointCount=1,v.m_type=Box2D.Collision.b2Manifold.e_faceA,v.m_localPlaneNormal.x=u.m_normals[q].x,v.m_localPlaneNormal.y=u.m_normals[q].y,v.m_localPlaneNormal.Normalize(),v.m_localPoint.Set(m,n),v.m_points[0].m_localPoint.SetV(s.m_p),v.m_points[0].m_id.SetKey(0)))};Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector();Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_proxyB=this.m_proxyA=null};Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(x,w,v,u,t){this.m_proxyA=w;this.m_proxyB=u;var s=x.count;Box2D.Common.b2Settings.b2Assert(0<s&&3>s);var r,q,p=q=r=0,o=0,u=w=0,n,m,p=0;1==s?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(x.indexA[0]),x=this.m_proxyB.GetVertex(x.indexB[0]),m=s,n=v.R,r=v.position.x+(n.col1.x*m.x+n.col2.x*m.y),q=v.position.y+(n.col1.y*m.x+n.col2.y*m.y),m=x,n=t.R,p=t.position.x+(n.col1.x*m.x+n.col2.x*m.y),o=t.position.y+(n.col1.y*m.x+n.col2.y*m.y),this.m_axis.x=p-r,this.m_axis.y=o-q,this.m_axis.Normalize()):x.indexB[0]==x.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,w=this.m_proxyA.GetVertex(x.indexA[0]),u=this.m_proxyA.GetVertex(x.indexA[1]),x=this.m_proxyB.GetVertex(x.indexB[0]),this.m_localPoint.x=0.5*(w.x+u.x),this.m_localPoint.y=0.5*(w.y+u.y),o=Box2D.Common.Math.b2Math.SubtractVV(u,w),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(o,1),Box2D.Common.Math.b2Vec2.Free(o),this.m_axis.Normalize(),m=this.m_axis,n=v.R,w=n.col1.x*m.x+n.col2.x*m.y,u=n.col1.y*m.x+n.col2.y*m.y,m=this.m_localPoint,n=v.R,r=v.position.x+(n.col1.x*m.x+n.col2.x*m.y),q=v.position.y+(n.col1.y*m.x+n.col2.y*m.y),m=x,n=t.R,p=t.position.x+(n.col1.x*m.x+n.col2.x*m.y),o=t.position.y+(n.col1.y*m.x+n.col2.y*m.y),0>(p-r)*w+(o-q)*u&&this.m_axis.NegativeSelf()):x.indexA[0]==x.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,r=this.m_proxyB.GetVertex(x.indexB[0]),q=this.m_proxyB.GetVertex(x.indexB[1]),s=this.m_proxyA.GetVertex(x.indexA[0]),this.m_localPoint.x=0.5*(r.x+q.x),this.m_localPoint.y=0.5*(r.y+q.y),o=Box2D.Common.Math.b2Math.SubtractVV(q,r),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(o,1),Box2D.Common.Math.b2Vec2.Free(o),this.m_axis.Normalize(),m=this.m_axis,n=t.R,w=n.col1.x*m.x+n.col2.x*m.y,u=n.col1.y*m.x+n.col2.y*m.y,m=this.m_localPoint,n=t.R,p=t.position.x+(n.col1.x*m.x+n.col2.x*m.y),o=t.position.y+(n.col1.y*m.x+n.col2.y*m.y),m=s,n=v.R,r=v.position.x+(n.col1.x*m.x+n.col2.x*m.y),q=v.position.y+(n.col1.y*m.x+n.col2.y*m.y),0>(r-p)*w+(q-o)*u&&this.m_axis.NegativeSelf()):(w=this.m_proxyA.GetVertex(x.indexA[0]),u=this.m_proxyA.GetVertex(x.indexA[1]),r=this.m_proxyB.GetVertex(x.indexB[0]),q=this.m_proxyB.GetVertex(x.indexB[1]),o=Box2D.Common.Math.b2Math.SubtractVV(u,w),p=Box2D.Common.Math.b2Math.MulMV(v.R,o),Box2D.Common.Math.b2Vec2.Free(o),o=Box2D.Common.Math.b2Math.SubtractVV(q,r),n=Box2D.Common.Math.b2Math.MulMV(t.R,o),Box2D.Common.Math.b2Vec2.Free(o),t=p.x*p.x+p.y*p.y,v=n.x*n.x+n.y*n.y,o=Box2D.Common.Math.b2Math.SubtractVV(n,p),x=p.x*o.x+p.y*o.y,s=n.x*o.x+n.y*o.y,Box2D.Common.Math.b2Vec2.Free(o),o=p.x*n.x+p.y*n.y,n=t*v-o*o,p=0,0!=n&&(p=Box2D.Common.Math.b2Math.Clamp((o*s-x*v)/n,0,1)),0>(o*p+s)/v&&(p=Box2D.Common.Math.b2Math.Clamp((o-x)/t,0,1)),s=Box2D.Common.Math.b2Vec2.Get(0,0),s.x=w.x+p*(u.x-w.x),s.y=w.y+p*(u.y-w.y),x=Box2D.Common.Math.b2Vec2.Get(0,0),x.x=r.x+p*(q.x-r.x),x.y=r.y+p*(q.y-r.y),0==p||1==p?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,o=Box2D.Common.Math.b2Math.SubtractVV(q,r),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(o,1),Box2D.Common.Math.b2Vec2.Free(o),this.m_axis.Normalize(),this.m_localPoint=x):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,o=Box2D.Common.Math.b2Math.SubtractVV(u,w),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(o,1),Box2D.Common.Math.b2Vec2.Free(o),this.m_localPoint=s),0>p&&this.m_axis.NegativeSelf(),Box2D.Common.Math.b2Vec2.Free(s),Box2D.Common.Math.b2Vec2.Free(x))};Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(h,g){var l=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:var l=Box2D.Common.Math.b2Math.MulTMV(h.R,this.m_axis),k=this.m_axis.GetNegative(),j=Box2D.Common.Math.b2Math.MulTMV(g.R,k);Box2D.Common.Math.b2Vec2.Free(k);var i=this.m_proxyA.GetSupportVertex(l);Box2D.Common.Math.b2Vec2.Free(l);l=this.m_proxyB.GetSupportVertex(j);Box2D.Common.Math.b2Vec2.Free(j);j=Box2D.Common.Math.b2Math.MulX(h,i);i=Box2D.Common.Math.b2Math.MulX(g,l);l=(i.x-j.x)*this.m_axis.x+(i.y-j.y)*this.m_axis.y;Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);break;case Box2D.Collision.b2SeparationFunction.e_faceA:k=Box2D.Common.Math.b2Math.MulMV(h.R,this.m_axis);i=k.GetNegative();j=Box2D.Common.Math.b2Math.MulTMV(g.R,i);Box2D.Common.Math.b2Vec2.Free(i);l=this.m_proxyB.GetSupportVertex(j);Box2D.Common.Math.b2Vec2.Free(j);j=Box2D.Common.Math.b2Math.MulX(h,this.m_localPoint);i=Box2D.Common.Math.b2Math.MulX(g,l);l=(i.x-j.x)*k.x+(i.y-j.y)*k.y;Box2D.Common.Math.b2Vec2.Free(k);Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);break;case Box2D.Collision.b2SeparationFunction.e_faceB:k=Box2D.Common.Math.b2Math.MulMV(g.R,this.m_axis);i=k.GetNegative();l=Box2D.Common.Math.b2Math.MulTMV(h.R,i);Box2D.Common.Math.b2Vec2.Free(i);i=this.m_proxyA.GetSupportVertex(l);Box2D.Common.Math.b2Vec2.Free(l);j=Box2D.Common.Math.b2Math.MulX(h,i);i=Box2D.Common.Math.b2Math.MulX(g,this.m_localPoint);l=(j.x-i.x)*k.x+(j.y-i.y)*k.y;Box2D.Common.Math.b2Vec2.Free(k);Box2D.Common.Math.b2Vec2.Free(j);Box2D.Common.Math.b2Vec2.Free(i);break;default:Box2D.Common.b2Settings.b2Assert(!1)}return l};Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4;Box2D.Common.Math.b2Transform=function(d,c){this.position=Box2D.Common.Math.b2Vec2.Get(0,0);this.R=new Box2D.Common.Math.b2Mat22;d&&this.position.SetV(d);c&&this.R.SetM(c)};Box2D.Common.Math.b2Transform.prototype.Initialize=function(d,c){this.position.SetV(d);this.R.SetM(c)};Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};Box2D.Common.Math.b2Transform.prototype.Set=function(b){this.position.SetV(b.position);this.R.SetM(b.R)};Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};Box2D.Collision.b2TimeOfImpact={};Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(H){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var G=H.proxyA,F=H.proxyB,E=H.sweepA,D=H.sweepB;Box2D.Common.b2Settings.b2Assert(E.t0==D.t0);Box2D.Common.b2Settings.b2Assert(1-E.t0>Number.MIN_VALUE);var C=G.m_radius+F.m_radius,H=H.tolerance,B=0,A=0,z=0;Box2D.Collision.b2TimeOfImpact.s_cache.count=0;for(Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){E.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,B);D.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,B);Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=G;Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=F;Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA;Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB;Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput);if(0>=Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance){B=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,G,Box2D.Collision.b2TimeOfImpact.s_xfA,F,Box2D.Collision.b2TimeOfImpact.s_xfB);var y=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(0>=y){B=1;break}0==A&&(z=y>C?Math.max(C-H,0.75*C):Math.max(y-H,0.02*C));if(y-z<0.5*H){if(0==A){B=1;break}break}var x=B,w=B,u=1;E.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,u);D.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,u);var v=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(v>=z){B=1;break}for(var t=0;;){var s=0,s=t&1?w+(z-y)*(u-w)/(v-y):0.5*(w+u);E.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,s);D.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,s);var r=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(r-z)<0.025*H){x=s;break}r>z?(w=s,y=r):(u=s,v=r);t++;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++;if(50==t){break}}Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,t);if(x<(1+100*Number.MIN_VALUE)*B){break}B=x;A++;Box2D.Collision.b2TimeOfImpact.b2_toiIters++;if(1000==A){break}}Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,A);return B};Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput;Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform;Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform;Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput;Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0);this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody;this.active=!0;this.inertiaScale=1};Box2D.Dynamics.b2BodyDef.b2_staticBody=0;Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1;Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2;Box2D.Dynamics.Contacts={};Box2D.Dynamics.Contacts.b2Contact=function(f,e){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++;this.m_manifold=new Box2D.Collision.b2Manifold;this.m_oldManifold=new Box2D.Collision.b2Manifold;this.touching=!1;var h=f.GetBody(),g=e.GetBody();this.continuous=h.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||h.IsBullet()||g.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||g.IsBullet();this.sensor=f.IsSensor()||e.IsSensor();this.filtering=!1;this.m_fixtureA=f;this.m_fixtureB=e;this.enabled=!0;this.bodyAList=h.GetContactList();this.bodyBList=g.GetContactList();this.worldList=g.GetWorld().GetContactList();this.AddToLists()};Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(f,e){this.m_manifold.Reset();this.m_oldManifold.Reset();this.touching=!1;var h=f.GetBody(),g=e.GetBody();this.continuous=h.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||h.IsBullet()||g.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||g.IsBullet();this.sensor=f.IsSensor()||e.IsSensor();this.filtering=!1;this.m_fixtureA=f;this.m_fixtureB=e;this.enabled=!0;this.bodyAList=h.GetContactList();this.bodyBList=g.GetContactList();this.worldList=g.GetWorld().GetContactList();this.AddToLists()};Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this);this.bodyBList.AddContact(this);this.worldList.AddContact(this);this.UpdateLists()};Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var d=!1,c=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(d=!0),this.IsContinuous()&&(c=!0));this.bodyAList.UpdateContact(this,d,c);this.bodyBList.UpdateContact(this,d,c);this.worldList.UpdateContact(this,d,c)};Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this);this.bodyBList.RemoveContact(this);this.worldList.RemoveContact(this)};Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold};Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(g){var f=this.m_fixtureA.GetBody(),j=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape();g.Initialize(this.m_manifold,f.GetTransform(),i.m_radius,j.GetTransform(),h.m_radius)};Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching};Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous};Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(b){this.sensor=b;this.UpdateLists()};Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor};Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(b){this.enabled=b;this.UpdateLists()};Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled};Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next};Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA};Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB};Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(d){var c=this.m_fixtureA.GetBody();return c!=d?c:this.m_fixtureB.GetBody()};Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0};Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1};Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering};Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(r){var q=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=q;this.enabled=!0;var q=!1,p=this.IsTouching(),o=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),m=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor){m&&(q=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),o.GetTransform(),this.m_fixtureB.GetShape(),n.GetTransform())),this.m_manifold.m_pointCount=0}else{this.continuous=o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet()||n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()?!0:!1;if(m){this.Evaluate();q=0<this.m_manifold.m_pointCount;for(m=0;m<this.m_manifold.m_pointCount;m++){var l=this.m_manifold.m_points[m];l.m_normalImpulse=0;for(var k=l.m_tangentImpulse=0;k<this.m_oldManifold.m_pointCount;k++){var j=this.m_oldManifold.m_points[k];if(j.m_id.GetKey()==l.m_id.GetKey()){l.m_normalImpulse=j.m_normalImpulse;l.m_tangentImpulse=j.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}q!=p&&(o.SetAwake(!0),n.SetAwake(!0))}this.touching=q;q!=p&&this.UpdateLists();!p&&q&&r.BeginContact(this);p&&!q&&r.EndContact(this);this.sensor||r.PreSolve(this,this.m_oldManifold)};Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){};Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(d,c){Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape());Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape());Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=d;Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=c;Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop;return Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)};Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput;Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0;Box2D.Collision.Shapes.b2MassData=function(){this.mass=0;this.center=Box2D.Common.Math.b2Vec2.Get(0,0);this.I=0};Box2D.Collision.Shapes.b2MassData._freeCache=[];Box2D.Collision.Shapes.b2MassData.Get=function(){if(0<Box2D.Collision.Shapes.b2MassData._freeCache.length){var b=Box2D.Collision.Shapes.b2MassData._freeCache.pop();b.mass=0;b.center.SetZero();b.I=0;return b}return new Box2D.Collision.Shapes.b2MassData};Box2D.Collision.Shapes.b2MassData.Free=function(b){null!=b&&(Box2D.Collision.Shapes.b2MassData._freeCache.push(b))};Box2D.Collision.Shapes.b2MassData.prototype.SetV=function(e,d,f){this.mass=e;this.center.SetV(d);this.I=f};Box2D.Collision.Shapes.b2MassData.prototype.Set=function(f,e,h,g){this.mass=f;this.center.Set(e,h);this.I=g};Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this);this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_vertices=[];this.m_normals=[]};goog.inherits(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape);Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME};Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var b=new Box2D.Collision.Shapes.b2PolygonShape;b.Set(this);return b};Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(d){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,d);if(d instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(d.m_centroid);this.m_vertexCount=d.m_vertexCount;this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++){this.m_vertices[c].SetV(d.m_vertices[c]),this.m_normals[c].SetV(d.m_normals[c])}}};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(b){this.SetAsVector(b)};Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(d){var c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsArray(d);return c};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(e){var d=e.length;Box2D.Common.b2Settings.b2Assert(2<=d);this.m_vertexCount=d;this.Reserve(d);for(d=d=0;d<this.m_vertexCount;d++){this.m_vertices[d].SetV(e[d])}for(d=0;d<this.m_vertexCount;++d){e=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[d+1<this.m_vertexCount?d+1:0],this.m_vertices[d]);Box2D.Common.b2Settings.b2Assert(e.LengthSquared()>Number.MIN_VALUE);var f=Box2D.Common.Math.b2Math.CrossVF(e,1);Box2D.Common.Math.b2Vec2.Free(e);this.m_normals[d].SetV(f);Box2D.Common.Math.b2Vec2.Free(f);this.m_normals[d].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)};Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(d){var c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsVector(d);return c};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(d,c){this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-d,-c);this.m_vertices[1].Set(d,-c);this.m_vertices[2].Set(d,c);this.m_vertices[3].Set(-d,c);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(e,d){var f=new Box2D.Collision.Shapes.b2PolygonShape;f.SetAsBox(e,d);return f};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(f,e,h,g){this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-f,-e);this.m_vertices[1].Set(f,-e);this.m_vertices[2].Set(f,e);this.m_vertices[3].Set(-f,e);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=h;f=new Box2D.Common.Math.b2Mat22;f.Set(g);h=new Box2D.Common.Math.b2Transform(h,f);for(g=0;g<this.m_vertexCount;++g){this.m_vertices[g]=Box2D.Common.Math.b2Math.MulX(h,this.m_vertices[g]),this.m_normals[g]=Box2D.Common.Math.b2Math.MulMV(h.R,this.m_normals[g])}};Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(g,f,j,i){var h=new Box2D.Collision.Shapes.b2PolygonShape;h.SetAsOrientedBox(g,f,j,i);return h};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(f,e){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(f);this.m_vertices[1].SetV(e);this.m_centroid.x=0.5*(f.x+e.x);this.m_centroid.y=0.5*(f.y+e.y);var h=Box2D.Common.Math.b2Math.SubtractVV(e,f),g=Box2D.Common.Math.b2Math.CrossVF(h,1);Box2D.Common.Math.b2Vec2.Free(h);this.m_normals[0]=g;Box2D.Common.Math.b2Vec2.Free(g);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(e,d){var f=new Box2D.Collision.Shapes.b2PolygonShape;f.SetAsEdge(e,d);return f};Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(j,i){var p;p=j.R;for(var o=i.x-j.position.x,n=i.y-j.position.y,m=o*p.col1.x+n*p.col1.y,l=o*p.col2.x+n*p.col2.y,k=0;k<this.m_vertexCount;++k){if(p=this.m_vertices[k],o=m-p.x,n=l-p.y,p=this.m_normals[k],0<p.x*o+p.y*n){return !1}}return !0};Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(z,y,x){var w=0,v=y.maxFraction,u=0,t=0,s,r,u=y.p1.x-x.position.x,t=y.p1.y-x.position.y;s=x.R;var q=u*s.col1.x+t*s.col1.y,p=u*s.col2.x+t*s.col2.y,u=y.p2.x-x.position.x,t=y.p2.y-x.position.y;s=x.R;y=u*s.col1.x+t*s.col1.y-q;s=u*s.col2.x+t*s.col2.y-p;for(var o=-1,m=0;m<this.m_vertexCount;++m){r=this.m_vertices[m];u=r.x-q;t=r.y-p;r=this.m_normals[m];u=r.x*u+r.y*t;t=r.x*y+r.y*s;if(0==t){if(0>u){return !1}}else{0>t&&u<w*t?(w=u/t,o=m):0<t&&u<v*t&&(v=u/t)}if(v<w-Number.MIN_VALUE){return !1}}return 0<=o?(z.fraction=w,s=x.R,r=this.m_normals[o],z.normal.x=s.col1.x*r.x+s.col2.x*r.y,z.normal.y=s.col1.y*r.x+s.col2.y*r.y,!0):!1};Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(t,s){for(var r=s.R,q=this.m_vertices[0],p=s.position.x+(r.col1.x*q.x+r.col2.x*q.y),o=s.position.y+(r.col1.y*q.x+r.col2.y*q.y),n=p,m=o,l=1;l<this.m_vertexCount;++l){var q=this.m_vertices[l],k=s.position.x+(r.col1.x*q.x+r.col2.x*q.y),q=s.position.y+(r.col1.y*q.x+r.col2.y*q.y),p=p<k?p:k,o=o<q?o:q,n=n>k?n:k,m=m>q?m:q}t.lowerBound.x=p-this.m_radius;t.lowerBound.y=o-this.m_radius;t.upperBound.x=n+this.m_radius;t.upperBound.y=m+this.m_radius};Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(F,E){if(2==this.m_vertexCount){F.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),F.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y),F.mass=0,F.I=0}else{for(var D=0,C=0,B=0,A=0,z=1/3,y=0;y<this.m_vertexCount;++y){var x=this.m_vertices[y],w=y+1<this.m_vertexCount?this.m_vertices[y+1]:this.m_vertices[0],v=x.x-0,u=x.y-0,s=w.x-0,t=w.y-0,r=v*t-u*s,q=0.5*r,B=B+q,D=D+q*z*(0+x.x+w.x),C=C+q*z*(0+x.y+w.y),x=v,A=A+r*(z*(0.25*(x*x+s*x+s*s)+(0*x+0*s))+0+(z*(0.25*(u*u+t*u+t*t)+(0*u+0*t))+0))}F.Set(E*B,D*(1/B),C*(1/B),E*A)}};Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(v,u,t,s){for(var r=Box2D.Common.Math.b2Math.MulTMV(t.R,v),q=u-Box2D.Common.Math.b2Math.Dot(v,t.position),p=[],o=0,n=-1,u=-1,m=!1,v=v=0;v<this.m_vertexCount;++v){p[v]=Box2D.Common.Math.b2Math.Dot(r,this.m_vertices[v])-q;var l=p[v]<-Number.MIN_VALUE;0<v&&(l?m||(n=v-1,o++):m&&(u=v-1,o++));m=l}Box2D.Common.Math.b2Vec2.Free(r);switch(o){case 0:return m?(v=Box2D.Collision.Shapes.b2MassData.Get(),this.ComputeMass(v,1),t=Box2D.Common.Math.b2Math.MulX(t,v.center),s.SetV(t),Box2D.Common.Math.b2Vec2.Free(t),s=v.mass,Box2D.Collision.Shapes.b2MassData.Free(v),s):0;case 1:-1==n?n=this.m_vertexCount-1:u=this.m_vertexCount-1}v=(n+1)%this.m_vertexCount;r=(u+1)%this.m_vertexCount;q=(0-p[n])/(p[v]-p[n]);p=(0-p[u])/(p[r]-p[u]);n=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[n].x*(1-q)+this.m_vertices[v].x*q,this.m_vertices[n].y*(1-q)+this.m_vertices[v].y*q);q=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[u].x*(1-p)+this.m_vertices[r].x*p,this.m_vertices[u].y*(1-p)+this.m_vertices[r].y*p);u=0;p=Box2D.Common.Math.b2Vec2.Get(0,0);for(o=this.m_vertices[v];v!=r;){v=(v+1)%this.m_vertexCount,m=v==r?q:this.m_vertices[v],l=0.5*((o.x-n.x)*(m.y-n.y)-(o.y-n.y)*(m.x-n.x)),u+=l,p.x+=l*(n.x+o.x+m.x)/3,p.y+=l*(n.y+o.y+m.y)/3,o=m}Box2D.Common.Math.b2Vec2.Free(n);Box2D.Common.Math.b2Vec2.Free(q);p.Multiply(1/u);t=Box2D.Common.Math.b2Math.MulX(t,p);Box2D.Common.Math.b2Vec2.Free(p);s.SetV(t);Box2D.Common.Math.b2Vec2.Free(t);return u};Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(b){b.SetValues(this.m_vertexCount,this.m_radius,this.m_vertices)};Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount};Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices};Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals};Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(g){for(var f=0,j=this.m_vertices[0].x*g.x+this.m_vertices[0].y*g.y,i=1;i<this.m_vertexCount;++i){var h=this.m_vertices[i].x*g.x+this.m_vertices[i].y*g.y;h>j&&(f=i,j=h)}return f};Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(g){for(var f=0,j=this.m_vertices[0].x*g.x+this.m_vertices[0].y*g.y,i=1;i<this.m_vertexCount;++i){var h=this.m_vertices[i].x*g.x+this.m_vertices[i].y*g.y;h>j&&(f=i,j=h)}return this.m_vertices[f]};Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(d){for(var c=0;c<this.m_vertices.length;c++){Box2D.Common.Math.b2Vec2.Free(this.m_vertices[c]),Box2D.Common.Math.b2Vec2.Free(this.m_normals[c])}this.m_vertices=[];this.m_normals=[];for(c=0;c<d;c++){this.m_vertices[c]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[c]=Box2D.Common.Math.b2Vec2.Get(0,0)}};Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(r,q){for(var p=Box2D.Common.Math.b2Vec2.Get(0,0),o=0,n=1/3,m=0;m<q;++m){var l=r[m],k=m+1<q?r[m+1]:r[0],j=0.5*((l.x-0)*(k.y-0)-(l.y-0)*(k.x-0)),o=o+j;p.x+=j*n*(0+l.x+k.x);p.y+=j*n*(0+l.y+k.y)}p.x*=1/o;p.y*=1/o;return p};Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22;Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape";Box2D.Collision.Shapes.b2EdgeShape=function(d,c){Box2D.Collision.Shapes.b2Shape.call(this);this.m_nextEdge=this.m_prevEdge=null;this.m_v1=d;this.m_v2=c;this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x);this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y);this.m_cornerConvex2=this.m_cornerConvex1=!1};goog.inherits(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape);Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME};Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(){return !1};Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(v,u,t){var s=u.p2.x-u.p1.x,r=u.p2.y-u.p1.y,q=t.R,p=t.position.x+(q.col1.x*this.m_v1.x+q.col2.x*this.m_v1.y),o=t.position.y+(q.col1.y*this.m_v1.x+q.col2.y*this.m_v1.y),n=t.position.y+(q.col1.y*this.m_v2.x+q.col2.y*this.m_v2.y)-o,t=-(t.position.x+(q.col1.x*this.m_v2.x+q.col2.x*this.m_v2.y)-p),q=100*Number.MIN_VALUE,m=-(s*n+r*t);if(m>q){var p=u.p1.x-p,l=u.p1.y-o,o=p*n+l*t;if(0<=o&&o<=u.maxFraction*m&&(u=-s*l+r*p,-q*m<=u&&u<=m*(1+q))){return v.fraction=o/m,u=Math.sqrt(n*n+t*t),v.normal.x=n/u,v.normal.y=t/u,!0}}return !1};Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(h,g){var l=g.R,k=g.position.x+(l.col1.x*this.m_v1.x+l.col2.x*this.m_v1.y),j=g.position.y+(l.col1.y*this.m_v1.x+l.col2.y*this.m_v1.y),i=g.position.x+(l.col1.x*this.m_v2.x+l.col2.x*this.m_v2.y),l=g.position.y+(l.col1.y*this.m_v2.x+l.col2.y*this.m_v2.y);k<i?(h.lowerBound.x=k,h.upperBound.x=i):(h.lowerBound.x=i,h.upperBound.x=k);j<l?(h.lowerBound.y=j,h.upperBound.y=l):(h.lowerBound.y=l,h.upperBound.y=j)};Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(b){b.mass=0;b.center.SetV(this.m_v1);b.I=0};Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(i,h,n,m){void 0===h&&(h=0);var l=Box2D.Common.Math.b2Vec2.Get(i.x*h,i.y*h),k=Box2D.Common.Math.b2Math.MulX(n,this.m_v1),n=Box2D.Common.Math.b2Math.MulX(n,this.m_v2),j=Box2D.Common.Math.b2Math.Dot(i,k)-h,i=Box2D.Common.Math.b2Math.Dot(i,n)-h;if(0<j){if(0<i){return 0}k.x=-i/(j-i)*k.x+j/(j-i)*n.x;k.y=-i/(j-i)*k.y+j/(j-i)*n.y}else{0<i&&(n.x=-i/(j-i)*k.x+j/(j-i)*n.x,n.y=-i/(j-i)*k.y+j/(j-i)*n.y)}m.x=(l.x+k.x+n.x)/3;m.y=(l.y+k.y+n.y)/3;return 0.5*((k.x-l.x)*(n.y-l.y)-(k.y-l.y)*(n.x-l.x))};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(d){var c=d.R;return Box2D.Common.Math.b2Vec2.Get(d.position.x+(c.col1.x*this.m_coreV1.x+c.col2.x*this.m_coreV1.y),d.position.y+(c.col1.y*this.m_coreV1.x+c.col2.y*this.m_coreV1.y))};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge};Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge};Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(i,h,n){var m=i.R,l=i.position.x+(m.col1.x*this.m_coreV1.x+m.col2.x*this.m_coreV1.y),k=i.position.y+(m.col1.y*this.m_coreV1.x+m.col2.y*this.m_coreV1.y),j=i.position.x+(m.col1.x*this.m_coreV2.x+m.col2.x*this.m_coreV2.y),i=i.position.y+(m.col1.y*this.m_coreV2.x+m.col2.y*this.m_coreV2.y);return l*h+k*n>j*h+i*n?Box2D.Common.Math.b2Vec2.Get(l,k):Box2D.Common.Math.b2Vec2.Get(j,i)};Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(f,e,h,g){this.m_prevEdge=f;this.m_coreV1=e;this.m_cornerDir1=h;this.m_cornerConvex1=g};Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(f,e,h,g){this.m_nextEdge=f;this.m_coreV2=e;this.m_cornerDir2=h;this.m_cornerConvex2=g};Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape";Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(d,c){Box2D.Common.b2Settings.b2Assert(d.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape);Box2D.Common.b2Settings.b2Assert(c.GetShape() instanceof Box2D.Collision.Shapes.b2EdgeShape);Box2D.Dynamics.Contacts.b2Contact.call(this,d,c)};goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact);Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(d,c){Box2D.Common.b2Settings.b2Assert(d.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape);Box2D.Common.b2Settings.b2Assert(c.GetShape() instanceof Box2D.Collision.Shapes.b2EdgeShape);Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,d,c)};Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)};Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){};Box2D.Dynamics.b2TimeStep=function(g,f,j,i,h){this.Reset(g,f,j,i,h)};Box2D.Dynamics.b2TimeStep.prototype.Reset=function(h,g,l,k,j){this.dt=h;var i=0;0<h&&(i=1/h);this.inv_dt=i;this.dtRatio=g;this.positionIterations=l;this.velocityIterations=k;this.warmStarting=j};Box2D.Dynamics.Joints.b2FrictionJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_linearMass=new Box2D.Common.Math.b2Mat22;this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchorA.SetV(b.localAnchorA);this.m_localAnchorB.SetV(b.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=b.maxForce;this.m_maxTorque=b.maxTorque};goog.inherits(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return new Box2D.Common.Math.b2Vec2.Get(b*this.m_linearImpulse.x,b*this.m_linearImpulse.y)};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(b){void 0===b&&(b=0);return b*this.m_angularImpulse};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(b){void 0===b&&(b=0);this.m_maxForce=b};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(b){void 0===b&&(b=0);this.m_maxTorque=b};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(x){var w,v=0,u=this.m_bodyA,t=this.m_bodyB;w=u.m_xf.R;var s=this.m_localAnchorA.x-u.m_sweep.localCenter.x,r=this.m_localAnchorA.y-u.m_sweep.localCenter.y,v=w.col1.x*s+w.col2.x*r,r=w.col1.y*s+w.col2.y*r,s=v;w=t.m_xf.R;var q=this.m_localAnchorB.x-t.m_sweep.localCenter.x,p=this.m_localAnchorB.y-t.m_sweep.localCenter.y,v=w.col1.x*q+w.col2.x*p,p=w.col1.y*q+w.col2.y*p,q=v;w=u.m_invMass;var v=t.m_invMass,o=u.m_invI,n=t.m_invI,m=new b2Mat22;m.col1.x=w+v;m.col2.x=0;m.col1.y=0;m.col2.y=w+v;m.col1.x+=o*r*r;m.col2.x+=-o*s*r;m.col1.y+=-o*s*r;m.col2.y+=o*s*s;m.col1.x+=n*p*p;m.col2.x+=-n*q*p;m.col1.y+=-n*q*p;m.col2.y+=n*q*q;m.GetInverse(this.m_linearMass);this.m_angularMass=o+n;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);x.warmStarting?(this.m_linearImpulse.x*=x.dtRatio,this.m_linearImpulse.y*=x.dtRatio,this.m_angularImpulse*=x.dtRatio,x=this.m_linearImpulse,u.m_linearVelocity.x-=w*x.x,u.m_linearVelocity.y-=w*x.y,u.m_angularVelocity-=o*(s*x.y-r*x.x+this.m_angularImpulse),t.m_linearVelocity.x+=v*x.x,t.m_linearVelocity.y+=v*x.y,t.m_angularVelocity+=n*(q*x.y-p*x.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(J){var I,H=0,G=this.m_bodyA,F=this.m_bodyB,E=G.m_linearVelocity,D=G.m_angularVelocity,C=F.m_linearVelocity,B=F.m_angularVelocity,A=G.m_invMass,z=F.m_invMass,y=G.m_invI,w=F.m_invI;I=G.m_xf.R;var x=this.m_localAnchorA.x-G.m_sweep.localCenter.x,v=this.m_localAnchorA.y-G.m_sweep.localCenter.y,H=I.col1.x*x+I.col2.x*v,v=I.col1.y*x+I.col2.y*v,x=H;I=F.m_xf.R;var u=this.m_localAnchorB.x-F.m_sweep.localCenter.x,t=this.m_localAnchorB.y-F.m_sweep.localCenter.y,H=I.col1.x*u+I.col2.x*t,t=I.col1.y*u+I.col2.y*t,u=H;I=0;var H=-this.m_angularMass*(B-D),s=this.m_angularImpulse;I=J.dt*this.m_maxTorque;this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+H,-I,I);H=this.m_angularImpulse-s;D-=y*H;B+=w*H;I=Box2D.Common.Math.b2Vec2.Get(-(C.x-B*t-E.x+D*v),-(C.y+B*u-E.y-D*x));I.MulM(this.m_linearMass);H=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(I);Box2D.Common.Math.b2Vec2.Free(I);I=J.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>I*I&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(I));I=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,H);Box2D.Common.Math.b2Vec2.Free(H);E.x-=A*I.x;E.y-=A*I.y;D-=y*(x*I.y-v*I.x);C.x+=z*I.x;C.y+=z*I.y;B+=w*(u*I.y-t*I.x);Box2D.Common.Math.b2Vec2.Free(I);G.m_angularVelocity=D;F.m_angularVelocity=B};Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return !0};Box2D.Dynamics.b2DestructionListener=function(){};Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(){};Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(){};Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var b=new Box2D.Dynamics.b2FilterData;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};Box2D.Dynamics.b2Fixture=function(e,d,f){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++;this.m_filter=f.filter.Copy();this.m_aabb=Box2D.Collision.b2AABB.Get();this.m_aabb_temp=Box2D.Collision.b2AABB.Get();this.m_body=e;this.m_shape=f.shape.Copy();this.m_density=f.density;this.m_friction=f.friction;this.m_restitution=f.restitution;this.m_isSensor=f.isSensor};Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape};Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(e){if(this.m_isSensor!=e&&(this.m_isSensor=e,null!=this.m_body)){for(e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode()){var d=e.contact.GetFixtureA(),f=e.contact.GetFixtureB();if(d==this||f==this){e.contact.SetSensor(d.IsSensor()||f.IsSensor())}}}};Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor};Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(b){this.m_filter=b.Copy();if(null!=this.m_body){for(b=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode()){(b.contact.GetFixtureA()==this||b.contact.GetFixtureB()==this)&&b.contact.FlagForFiltering()}}};Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter};Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body};Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(b){return this.m_shape.TestPoint(this.m_body.GetTransform(),b)};Box2D.Dynamics.b2Fixture.prototype.RayCast=function(d,c){return this.m_shape.RayCast(d,c,this.m_body.GetTransform())};Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(b){b||(b=Box2D.Collision.Shapes.b2MassData.Get());this.m_shape.ComputeMass(b,this.m_density);return b};Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(b){this.m_density=b};Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density};Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction};Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(b){this.m_friction=b};Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution};Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(b){this.m_restitution=b};Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb};Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)};Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(d,c){this.m_shape.ComputeAABB(this.m_aabb,c);this.m_proxy=d.CreateProxy(this.m_aabb,this)};Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(b){null!=this.m_proxy&&(b.DestroyProxy(this.m_proxy),this.m_proxy=null)};Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(e,d,f){this.m_proxy&&(this.m_shape.ComputeAABB(this.m_aabb,d),this.m_shape.ComputeAABB(this.m_aabb_temp,f),this.m_aabb.Combine(this.m_aabb,this.m_aabb_temp),d=Box2D.Common.Math.b2Math.SubtractVV(f.position,d.position),e.MoveProxy(this.m_proxy,this.m_aabb,d),Box2D.Common.Math.b2Vec2.Free(d))};Box2D.Dynamics.b2Fixture.NEXT_ID=0;Box2D.Dynamics.iContactListener=function(){};Box2D.Dynamics.iContactListener.prototype.BeginContact=function(){};Box2D.Dynamics.iContactListener.prototype.EndContact=function(){};Box2D.Dynamics.iContactListener.prototype.PreSolve=function(){};Box2D.Dynamics.iContactListener.prototype.PostSolve=function(){};Box2D.Dynamics.Contacts.b2CircleContact=function(d,c){Box2D.Dynamics.Contacts.b2Contact.call(this,d,c)};goog.inherits(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact);Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(d,c){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,d,c)};Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){var d=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,d,this.m_fixtureA.GetBody().m_xf,c,this.m_fixtureB.GetBody().m_xf)};Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(d,c){Box2D.Dynamics.Contacts.b2Contact.call(this,d,c)};goog.inherits(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact);Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(d,c){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,d,c)};Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody();this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)};Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){};Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint;this.maxTorque=this.maxForce=0};goog.inherits(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(e,d,f){this.bodyA=e;this.bodyB=d;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(f));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(f))};Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)};Box2D.Dynamics.Joints.b2RevoluteJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.K=new Box2D.Common.Math.b2Mat22;this.K1=new Box2D.Common.Math.b2Mat22;this.K2=new Box2D.Common.Math.b2Mat22;this.K3=new Box2D.Common.Math.b2Mat22;this.impulse3=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0);this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass=new Box2D.Common.Math.b2Mat33;this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_referenceAngle=b.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=b.lowerAngle;this.m_upperAngle=b.upperAngle;this.m_maxMotorTorque=b.maxMotorTorque;this.m_motorSpeed=b.motorSpeed;this.m_enableLimit=b.enableLimit;this.m_enableMotor=b.enableMotor;this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;this.m_motorMass=0};goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse.x,b*this.m_impulse.y)};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(b){void 0===b&&(b=0);return b*this.m_impulse.z};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(b){this.m_enableLimit=b};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(d,c){void 0===d&&(d=0);void 0===c&&(c=0);this.m_lowerAngle=d;this.m_upperAngle=c};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(b){this.m_enableMotor=b};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(b){void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=b};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(b){void 0===b&&(b=0);this.m_maxMotorTorque=b};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(e){var c=this.m_bodyA;var b=this.m_bodyB;var l;var m=0;l=c.m_xf.R;var p=this.m_localAnchor1.x-c.m_sweep.localCenter.x;var n=this.m_localAnchor1.y-c.m_sweep.localCenter.y;m=(l.col1.x*p+l.col2.x*n);n=(l.col1.y*p+l.col2.y*n);p=m;l=b.m_xf.R;var k=this.m_localAnchor2.x-b.m_sweep.localCenter.x;var j=this.m_localAnchor2.y-b.m_sweep.localCenter.y;m=(l.col1.x*k+l.col2.x*j);j=(l.col1.y*k+l.col2.y*j);k=m;var q=c.m_invMass;var o=b.m_invMass;var i=c.m_invI;var g=b.m_invI;this.m_mass.col1.x=q+o+n*n*i+j*j*g;this.m_mass.col2.x=(-n*p*i)-j*k*g;this.m_mass.col3.x=(-n*i)-j*g;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=q+o+p*p*i+k*k*g;this.m_mass.col3.y=p*i+k*g;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=i+g;if(i+g==0){this.m_motorMass=0}else{this.m_motorMass=0.01}if(!this.m_enableMotor){this.m_motorImpulse=0}if(this.m_enableLimit){var d=b.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;if(Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop){this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits}else{if(d<=this.m_lowerAngle){if(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit}else{if(d>=this.m_upperAngle){if(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit}else{this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit}if(e.warmStarting){this.m_impulse.x*=e.dtRatio;this.m_impulse.y*=e.dtRatio;this.m_motorImpulse*=e.dtRatio;var h=this.m_impulse.x;var f=this.m_impulse.y;c.m_linearVelocity.x-=q*h;c.m_linearVelocity.y-=q*f;c.m_angularVelocity-=i*((p*f-n*h)+this.m_motorImpulse+this.m_impulse.z);b.m_linearVelocity.x+=o*h;b.m_linearVelocity.y+=o*f;b.m_angularVelocity+=g*((k*f-j*h)+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(H){var G=this.m_bodyA,F=this.m_bodyB,E=0,D=E=0,C=0,B=0,A=0,z=G.m_linearVelocity,y=G.m_angularVelocity,x=F.m_linearVelocity,w=F.m_angularVelocity,u=G.m_invMass,v=F.m_invMass,t=G.m_invI,s=F.m_invI;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(D=this.m_motorMass*-(w-y-this.m_motorSpeed),C=this.m_motorImpulse,B=H.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+D,-B,B),D=this.m_motorImpulse-C,y-=t*D,w+=s*D);if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var H=G.m_xf.R,D=this.m_localAnchor1.x-G.m_sweep.localCenter.x,C=this.m_localAnchor1.y-G.m_sweep.localCenter.y,E=H.col1.x*D+H.col2.x*C,C=H.col1.y*D+H.col2.y*C,D=E,H=F.m_xf.R,B=this.m_localAnchor2.x-F.m_sweep.localCenter.x,A=this.m_localAnchor2.y-F.m_sweep.localCenter.y,E=H.col1.x*B+H.col2.x*A,A=H.col1.y*B+H.col2.y*A,B=E,H=x.x+-w*A-z.x- -y*C,r=x.y+w*B-z.y-y*D;this.m_mass.Solve33(this.impulse3,-H,-r,-(w-y));this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(E=this.m_impulse.z+this.impulse3.z,0>E&&(this.m_mass.Solve22(this.reduced,-H,-r),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(E=this.m_impulse.z+this.impulse3.z,0<E&&(this.m_mass.Solve22(this.reduced,-H,-r),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0));z.x-=u*this.impulse3.x;z.y-=u*this.impulse3.y;y-=t*(D*this.impulse3.y-C*this.impulse3.x+this.impulse3.z);x.x+=v*this.impulse3.x;x.y+=v*this.impulse3.y;w+=s*(B*this.impulse3.y-A*this.impulse3.x+this.impulse3.z)}else{H=G.m_xf.R,D=this.m_localAnchor1.x-G.m_sweep.localCenter.x,C=this.m_localAnchor1.y-G.m_sweep.localCenter.y,E=H.col1.x*D+H.col2.x*C,C=H.col1.y*D+H.col2.y*C,D=E,H=F.m_xf.R,B=this.m_localAnchor2.x-F.m_sweep.localCenter.x,A=this.m_localAnchor2.y-F.m_sweep.localCenter.y,E=H.col1.x*B+H.col2.x*A,A=H.col1.y*B+H.col2.y*A,B=E,this.m_mass.Solve22(this.impulse2,-(x.x+-w*A-z.x- -y*C),-(x.y+w*B-z.y-y*D)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,z.x-=u*this.impulse2.x,z.y-=u*this.impulse2.y,y-=t*(D*this.impulse2.y-C*this.impulse2.x),x.x+=v*this.impulse2.x,x.y+=v*this.impulse2.y,w+=s*(B*this.impulse2.y-A*this.impulse2.x)}G.m_linearVelocity.SetV(z);G.m_angularVelocity=y;F.m_linearVelocity.SetV(x);F.m_angularVelocity=w};Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var F=0,E,D=this.m_bodyA,C=this.m_bodyB,B=0,A=E=0,z=0,y=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var F=C.m_sweep.a-D.m_sweep.a-this.m_referenceAngle,x=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(F=Box2D.Common.Math.b2Math.Clamp(F-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),x=-this.m_motorMass*F,B=Math.abs(F)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(F-=this.m_lowerAngle,B=-F,F=Box2D.Common.Math.b2Math.Clamp(F+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),x=-this.m_motorMass*F):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(B=F-=this.m_upperAngle,F=Box2D.Common.Math.b2Math.Clamp(F-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),x=-this.m_motorMass*F);D.m_sweep.a-=D.m_invI*x;C.m_sweep.a+=C.m_invI*x;D.SynchronizeTransform();C.SynchronizeTransform()}E=D.m_xf.R;x=this.m_localAnchor1.x-D.m_sweep.localCenter.x;F=this.m_localAnchor1.y-D.m_sweep.localCenter.y;A=E.col1.x*x+E.col2.x*F;F=E.col1.y*x+E.col2.y*F;x=A;E=C.m_xf.R;var w=this.m_localAnchor2.x-C.m_sweep.localCenter.x,v=this.m_localAnchor2.y-C.m_sweep.localCenter.y,A=E.col1.x*w+E.col2.x*v,v=E.col1.y*w+E.col2.y*v,w=A,z=C.m_sweep.c.x+w-D.m_sweep.c.x-x,y=C.m_sweep.c.y+v-D.m_sweep.c.y-F,u=z*z+y*y;E=Math.sqrt(u);var A=D.m_invMass,s=C.m_invMass,t=D.m_invI,r=C.m_invI,q=10*Box2D.Common.b2Settings.b2_linearSlop;u>q*q&&(u=1/(A+s),z=u*-z,y=u*-y,D.m_sweep.c.x-=0.5*A*z,D.m_sweep.c.y-=0.5*A*y,C.m_sweep.c.x+=0.5*s*z,C.m_sweep.c.y+=0.5*s*y,z=C.m_sweep.c.x+w-D.m_sweep.c.x-x,y=C.m_sweep.c.y+v-D.m_sweep.c.y-F);this.K1.col1.x=A+s;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=A+s;this.K2.col1.x=t*F*F;this.K2.col2.x=-t*x*F;this.K2.col1.y=-t*x*F;this.K2.col2.y=t*x*x;this.K3.col1.x=r*v*v;this.K3.col2.x=-r*w*v;this.K3.col1.y=-r*w*v;this.K3.col2.y=r*w*w;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-z,-y);z=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x;y=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y;D.m_sweep.c.x-=D.m_invMass*z;D.m_sweep.c.y-=D.m_invMass*y;D.m_sweep.a-=D.m_invI*(x*y-F*z);C.m_sweep.c.x+=C.m_invMass*z;C.m_sweep.c.y+=C.m_invMass*y;C.m_sweep.a+=C.m_invI*(w*y-v*z);D.SynchronizeTransform();C.SynchronizeTransform();return E<=Box2D.Common.b2Settings.b2_linearSlop&&B<=Box2D.Common.b2Settings.b2_angularSlop};Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0);Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint;this.localAnchorA.SetZero();this.localAnchorB.SetZero();this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(e,d,f){this.bodyA=e;this.bodyB=d;this.localAnchorA=this.bodyA.GetLocalPoint(f);this.localAnchorB=this.bodyB.GetLocalPoint(f);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)};Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_separations=[];this.m_points=[];for(var b=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++){this.m_points[b]=Box2D.Common.Math.b2Vec2.Get(0,0)}};Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(b){Box2D.Common.b2Settings.b2Assert(0<b.pointCount);switch(b.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(b);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(b);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(b)}};Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(j){var i=j.bodyA.m_xf.R,p=j.localPoint,o=j.bodyA.m_xf.position.x+(i.col1.x*p.x+i.col2.x*p.y),n=j.bodyA.m_xf.position.y+(i.col1.y*p.x+i.col2.y*p.y),i=j.bodyB.m_xf.R,p=j.points[0].localPoint,m=j.bodyB.m_xf.position.x+(i.col1.x*p.x+i.col2.x*p.y),i=j.bodyB.m_xf.position.y+(i.col1.y*p.x+i.col2.y*p.y),p=m-o,l=i-n,k=p*p+l*l;k>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(k=Math.sqrt(k),this.m_normal.x=p/k,this.m_normal.y=l/k):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(o+m);this.m_points[0].y=0.5*(n+i);this.m_separations[0]=p*this.m_normal.x+l*this.m_normal.y-j.radius};Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(h){this.m_normal.x=h.bodyA.m_xf.R.col1.x*h.localPlaneNormal.x+h.bodyA.m_xf.R.col2.x*h.localPlaneNormal.y;this.m_normal.y=h.bodyA.m_xf.R.col1.y*h.localPlaneNormal.x+h.bodyA.m_xf.R.col2.y*h.localPlaneNormal.y;for(var g=h.bodyA.m_xf.position.x+(h.bodyA.m_xf.R.col1.x*h.localPoint.x+h.bodyA.m_xf.R.col2.x*h.localPoint.y),l=h.bodyA.m_xf.position.y+(h.bodyA.m_xf.R.col1.y*h.localPoint.x+h.bodyA.m_xf.R.col2.y*h.localPoint.y),k=0;k<h.pointCount;k++){var j=h.bodyB.m_xf.position.x+(h.bodyB.m_xf.R.col1.x*h.points[k].localPoint.x+h.bodyB.m_xf.R.col2.x*h.points[k].localPoint.y),i=h.bodyB.m_xf.position.y+(h.bodyB.m_xf.R.col1.y*h.points[k].localPoint.x+h.bodyB.m_xf.R.col2.y*h.points[k].localPoint.y);this.m_separations[k]=(j-g)*this.m_normal.x+(i-l)*this.m_normal.y-h.radius;this.m_points[k].x=j;this.m_points[k].y=i}};Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(h){this.m_normal.x=h.bodyB.m_xf.R.col1.x*h.localPlaneNormal.x+h.bodyB.m_xf.R.col2.x*h.localPlaneNormal.y;this.m_normal.y=h.bodyB.m_xf.R.col1.y*h.localPlaneNormal.x+h.bodyB.m_xf.R.col2.y*h.localPlaneNormal.y;for(var g=h.bodyB.m_xf.position.x+(h.bodyB.m_xf.R.col1.x*h.localPoint.x+h.bodyB.m_xf.R.col2.x*h.localPoint.y),l=h.bodyB.m_xf.position.y+(h.bodyB.m_xf.R.col1.y*h.localPoint.x+h.bodyB.m_xf.R.col2.y*h.localPoint.y),k=0;k<h.pointCount;k++){var j=h.bodyA.m_xf.position.x+(h.bodyA.m_xf.R.col1.x*h.points[k].localPoint.x+h.bodyA.m_xf.R.col2.x*h.points[k].localPoint.y),i=h.bodyA.m_xf.position.y+(h.bodyA.m_xf.R.col1.y*h.points[k].localPoint.x+h.bodyA.m_xf.R.col2.y*h.points[k].localPoint.y);this.m_separations[k]=(j-g)*this.m_normal.x+(i-l)*this.m_normal.y-h.radius;this.m_points[k].Set(j,i)}this.m_normal.x*=-1;this.m_normal.y*=-1};Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(d,c){Box2D.Common.b2Settings.b2Assert(d.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape);Box2D.Common.b2Settings.b2Assert(c.GetShape() instanceof Box2D.Collision.Shapes.b2CircleShape);Box2D.Dynamics.Contacts.b2Contact.call(this,d,c)};goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact);Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(d,c){Box2D.Common.b2Settings.b2Assert(d.GetShape() instanceof Box2D.Collision.Shapes.b2PolygonShape);Box2D.Common.b2Settings.b2Assert(c.GetShape() instanceof Box2D.Collision.Shapes.b2CircleShape);Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,d,c)};Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){var d=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,d,this.m_fixtureA.GetBody().m_xf,c,this.m_fixtureB.GetBody().m_xf)};Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0);this.rA=Box2D.Common.Math.b2Vec2.Get(0,0);this.rB=Box2D.Common.Math.b2Vec2.Get(0,0);this.tangentImpulse=this.normalImpulse=0};Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0);this.rA.Set(0,0);this.rB.Set(0,0);this.tangentImpulse=this.normalImpulse=0};Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0);this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0);this.normal=Box2D.Common.Math.b2Vec2.Get(0,0);this.normalMass=new Box2D.Common.Math.b2Mat22;this.K=new Box2D.Common.Math.b2Mat22;this.points=[];for(var b=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++){this.points[b]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint}};Box2D.Dynamics.b2FixtureList=function(){this.fixtureLastNode=this.fixtureFirstNode=null;this.fixtureNodeLookup={};this.fixtureCount=0};Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode};Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(e){var d=e.ID;if(null==this.fixtureNodeLookup[d]){var e=new Box2D.Dynamics.b2FixtureListNode(e),f=this.fixtureLastNode;null!=f?f.SetNextNode(e):this.fixtureFirstNode=e;e.SetPreviousNode(f);this.fixtureLastNode=e;this.fixtureNodeLookup[d]=e;this.fixtureCount++}};Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(e){var e=e.ID,d=this.fixtureNodeLookup[e];if(null!=d){var f=d.GetPreviousNode(),d=d.GetNextNode();null==f?this.fixtureFirstNode=d:f.SetNextNode(d);null==d?this.fixtureLastNode=f:d.SetPreviousNode(f);delete this.fixtureNodeLookup[e];this.fixtureCount--}};Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount};Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0);this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(f,e,h,g){void 0===e&&(e=0);void 0===g&&(g=0);this.linearA.SetV(f);this.angularA=e;this.linearB.SetV(h);this.angularB=g};Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(f,e,h,g){void 0===e&&(e=0);void 0===g&&(g=0);return this.linearA.x*f.x+this.linearA.y*f.y+this.angularA*e+(this.linearB.x*h.x+this.linearB.y*h.y)+this.angularB*g};Box2D.Dynamics.Joints.b2GearJoint=function(g){Box2D.Dynamics.Joints.b2Joint.call(this,g);this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var f=g.joint1.m_type,j=g.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var i=0,h=0;this.m_ground1=g.joint1.GetBodyA();this.m_bodyA=g.joint1.GetBodyB();f==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=g.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),i=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=g.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),i=this.m_prismatic1.GetJointTranslation());this.m_ground2=g.joint2.GetBodyA();this.m_bodyB=g.joint2.GetBodyB();j==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=g.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),h=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=g.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),h=this.m_prismatic2.GetJointTranslation());this.m_ratio=g.ratio;this.m_constant=i+this.m_ratio*h;this.m_impulse=0};goog.inherits(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse*this.m_J.linearB.x,b*this.m_impulse*this.m_J.linearB.y)};Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(g){void 0===g&&(g=0);var f=this.m_bodyB.m_xf.R,j=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,h=f.col1.x*j+f.col2.x*i,i=f.col1.y*j+f.col2.y*i;return g*(this.m_impulse*this.m_J.angularB-h*this.m_impulse*this.m_J.linearB.y+i*this.m_impulse*this.m_J.linearB.x)};Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio};Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(b){void 0===b&&(b=0);this.m_ratio=b};Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(v){var u=this.m_ground1,t=this.m_ground2,s=this.m_bodyA,r=this.m_bodyB,q=0,p=0,o=0,n=0,m=o=0,l=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,l+=s.m_invI):(u=u.m_xf.R,p=this.m_prismatic1.m_localXAxis1,q=u.col1.x*p.x+u.col2.x*p.y,p=u.col1.y*p.x+u.col2.y*p.y,u=s.m_xf.R,o=this.m_localAnchor1.x-s.m_sweep.localCenter.x,n=this.m_localAnchor1.y-s.m_sweep.localCenter.y,m=u.col1.x*o+u.col2.x*n,n=u.col1.y*o+u.col2.y*n,o=m*p-n*q,this.m_J.linearA.Set(-q,-p),this.m_J.angularA=-o,l+=s.m_invMass+s.m_invI*o*o);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*r.m_invI):(u=t.m_xf.R,p=this.m_prismatic2.m_localXAxis1,q=u.col1.x*p.x+u.col2.x*p.y,p=u.col1.y*p.x+u.col2.y*p.y,u=r.m_xf.R,o=this.m_localAnchor2.x-r.m_sweep.localCenter.x,n=this.m_localAnchor2.y-r.m_sweep.localCenter.y,m=u.col1.x*o+u.col2.x*n,n=u.col1.y*o+u.col2.y*n,o=m*p-n*q,this.m_J.linearB.Set(-this.m_ratio*q,-this.m_ratio*p),this.m_J.angularB=-this.m_ratio*o,l+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*o*o));this.m_mass=0<l?1/l:0;v.warmStarting?(s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearA.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearA.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,d=this.m_bodyB,f=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,d.m_linearVelocity,d.m_angularVelocity);this.m_impulse+=f;e.m_linearVelocity.x+=e.m_invMass*f*this.m_J.linearA.x;e.m_linearVelocity.y+=e.m_invMass*f*this.m_J.linearA.y;e.m_angularVelocity+=e.m_invI*f*this.m_J.angularA;d.m_linearVelocity.x+=d.m_invMass*f*this.m_J.linearB.x;d.m_linearVelocity.y+=d.m_invMass*f*this.m_J.linearB.y;d.m_angularVelocity+=d.m_invI*f*this.m_J.angularB};Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(){var f=this.m_bodyA,e=this.m_bodyB,h=0,g=0,h=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),g=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),h=-this.m_mass*(this.m_constant-(h+this.m_ratio*g));f.m_sweep.c.x+=f.m_invMass*h*this.m_J.linearA.x;f.m_sweep.c.y+=f.m_invMass*h*this.m_J.linearA.y;f.m_sweep.a+=f.m_invI*h*this.m_J.angularA;e.m_sweep.c.x+=e.m_invMass*h*this.m_J.linearB.x;e.m_sweep.c.y+=e.m_invMass*h*this.m_J.linearB.y;e.m_sweep.a+=e.m_invI*h*this.m_J.angularB;f.SynchronizeTransform();e.SynchronizeTransform();return 0<Box2D.Common.b2Settings.b2_linearSlop};Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};goog.inherits(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(e,d,f){this.joint1=e;this.bodyA=e.GetBodyA();this.joint2=d;this.bodyB=d.GetBodyA();this.ratio=f};Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)};Box2D.Dynamics.Joints.b2PulleyJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=b.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=b.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=b.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=b.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_ratio=b.ratio;this.m_constant=b.lengthA+this.m_ratio*b.lengthB;this.m_maxLength1=Math.min(b.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=Math.min(b.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};goog.inherits(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse*this.m_u2.x,b*this.m_impulse*this.m_u2.y)};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor1);return b};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var b=this.m_ground.m_xf.position.Copy();b.Add(this.m_groundAnchor2);return b};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var d=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),c=d.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),d=d.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(c*c+d*d)};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var d=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),c=d.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),d=d.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(c*c+d*d)};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(v){var u=this.m_bodyA,t=this.m_bodyB,s;s=u.m_xf.R;var r=this.m_localAnchor1.x-u.m_sweep.localCenter.x,q=this.m_localAnchor1.y-u.m_sweep.localCenter.y,p=s.col1.x*r+s.col2.x*q,q=s.col1.y*r+s.col2.y*q,r=p;s=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,n=this.m_localAnchor2.y-t.m_sweep.localCenter.y,p=s.col1.x*o+s.col2.x*n,n=s.col1.y*o+s.col2.y*n,o=p;s=t.m_sweep.c.x+o;var p=t.m_sweep.c.y+n,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(u.m_sweep.c.x+r-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),u.m_sweep.c.y+q-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(s-m,p-l);s=this.m_u1.Length();p=this.m_u2.Length();s>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/s):this.m_u1.SetZero();p>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/p):this.m_u2.SetZero();0<this.m_constant-s-this.m_ratio*p?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit;s<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit;p<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit;s=r*this.m_u1.y-q*this.m_u1.x;p=o*this.m_u2.y-n*this.m_u2.x;this.m_limitMass1=u.m_invMass+u.m_invI*s*s;this.m_limitMass2=t.m_invMass+t.m_invI*p*p;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;v.warmStarting?(this.m_impulse*=v.dtRatio,this.m_limitImpulse1*=v.dtRatio,this.m_limitImpulse2*=v.dtRatio,v=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,s=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,p=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,m=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,u.m_linearVelocity.x+=u.m_invMass*v,u.m_linearVelocity.y+=u.m_invMass*s,u.m_angularVelocity+=u.m_invI*(r*s-q*v),t.m_linearVelocity.x+=t.m_invMass*p,t.m_linearVelocity.y+=t.m_invMass*m,t.m_angularVelocity+=t.m_invI*(o*m-n*p)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,s=this.m_bodyB,r;r=t.m_xf.R;var q=this.m_localAnchor1.x-t.m_sweep.localCenter.x,p=this.m_localAnchor1.y-t.m_sweep.localCenter.y,o=r.col1.x*q+r.col2.x*p,p=r.col1.y*q+r.col2.y*p,q=o;r=s.m_xf.R;var n=this.m_localAnchor2.x-s.m_sweep.localCenter.x,m=this.m_localAnchor2.y-s.m_sweep.localCenter.y,o=r.col1.x*n+r.col2.x*m,m=r.col1.y*n+r.col2.y*m,n=o,l=o=r=0,k=0;r=k=r=k=l=o=r=0;this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(r=t.m_linearVelocity.x+-t.m_angularVelocity*p,o=t.m_linearVelocity.y+t.m_angularVelocity*q,l=s.m_linearVelocity.x+-s.m_angularVelocity*m,k=s.m_linearVelocity.y+s.m_angularVelocity*n,r=-(this.m_u1.x*r+this.m_u1.y*o)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*k),k=this.m_pulleyMass*-r,r=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+k),k=this.m_impulse-r,r=-k*this.m_u1.x,o=-k*this.m_u1.y,l=-this.m_ratio*k*this.m_u2.x,k=-this.m_ratio*k*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*r,t.m_linearVelocity.y+=t.m_invMass*o,t.m_angularVelocity+=t.m_invI*(q*o-p*r),s.m_linearVelocity.x+=s.m_invMass*l,s.m_linearVelocity.y+=s.m_invMass*k,s.m_angularVelocity+=s.m_invI*(n*k-m*l));this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(r=t.m_linearVelocity.x+-t.m_angularVelocity*p,o=t.m_linearVelocity.y+t.m_angularVelocity*q,r=-(this.m_u1.x*r+this.m_u1.y*o),k=-this.m_limitMass1*r,r=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+k),k=this.m_limitImpulse1-r,r=-k*this.m_u1.x,o=-k*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*r,t.m_linearVelocity.y+=t.m_invMass*o,t.m_angularVelocity+=t.m_invI*(q*o-p*r));this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(l=s.m_linearVelocity.x+-s.m_angularVelocity*m,k=s.m_linearVelocity.y+s.m_angularVelocity*n,r=-(this.m_u2.x*l+this.m_u2.y*k),k=-this.m_limitMass2*r,r=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+k),k=this.m_limitImpulse2-r,l=-k*this.m_u2.x,k=-k*this.m_u2.y,s.m_linearVelocity.x+=s.m_invMass*l,s.m_linearVelocity.y+=s.m_invMass*k,s.m_angularVelocity+=s.m_invI*(n*k-m*l))};Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(){var D=this.m_bodyA,C=this.m_bodyB,B,A=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,z=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,y=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,x=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,w=0,v=0,u=0,t=0,s=B=0,q=0,r=0,p=s=r=B=s=B=0;this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(B=D.m_xf.R,w=this.m_localAnchor1.x-D.m_sweep.localCenter.x,v=this.m_localAnchor1.y-D.m_sweep.localCenter.y,s=B.col1.x*w+B.col2.x*v,v=B.col1.y*w+B.col2.y*v,w=s,B=C.m_xf.R,u=this.m_localAnchor2.x-C.m_sweep.localCenter.x,t=this.m_localAnchor2.y-C.m_sweep.localCenter.y,s=B.col1.x*u+B.col2.x*t,t=B.col1.y*u+B.col2.y*t,u=s,B=D.m_sweep.c.x+w,s=D.m_sweep.c.y+v,q=C.m_sweep.c.x+u,r=C.m_sweep.c.y+t,this.m_u1.Set(B-A,s-z),this.m_u2.Set(q-y,r-x),B=this.m_u1.Length(),s=this.m_u2.Length(),B>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/B):this.m_u1.SetZero(),s>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/s):this.m_u2.SetZero(),B=this.m_constant-B-this.m_ratio*s,p=Math.max(p,-B),B=Box2D.Common.Math.b2Math.Clamp(B+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),r=-this.m_pulleyMass*B,B=-r*this.m_u1.x,s=-r*this.m_u1.y,q=-this.m_ratio*r*this.m_u2.x,r=-this.m_ratio*r*this.m_u2.y,D.m_sweep.c.x+=D.m_invMass*B,D.m_sweep.c.y+=D.m_invMass*s,D.m_sweep.a+=D.m_invI*(w*s-v*B),C.m_sweep.c.x+=C.m_invMass*q,C.m_sweep.c.y+=C.m_invMass*r,C.m_sweep.a+=C.m_invI*(u*r-t*q),D.SynchronizeTransform(),C.SynchronizeTransform());this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(B=D.m_xf.R,w=this.m_localAnchor1.x-D.m_sweep.localCenter.x,v=this.m_localAnchor1.y-D.m_sweep.localCenter.y,s=B.col1.x*w+B.col2.x*v,v=B.col1.y*w+B.col2.y*v,w=s,B=D.m_sweep.c.x+w,s=D.m_sweep.c.y+v,this.m_u1.Set(B-A,s-z),B=this.m_u1.Length(),B>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/B,this.m_u1.y*=1/B):this.m_u1.SetZero(),B=this.m_maxLength1-B,p=Math.max(p,-B),B=Box2D.Common.Math.b2Math.Clamp(B+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),r=-this.m_limitMass1*B,B=-r*this.m_u1.x,s=-r*this.m_u1.y,D.m_sweep.c.x+=D.m_invMass*B,D.m_sweep.c.y+=D.m_invMass*s,D.m_sweep.a+=D.m_invI*(w*s-v*B),D.SynchronizeTransform());this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(B=C.m_xf.R,u=this.m_localAnchor2.x-C.m_sweep.localCenter.x,t=this.m_localAnchor2.y-C.m_sweep.localCenter.y,s=B.col1.x*u+B.col2.x*t,t=B.col1.y*u+B.col2.y*t,u=s,q=C.m_sweep.c.x+u,r=C.m_sweep.c.y+t,this.m_u2.Set(q-y,r-x),s=this.m_u2.Length(),s>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/s,this.m_u2.y*=1/s):this.m_u2.SetZero(),B=this.m_maxLength2-s,p=Math.max(p,-B),B=Box2D.Common.Math.b2Math.Clamp(B+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),r=-this.m_limitMass2*B,q=-r*this.m_u2.x,r=-r*this.m_u2.y,C.m_sweep.c.x+=C.m_invMass*q,C.m_sweep.c.y+=C.m_invMass*r,C.m_sweep.a+=C.m_invI*(u*r-t*q),C.SynchronizeTransform());return p<Box2D.Common.b2Settings.b2_linearSlop};Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1;Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[];this.tangentImpulses=[]};Box2D.Dynamics.b2ContactImpulse.prototype.Reset=function(){this.normalImpulses=[];this.tangentImpulses=[]};Box2D.Dynamics.Contacts.b2ContactListNode=function(b){this.contact=b;this.previous=this.next=null};Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[];Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(d){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var c=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();c.next=null;c.previous=null;c.contact=d;return c}return new Box2D.Dynamics.Contacts.b2ContactListNode(d)};Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(b){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(b)};Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(b){this.next=b};Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(b){this.previous=b};Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact};Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next};Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous};Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var b=0;b<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;b++){this.contactFirstNodes[b]=null}this.contactLastNodes=[];for(b=0;b<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;b++){this.contactLastNodes[b]=null}this.contactNodeLookup={};this.contactCount=0};Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(b){return this.contactFirstNodes[b]};Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(e){var d=e.ID;if(null==this.contactNodeLookup[d]){this.contactNodeLookup[d]=[];for(var f=0;f<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;f++){this.contactNodeLookup[d][f]=null}this.CreateNode(e,d,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);this.contactCount++}};Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(e,d,f){d?this.CreateNode(e,e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);f?this.CreateNode(e,e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)};Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(d){d=d.ID;if(null!=this.contactNodeLookup[d]){for(var c=0;c<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;c++){this.RemoveNode(d,c)}delete this.contactNodeLookup[d];this.contactCount--}};Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(g,f){var j=this.contactNodeLookup[g];if(null!=j){var i=j[f];if(null!=i){j[f]=null;var j=i.GetPreviousNode(),h=i.GetNextNode();null==j?this.contactFirstNodes[f]=h:j.SetNextNode(h);null==h?this.contactLastNodes[f]=j:h.SetPreviousNode(j);Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(i)}}};Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(e,d,f){d=this.contactNodeLookup[d];null==d[f]&&(d[f]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(e),e=this.contactLastNodes[f],null!=e?(e.SetNextNode(d[f]),d[f].SetPreviousNode(e)):this.contactFirstNodes[f]=d[f],this.contactLastNodes[f]=d[f])};Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount};Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2};Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0);this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Collision.b2Segment.prototype.TestSegment=function(x,w,v,u){var t=v.p1,s=v.p2.x-t.x,r=v.p2.y-t.y,v=this.p2.y-this.p1.y,q=-(this.p2.x-this.p1.x),p=100*Number.MIN_VALUE,o=-(s*v+r*q);if(o>p){var n=t.x-this.p1.x,m=t.y-this.p1.y,t=n*v+m*q;if(0<=t&&t<=u*o&&(u=-s*m+r*n,-p*o<=u&&u<=o*(1+p))){return t/=o,u=Math.sqrt(v*v+q*q),x[0]=t,w.Set(v/u,q/u),!0}}return !1};Box2D.Collision.b2Segment.prototype.Extend=function(b){this.ExtendForward(b);this.ExtendBackward(b)};Box2D.Collision.b2Segment.prototype.ExtendForward=function(e){var d=this.p2.x-this.p1.x,f=this.p2.y-this.p1.y,e=Math.min(0<d?(e.upperBound.x-this.p1.x)/d:0>d?(e.lowerBound.x-this.p1.x)/d:Number.POSITIVE_INFINITY,0<f?(e.upperBound.y-this.p1.y)/f:0>f?(e.lowerBound.y-this.p1.y)/f:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+d*e;this.p2.y=this.p1.y+f*e};Box2D.Collision.b2Segment.prototype.ExtendBackward=function(e){var d=-this.p2.x+this.p1.x,f=-this.p2.y+this.p1.y,e=Math.min(0<d?(e.upperBound.x-this.p2.x)/d:0>d?(e.lowerBound.x-this.p2.x)/d:Number.POSITIVE_INFINITY,0<f?(e.upperBound.y-this.p2.y)/f:0>f?(e.lowerBound.y-this.p2.y)/f:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+d*e;this.p1.y=this.p2.y+f*e};Box2D.Dynamics.Joints.b2MouseJoint=function(f){Box2D.Dynamics.Joints.b2Joint.call(this,f);this.K=new Box2D.Common.Math.b2Mat22;this.K1=new Box2D.Common.Math.b2Mat22;this.K2=new Box2D.Common.Math.b2Mat22;this.m_localAnchor=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_target=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_mass=new Box2D.Common.Math.b2Mat22;this.m_C=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_target.SetV(f.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,h=this.m_target.y-this.m_bodyB.m_xf.position.y,g=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*g.col1.x+h*g.col1.y;this.m_localAnchor.y=e*g.col2.x+h*g.col2.y;this.m_maxForce=f.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=f.frequencyHz;this.m_dampingRatio=f.dampingRatio;this.m_gamma=this.m_beta=0};goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA=function(){return Box2D.Common.Math.b2Vec2.Get(this.m_target.x,this.m_target.y)};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce=function(b){void 0===b&&(b=0);return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse.x,b*this.m_impulse.y)};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque=function(){return 0};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget=function(){return this.m_target};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget=function(b){!1==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=b};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce=function(b){void 0===b&&(b=0);this.m_maxForce=b};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency=function(b){void 0===b&&(b=0);this.m_frequencyHz=b};Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio=function(b){void 0===b&&(b=0);this.m_dampingRatio=b};Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints=function(h){var g=this.m_bodyB,l=g.GetMass(),k=2*Math.PI*this.m_frequencyHz,j=l*k*k;this.m_gamma=h.dt*(2*l*this.m_dampingRatio*k+h.dt*j);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=h.dt*j*this.m_gamma;var j=g.m_xf.R,l=this.m_localAnchor.x-g.m_sweep.localCenter.x,k=this.m_localAnchor.y-g.m_sweep.localCenter.y,i=j.col1.x*l+j.col2.x*k,k=j.col1.y*l+j.col2.y*k,l=i,j=g.m_invMass,i=g.m_invI;this.K1.col1.x=j;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=j;this.K2.col1.x=i*k*k;this.K2.col2.x=-i*l*k;this.K2.col1.y=-i*l*k;this.K2.col2.y=i*l*l;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=g.m_sweep.c.x+l-this.m_target.x;this.m_C.y=g.m_sweep.c.y+k-this.m_target.y;g.m_angularVelocity*=0.98;this.m_impulse.x*=h.dtRatio;this.m_impulse.y*=h.dtRatio;g.m_linearVelocity.x+=j*this.m_impulse.x;g.m_linearVelocity.y+=j*this.m_impulse.y;g.m_angularVelocity+=i*(l*this.m_impulse.y-k*this.m_impulse.x)};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints=function(j){var i=this.m_bodyB,p,o=0,n=0;p=i.m_xf.R;var m=this.m_localAnchor.x-i.m_sweep.localCenter.x,l=this.m_localAnchor.y-i.m_sweep.localCenter.y,o=p.col1.x*m+p.col2.x*l,l=p.col1.y*m+p.col2.y*l,m=o,o=i.m_linearVelocity.x+-i.m_angularVelocity*l,k=i.m_linearVelocity.y+i.m_angularVelocity*m;p=this.m_mass;o=o+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;n=k+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;k=-(p.col1.x*o+p.col2.x*n);n=-(p.col1.y*o+p.col2.y*n);p=this.m_impulse.x;o=this.m_impulse.y;this.m_impulse.x+=k;this.m_impulse.y+=n;j=j.dt*this.m_maxForce;this.m_impulse.LengthSquared()>j*j&&this.m_impulse.Multiply(j/this.m_impulse.Length());k=this.m_impulse.x-p;n=this.m_impulse.y-o;i.m_linearVelocity.x+=i.m_invMass*k;i.m_linearVelocity.y+=i.m_invMass*n;i.m_angularVelocity+=i.m_invI*(m*n-l*k)};Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints=function(){return !0};Box2D.Dynamics.b2BodyListNode=function(b){this.body=b;this.previous=this.next=null};Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(b){this.next=b};Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(b){this.previous=b};Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body};Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next};Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous};Box2D.Common.b2Color=function(e,d,f){this._r=255*Box2D.Common.Math.b2Math.Clamp(e,0,1);this._g=255*Box2D.Common.Math.b2Math.Clamp(d,0,1);this._b=255*Box2D.Common.Math.b2Math.Clamp(f,0,1)};Box2D.Common.b2Color.prototype.Set=function(e,d,f){this._r=255*Box2D.Common.Math.b2Math.Clamp(e,0,1);this._g=255*Box2D.Common.Math.b2Math.Clamp(d,0,1);this._b=255*Box2D.Common.Math.b2Math.Clamp(f,0,1)};Box2D.Common.b2Color.prototype.GetColor=function(){return this._r<<16|this._g<<8|this._b};Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var b=0;b<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;b++){this.bodyFirstNodes[b]=null}this.bodyLastNodes=[];for(b=0;b<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;b++){this.bodyLastNodes[b]=null}this.bodyNodeLookup={};this.bodyCount=0};Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(b){return this.bodyFirstNodes[b]};Box2D.Dynamics.b2BodyList.prototype.AddBody=function(d){var c=d.ID;null==this.bodyNodeLookup[c]&&(this.CreateNode(d,c,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(d),d.m_lists.push(this),this.bodyCount++)};Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(g){var f=g.GetType(),j=g.ID,i=g.IsAwake(),h=g.IsActive();f==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(g,j,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(j,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);f!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(g,j,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(j,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies);f!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&h&&i?this.CreateNode(g,j,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(j,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);i?this.CreateNode(g,j,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(j,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);h?this.CreateNode(g,j,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(j,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)};Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(d){var c=d.ID;if(null!=this.bodyNodeLookup[c]){goog.array.remove(d.m_lists,this);for(d=0;d<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;d++){this.RemoveNode(c,d)}delete this.bodyNodeLookup[c];this.bodyCount--}};Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(f,e){var h=this.bodyNodeLookup[f];if(null!=h){var g=h[e];null!=g&&(h[e]=null,h=g.GetPreviousNode(),g=g.GetNextNode(),null==h?this.bodyFirstNodes[e]=g:h.SetNextNode(g),null==g?this.bodyLastNodes[e]=h:g.SetPreviousNode(h))}};Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(g,f,j){var i=this.bodyNodeLookup[f];if(null==i){for(var i=[],h=0;h<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;h++){i[h]=null}this.bodyNodeLookup[f]=i}null==i[j]&&(i[j]=new Box2D.Dynamics.b2BodyListNode(g),g=this.bodyLastNodes[j],null!=g?g.SetNextNode(i[j]):this.bodyFirstNodes[j]=i[j],i[j].SetPreviousNode(g),this.bodyLastNodes[j]=i[j])};Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount};Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5};Box2D.Dynamics.Controllers={};Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++;this.m_world=null;this.bodyList=new Box2D.Dynamics.b2BodyList};Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(){};Box2D.Dynamics.Controllers.b2Controller.prototype.Draw=function(){};Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(b){this.bodyList.AddBody(b);b.AddController(this)};Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(b){this.bodyList.RemoveBody(b);b.RemoveController(this)};Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);b;b=b.GetNextNode()){this.RemoveBody(b.body)}};Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList};Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0;Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this);this.A=Box2D.Common.Math.b2Vec2.Get(0,0)};goog.inherits(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller);Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(f){for(var f=Box2D.Common.Math.b2Vec2.Get(this.A.x*f.dt,this.A.y*f.dt),e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var h=e.body,g=h.GetLinearVelocity(),g=Box2D.Common.Math.b2Vec2.Get(g.x+f.x,g.y+f.y);h.SetLinearVelocity(g);Box2D.Common.Math.b2Vec2.Free(g)}Box2D.Common.Math.b2Vec2.Free(f)};Box2D.Dynamics.Contacts.b2PolygonContact=function(d,c){Box2D.Dynamics.Contacts.b2Contact.call(this,d,c)};goog.inherits(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact);Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(d,c){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,d,c)};Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){var d=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,d,this.m_fixtureA.GetBody().m_xf,c,this.m_fixtureB.GetBody().m_xf)};Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Dynamics.b2Island=function(d,c){this.m_listener=d;this.m_contactSolver=c;this.m_bodies=[];this.m_dynamicBodies=[];this.m_nonStaticBodies=[];this.m_contacts=[];this.m_joints=[];this.impulse=new Box2D.Dynamics.b2ContactImpulse};Box2D.Dynamics.b2Island.prototype.Reset=function(d,c){this.m_listener=d;this.m_contactSolver=c};Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[];this.m_dynamicBodies=[];this.m_nonStaticBodies=[];this.m_contacts=[];this.m_joints=[]};Box2D.Dynamics.b2Island.prototype.Solve=function(e,d,f){this._InitializeVelocities(e,d);this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contacts.length);this._SolveVelocityConstraints(e);this._SolveBodies(e);this._SolvePositionConstraints(e);this.Report(this.m_contactSolver.m_constraints);f&&this._SleepIfTired(e)};Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(b,i){for(var h=0;h<this.m_dynamicBodies.length;h++){var g=this.m_dynamicBodies[h];var f=i.x;var e=i.y;if(g._pc_gravityX!=undefined){f=g._pc_gravityX}if(g._pc_gravityY!=undefined){e=g._pc_gravityY}g.m_linearVelocity.x+=b.dt*(f+g.m_invMass*g.m_force.x);g.m_linearVelocity.y+=b.dt*(e+g.m_invMass*g.m_force.y);g.m_angularVelocity+=b.dt*g.m_invI*g.m_torque;g.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-b.dt*g.m_linearDamping,0,1));g.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-b.dt*g.m_angularDamping,0,1)}};Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(e){this.m_contactSolver.InitVelocityConstraints(e);for(var d=0;d<this.m_joints.length;d++){this.m_joints[d].InitVelocityConstraints(e)}for(d=0;d<e.velocityIterations;d++){for(var f=0;f<this.m_joints.length;f++){this.m_joints[f].SolveVelocityConstraints(e)}this.m_contactSolver.SolveVelocityConstraints()}for(e=0;e<this.m_joints.length;e++){this.m_joints[e].FinalizeVelocityConstraints()}this.m_contactSolver.FinalizeVelocityConstraints()};Box2D.Dynamics.b2Island.prototype._SolveBodies=function(g){for(var f=0;f<this.m_nonStaticBodies.length;++f){var j=this.m_nonStaticBodies[f],i=g.dt*j.m_linearVelocity.x,h=g.dt*j.m_linearVelocity.y;i*i+h*h>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(j.m_linearVelocity.Normalize(),j.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*g.inv_dt,j.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*g.inv_dt);i=g.dt*j.m_angularVelocity;i*i>Box2D.Common.b2Settings.b2_maxRotationSquared&&(j.m_angularVelocity=0>j.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*g.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*g.inv_dt);j.m_sweep.c0.SetV(j.m_sweep.c);j.m_sweep.a0=j.m_sweep.a;j.m_sweep.c.x+=g.dt*j.m_linearVelocity.x;j.m_sweep.c.y+=g.dt*j.m_linearVelocity.y;j.m_sweep.a+=g.dt*j.m_angularVelocity;j.SynchronizeTransform()}};Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(h){for(var g=0;g<h.positionIterations;g++){for(var l=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),k=!0,j=0;j<this.m_joints.length;j++){var i=this.m_joints[j].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),k=k&&i}if(l&&k){break}}};Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(f){for(var e=Number.MAX_VALUE,h=0;h<this.m_nonStaticBodies.length;h++){var g=this.m_nonStaticBodies[h];!g.m_allowSleep||Math.abs(g.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(g.m_linearVelocity,g.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?e=g.m_sleepTime=0:(g.m_sleepTime+=f.dt,e=Math.min(e,g.m_sleepTime))}if(e>=Box2D.Common.b2Settings.b2_timeToSleep){for(f=0;f<this.m_bodies.length;f++){this.m_bodies[f].SetAwake(!1)}}};Box2D.Dynamics.b2Island.prototype.SolveTOI=function(i){var h=0,n=0;this.m_contactSolver.Initialize(i,this.m_contacts,this.m_contacts.length);for(var m=this.m_contactSolver,h=0;h<this.m_joints.length;++h){this.m_joints[h].InitVelocityConstraints(i)}for(h=0;h<i.velocityIterations;++h){m.SolveVelocityConstraints();for(n=0;n<this.m_joints.length;++n){this.m_joints[n].SolveVelocityConstraints(i)}}for(h=0;h<this.m_nonStaticBodies.length;++h){var n=this.m_nonStaticBodies[h],l=i.dt*n.m_linearVelocity.x,k=i.dt*n.m_linearVelocity.y;l*l+k*k>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*i.inv_dt,n.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*i.inv_dt);l=i.dt*n.m_angularVelocity;l*l>Box2D.Common.b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*i.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*i.inv_dt);n.m_sweep.c0.SetV(n.m_sweep.c);n.m_sweep.a0=n.m_sweep.a;n.m_sweep.c.x+=i.dt*n.m_linearVelocity.x;n.m_sweep.c.y+=i.dt*n.m_linearVelocity.y;n.m_sweep.a+=i.dt*n.m_angularVelocity;n.SynchronizeTransform()}for(h=0;h<i.positionIterations;++h){l=m.SolvePositionConstraints(0.75);k=!0;for(n=0;n<this.m_joints.length;++n){var j=this.m_joints[n].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),k=k&&j}if(l&&k){break}}this.Report(m.m_constraints)};Box2D.Dynamics.b2Island.prototype.Report=function(g){if(null!=this.m_listener){for(var f=0;f<this.m_contacts.length;++f){var j=this.m_contacts[f],i=g[f];this.impulse.Reset();for(var h=0;h<i.pointCount;++h){this.impulse.normalImpulses[h]=i.points[h].normalImpulse,this.impulse.tangentImpulses[h]=i.points[h].tangentImpulse}this.m_listener.PostSolve(j,this.impulse)}}};Box2D.Dynamics.b2Island.prototype.AddBody=function(b){this.m_bodies.push(b);b.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(b),b.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(b))};Box2D.Dynamics.b2Island.prototype.AddContact=function(b){this.m_contacts.push(b)};Box2D.Dynamics.b2Island.prototype.AddJoint=function(b){this.m_joints.push(b)};Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null;this.poolCount=0};Box2D.Collision.b2DynamicTreePair=function(d,c){this.fixtureA=d;this.fixtureB=c};Box2D.Collision.b2DynamicTreePair._freeCache=[];Box2D.Collision.b2DynamicTreePair.Get=function(e,d){if(0<Box2D.Collision.b2DynamicTreePair._freeCache.length){var f=Box2D.Collision.b2DynamicTreePair._freeCache.pop();f.fixtureA=e;f.fixtureB=d;return f}return new Box2D.Collision.b2DynamicTreePair(e,d)};Box2D.Collision.b2DynamicTreePair.Free=function(b){null!=b&&(Box2D.Collision.b2DynamicTreePair._freeCache.push(b))};Box2D.Dynamics.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;this.m_drawFlags=0;this.m_originX=0;this.m_originY=0;this.m_ctx=null};Box2D.Dynamics.b2DebugDraw.prototype.SetOrigin=function(b,c){this.m_originX=b;this.m_originY=c};Box2D.Dynamics.b2DebugDraw.prototype.Clear=function(){};Box2D.Dynamics.b2DebugDraw.prototype._color=function(d,c){return"rgba("+((d&16711680)>>16)+","+((d&65280)>>8)+","+(d&255)+","+c+")"};Box2D.Dynamics.b2DebugDraw.prototype.SetFlags=function(b){this.m_drawFlags=b};Box2D.Dynamics.b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags};Box2D.Dynamics.b2DebugDraw.prototype.AppendFlags=function(b){this.m_drawFlags|=b};Box2D.Dynamics.b2DebugDraw.prototype.ClearFlags=function(b){this.m_drawFlags&=~b};Box2D.Dynamics.b2DebugDraw.prototype.SetSprite=function(b){this.m_ctx=b};Box2D.Dynamics.b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx};Box2D.Dynamics.b2DebugDraw.prototype.SetDrawScale=function(b){this.m_drawScale=b};Box2D.Dynamics.b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale};Box2D.Dynamics.b2DebugDraw.prototype.SetLineThickness=function(b){this.m_lineThickness=b;this.m_ctx.strokeWidth=b};Box2D.Dynamics.b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness};Box2D.Dynamics.b2DebugDraw.prototype.SetAlpha=function(b){this.m_alpha=b};Box2D.Dynamics.b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha};Box2D.Dynamics.b2DebugDraw.prototype.SetFillAlpha=function(b){this.m_fillAlpha=b};Box2D.Dynamics.b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha};Box2D.Dynamics.b2DebugDraw.prototype.SetXFormScale=function(b){this.m_xformScale=b};Box2D.Dynamics.b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale};(function(b){b.prototype.DrawPolygon=function(g,k,j){if(k){var i=this.m_ctx,h=this.m_drawScale;i.beginPath();i.strokeStyle=this._color(j.GetColor(),this.m_alpha);i.moveTo((g[0].x*h)-this.m_originX,(g[0].y*h)-this.m_originY);for(j=1;j<k;j++){i.lineTo((g[j].x*h)-this.m_originX,(g[j].y*h)-this.m_originY)}i.lineTo((g[0].x*h)-this.m_originX,(g[0].y*h)-this.m_originY);i.closePath();i.stroke()}};b.prototype.DrawSolidPolygon=function(g,k,j){if(k){var i=this.m_ctx,h=this.m_drawScale;i.beginPath();i.strokeStyle=this._color(j.GetColor(),this.m_alpha);i.fillStyle=this._color(j.GetColor(),this.m_fillAlpha);i.moveTo((g[0].x*h)-this.m_originX,(g[0].y*h)-this.m_originY);for(j=1;j<k;j++){i.lineTo((g[j].x*h)-this.m_originX,(g[j].y*h)-this.m_originY)}i.lineTo((g[0].x*h)-this.m_originX,(g[0].y*h)-this.m_originY);i.closePath();i.fill();i.stroke()}};b.prototype.DrawCircle=function(g,k,j){if(k){var i=this.m_ctx,h=this.m_drawScale;i.beginPath();i.strokeStyle=this._color(j.GetColor(),this.m_alpha);i.arc((g.x*h)-this.m_originX,(g.y*h)-this.m_originY,k*h,0,2*Math.PI,!0);i.closePath();i.stroke()}};b.prototype.DrawSolidCircle=function(j,q,p,o){if(q){var n=this.m_ctx,m=this.m_drawScale,l=(j.x*m)-this.m_originX,k=(j.y*m)-this.m_originY;n.moveTo(0,0);n.beginPath();n.strokeStyle=this._color(o.GetColor(),this.m_alpha);n.fillStyle=this._color(o.GetColor(),this.m_fillAlpha);n.arc(l,k,q*m,0,2*Math.PI,!0);n.moveTo(l,k);n.lineTo(((j.x+p.x*q)*m)-this.m_originX,((j.y+p.y*q)*m)-this.m_originY);n.closePath();n.fill();n.stroke()}};b.prototype.DrawSegment=function(g,k,j){var i=this.m_ctx,h=this.m_drawScale;i.strokeStyle=this._color(j.GetColor(),this.m_alpha);i.beginPath();i.moveTo((g.x*h)-this.m_originX,(g.y*h)-this.m_originY);i.lineTo((k.x*h)-this.m_originX,(k.y*h)-this.m_originY);i.closePath();i.stroke()};b.prototype.DrawTransform=function(e){var g=this.m_ctx,f=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(16711680,this.m_alpha);g.moveTo((e.position.x*f)-this.m_originX,(e.position.y*f)-this.m_originY);g.lineTo(((e.position.x+this.m_xformScale*e.R.col1.x)*f)-this.m_originX,((e.position.y+this.m_xformScale*e.R.col1.y)*f)-this.m_originY);g.strokeStyle=this._color(65280,this.m_alpha);g.moveTo((e.position.x*f)-this.m_originX,(e.position.y*f)-this.m_originY);g.lineTo(((e.position.x+this.m_xformScale*e.R.col2.x)*f)-this.m_originX,((e.position.y+this.m_xformScale*e.R.col2.y)*f)-this.m_originY);g.closePath();g.stroke()}})(Box2D.Dynamics.b2DebugDraw);Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32;Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)};Box2D.Dynamics.iContactFilter=function(){};Box2D.Dynamics.iContactFilter.prototype.ShouldCollide=function(){};Box2D.Dynamics.b2ContactFilter=function(){};Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(f,e){var h=f.GetFilterData(),g=e.GetFilterData();return h.groupIndex==g.groupIndex&&0!=h.groupIndex?0<h.groupIndex:0!=(h.maskBits&g.categoryBits)&&0!=(h.categoryBits&g.maskBits)};Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter;Box2D.Dynamics.Joints.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.target=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};goog.inherits(Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2MouseJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2MouseJoint(this)};Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={};this.m_freeContacts={};this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME);this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME);this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME);this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME);this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)};Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(e,d,f){this.m_freeContacts[d]=this.m_freeContacts[d]||{};this.m_freeContacts[d][f]=this.m_freeContacts[d][f]||[];this.m_registers[d]=this.m_registers[d]||{};this.m_registers[d][f]=new Box2D.Dynamics.Contacts.b2ContactRegister;this.m_registers[d][f].ctor=e;this.m_registers[d][f].primary=!0;d!=f&&(this.m_registers[f]=this.m_registers[f]||{},this.m_registers[f][d]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[f][d].ctor=e,this.m_registers[f][d].primary=!1)};Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(h,g){var l=h.GetShape().GetTypeName(),k=g.GetShape().GetTypeName(),j=this.m_registers[l][k],i=j.ctor;return null!=i?j.primary?0<this.m_freeContacts[l][k].length?(l=this.m_freeContacts[l][k].pop(),l.Reset(h,g),l):new i(h,g):0<this.m_freeContacts[k][l].length?(l=this.m_freeContacts[k][l].pop(),l.Reset(g,h),l):new i(g,h):null};Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(e){var d=e.GetFixtureA().GetShape().GetTypeName(),f=e.GetFixtureB().GetShape().GetTypeName();this.m_freeContacts[d][f].push(e)};Box2D.Dynamics.b2ContactListener=function(){};Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(){};Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(){};Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(){};Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(){};Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener;Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0);this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0);this.normal=Box2D.Common.Math.b2Vec2.Get(0,0);this.id=new Box2D.Collision.b2ContactID};Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree;this.m_moveBuffer=[];this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(e,d){var f=this.m_tree.CreateProxy(e,d);this.BufferMove(f);return f};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(b){this.UnBufferMove(b);this.m_tree.DestroyProxy(b)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(e,d,f){this.m_tree.MoveProxy(e,d,f)&&this.BufferMove(e)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(f,e){var h=this.m_tree.GetFatAABB(f),g=this.m_tree.GetFatAABB(e);return h.TestOverlap(g)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(b){return this.m_tree.GetFatAABB(b)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(b){this.lastQueryFixtureB=this.lastQueryFixtureA=null;for(this.updatePairsCallback=b;0<this.m_moveBuffer.length;){this.queryProxy=this.m_moveBuffer.pop(),this.m_tree.Query(this.QueryCallback,this.m_tree.GetFatAABB(this.queryProxy),this)}this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.QueryCallback=function(b){b!=this.queryProxy.fixture&&(!(this.queryProxy.fixture==this.lastQueryFixtureA&&b==this.lastQueryFixtureB)&&!(this.queryProxy.fixture==this.lastQueryFixtureB&&b==this.lastQueryFixtureA))&&(this.updatePairsCallback(this.queryProxy.fixture,b),this.lastQueryFixtureA=this.queryProxy.fixture,this.lastQueryFixtureB=b);return !0};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(d,c){this.m_tree.Query(d,c)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(d,c){this.m_tree.RayCast(d,c)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(b){this.m_tree.Rebalance(b)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(b){this.m_moveBuffer.push(b)};Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(b){goog.array.remove(this.m_moveBuffer,b)};Box2D.Collision.b2DynamicTreeBroadPhase.__implements={};Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0;Box2D.Dynamics.b2ContactManager=function(b){this.m_world=b;this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter;this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener;this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory;this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase};Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(f,e){var h=f.GetBody(),g=e.GetBody();if(h!=g&&g.ShouldCollide(h)&&this.m_contactFilter.ShouldCollide(f,e)){for(h=g.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);h;h=h.GetNextNode()){if(g=h.contact.GetFixtureA(),g==f){if(g=h.contact.GetFixtureB(),g==e){return}}else{if(g==e&&(g=h.contact.GetFixtureB(),g==f)){return}}}this.m_contactFactory.Create(f,e)}};Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var b=this;this.m_broadPhase.UpdatePairs(function(d,e){b.AddPair(d,e)})};Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(e){var d=e.GetFixtureA(),f=e.GetFixtureB(),d=d.GetBody(),f=f.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e);0<e.m_manifold.m_pointCount&&(d.SetAwake(!0),f.SetAwake(!0));e.RemoveFromLists();this.m_contactFactory.Destroy(e)};Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var h=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);h;h=h.GetNextNode()){var g=h.contact,l=g.GetFixtureA(),k=g.GetFixtureB(),j=l.GetBody(),i=k.GetBody();if(j.IsAwake()||i.IsAwake()){if(g.IsFiltering()){if(!i.ShouldCollide(j)){this.Destroy(g);continue}if(!this.m_contactFilter.ShouldCollide(l,k)){this.Destroy(g);continue}g.ClearFiltering()}this.m_broadPhase.TestOverlap(l.m_proxy,k.m_proxy)?g.Update(this.m_contactListener):this.Destroy(g)}}};Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint;Box2D.Dynamics.Joints.b2DistanceJoint=function(b){Box2D.Dynamics.Joints.b2Joint.call(this,b);this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1.SetV(b.localAnchorA);this.m_localAnchor2.SetV(b.localAnchorB);this.m_length=b.length;this.m_frequencyHz=b.frequencyHz;this.m_dampingRatio=b.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};goog.inherits(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint);Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(b){return Box2D.Common.Math.b2Vec2.Get(b*this.m_impulse*this.m_u.x,b*this.m_impulse*this.m_u.y)};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(b){this.m_length=b};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(b){this.m_frequencyHz=b};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(b){this.m_dampingRatio=b};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(v){var u,t=0,s=this.m_bodyA,r=this.m_bodyB;u=s.m_xf.R;var q=this.m_localAnchor1.x-s.m_sweep.localCenter.x,p=this.m_localAnchor1.y-s.m_sweep.localCenter.y,t=u.col1.x*q+u.col2.x*p,p=u.col1.y*q+u.col2.y*p,q=t;u=r.m_xf.R;var o=this.m_localAnchor2.x-r.m_sweep.localCenter.x,n=this.m_localAnchor2.y-r.m_sweep.localCenter.y,t=u.col1.x*o+u.col2.x*n,n=u.col1.y*o+u.col2.y*n,o=t;this.m_u.x=r.m_sweep.c.x+o-s.m_sweep.c.x-q;this.m_u.y=r.m_sweep.c.y+n-s.m_sweep.c.y-p;t=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);t>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/t):this.m_u.SetZero();u=q*this.m_u.y-p*this.m_u.x;var m=o*this.m_u.y-n*this.m_u.x;u=s.m_invMass+s.m_invI*u*u+r.m_invMass+r.m_invI*m*m;this.m_mass=0!=u?1/u:0;if(0<this.m_frequencyHz){var t=t-this.m_length,m=2*Math.PI*this.m_frequencyHz,l=this.m_mass*m*m;this.m_gamma=v.dt*(2*this.m_mass*this.m_dampingRatio*m+v.dt*l);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=t*v.dt*l*this.m_gamma;this.m_mass=u+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}v.warmStarting?(this.m_impulse*=v.dtRatio,v=this.m_impulse*this.m_u.x,u=this.m_impulse*this.m_u.y,s.m_linearVelocity.x-=s.m_invMass*v,s.m_linearVelocity.y-=s.m_invMass*u,s.m_angularVelocity-=s.m_invI*(q*u-p*v),r.m_linearVelocity.x+=r.m_invMass*v,r.m_linearVelocity.y+=r.m_invMass*u,r.m_angularVelocity+=r.m_invI*(o*u-n*v)):this.m_impulse=0};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var h=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,g=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,l=this.m_bodyA.m_xf.R.col1.x*h+this.m_bodyA.m_xf.R.col2.x*g,g=this.m_bodyA.m_xf.R.col1.y*h+this.m_bodyA.m_xf.R.col2.y*g,h=l,k=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,j=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,l=this.m_bodyB.m_xf.R.col1.x*k+this.m_bodyB.m_xf.R.col2.x*j,j=this.m_bodyB.m_xf.R.col1.y*k+this.m_bodyB.m_xf.R.col2.y*j,k=l,i=-this.m_mass*(this.m_u.x*(this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*j-(this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*g))+this.m_u.y*(this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*k-(this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*h))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=i;l=i*this.m_u.x;i*=this.m_u.y;this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*l;this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*i;this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(h*i-g*l);this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*l;this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*i;this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(k*i-j*l)};Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(){if(0<this.m_frequencyHz){return !0}var j=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,p=this.m_bodyA.m_xf.R.col1.x*j+this.m_bodyA.m_xf.R.col2.x*i,i=this.m_bodyA.m_xf.R.col1.y*j+this.m_bodyA.m_xf.R.col2.y*i,j=p,o=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,p=this.m_bodyB.m_xf.R.col1.x*o+this.m_bodyB.m_xf.R.col2.x*n,n=this.m_bodyB.m_xf.R.col1.y*o+this.m_bodyB.m_xf.R.col2.y*n,o=p,m=this.m_bodyB.m_sweep.c.x+o-this.m_bodyA.m_sweep.c.x-j,l=this.m_bodyB.m_sweep.c.y+n-this.m_bodyA.m_sweep.c.y-i,p=Math.sqrt(m*m+l*l),m=m/p,l=l/p,p=Box2D.Common.Math.b2Math.Clamp(p-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),k=-this.m_mass*p;this.m_u.Set(m,l);m=k*this.m_u.x;l=k*this.m_u.y;this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*m;this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*l;this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(j*l-i*m);this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*m;this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*l;this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(o*l-n*m);this.m_bodyA.SynchronizeTransform();this.m_bodyB.SynchronizeTransform();return Math.abs(p)<Box2D.Common.b2Settings.b2_linearSlop};Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};goog.inherits(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(f,e,h,g){this.bodyA=f;this.bodyB=e;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(h));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(g));f=g.x-h.x;h=g.y-h.y;this.length=Math.sqrt(f*f+h*h);this.dampingRatio=this.frequencyHz=0};Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)};Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this);this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1);this.density=this.offset=0;this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};goog.inherits(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller);Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity());for(var t=Box2D.Common.Math.b2Vec2.Get(0,0),s=Box2D.Common.Math.b2Vec2.Get(0,0),r=Box2D.Common.Math.b2Vec2.Get(0,0),q=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);q;q=q.GetNextNode()){s.Set(0,0);t.Set(0,0);for(var p=q.body,o=0,n=0,m=p.GetFixtureList().GetFirstNode();m;m=m.GetNextNode()){r.Set(0,0);var l=m.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,p.GetTransform(),r),o=o+l;t.x+=l*r.x;t.y+=l*r.y;var k=0,k=1,n=n+l*k;s.x+=l*r.x*k;s.y+=l*r.y*k}o<Number.MIN_VALUE||(t.x/=o,t.y/=o,s.x/=n,s.y/=n,n=this.gravity.GetNegative(),n.Multiply(this.density*o),p.ApplyForce(n,s),Box2D.Common.Math.b2Vec2.Free(n),n=p.GetLinearVelocityFromWorldPoint(t),n.Subtract(this.velocity),n.Multiply(-this.linearDrag*o),p.ApplyForce(n,t),Box2D.Common.Math.b2Vec2.Free(n),p.ApplyTorque(-p.GetInertia()/p.GetMass()*o*p.GetAngularVelocity()*this.angularDrag))}Box2D.Common.Math.b2Vec2.Free(r);Box2D.Common.Math.b2Vec2.Free(s);Box2D.Common.Math.b2Vec2.Free(t)};Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Draw=function(e){var d=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset+1000*this.normal.y,this.normal.y*this.offset-1000*this.normal.x),f=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset-1000*this.normal.y,this.normal.y*this.offset+1000*this.normal.x);e.DrawSegment(d,f,Box2D.Dynamics.Controllers.b2BuoyancyController.color);Box2D.Common.Math.b2Vec2.Free(d);Box2D.Common.Math.b2Vec2.Free(f)};Box2D.Dynamics.Controllers.b2BuoyancyController.color=new Box2D.Common.b2Color(0,0,1);Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this);this.G=1;this.invSqr=!0};goog.inherits(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller);Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(){var t=null,s=null,r=0,q=null,p=null,o=0,n=0,m=0,o=null;if(this.invSqr){for(var l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode()){for(var t=l.body,s=t.GetWorldCenter(),r=t.GetMass(),k=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);k;k=k.GetNextNode()){if(q=k.body,t.IsAwake()||q.IsAwake()){p=q.GetWorldCenter(),o=p.x-s.x,n=p.y-s.y,m=o*o+n*n,m<Number.MIN_VALUE||(o=Box2D.Common.Math.b2Vec2.Get(o,n),o.Multiply(this.G/m/Math.sqrt(m)*r*q.GetMass()),t.IsAwake()&&t.ApplyForce(o,s),o.Multiply(-1),q.IsAwake()&&q.ApplyForce(o,p),Box2D.Common.Math.b2Vec2.Free(o))}}}}else{for(l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode()){t=bodyNode.body;s=t.GetWorldCenter();r=t.GetMass();for(k=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);k;k=k.GetNextNode()){if(q=bodyNode.body,t.IsAwake()||q.IsAwake()){p=q.GetWorldCenter(),o=p.x-s.x,n=p.y-s.y,m=o*o+n*n,m<Number.MIN_VALUE||(o=Box2D.Common.Math.b2Vec2.Get(o,n),o.Multiply(this.G/m*r*q.GetMass()),t.IsAwake()&&t.ApplyForce(o,s),o.Multiply(-1),q.IsAwake()&&q.ApplyForce(o,p),Box2D.Common.Math.b2Vec2.Free(o))}}}}};Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_points=[];for(var b=this.m_pointCount=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++){this.m_points[b]=Box2D.Common.Math.b2Vec2.Get(0,0)}};Box2D.Collision.b2WorldManifold.prototype.Initialize=function(z,y,x,w,v){if(0!=z.m_pointCount){var u=0,t,s,r=0,q=0,p=0,o=0,m=0;t=0;switch(z.m_type){case Box2D.Collision.b2Manifold.e_circles:s=y.R;t=z.m_localPoint;u=y.position.x+s.col1.x*t.x+s.col2.x*t.y;y=y.position.y+s.col1.y*t.x+s.col2.y*t.y;s=w.R;t=z.m_points[0].m_localPoint;z=w.position.x+s.col1.x*t.x+s.col2.x*t.y;w=w.position.y+s.col1.y*t.x+s.col2.y*t.y;t=z-u;s=w-y;r=t*t+s*s;r>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(r=Math.sqrt(r),this.m_normal.x=t/r,this.m_normal.y=s/r):(this.m_normal.x=1,this.m_normal.y=0);t=y+x*this.m_normal.y;w-=v*this.m_normal.y;this.m_points[0].x=0.5*(u+x*this.m_normal.x+(z-v*this.m_normal.x));this.m_points[0].y=0.5*(t+w);break;case Box2D.Collision.b2Manifold.e_faceA:s=y.R;t=z.m_localPlaneNormal;r=s.col1.x*t.x+s.col2.x*t.y;q=s.col1.y*t.x+s.col2.y*t.y;s=y.R;t=z.m_localPoint;p=y.position.x+s.col1.x*t.x+s.col2.x*t.y;o=y.position.y+s.col1.y*t.x+s.col2.y*t.y;this.m_normal.x=r;this.m_normal.y=q;for(u=0;u<z.m_pointCount;u++){s=w.R,t=z.m_points[u].m_localPoint,m=w.position.x+s.col1.x*t.x+s.col2.x*t.y,t=w.position.y+s.col1.y*t.x+s.col2.y*t.y,this.m_points[u].x=m+0.5*(x-(m-p)*r-(t-o)*q-v)*r,this.m_points[u].y=t+0.5*(x-(m-p)*r-(t-o)*q-v)*q}break;case Box2D.Collision.b2Manifold.e_faceB:s=w.R;t=z.m_localPlaneNormal;r=s.col1.x*t.x+s.col2.x*t.y;q=s.col1.y*t.x+s.col2.y*t.y;s=w.R;t=z.m_localPoint;p=w.position.x+s.col1.x*t.x+s.col2.x*t.y;o=w.position.y+s.col1.y*t.x+s.col2.y*t.y;this.m_normal.x=-r;this.m_normal.y=-q;for(u=0;u<z.m_pointCount;u++){s=y.R,t=z.m_points[u].m_localPoint,m=y.position.x+s.col1.x*t.x+s.col2.x*t.y,t=y.position.y+s.col1.y*t.x+s.col2.y*t.y,this.m_points[u].x=m+0.5*(v-(m-p)*r-(t-o)*q-x)*r,this.m_points[u].y=t+0.5*(v-(m-p)*r-(t-o)*q-x)*q}}}};Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(V,U,T){for(this.m_constraintCount=T;this.m_constraints.length<this.m_constraintCount;){this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint}for(V=0;V<T;V++){var S=U[V],R=S.m_fixtureA,Q=S.m_fixtureB,P=R.m_shape.m_radius,O=Q.m_shape.m_radius,N=R.GetBody(),M=Q.GetBody(),L=S.GetManifold(),K=Box2D.Common.b2Settings.b2MixFriction(R.GetFriction(),Q.GetFriction()),I=Box2D.Common.b2Settings.b2MixRestitution(R.GetRestitution(),Q.GetRestitution()),J=N.m_linearVelocity.x,H=N.m_linearVelocity.y,G=M.m_linearVelocity.x,F=M.m_linearVelocity.y,E=N.m_angularVelocity,y=M.m_angularVelocity;Box2D.Common.b2Settings.b2Assert(0<L.m_pointCount);Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(L,N.m_xf,P,M.m_xf,O);Q=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x;S=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y;R=this.m_constraints[V];R.bodyA=N;R.bodyB=M;R.manifold=L;R.normal.x=Q;R.normal.y=S;R.pointCount=L.m_pointCount;R.friction=K;R.restitution=I;R.localPlaneNormal.x=L.m_localPlaneNormal.x;R.localPlaneNormal.y=L.m_localPlaneNormal.y;R.localPoint.x=L.m_localPoint.x;R.localPoint.y=L.m_localPoint.y;R.radius=P+O;R.type=L.m_type;for(P=0;P<R.pointCount;++P){K=L.m_points[P];O=R.points[P];O.normalImpulse=K.m_normalImpulse;O.tangentImpulse=K.m_tangentImpulse;O.localPoint.SetV(K.m_localPoint);var K=O.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[P].x-N.m_sweep.c.x,I=O.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[P].y-N.m_sweep.c.y,A=O.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[P].x-M.m_sweep.c.x,z=O.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[P].y-M.m_sweep.c.y,C=K*S-I*Q,D=A*S-z*Q,C=C*C,D=D*D;O.normalMass=1/(N.m_invMass+M.m_invMass+N.m_invI*C+M.m_invI*D);var B=N.m_mass*N.m_invMass+M.m_mass*M.m_invMass,B=B+(N.m_mass*N.m_invI*C+M.m_mass*M.m_invI*D);O.equalizedMass=1/B;D=S;B=-Q;C=K*B-I*D;D=A*B-z*D;C*=C;D*=D;O.tangentMass=1/(N.m_invMass+M.m_invMass+N.m_invI*C+M.m_invI*D);O.velocityBias=0;K=R.normal.x*(G+-y*z-J- -E*I)+R.normal.y*(F+y*A-H-E*K);K<-Box2D.Common.b2Settings.b2_velocityThreshold&&(O.velocityBias+=-R.restitution*K)}2==R.pointCount&&(F=R.points[0],G=R.points[1],L=N.m_invMass,N=N.m_invI,J=M.m_invMass,M=M.m_invI,H=F.rA.x*S-F.rA.y*Q,F=F.rB.x*S-F.rB.y*Q,E=G.rA.x*S-G.rA.y*Q,G=G.rB.x*S-G.rB.y*Q,Q=L+J+N*H*H+M*F*F,S=L+J+N*E*E+M*G*G,M=L+J+N*H*E+M*F*G,Q*Q<100*(Q*S-M*M)?(R.K.col1.Set(Q,M),R.K.col2.Set(M,S),R.K.GetInverse(R.normalMass)):R.pointCount=1)}};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(J){for(var I=0;I<this.m_constraintCount;++I){var H=this.m_constraints[I],G=H.bodyA,F=H.bodyB,E=G.m_invMass,D=G.m_invI,C=F.m_invMass,B=F.m_invI,A=H.normal.x,z=H.normal.y,y=z,w=-A,x=0,v=0;if(J.warmStarting){v=H.pointCount;for(x=0;x<v;++x){var u=H.points[x];u.normalImpulse*=J.dtRatio;u.tangentImpulse*=J.dtRatio;var t=u.normalImpulse*A+u.tangentImpulse*y,s=u.normalImpulse*z+u.tangentImpulse*w;G.m_angularVelocity-=D*(u.rA.x*s-u.rA.y*t);G.m_linearVelocity.x-=E*t;G.m_linearVelocity.y-=E*s;F.m_angularVelocity+=B*(u.rB.x*s-u.rB.y*t);F.m_linearVelocity.x+=C*t;F.m_linearVelocity.y+=C*s}}else{v=H.pointCount;for(x=0;x<v;++x){G=H.points[x],G.normalImpulse=0,G.tangentImpulse=0}}}};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var b=0;b<this.m_constraintCount;b++){this.SolveVelocityConstraints_Constraint(this.m_constraints[b])}};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(r){for(var q=r.normal.x,p=r.normal.y,o=0;o<r.pointCount;o++){Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(r,r.points[o])}if(1==r.pointCount){var o=r.points[0],n=o.normalImpulse-o.normalMass*((r.bodyB.m_linearVelocity.x-r.bodyB.m_angularVelocity*o.rB.y-r.bodyA.m_linearVelocity.x+r.bodyA.m_angularVelocity*o.rA.y)*q+(r.bodyB.m_linearVelocity.y+r.bodyB.m_angularVelocity*o.rB.x-r.bodyA.m_linearVelocity.y-r.bodyA.m_angularVelocity*o.rA.x)*p-o.velocityBias),n=0<n?n:0,m=n-o.normalImpulse,l=m*q,p=m*p;r.bodyA.m_linearVelocity.x-=r.bodyA.m_invMass*l;r.bodyA.m_linearVelocity.y-=r.bodyA.m_invMass*p;r.bodyA.m_angularVelocity-=r.bodyA.m_invI*(o.rA.x*p-o.rA.y*l);r.bodyB.m_linearVelocity.x+=r.bodyB.m_invMass*l;r.bodyB.m_linearVelocity.y+=r.bodyB.m_invMass*p;r.bodyB.m_angularVelocity+=r.bodyB.m_invI*(o.rB.x*p-o.rB.y*l);o.normalImpulse=n}else{for(var o=r.points[0],n=r.points[1],m=o.normalImpulse,l=n.normalImpulse,k=(r.bodyB.m_linearVelocity.x-r.bodyB.m_angularVelocity*o.rB.y-r.bodyA.m_linearVelocity.x+r.bodyA.m_angularVelocity*o.rA.y)*q+(r.bodyB.m_linearVelocity.y+r.bodyB.m_angularVelocity*o.rB.x-r.bodyA.m_linearVelocity.y-r.bodyA.m_angularVelocity*o.rA.x)*p-o.velocityBias,p=(r.bodyB.m_linearVelocity.x-r.bodyB.m_angularVelocity*n.rB.y-r.bodyA.m_linearVelocity.x+r.bodyA.m_angularVelocity*n.rA.y)*q+(r.bodyB.m_linearVelocity.y+r.bodyB.m_angularVelocity*n.rB.x-r.bodyA.m_linearVelocity.y-r.bodyA.m_angularVelocity*n.rA.x)*p-n.velocityBias,k=k-(r.K.col1.x*m+r.K.col2.x*l),p=p-(r.K.col1.y*m+r.K.col2.y*l);;){q=-(r.normalMass.col1.x*k+r.normalMass.col2.x*p);if(0<=q){var j=-(r.normalMass.col1.y*k+r.normalMass.col2.y*p);if(0<=j){this.SolveVelocityConstraints_ConstraintPointUpdate(r,o,n,q-m,j-l);o.normalImpulse=q;n.normalImpulse=j;break}}q=-o.normalMass*k;if(0<=q&&0<=r.K.col1.y*q+p){this.SolveVelocityConstraints_ConstraintPointUpdate(r,o,n,q-m,-l);o.normalImpulse=q;n.normalImpulse=0;break}q=-n.normalMass*p;if(0<=q&&0<=r.K.col2.x*q+k){this.SolveVelocityConstraints_ConstraintPointUpdate(r,o,n,-m,q-l);o.normalImpulse=0;n.normalImpulse=q;break}if(0<=k&&0<=p){this.SolveVelocityConstraints_ConstraintPointUpdate(r,o,n,-m,-l);o.normalImpulse=0;n.normalImpulse=0;break}break}}};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(h,g){var l=h.normal.y,k=-h.normal.x,j=h.friction*g.normalImpulse,j=Box2D.Common.Math.b2Math.Clamp(g.tangentImpulse-g.tangentMass*((h.bodyB.m_linearVelocity.x-h.bodyB.m_angularVelocity*g.rB.y-h.bodyA.m_linearVelocity.x+h.bodyA.m_angularVelocity*g.rA.y)*l+(h.bodyB.m_linearVelocity.y+h.bodyB.m_angularVelocity*g.rB.x-h.bodyA.m_linearVelocity.y-h.bodyA.m_angularVelocity*g.rA.x)*k),-j,j),i=j-g.tangentImpulse,l=i*l,k=i*k;h.bodyA.m_linearVelocity.x-=h.bodyA.m_invMass*l;h.bodyA.m_linearVelocity.y-=h.bodyA.m_invMass*k;h.bodyA.m_angularVelocity-=h.bodyA.m_invI*(g.rA.x*k-g.rA.y*l);h.bodyB.m_linearVelocity.x+=h.bodyB.m_invMass*l;h.bodyB.m_linearVelocity.y+=h.bodyB.m_invMass*k;h.bodyB.m_angularVelocity+=h.bodyB.m_invI*(g.rB.x*k-g.rB.y*l);g.tangentImpulse=j};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(i,h,n,m,l){var k=m*i.normal.x,m=m*i.normal.y,j=l*i.normal.x,l=l*i.normal.y;i.bodyA.m_linearVelocity.x-=i.bodyA.m_invMass*(k+j);i.bodyA.m_linearVelocity.y-=i.bodyA.m_invMass*(m+l);i.bodyA.m_angularVelocity-=i.bodyA.m_invI*(h.rA.x*m-h.rA.y*k+n.rA.x*l-n.rA.y*j);i.bodyB.m_linearVelocity.x+=i.bodyB.m_invMass*(k+j);i.bodyB.m_linearVelocity.y+=i.bodyB.m_invMass*(m+l);i.bodyB.m_angularVelocity+=i.bodyB.m_invI*(h.rB.x*m-h.rB.y*k+n.rB.x*l-n.rB.y*j);h.normalImpulse=0;n.normalImpulse=0};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var h=0;h<this.m_constraintCount;++h){for(var g=this.m_constraints[h],l=g.manifold,k=0;k<g.pointCount;++k){var j=l.m_points[k],i=g.points[k];j.m_normalImpulse=i.normalImpulse;j.m_tangentImpulse=i.tangentImpulse}}};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(J){void 0===J&&(J=0);for(var I=0,H=0;H<this.m_constraintCount;H++){var G=this.m_constraints[H],F=G.bodyA,E=G.bodyB,D=F.m_mass*F.m_invMass,C=F.m_mass*F.m_invI,B=E.m_mass*E.m_invMass,A=E.m_mass*E.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(G);for(var z=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,y=0;y<G.pointCount;y++){var w=G.points[y],x=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[y],v=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[y],u=x.x-F.m_sweep.c.x,t=x.y-F.m_sweep.c.y,s=x.x-E.m_sweep.c.x,x=x.y-E.m_sweep.c.y,I=I<v?I:v,v=Box2D.Common.Math.b2Math.Clamp(J*(v+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),v=-w.equalizedMass*v,w=v*z.x,v=v*z.y;F.m_sweep.c.x-=D*w;F.m_sweep.c.y-=D*v;F.m_sweep.a-=C*(u*v-t*w);F.SynchronizeTransform();E.m_sweep.c.x+=B*w;E.m_sweep.c.y+=B*v;E.m_sweep.a+=A*(s*v-x*w);E.SynchronizeTransform()}}return I>-1.5*Box2D.Common.b2Settings.b2_linearSlop};Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(J){void 0===J&&(J=0);for(var I=0,H=0;H<this.m_constraintCount;H++){var G=this.m_constraints[H],F=G.bodyA,E=G.bodyB,D=F.m_mass*F.m_invMass,C=F.m_mass*F.m_invI,B=E.m_mass*E.m_invMass,A=E.m_mass*E.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(G);for(var z=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,y=0;y<G.pointCount;y++){var w=G.points[y],x=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[y],v=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[y],u=x.x-F.m_sweep.c.x,t=x.y-F.m_sweep.c.y,s=x.x-E.m_sweep.c.x,x=x.y-E.m_sweep.c.y;v<I&&(I=v);0!=J&&Box2D.Common.Math.b2Math.Clamp(J*(v+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0);v=0*-w.equalizedMass;w=v*z.x;v*=z.y;F.m_sweep.c.x-=D*w;F.m_sweep.c.y-=D*v;F.m_sweep.a-=C*(u*v-t*w);F.SynchronizeTransform();E.m_sweep.c.x+=B*w;E.m_sweep.c.y+=B*v;E.m_sweep.a+=A*(s*v-x*w);E.SynchronizeTransform()}}return I>-1.5*Box2D.Common.b2Settings.b2_linearSlop};Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold;Box2D.Dynamics.Controllers.b2ControllerListNode=function(b){this.controller=b;this.previous=this.next=null};Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(b){this.next=b};Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(b){this.previous=b};Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next};Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous};Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerLastNode=this.controllerFirstNode=null;this.controllerNodeLookup={};this.controllerCount=0};Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode};Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(e){var d=e.ID;if(null==this.controllerNodeLookup[d]){var e=new Box2D.Dynamics.Controllers.b2ControllerListNode(e),f=this.controllerLastNode;null!=f?f.SetNextNode(e):this.controllerFirstNode=e;e.SetPreviousNode(f);this.controllerLastNode=e;this.controllerNodeLookup[d]=e;this.controllerCount++}};Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(e){var e=e.ID,d=this.controllerNodeLookup[e];if(null!=d){var f=d.GetPreviousNode(),d=d.GetNextNode();null==f?this.controllerFirstNode=d:f.SetNextNode(d);null==d?this.controllerLastNode=f:d.SetPreviousNode(f);delete this.controllerNodeLookup[e];this.controllerCount--}};Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount};Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.isSensor=!1};Box2D.Dynamics.b2Body=function(d,c){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++;this.m_xf=new Box2D.Common.Math.b2Transform;this.m_xf.position.SetV(d.position);this.m_xf.R.Set(d.angle);this.m_sweep=new Box2D.Common.Math.b2Sweep;this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=d.angle;this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y;this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_linearVelocity=d.linearVelocity.Copy();this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_bullet=d.bullet;this.m_fixedRotation=d.fixedRotation;this.m_allowSleep=d.allowSleep;this.m_awake=d.awake;this.m_active=d.active;this.m_world=c;this.m_userData=null;this.m_jointList=null;this.contactList=new Box2D.Dynamics.Contacts.b2ContactList;this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList;this.m_controllerCount=0;this.m_angularVelocity=d.angularVelocity;this.m_linearDamping=d.linearDamping;this.m_angularDamping=d.angularDamping;this.m_sleepTime=this.m_torque=0;this.m_type=d.type;this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0;this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0;this.m_invI=this.m_I=0;this.m_inertiaScale=d.inertiaScale;this.fixtureList=new Box2D.Dynamics.b2FixtureList;this.m_lists=[]};Box2D.Dynamics.b2Body.prototype.CreateFixture=function(b){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());b=new Box2D.Dynamics.b2Fixture(this,this.m_xf,b);this.m_active&&b.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);this.fixtureList.AddFixture(b);b.m_body=this;0<b.m_density&&this.ResetMassData();this.m_world.m_newFixture=!0;return b};Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(e,d){var f=new Box2D.Dynamics.b2FixtureDef;f.shape=e;f.density=d;return this.CreateFixture(f)};Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity);Box2D.Common.Math.b2Vec2.Free(this.m_force)};Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(d){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());this.fixtureList.RemoveFixture(d);for(var c=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);c;c=c.GetNextNode()){(d==c.contact.GetFixtureA()||d==c.contact.GetFixtureB())&&this.m_world.m_contactManager.Destroy(c.contact)}this.m_active&&d.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);d.Destroy();this.ResetMassData()};Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(f,e){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());this.m_xf.R.Set(e);this.m_xf.position.SetV(f);var h=this.m_xf.R,g=this.m_sweep.localCenter;this.m_sweep.c.x=h.col1.x*g.x+h.col2.x*g.y;this.m_sweep.c.y=h.col1.y*g.x+h.col2.y*g.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=e;h=this.m_world.m_contactManager.m_broadPhase;for(g=this.fixtureList.GetFirstNode();g;g=g.GetNextNode()){g.fixture.Synchronize(h,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};Box2D.Dynamics.b2Body.prototype.SetTransform=function(b){this.SetPositionAndAngle(b.position,b.GetAngle())};Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf};Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position};Box2D.Dynamics.b2Body.prototype.SetPosition=function(b){this.SetPositionAndAngle(b,this.GetAngle())};Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a};Box2D.Dynamics.b2Body.prototype.SetAngle=function(b){this.SetPositionAndAngle(this.GetPosition(),b)};Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c};Box2D.Dynamics.b2Body.prototype.GetUserData=function(){return this.m_userData};Box2D.Dynamics.b2Body.prototype.SetUserData=function(b){this.m_userData=b};Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(b){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(b)};Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(b){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=b)};Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var b=new Box2D.Dynamics.b2BodyDef;b.type=this.GetType();b.allowSleep=this.m_allowSleep;b.angle=this.GetAngle();b.angularDamping=this.m_angularDamping;b.angularVelocity=this.m_angularVelocity;b.fixedRotation=this.m_fixedRotation;b.bullet=this.m_bullet;b.active=this.m_active;b.awake=this.m_awake;b.linearDamping=this.m_linearDamping;b.linearVelocity.SetV(this.GetLinearVelocity());b.position.SetV(this.GetPosition());return b};Box2D.Dynamics.b2Body.prototype.ApplyForce=function(d,c){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=d.x,this.m_force.y+=d.y,this.m_torque+=(c.x-this.m_sweep.c.x)*d.y-(c.y-this.m_sweep.c.y)*d.x)};Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(b){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=b)};Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(d,c){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*d.x,this.m_linearVelocity.y+=this.m_invMass*d.y,this.m_angularVelocity+=this.m_invI*((c.x-this.m_sweep.c.x)*d.y-(c.y-this.m_sweep.c.y)*d.x))};Box2D.Dynamics.b2Body.prototype.Split=function(i){for(var h=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),m=this.GetWorldCenter(),l=this.m_world.CreateBody(this.GetDefinition()),k=this.fixtureList.GetFirstNode();k;k=k.GetNextNode()){var j=k.fixture;i(j)&&(this.fixtureList.RemoveFixture(j),l.fixtureList.AddFixture(j))}this.ResetMassData();l.ResetMassData();k=this.GetWorldCenter();i=l.GetWorldCenter();j=Box2D.Common.Math.b2Math.SubtractVV(k,m);k=Box2D.Common.Math.b2Math.CrossFV(n,j);Box2D.Common.Math.b2Vec2.Free(j);j=Box2D.Common.Math.b2Math.AddVV(h,k);Box2D.Common.Math.b2Vec2.Free(k);this.SetLinearVelocity(j);Box2D.Common.Math.b2Vec2.Free(j);i=Box2D.Common.Math.b2Math.SubtractVV(i,m);m=Box2D.Common.Math.b2Math.CrossFV(n,i);Box2D.Common.Math.b2Vec2.Free(i);i=Box2D.Common.Math.b2Math.AddVV(h,m);Box2D.Common.Math.b2Vec2.Free(m);l.SetLinearVelocity(i);Box2D.Common.Math.b2Vec2.Free(i);Box2D.Common.Math.b2Vec2.Free(h);this.SetAngularVelocity(n);l.SetAngularVelocity(n);this.SynchronizeFixtures();l.SynchronizeFixtures();return l};Box2D.Dynamics.b2Body.prototype.Merge=function(d){for(var c=d.fixtureList.GetFirstNode();c;c=c.GetNextNode()){this.fixtureList.AddFixture(c.fixture),d.fixtureList.RemoveFixture(c.fixture)}d.ResetMassData();this.ResetMassData();this.SynchronizeFixtures()};Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass};Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I};Box2D.Dynamics.b2Body.prototype.GetMassData=function(b){b||(b=Box2D.Collision.Shapes.b2MassData.Get());b.mass=this.m_mass;b.I=this.m_I;b.center.SetV(this.m_sweep.localCenter);return b};Box2D.Dynamics.b2Body.prototype.SetMassData=function(d){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());if(this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=d.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<d.I&&!this.m_fixedRotation&&(this.m_I=d.I-this.m_mass*(d.center.x*d.center.x+d.center.y*d.center.y),this.m_invI=1/this.m_I);var c=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(d.center);this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-c.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-c.x);Box2D.Common.Math.b2Vec2.Free(c)}};Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody||this.m_type==Box2D.Dynamics.b2BodyDef.b2_kinematicBody)){for(var e=Box2D.Common.Math.b2Vec2.Get(0,0),d=this.fixtureList.GetFirstNode();d;d=d.GetNextNode()){var f=d.fixture;0!=f.m_density&&(f=f.GetMassData(),this.m_mass+=f.mass,e.x+=f.center.x*f.mass,e.y+=f.center.y*f.mass,this.m_I+=f.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,Box2D.Common.b2Settings.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e);this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x);Box2D.Common.Math.b2Vec2.Free(e);Box2D.Common.Math.b2Vec2.Free(d)}};Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(d){var c=this.m_xf.R,d=Box2D.Common.Math.b2Vec2.Get(c.col1.x*d.x+c.col2.x*d.y,c.col1.y*d.x+c.col2.y*d.y);d.x+=this.m_xf.position.x;d.y+=this.m_xf.position.y;return d};Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(b){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,b)};Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(b){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,b)};Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(b){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,b)};Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(b){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(b.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(b.x-this.m_sweep.c.x))};Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(d){var c=this.m_xf.R,d=Box2D.Common.Math.b2Vec2.Get(c.col1.x*d.x+c.col2.x*d.y,c.col1.y*d.x+c.col2.y*d.y);d.x+=this.m_xf.position.x;d.y+=this.m_xf.position.y;c=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(d.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(d.x-this.m_sweep.c.x));Box2D.Common.Math.b2Vec2.Free(d);return c};Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping};Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(b){this.m_linearDamping=b};Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping};Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(b){this.m_angularDamping=b};Box2D.Dynamics.b2Body.prototype.SetType=function(b){if(this.m_type!=b){this.m_type=b;this.ResetMassData();this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0);this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(b=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode()){b.contact.FlagForFiltering()}for(b=0;b<this.m_lists.length;b++){this.m_lists[b].UpdateBody(this)}}};Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type};Box2D.Dynamics.b2Body.prototype.SetBullet=function(b){this.m_bullet=b};Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet};Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(b){(this.m_allowSleep=b)||this.SetAwake(!0)};Box2D.Dynamics.b2Body.prototype.SetAwake=function(b){if(this.m_awake!=b){this.m_awake=b;this.m_sleepTime=0;b||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);for(b=0;b<this.m_lists.length;b++){this.m_lists[b].UpdateBody(this)}}};Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake};Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(b){this.m_fixedRotation=b;this.ResetMassData()};Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation};Box2D.Dynamics.b2Body.prototype.SetActive=function(d){if(d!=this.m_active){if(d){this.m_active=!0;for(var d=this.m_world.m_contactManager.m_broadPhase,c=this.fixtureList.GetFirstNode();c;c=c.GetNextNode()){c.fixture.CreateProxy(d,this.m_xf)}}else{this.m_active=!1;d=this.m_world.m_contactManager.m_broadPhase;for(c=this.fixtureList.GetFirstNode();c;c=c.GetNextNode()){c.fixture.DestroyProxy(d)}for(d=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);d;d=d.GetNextNode()){this.m_world.m_contactManager.Destroy(d.contact)}}for(d=0;d<this.m_lists.length;d++){this.m_lists[d].UpdateBody(this)}}};Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active};Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep};Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList};Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList};Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList};Box2D.Dynamics.b2Body.prototype.AddController=function(b){this.controllerList.AddController(b)};Box2D.Dynamics.b2Body.prototype.RemoveController=function(b){this.controllerList.RemoveController(b)};Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList};Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world};Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var e=Box2D.Dynamics.b2Body.s_xf1;e.R.Set(this.m_sweep.a0);var d=e.R,f=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(d.col1.x*f.x+d.col2.x*f.y);e.position.y=this.m_sweep.c0.y-(d.col1.y*f.x+d.col2.y*f.y);d=this.m_world.m_contactManager.m_broadPhase;for(f=this.fixtureList.GetFirstNode();f;f=f.GetNextNode()){f.fixture.Synchronize(d,e,this.m_xf)}};Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var d=this.m_xf.R,c=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(d.col1.x*c.x+d.col2.x*c.y);this.m_xf.position.y=this.m_sweep.c.y-(d.col1.y*c.x+d.col2.y*c.y)};Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(d){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&d.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody){return !1}for(var c=this.m_jointList;c;c=c.next){if(c.other==d&&!1==c.joint.m_collideConnected){return !1}}return !0};Box2D.Dynamics.b2Body.prototype.Advance=function(b){this.m_sweep.Advance(b);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.Dynamics.b2Body.NEXT_ID=0;Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform;Box2D.Dynamics.b2World=function(d,c){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this);this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver;this.m_newFixture=this.m_isLocked=!1;this.m_debugDraw=this.m_destructionListener=null;this.bodyList=new Box2D.Dynamics.b2BodyList;this.contactList=new Box2D.Dynamics.Contacts.b2ContactList;this.m_jointList=null;this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList;this.m_jointCount=0;this.m_continuousPhysics=this.m_warmStarting=!0;this.m_allowSleep=c;this.m_gravity=d;this.m_inv_dt0=0;this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef);this.mainTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting);this.islandTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting);this.island=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver)};Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE;Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(b){this.m_destructionListener=b};Box2D.Dynamics.b2World.prototype.SetContactFilter=function(b){this.m_contactManager.m_contactFilter=b};Box2D.Dynamics.b2World.prototype.SetContactListener=function(b){this.m_contactManager.m_contactListener=b};Box2D.Dynamics.b2World.prototype.SetDebugDraw=function(b){this.m_debugDraw=b};Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(g){var f=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=g;for(var j=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);j;j=j.GetNextNode()){for(var i=j.body.GetFixtureList().GetFirstNode();i;i=i.GetNextNode()){var h=i.fixture;h.m_proxy=g.CreateProxy(f.GetFatAABB(h.m_proxy),h)}}};Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};Box2D.Dynamics.b2World.prototype.CreateBody=function(b){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());b=new Box2D.Dynamics.b2Body(b,this);this.bodyList.AddBody(b);return b};Box2D.Dynamics.b2World.prototype.DestroyBody=function(e){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());for(var d=e.m_jointList;d;){var f=d,d=d.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(f.joint);this.DestroyJoint(f.joint)}for(d=e.GetControllerList().GetFirstNode();d;d=d.GetNextNode()){d.controller.RemoveBody(e)}for(d=e.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);d;d=d.GetNextNode()){this.m_contactManager.Destroy(d.contact)}for(d=e.GetFixtureList().GetFirstNode();d;d=d.GetNextNode()){this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(d.fixture),e.DestroyFixture(d.fixture)}e.Destroy();this.bodyList.RemoveBody(e)};Box2D.Dynamics.b2World.prototype.CreateJoint=function(f){var e=Box2D.Dynamics.Joints.b2Joint.Create(f);e.m_prev=null;if(e.m_next=this.m_jointList){this.m_jointList.m_prev=e}this.m_jointList=e;this.m_jointCount++;e.m_edgeA.joint=e;e.m_edgeA.other=e.m_bodyB;e.m_edgeA.prev=null;if(e.m_edgeA.next=e.m_bodyA.m_jointList){e.m_bodyA.m_jointList.prev=e.m_edgeA}e.m_bodyA.m_jointList=e.m_edgeA;e.m_edgeB.joint=e;e.m_edgeB.other=e.m_bodyA;e.m_edgeB.prev=null;if(e.m_edgeB.next=e.m_bodyB.m_jointList){e.m_bodyB.m_jointList.prev=e.m_edgeB}e.m_bodyB.m_jointList=e.m_edgeB;var h=f.bodyA,g=f.bodyB;if(!f.collideConnected){for(f=g.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);f;f=f.GetNextNode()){f.contact.GetOther(g)==h&&f.contact.FlagForFiltering()}}return e};Box2D.Dynamics.b2World.prototype.DestroyJoint=function(f){var e=f.m_collideConnected;f.m_prev&&(f.m_prev.m_next=f.m_next);f.m_next&&(f.m_next.m_prev=f.m_prev);f==this.m_jointList&&(this.m_jointList=f.m_next);var h=f.m_bodyA,g=f.m_bodyB;h.SetAwake(!0);g.SetAwake(!0);f.m_edgeA.prev&&(f.m_edgeA.prev.next=f.m_edgeA.next);f.m_edgeA.next&&(f.m_edgeA.next.prev=f.m_edgeA.prev);f.m_edgeA==h.m_jointList&&(h.m_jointList=f.m_edgeA.next);f.m_edgeA.prev=null;f.m_edgeA.next=null;f.m_edgeB.prev&&(f.m_edgeB.prev.next=f.m_edgeB.next);f.m_edgeB.next&&(f.m_edgeB.next.prev=f.m_edgeB.prev);f.m_edgeB==g.m_jointList&&(g.m_jointList=f.m_edgeB.next);f.m_edgeB.prev=null;f.m_edgeB.next=null;this.m_jointCount--;if(!e){for(f=g.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);f;f=f.GetNextNode()){f.contact.GetOther(g)==h&&f.contact.FlagForFiltering()}}};Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList};Box2D.Dynamics.b2World.prototype.AddController=function(b){if(null!==b.m_world&&b.m_world!=this){throw Error("Controller can only be a member of one world")}this.controllerList.AddController(b);b.m_world=this;return b};Box2D.Dynamics.b2World.prototype.RemoveController=function(b){this.controllerList.RemoveController(b);b.m_world=null;b.Clear()};Box2D.Dynamics.b2World.prototype.CreateController=function(b){return this.AddController(b)};Box2D.Dynamics.b2World.prototype.DestroyController=function(b){this.RemoveController(b)};Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(b){this.m_warmStarting=b};Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(b){this.m_continuousPhysics=b};Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()};Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount};Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()};Box2D.Dynamics.b2World.prototype.SetGravity=function(b){this.m_gravity=b};Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity};Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody};Box2D.Dynamics.b2World.prototype.Step=function(e,d,f){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1);this.m_isLocked=!0;this.mainTimeStep.Reset(e,this.m_inv_dt0*e,d,f,this.m_warmStarting);this.m_contactManager.Collide();0<this.mainTimeStep.dt&&(this.Solve(this.mainTimeStep),this.m_continuousPhysics&&this.SolveTOI(this.mainTimeStep),this.m_inv_dt0=this.mainTimeStep.inv_dt);this.m_isLocked=!1};Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);b;b=b.GetNextNode()){b.body.m_force.SetZero(),b.body.m_torque=0}};Box2D.Dynamics.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){this.m_debugDraw.Clear();var t=this.m_debugDraw.GetFlags();if(t&Box2D.Dynamics.b2DebugDraw.e_shapeBit){for(var s=Box2D.Dynamics.b2World.s_color_inactive,r=Box2D.Dynamics.b2World.s_color_static,q=Box2D.Dynamics.b2World.s_color_kinematic,p=Box2D.Dynamics.b2World.s_color_dynamic_sleeping,o=Box2D.Dynamics.b2World.s_color_dynamic_awake,n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode()){for(var m=n.body,l=m.GetFixtureList().GetFirstNode();l;l=l.GetNextNode()){var k=l.fixture,k=k.GetShape();m.IsActive()?m.GetType()==Box2D.Dynamics.b2BodyDef.b2_staticBody?this.DrawShape(k,m.m_xf,r):m.GetType()==Box2D.Dynamics.b2BodyDef.b2_kinematicBody?this.DrawShape(k,m.m_xf,q):m.IsAwake()?this.DrawShape(k,m.m_xf,o):this.DrawShape(k,m.m_xf,p):this.DrawShape(k,m.m_xf,s)}}}if(t&Box2D.Dynamics.b2DebugDraw.e_jointBit){for(n=this.m_jointList;n;n=n.m_next){this.DrawJoint(n)}}if(t&Box2D.Dynamics.b2DebugDraw.e_controllerBit){for(n=this.controllerList.GetFirstNode();n;n=n.GetNextNode()){n.controller.Draw(this.m_debugDraw)}}if(t&Box2D.Dynamics.b2DebugDraw.e_pairBit){n=Box2D.Dynamics.b2World.s_pairColor;for(l=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);l;l=l.GetNextNode()){s=l.contact.GetFixtureA(),m=l.contact.GetFixtureB(),s=s.GetAABB().GetCenter(),m=m.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(s,m,n),Box2D.Common.Math.b2Vec2.Free(s),Box2D.Common.Math.b2Vec2.Free(m)}}if(t&Box2D.Dynamics.b2DebugDraw.e_aabbBit){s=Box2D.Dynamics.b2World.s_aabbColor;for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.activeBodies);n;n=n.GetNextNode()){m=n.body;for(l=m.GetFixtureList().GetFirstNode();l;l=l.GetNextNode()){k=l.fixture,m=this.m_contactManager.m_broadPhase.GetFatAABB(k.m_proxy),m=[Box2D.Common.Math.b2Vec2.Get(m.lowerBound.x,m.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(m.upperBound.x,m.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(m.upperBound.x,m.upperBound.y),Box2D.Common.Math.b2Vec2.Get(m.lowerBound.x,m.upperBound.y)],this.m_debugDraw.DrawPolygon(m,4,s),Box2D.Common.Math.b2Vec2.Free(m[0]),Box2D.Common.Math.b2Vec2.Free(m[1]),Box2D.Common.Math.b2Vec2.Free(m[2]),Box2D.Common.Math.b2Vec2.Free(m[3])}}}if(t&Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit){for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode()){m=n.body,Box2D.Dynamics.b2World.s_xf.R=m.m_xf.R,Box2D.Dynamics.b2World.s_xf.position=m.GetWorldCenter(),this.m_debugDraw.DrawTransform(Box2D.Dynamics.b2World.s_xf)}}}};Box2D.Dynamics.b2World.prototype.QueryAABB=function(d,c){this.m_contactManager.m_broadPhase.Query(d,c)};Box2D.Dynamics.b2World.prototype.QueryPoint=function(e,d){var f=Box2D.Collision.b2AABB.Get();f.lowerBound.Set(d.x-Box2D.Common.b2Settings.b2_linearSlop,d.y-Box2D.Common.b2Settings.b2_linearSlop);f.upperBound.Set(d.x+Box2D.Common.b2Settings.b2_linearSlop,d.y+Box2D.Common.b2Settings.b2_linearSlop);this.m_contactManager.m_broadPhase.Query(function(b){return b.TestPoint(d)?e(b):!0},f);Box2D.Collision.b2AABB.Free(f)};Box2D.Dynamics.b2World.prototype.RayCast=function(h,g,l){var k=this.m_contactManager.m_broadPhase,j=new Box2D.Collision.b2RayCastOutput,i=new Box2D.Collision.b2RayCastInput(g,l,1);k.RayCast(function(m,e){if(e.RayCast(j,m)){var c=1-j.fraction,c=Box2D.Common.Math.b2Vec2.Get(c*g.x+j.fraction*l.x,c*g.y+j.fraction*l.y),b=h(e,c,j.normal,j.fraction);Box2D.Common.Math.b2Vec2.Free(c);return b}return m.maxFraction},i)};Box2D.Dynamics.b2World.prototype.RayCastOne=function(e,d){var f=null;this.RayCast(function(h,c,j,i){f=h;return i},e,d);return f};Box2D.Dynamics.b2World.prototype.RayCastAll=function(e,d){var f=[];this.RayCast(function(b){f.push(b);return 1},e,d);return f};Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList};Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList};Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList};Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked};Box2D.Dynamics.b2World.prototype.Solve=function(i){for(var h=this.controllerList.GetFirstNode();h;h=h.GetNextNode()){h.controller.Step(i)}h=this.island;h.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode()){n.body.m_islandFlag=!1}for(var m=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);m;m=m.GetNextNode()){m.contact.m_islandFlag=!1}for(n=this.m_jointList;n;n=n.m_next){n.m_islandFlag=!1}for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);n;n=n.GetNextNode()){if(m=n.body,!m.m_islandFlag){h.Clear();var l=[];l.push(m);for(m.m_islandFlag=!0;0<l.length;){var k=l.pop();h.AddBody(k);k.IsAwake()||k.SetAwake(!0);if(k.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(m=k.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);m;m=m.GetNextNode()){var j=m.contact;j.m_islandFlag||(h.AddContact(j),j.m_islandFlag=!0,j=j.GetOther(k),j.m_islandFlag||(l.push(j),j.m_islandFlag=!0))}for(m=k.m_jointList;m;m=m.next){!m.joint.m_islandFlag&&m.other.IsActive()&&(h.AddJoint(m.joint),m.joint.m_islandFlag=!0,m.other.m_islandFlag||(l.push(m.other),m.other.m_islandFlag=!0))}}}h.Solve(i,this.m_gravity,this.m_allowSleep)}}for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);n;n=n.GetNextNode()){n.body.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};Box2D.Dynamics.b2World.prototype.SolveTOI=function(i){var h=this.island;h.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode()){var m=n.body;m.m_islandFlag=!1;m.m_sweep.t0=0}for(var l=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);l;l=l.GetNextNode()){l.contact.m_islandFlag=!1,l.contact.m_toi=null}for(n=this.m_jointList;n;n=n.m_next){n.m_islandFlag=!1}for(;;){var n=this._SolveTOI2(i),k=n.minContact,n=n.minTOI;if(null===k||Box2D.Dynamics.b2World.MAX_TOI<n){break}l=k.m_fixtureA.GetBody();m=k.m_fixtureB.GetBody();Box2D.Dynamics.b2World.s_backupA.Set(l.m_sweep);Box2D.Dynamics.b2World.s_backupB.Set(m.m_sweep);l.Advance(n);m.Advance(n);k.Update(this.m_contactManager.m_contactListener);k.m_toi=null;if(k.IsSensor()||!k.IsEnabled()){l.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),m.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),l.SynchronizeTransform(),m.SynchronizeTransform()}else{if(k.IsTouching()){l.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(l=m);h.Clear();k=new goog.structs.Queue;k.enqueue(l);for(l.m_islandFlag=!0;0<k.size;){if(m=k.dequeue(),h.AddBody(m),m.IsAwake()||m.SetAwake(!0),m.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(l=m.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);l&&h.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;l=l.GetNextNode()){var j=l.contact;j.m_islandFlag||(h.AddContact(j),j.m_islandFlag=!0,j=j.GetOther(m),j.m_islandFlag||(j.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(j.Advance(n),j.SetAwake(!0),k.enqueue(j)),j.m_islandFlag=!0))}for(m=m.m_jointList;m;m=m.next){h.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&(!m.joint.m_islandFlag&&m.other.IsActive())&&(h.AddJoint(m.joint),m.joint.m_islandFlag=!0,m.other.m_islandFlag||(m.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(m.other.Advance(n),m.other.SetAwake(!0),k.enqueue(m.other)),m.other.m_islandFlag=!0))}}}this.islandTimeStep.Reset((1-n)*i.dt,0,i.velocityIterations,i.positionIterations,!1);h.SolveTOI(this.islandTimeStep);for(n=0;n<h.m_bodies.length;n++){if(h.m_bodies[n].m_islandFlag=!1,h.m_bodies[n].IsAwake()&&h.m_bodies[n].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){h.m_bodies[n].SynchronizeFixtures();for(l=h.m_bodies[n].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);l;l=l.GetNextNode()){l.contact.m_toi=null}}}for(n=0;n<h.m_contactCount;n++){h.m_contacts[n].m_islandFlag=!1,h.m_contacts[n].m_toi=null}for(n=0;n<h.m_jointCount;n++){h.m_joints[n].m_islandFlag=!1}this.m_contactManager.FindNewContacts()}}}};Box2D.Dynamics.b2World.prototype._SolveTOI2=function(j){for(var i=null,p=1,o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);o;o=o.GetNextNode()){var n=o.contact;if(!this._SolveTOI2SkipContact(j,n)){var m=1;if(null!=n.m_toi){m=n.m_toi}else{if(n.IsTouching()){m=1}else{var m=n.m_fixtureA.GetBody(),l=n.m_fixtureB.GetBody(),k=m.m_sweep.t0;m.m_sweep.t0<l.m_sweep.t0?(k=l.m_sweep.t0,m.m_sweep.Advance(k)):l.m_sweep.t0<m.m_sweep.t0&&(k=m.m_sweep.t0,l.m_sweep.Advance(k));m=n.ComputeTOI(m.m_sweep,l.m_sweep);Box2D.Common.b2Settings.b2Assert(0<=m&&1>=m);0<m&&1>m&&(m=(1-m)*k+m)}n.m_toi=m}Number.MIN_VALUE<m&&m<p&&(i=n,p=m)}}return{minContact:i,minTOI:p}};Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(f,e){var h=e.m_fixtureA.GetBody(),g=e.m_fixtureB.GetBody();return(h.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||!h.IsAwake())&&(g.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||!g.IsAwake())?!0:!1};Box2D.Dynamics.b2World.prototype.DrawJoint=function(f){if(f instanceof Box2D.Dynamics.Joints.b2DistanceJoint||f instanceof Box2D.Dynamics.Joints.b2MouseJoint){var e=f.GetAnchorA(),h=f.GetAnchorB();this.m_debugDraw.DrawSegment(e,h,Box2D.Dynamics.b2World.s_jointColor);Box2D.Common.Math.b2Vec2.Free(e);Box2D.Common.Math.b2Vec2.Free(h)}else{if(f instanceof Box2D.Dynamics.Joints.b2PulleyJoint){var e=f.GetAnchorA(),h=f.GetAnchorB(),g=f.GetGroundAnchorA(),f=f.GetGroundAnchorB();this.m_debugDraw.DrawSegment(g,e,Box2D.Dynamics.b2World.s_jointColor);this.m_debugDraw.DrawSegment(f,h,Box2D.Dynamics.b2World.s_jointColor);this.m_debugDraw.DrawSegment(g,f,Box2D.Dynamics.b2World.s_jointColor);Box2D.Common.Math.b2Vec2.Free(e);Box2D.Common.Math.b2Vec2.Free(h);Box2D.Common.Math.b2Vec2.Free(g);Box2D.Common.Math.b2Vec2.Free(f)}else{e=f.GetAnchorA(),h=f.GetAnchorB(),f.GetBodyA()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f.GetBodyA().m_xf.position,e,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(e,h,Box2D.Dynamics.b2World.s_jointColor),f.GetBodyB()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f.GetBodyB().m_xf.position,h,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(h)}}};Box2D.Dynamics.b2World.prototype.DrawShape=function(h,g,l){if(h instanceof Box2D.Collision.Shapes.b2CircleShape){var k=Box2D.Common.Math.b2Math.MulX(g,h.m_p);this.m_debugDraw.DrawSolidCircle(k,h.m_radius,g.R.col1,l);Box2D.Common.Math.b2Vec2.Free(k)}else{if(h instanceof Box2D.Collision.Shapes.b2PolygonShape){for(var k=0,j=h.GetVertexCount(),h=h.GetVertices(),i=[],k=0;k<j;k++){i[k]=Box2D.Common.Math.b2Math.MulX(g,h[k])}this.m_debugDraw.DrawSolidPolygon(i,j,l);for(k=0;k<j;k++){Box2D.Common.Math.b2Vec2.Free(i[k])}}else{h instanceof Box2D.Collision.Shapes.b2EdgeShape&&(k=Box2D.Common.Math.b2Math.MulX(g,h.GetVertex1()),g=Box2D.Common.Math.b2Math.MulX(g,h.GetVertex2()),this.m_debugDraw.DrawSegment(k,g,l),Box2D.Common.Math.b2Vec2.Free(k),Box2D.Common.Math.b2Vec2.Free(g))}}};Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform;Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep;Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep;Box2D.Dynamics.b2World.s_jointColor=new Box2D.Common.b2Color(0.5,0.8,0.8);Box2D.Dynamics.b2World.s_color_inactive=new Box2D.Common.b2Color(0.5,0.5,0.3);Box2D.Dynamics.b2World.s_color_static=new Box2D.Common.b2Color(0.3,0.3,0.3);Box2D.Dynamics.b2World.s_color_kinematic=new Box2D.Common.b2Color(0.5,0.5,0.9);Box2D.Dynamics.b2World.s_color_dynamic_sleeping=new Box2D.Common.b2Color(0.6,0.6,0.6);Box2D.Dynamics.b2World.s_color_dynamic_awake=new Box2D.Common.b2Color(0.6,0.9,0.6);Box2D.Dynamics.b2World.s_pairColor=new Box2D.Common.b2Color(0.3,0.9,0.9);Box2D.Dynamics.b2World.s_aabbColor=new Box2D.Common.b2Color(0,0,0.8);Box2D.generateCallback=function(d,c){return function(){c.apply(d,arguments)}};Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this);this.T=new Box2D.Common.Math.b2Mat22;this.maxTimestep=0};goog.inherits(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller);Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(d,c){this.T.col1.x=-d;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-c;this.maxTimestep=0<d||0<c?1/Math.max(d,c):0};Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(g){g=g.dt;if(!(g<=Number.MIN_VALUE)){g>this.maxTimestep&&0<this.maxTimestep&&(g=this.maxTimestep);for(var f=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);f;f=f.GetNextNode()){var j=f.body,i=j.GetLocalVector(j.GetLinearVelocity()),h=Box2D.Common.Math.b2Math.MulMV(this.T,i);Box2D.Common.Math.b2Vec2.Free(i);i=j.GetWorldVector(h);Box2D.Common.Math.b2Vec2.Free(h);h=Box2D.Common.Math.b2Vec2.Get(j.GetLinearVelocity().x+i.x*g,j.GetLinearVelocity().y+i.y*g);Box2D.Common.Math.b2Vec2.Free(i);j.SetLinearVelocity(h);Box2D.Common.Math.b2Vec2.Free(h)}}};Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this);this.F=Box2D.Common.Math.b2Vec2.Get(0,0)};goog.inherits(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller);Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(){for(var d=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);d;d=d.GetNextNode()){var c=d.body;c.ApplyForce(this.F,c.GetWorldCenter())}};Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this);this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0);this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0);this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};goog.inherits(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef);Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(i,h,n,m,l,k,j){void 0===j&&(j=0);this.bodyA=i;this.bodyB=h;this.groundAnchorA.SetV(n);this.groundAnchorB.SetV(m);this.localAnchorA=this.bodyA.GetLocalPoint(l);this.localAnchorB=this.bodyB.GetLocalPoint(k);i=l.x-n.x;n=l.y-n.y;this.lengthA=Math.sqrt(i*i+n*n);n=k.x-m.x;m=k.y-m.y;this.lengthB=Math.sqrt(n*n+m*m);this.ratio=j;j=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=j-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength;this.maxLengthB=(j-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio};Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)};pc.Hashtable=gamecore.Hashtable;pc.Base=gamecore.Base("pc.Base",{},{});pc.Pool=gamecore.Pool.extend("pc.Pool",{},{});pc.Pooled=gamecore.Pooled.extend("pc.Pooled",{},{});pc.LinkedList=gamecore.LinkedList.extend("pc.LinkedList",{},{});pc.LinkedListNode=gamecore.LinkedListNode.extend("pc.LinkedListNode",{},{});pc.HashList=gamecore.HashList.extend("pc.HashList",{},{});if(!Function.prototype.bind){Function.prototype.bind=function(b){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable")}var f=Array.prototype.slice.call(arguments,1),e=this,c=function(){},d=function(){return e.apply(this instanceof c?this:b||window,f.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;d.prototype=new c();return d}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d){if(this==null){throw new TypeError()}var e=Object(this);var b=e.length>>>0;if(b===0){return -1}var f=0;if(arguments.length>0){f=Number(arguments[1]);if(f!=f){f=0}else{if(f!=0&&f!=Infinity&&f!=-Infinity){f=(f>0||-1)*Math.floor(Math.abs(f))}}}if(f>=b){return -1}var c=f>=0?f:Math.max(b-Math.abs(f),0);for(;c<b;c++){if(c in e&&e[c]===d){return c}}return -1}}if(!window.pc){window.pc={}}pc.VERSION="0.5.6";pc.JSLoader=function(){this.progress=0;this.canvasId=null;this.current=0;this.baseUrl="";this.started=false;this.finished=false;this._noCacheString="";this.gameClass=null;this.resources=[];this.setDisableCache=function(){this._noCacheString="?nocache="+Date.now()};this.setBaseUrl=function(b){this.baseUrl=b};this.makeUrl=function(b){return this.baseUrl+b+this._noCacheString};this.add=function(b){this.resources.push(this.makeUrl(b))};this.start=function(c,b){this.current=0;this.canvasId=c;this.gameClass=b;this.loadNextScript()};this.loadNextScript=function(){var c=this.resources[this.current];var b=document.createElement("script");b.type="application/javascript";b.src=c;b.onload=this.checkAllDone.bind(this);b.onerror=function(){throw ("Could not load javascript file: "+b.src)};console.log("Loading "+c);document.getElementsByTagName("head")[0].appendChild(b)};this.checkAllDone=function(){if(this.resources.length-1==this.current){this.finished=true;pc.device.boot(this.canvasId,this.gameClass)}else{this.current++;this.loadNextScript()}}};pc.start=function(h,g,f,c,d){var b=new pc.JSLoader();if(pc.packed==undefined){if(d==undefined){d="/playcraftjs/lib/"}b.setBaseUrl(d);b.add("ext/gamecore.js/src/gamecore.js");b.add("ext/gamecore.js/src/class.js");b.add("ext/gamecore.js/src/base.js");b.add("ext/gamecore.js/src/jhashtable.js");b.add("ext/gamecore.js/src/device.js");b.add("ext/gamecore.js/src/perf.js");b.add("ext/gamecore.js/src/linkedlist.js");b.add("ext/gamecore.js/src/hashlist.js");b.add("ext/gamecore.js/src/stacktrace.js");b.add("ext/gamecore.js/src/pooled.js");b.add("ext/box2dweb.2.1a-pc.js");b.add("boot.js");b.add("ext/base64.js");b.add("input.js");b.add("hashmap.js");b.add("tools.js");b.add("color.js");b.add("debug.js");b.add("device.js");b.add("sound.js");b.add("layer.js");b.add("entitylayer.js");b.add("tileset.js");b.add("tilemap.js");b.add("tilelayer.js");b.add("hextilelayer.js");b.add("entity.js");b.add("sprite.js");b.add("spritesheet.js");b.add("math.js");b.add("image.js");b.add("scene.js");b.add("game.js");b.add("loader.js");b.add("dataresource.js");b.add("components/component.js");b.add("components/physics.js");b.add("components/alpha.js");b.add("components/joint.js");b.add("components/expiry.js");b.add("components/originshifter.js");b.add("components/spatial.js");b.add("components/overlay.js");b.add("components/clip.js");b.add("components/activator.js");b.add("components/input.js");b.add("components/fade.js");b.add("components/spin.js");b.add("components/scale.js");b.add("components/rect.js");b.add("components/poly.js");b.add("components/circle.js");b.add("components/text.js");b.add("components/sprite.js");b.add("components/layout.js");b.add("components/particleemitter.js");b.add("systems/system.js");b.add("es/entitymanager.js");b.add("es/systemmanager.js");b.add("systems/entitysystem.js");b.add("systems/physics.js");b.add("systems/effects.js");b.add("systems/particles.js");b.add("systems/input.js");b.add("systems/expiry.js");b.add("systems/activation.js");b.add("systems/render.js");b.add("systems/layout.js")}b.setBaseUrl(f);for(var e=0;e<c.length;e++){b.add(c[e])}b.start(h,g)};pc.Input=pc.Base("pc.Input",{_eventPos:null,getEventPosition:function(c,d){if(this._eventPos==null){this._eventPos=pc.Point.create(0,0)}var b=d;if(!pc.Tools.isValid(d)){b=this._eventPos}if(c.pageX||c.pageY){b.x=c.pageX;b.y=c.pageY}else{b.x=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;b.y=c.clientY+document.body.scrollTop+document.documentElement.scrollTop}if(pc.Tools.isValid(c.alpha)){b.x=c.alpha;b.y=c.gamma}return b}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:false,mouseRightButtonDown:false,deviceOrientation:null,init:function(){this._super();this.stateBindings=new pc.Hashtable();this.states=new pc.Hashtable();this.actionBindings=new pc.Hashtable();this.mousePos=pc.Point.create(0,0);this.deviceOrientation=pc.Point.create(0,0)},bindState:function(f,d,b,c){if(f.uniqueId==null){throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function"}if(!pc.InputType.getCode(b)){throw"Unknown input code "+b+" - see pc.InputType for a list of input names"}b=b.toUpperCase();var g={stateName:d,object:f,input:b,state:{on:false,event:null},uiTarget:c};var e=this.stateBindings.get(b);if(e==null){this.stateBindings.put(b,[g])}else{e.push(g)}this.states.put(f.uniqueId+"\\\\"+d,{on:false,event:null});if(pc.InputType.isPositional(pc.InputType.getCode(b))){this._positionals.push(g)}},clearStates:function(g){var j=this.stateBindings.entries();for(var c=0;c<j.length;c++){var f=j[c];for(var d=0;d<f.length;d++){var h=f[d];if(h.object==g){var e=this.states.get(next.object.uniqueId+"\\\\"+next.stateName);e.on=false;e.event=null;if(pc.InputType.isPositional(h.input)){pc.tools.arrayRemove(this._positionals,h)}}}}},isInputState:function(d,c){var b=this.states.get(d.uniqueId+"\\\\"+c);if(b==null){throw"Ooops, unknown state "+c}return b.on},getInputState:function(c,b){return this.states.get(c.uniqueId+"\\\\"+b)},bindAction:function(f,b,c,d){c=c.toUpperCase();var e=this.actionBindings.get(c);if(e==null){this.actionBindings.put(c,[{actionName:b,object:f,input:c,uiTarget:d}])}else{e.push({actionName:b,input:c,object:f,uiTarget:d})}},fireAction:function(f,c){var k=this.actionBindings.get(pc.InputType.getName(f));if(k==null){return false}for(var e=0;e<k.length;e++){var h=k[e];var d=k[e].object;if(!d.isActive||d.isActive()){if(pc.InputType.isPositional(f)){var j=this.Class.getEventPosition(c);if(pc.InputType.isDeviceOrientation(f)){d.onAction(h.actionName,c,j,h.uiTarget);return true}var l=null;if(pc.valid(h.uiTarget)){l=h.uiTarget.getScreenRect()}else{l=d.getScreenRect?d.getScreenRect():null}if(l&&l.containsPoint(j)){var g=d.onAction(h.actionName,c,j,h.uiTarget);if(pc.valid(g)&&!g){break}}}else{var b=d.onAction(h.actionName);if(pc.valid(b)&&!b){break}}}}return true},_onReady:function(){pc.device.canvas.addEventListener("touchstart",this._touchStart.bind(this),true);pc.device.canvas.addEventListener("touchend",this._touchEnd.bind(this),true);pc.device.canvas.addEventListener("touchmove",this._touchMove.bind(this),true);pc.device.canvas.addEventListener("mouseup",this._mouseUp.bind(this),true);pc.device.canvas.addEventListener("mousedown",this._mouseDown.bind(this),true);pc.device.canvas.addEventListener("mousemove",this._mouseMove.bind(this),true);pc.device.canvas.addEventListener("mousewheel",this._mouseWheel.bind(this),true);pc.device.canvas.addEventListener("contextmenu",this._contextMenu.bind(this),true);window.addEventListener("keydown",this._keyDown.bind(this),true);window.addEventListener("keyup",this._keyUp.bind(this),true);window.addEventListener("deviceorientation",this._deviceOrientation.bind(this),true)},_positionals:[],_checkPositional:function(f){for(var c=0;c<this._positionals.length;c++){var e=this._positionals[c];if(f.type=="mousemove"&&pc.InputType.isTouch(pc.InputType.getCode(e.input))){continue}if(f.type=="touchmove"&&!pc.InputType.isTouch(pc.InputType.getCode(e.input))){continue}if(pc.InputType.getCode(e.input)==pc.InputType.MOUSE_BUTTON_LEFT_UP||pc.InputType.getCode(e.input)==pc.InputType.MOUSE_BUTTON_LEFT_DOWN||pc.InputType.getCode(e.input)==pc.InputType.MOUSE_BUTTON_RIGHT_UP||pc.InputType.getCode(e.input)==pc.InputType.MOUSE_BUTTON_RIGHT_DOWN){continue}var g=null;if(pc.valid(e.uiTarget)){g=e.uiTarget.getScreenRect()}else{g=e.object.getScreenRect?e.object.getScreenRect():null}if(g){if(!g.containsPoint(this.Class.getEventPosition(f))){var d=this.states.get(e.object.uniqueId+"\\\\"+e.stateName);d.on=false;d.event=f}else{var b=this.states.get(e.object.uniqueId+"\\\\"+e.stateName);b.on=true;b.event=f}}}},_changeState:function(f,d,c){var l=pc.InputType.getName(f);if(l==null){this.log("Unknown keycode = "+f);return false}var j=this.stateBindings.get(l);if(j==null){return false}for(var e=0;e<j.length;e++){var g=j[e];if(!g.object.isActive||g.object.isActive()){if(pc.InputType.isPositional(f)){var h=this.Class.getEventPosition(c);var k=null;if(pc.valid(g.uiTarget)){k=g.uiTarget.getScreenRect()}else{k=g.object.getScreenRect?g.object.getScreenRect():null}if(k){if(k.containsPoint(h)){var b=this.states.get(g.object.uniqueId+"\\\\"+g.stateName);b.on=d;b.event=c}}else{b=this.states.get(g.object.uniqueId+"\\\\"+g.stateName);b.on=d;b.event=c}}else{b=this.states.get(g.object.uniqueId+"\\\\"+g.stateName);b.on=d;b.event=c}}}return true},_lastMouseMove:null,_lastDeviceOrientation:null,process:function(){if(this._lastMouseMove){this._checkPositional(this._lastMouseMove);this.fireAction(pc.InputType.MOUSE_MOVE,this._lastMouseMove);this.Class.getEventPosition(this._lastMouseMove,this.mousePos);this._lastMouseMove=null}if(this._lastDeviceOrientation){this._changeState(pc.InputType.DEVICE_ORIENTATION,true,this._lastDeviceOrientation);this.fireAction(pc.InputType.DEVICE_ORIENTATION,this._lastDeviceOrientation);this.Class.getEventPosition(this._lastDeviceOrientation,this.deviceOrientation);this._lastDeviceOrientation=null}},_keyDown:function(b){if(this._changeState(b.keyCode,true,b)){b.preventDefault()}if(this.fireAction(b.keyCode,b)){b.preventDefault()}},_keyUp:function(b){if(this._changeState(b.keyCode,false,b)){b.preventDefault()}},_deviceOrientation:function(b){this._lastDeviceOrientation=b;b.preventDefault()},_touchStart:function(d){for(var c=0,b=d.touches.length;c<b;c++){this._changeState(pc.InputType.TOUCH,true,d.touches[c]);this.fireAction(pc.InputType.TOUCH,d.touches[c])}d.preventDefault()},_touchEnd:function(d){for(var c=0,b=d.changedTouches.length;c<b;c++){this._checkPositional(d.changedTouches[c]);this._changeState(pc.InputType.TOUCH_END,false,d.changedTouches[c]);this.fireAction(pc.InputType.TOUCH_END,d.changedTouches[c])}d.preventDefault()},_touchMove:function(d){for(var c=0,b=d.touches.length;c<b;c++){this._checkPositional(d.touches[c]);this._changeState(pc.InputType.TOUCH_MOVE,false,d.changedTouches[c]);this.fireAction(pc.InputType.TOUCH_MOVE,d.touches[c])}d.preventDefault()},_mouseUp:function(b){if(b.button==0||b.button==1){this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,false,b);this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,true,b);this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_UP,b);this.mouseLeftButtonDown=false}else{this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,false,b);this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,true,b);this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,b);this.mouseRightButtonDown=false}b.preventDefault()},_mouseDown:function(b){if(b.button==0||b.button==1){this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,true,b);this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,false,b);this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,b);this.mouseLeftButtonDown=true}else{this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,true,b);this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,false,b);this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,b);this.mouseRightButtonDown=true}b.preventDefault()},_mouseMove:function(b){this._lastMouseMove=b;b.preventDefault()},_contextMenu:function(b){this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,true,b);this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,b)},_mouseWheel:function(b){if(b.wheel>0){this.fireAction(pc.InputType.MOUSE_WHEEL_UP,b)}else{this.fireAction(pc.InputType.MOUSE_WHEEL_DOWN,b)}b.preventDefault()}});pc.InputType=pc.Base.extend("pc.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1000,MOUSE_MOVE:1100,MOUSE_BUTTON_LEFT_UP:1110,MOUSE_BUTTON_LEFT_DOWN:1111,MOUSE_BUTTON_RIGHT_UP:1120,MOUSE_BUTTON_RIGHT_DOWN:1121,MOUSE_WHEEL_UP:1130,MOUSE_WHEEL_DOWN:1131,TOUCH:1000,TOUCH_MOVE:1001,TOUCH_END:1002,DEVICE_ORIENTATION:1020,init:function(){this.nameToCode=new pc.Hashtable();this.codeToName=new pc.Hashtable();this.addInput(8,"BACKSPACE");this.addInput(9,"TAB");this.addInput(13,"ENTER");this.addInput(16,"SHIFT");this.addInput(17,"CTRL");this.addInput(18,"ALT");this.addInput(19,"PAUSE");this.addInput(20,"CAPS");this.addInput(27,"ESC");this.addInput(32,"SPACE");this.addInput(33,"PAGE_UP");this.addInput(34,"PAGE_DOWN");this.addInput(35,"END");this.addInput(36,"HOME");this.addInput(37,"LEFT");this.addInput(38,"UP");this.addInput(39,"RIGHT");this.addInput(40,"DOWN");this.addInput(45,"INSERT");this.addInput(46,"DELETE");for(var d=48;d<91;d++){var b=String.fromCharCode(d);this.addInput(d,b)}this.addInput(91,"WINDOW_LEFT");this.addInput(92,"WINDOW_RIGHT");this.addInput(93,"SELECT");this.addInput(96,"NUM_0");this.addInput(97,"NUM_1");this.addInput(98,"NUM_2");this.addInput(99,"NUM_3");this.addInput(100,"NUM_4");this.addInput(101,"NUM_5");this.addInput(102,"NUM_6");this.addInput(103,"NUM_7");this.addInput(104,"NUM_8");this.addInput(105,"NUM_9");this.addInput(106,"*");this.addInput(107,"+");this.addInput(109,"-");this.addInput(110,".");this.addInput(111,"/");this.addInput(112,"F1");this.addInput(113,"F2");this.addInput(114,"F3");this.addInput(115,"F4");this.addInput(116,"F5");this.addInput(117,"F6");this.addInput(118,"F7");this.addInput(119,"F8");this.addInput(120,"F9");this.addInput(121,"F10");this.addInput(122,"F11");this.addInput(123,"F12");this.addInput(144,"NUM_LOCK");this.addInput(145,"SCROLL_LOCK");this.addInput(186,";");this.addInput(187,"=");this.addInput(188,",");this.addInput(189,"-");this.addInput(190,".");this.addInput(191,"/");this.addInput(192,"`");this.addInput(219,"[");this.addInput(220,"\\");this.addInput(221,"]");this.addInput(222,"'");this.addInput(this.DEVICE_ORIENTATION,"DEVICE_ORIENTATION");this.addInput(this.TOUCH,"TOUCH");this.addInput(this.TOUCH_MOVE,"TOUCH_MOVE");this.addInput(this.TOUCH_END,"TOUCH_END");this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN");this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP");this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN");this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP");this.nameToCode.put("MOUSE_LEFT_BUTTON",this.MOUSE_BUTTON_LEFT_UP);this.nameToCode.put("MOUSE_RIGHT_BUTTON",this.MOUSE_BUTTON_RIGHT_UP);this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP");this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN");this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE")},isDeviceOrientation:function(b){return b==this.DEVICE_ORIENTATION},isTouch:function(b){return b==this.TOUCH},isPositional:function(b){return b>=this.POSITIONAL_EVENT_START},addInput:function(c,b){this.codeToName.put(c,b);this.nameToCode.put(b,c)},getName:function(b){return this.codeToName.get(b)},getCode:function(b){return this.nameToCode.get(b)}},{});pc.Hashmap=pc.Base.extend("pc.Hashmap",{},{init:function(){this._super();this.items={}},length:0,items:{},put:function(b,c){if(!pc.valid(b)){throw"invaid key"}this.items[b]=c;this.length++},get:function(b){return this.items[b]},hasKey:function(b){return this.items.hasOwnProperty(b)},remove:function(b){if(this.hasKey(b)){this.length--;delete this.items[b]}},keys:function(){var c=[];for(var b in this.items){c.push(b)}return c},values:function(){var c=[];for(var b in this.items){c.push(this.items[b])}return c},clear:function(){this.items={};this.length=0}});pc.Tools=pc.Base.extend("pc.Tools",{checked:function(c,b){if(!pc.valid(c)){return b}return c},isValid:function(b){return !(b==null||typeof b==="undefined")},assert:function(c,b){if(!c){throw b}},arrayRemove:function(d,c){for(var b=d.length-1;b>=0;b--){if(d[b]==c){d.splice(b,1)}}},arrayExclusiveAdd:function(c,b){if(c.indexOf(b)==-1){c.push(b)}},xmlToJson:function(b,d){var e={toObj:function(g){var l={};if(g.nodeType==1){if(g.attributes.length){for(var k=0;k<g.attributes.length;k++){l[g.attributes[k].nodeName]=(g.attributes[k].nodeValue||"").toString()}}if(g.firstChild){var f=0,j=0,h=false;for(var m=g.firstChild;m;m=m.nextSibling){if(m.nodeType==1){h=true}else{if(m.nodeType==3&&m.nodeValue.match(/[^ \f\n\r\t\v]/)){f++}else{if(m.nodeType==4){j++}}}}if(h){if(f<2&&j<2){e.removeWhite(g);for(var m=g.firstChild;m;m=m.nextSibling){if(m.nodeType==3){l["#text"]=e.escape(m.nodeValue)}else{if(m.nodeType==4){l["#cdata"]=e.escape(m.nodeValue)}else{if(l[m.nodeName]){if(l[m.nodeName] instanceof Array){l[m.nodeName][l[m.nodeName].length]=e.toObj(m)}else{l[m.nodeName]=[l[m.nodeName],e.toObj(m)]}}else{l[m.nodeName]=e.toObj(m)}}}}}else{if(!g.attributes.length){l=e.escape(e.innerXml(g))}else{l["#text"]=e.escape(e.innerXml(g))}}}else{if(f){if(!g.attributes.length){l=e.escape(e.innerXml(g))}else{l["#text"]=e.escape(e.innerXml(g))}}else{if(j){if(j>1){l=e.escape(e.innerXml(g))}else{for(var m=g.firstChild;m;m=m.nextSibling){l["#cdata"]=e.escape(m.nodeValue)}}}}}}if(!g.attributes.length&&!g.firstChild){l=null}}else{if(g.nodeType==9){l=e.toObj(g.documentElement)}else{alert("unhandled node type: "+g.nodeType)}}return l},toJson:function(p,h,l){var k=h?('"'+h+'"'):"";if(p instanceof Array){for(var j=0,q=p.length;j<q;j++){p[j]=e.toJson(p[j],"",l+"\t")}k+=(h?":[":"[")+(p.length>1?("\n"+l+"\t"+p.join(",\n"+l+"\t")+"\n"+l):p.join(""))+"]"}else{if(p==null){k+=(h&&":")+"null"}else{if(typeof(p)=="object"){var g=[];for(var f in p){g[g.length]=e.toJson(p[f],f,l+"\t")}k+=(h?":{":"{")+(g.length>1?("\n"+l+"\t"+g.join(",\n"+l+"\t")+"\n"+l):g.join(""))+"}"}else{if(typeof(p)=="string"){k+=(h&&":")+'"'+p.toString()+'"'}else{k+=(h&&":")+p.toString()}}}}return k},innerXml:function(h){var g="";if("innerHTML" in h){g=h.innerHTML}else{var f=function(m){var k="";if(m.nodeType==1){k+="<"+m.nodeName;for(var j=0;j<m.attributes.length;j++){k+=" "+m.attributes[j].nodeName+'="'+(m.attributes[j].nodeValue||"").toString()+'"'}if(m.firstChild){k+=">";for(var l=m.firstChild;l;l=l.nextSibling){k+=f(l)}k+="</"+m.nodeName+">"}else{k+="/>"}}else{if(m.nodeType==3){k+=m.nodeValue}else{if(m.nodeType==4){k+="<![CDATA["+m.nodeValue+"]]>"}}}return k};for(var i=h.firstChild;i;i=i.nextSibling){g+=f(i)}}return g},escape:function(f){return f.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(g){g.normalize();for(var h=g.firstChild;h;){if(h.nodeType==3){if(!h.nodeValue.match(/[^ \f\n\r\t\v]/)){var f=h.nextSibling;g.removeChild(h);h=f}else{h=h.nextSibling}}else{if(h.nodeType==1){e.removeWhite(h);h=h.nextSibling}else{h=h.nextSibling}}}return g}};if(b.nodeType==9){b=b.documentElement}var c=e.toJson(e.toObj(e.removeWhite(b)),b.nodeName,"\t");return"{\n"+d+(d?c.replace(/\t/g,d):c.replace(/\t|\n/g,""))+"\n}"}},{});pc.tools=new pc.Tools();pc.valid=pc.Tools.isValid;pc.checked=pc.Tools.checked;pc.assert=pc.Tools.assert;pc.Base64=pc.Base.extend("pc.Base64",{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(d){var b="";var l,j,g,k,h,f,e;var c=0;d=pc.Base64._utf8_encode(d);while(c<d.length){l=d.charCodeAt(c++);j=d.charCodeAt(c++);g=d.charCodeAt(c++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64}else{if(isNaN(g)){e=64}}b=b+this._keyStr.charAt(k)+this._keyStr.charAt(h)+this._keyStr.charAt(f)+this._keyStr.charAt(e)}return b},decode:function(d){var b=[];var l,j,g;var k,h,f,e;var c=0;d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<d.length){k=this._keyStr.indexOf(d.charAt(c++));h=this._keyStr.indexOf(d.charAt(c++));f=this._keyStr.indexOf(d.charAt(c++));e=this._keyStr.indexOf(d.charAt(c++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);g=((f&3)<<6)|e;b.push(String.fromCharCode(l));if(f!=64){b.push(String.fromCharCode(j))}if(e!=64){b.push(String.fromCharCode(g))}}return b.join("")},_utf8_encode:function(d){d=d.replace(/\r\n/g,"\n");var b="";for(var f=0;f<d.length;f++){var e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b},_utf8_decode:function(b){var d="";var e=0;var f=c1=c2=0;while(e<b.length){f=b.charCodeAt(e);if(f<128){d+=String.fromCharCode(f);e++}else{if((f>191)&&(f<224)){c2=b.charCodeAt(e+1);d+=String.fromCharCode(((f&31)<<6)|(c2&63));e+=2}else{c2=b.charCodeAt(e+1);c3=b.charCodeAt(e+2);d+=String.fromCharCode(((f&15)<<12)|((c2&63)<<6)|(c3&63));e+=3}}}return d}},{});if(!window.btoa){window.btoa=pc.Base64.encode}if(!window.atob){window.atob=pc.Base64.decode}pc.Color=pc.Pooled.extend("pc.Color",{create:function(b){var c=this._super();c.config(b);return c}},{rgb:[],color:null,init:function(b){if(b!=undefined){this.config(b)}},config:function(b){if(Array.isArray(b)){this.rgb=b}else{if(b.charAt(0)==="#"){this.rgb[0]=parseInt(b.substring(1,3),16);this.rgb[1]=parseInt(b.substring(3,5),16);this.rgb[2]=parseInt(b.substring(5,7),16)}else{throw"Invalid color: use either array [r,g,b] or '#RRGGBB'"}}this._updateColorCache()},set:function(b){this.config(b)},setRed:function(b){this.rgb[0]=pc.Math.limit(b,0,255);this._updateColorCache()},addRed:function(b){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],b,0,255);this._updateColorCache()},subRed:function(b){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],-b,0,255);this._updateColorCache()},setGreen:function(b){this.rgb[1]=pc.Math.limit(b,0,255);this._updateColorCache()},addGreen:function(b){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],b,0,255);this._updateColorCache()},subGreen:function(b){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],-b,0,255);this._updateColorCache()},setBlue:function(c){this.rgb[2]=pc.Math.limit(c,0,255);this._updateColorCache()},addBlue:function(c){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],c,0,255);this._updateColorCache()},subBlue:function(c){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],-c,0,255);this._updateColorCache()},darken:function(b){this.subRed(b);this.subGreen(b);this.subBlue(b)},lighten:function(b){this.addRed(b);this.addGreen(b);this.addBlue(b)},_updateColorCache:function(){this.color="rgb("+this.rgb[0]+","+this.rgb[1]+","+this.rgb[2]+")"}});pc.DebugPanel=pc.Base("pc.DebugPanel",{},{x:0,y:0,panelHeight:0,panelWidth:0,canvas:null,ctx:null,statusText:null,active:false,timeGraph:null,memGraph:null,entityGraph:null,poolGraph:null,currentMem:0,lastMem:0,init:function(){this._super()},onReady:function(){this.attach("pcDebug")},attach:function(b){this.canvas=document.getElementById(b);if(this.canvas==null){this.warn('Showing debug requires a div with an id of "debug" to be added to your dom.');pc.device.showDebug=false;return}this.panelElement=this.canvas.parentNode;this.ctx=this.canvas.getContext("2d");this.onResize();var c=4;this.timeGraph=new pc.CanvasLineGraph(this.ctx,"Performance","",10,[{name:"process (ms)",color:"#f55"},{name:"render (ms)",color:"#5f5"}],10,10,(this.panelWidth/c)-10,this.panelHeight-20);if(typeof console.memory==="undefined"||console.memory.totalJSHeapSize==0){this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","Memory profiling not available",0,[{name:"mem used (mb)",color:"#55f"}],(this.panelWidth/c)+10,10,(this.panelWidth/c)-10,this.panelHeight-20)}else{this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","",((console.memory.totalJSHeapSize/1024/1024)*1.2),[{name:"mem used (mb)",color:"#55f"}],(this.panelWidth/c)+10,10,(this.panelWidth/c)-10,this.panelHeight-20)}this.poolGraph=new pc.CanvasLineGraph(this.ctx,"Pool Size","",100,[{name:"pooled",color:"#5b1654"}],this.panelWidth-((this.panelWidth/c)*2)+10,10,(this.panelWidth/c)-20,this.panelHeight-20);this.entityGraph=new pc.CanvasLineGraph(this.ctx,"Entities","",100,[{name:"drawn (total)",color:"#f9f007"}],this.panelWidth-(this.panelWidth/c)+10,10,(this.panelWidth/c)-20,this.panelHeight-20);this.active=true},onResize:function(){if(this.canvas==null){return}this.canvas.width=this.panelElement.offsetWidth;this.canvas.height=this.panelElement.offsetHeight;this.panelWidth=this.panelElement.offsetWidth;this.panelHeight=this.panelElement.offsetHeight;this.ctx.fillStyle="#111";this.ctx.fillRect(0,0,this.panelWidth,this.panelHeight);var b=4;if(this.timeGraph!=null){this.timeGraph.resize(10,10,this.panelWidth/b-10,this.panelHeight-20)}if(this.memGraph!=null){this.memGraph.resize(this.panelWidth/b+10,10,this.panelWidth/b-10,this.panelHeight-20)}if(this.poolGraph!=null){this.poolGraph.resize(this.panelWidth-((this.panelWidth/b)*2)+20,10,this.panelWidth/b-20,this.panelHeight-20)}if(this.entityGraph!=null){this.entityGraph.resize(this.panelWidth-(this.panelWidth/b)+10,10,this.panelWidth/b-20,this.panelHeight-20)}},_timeSince:0,update:function(b){if(!this.active){return}this._timeSince+=b;if(this._timeSince>30){this._timeSince=0;if(this.timeGraph!=null){this.timeGraph.addLine2(pc.device.lastProcessMS,pc.device.lastDrawMS)}if(this.entityGraph!=null){this.entityGraph.addLine1(pc.device.elementsDrawn)}if(this.memGraph!=null){if(typeof console.memory!=="undefined"){if(console.memory.totalJSHeapSize!=0){this.memGraph.addLine1((window.performance.memory.usedJSHeapSize/1024/1024))}}}if(this.poolGraph!=null){this.poolGraph.addLine1(gamecore.Pool.totalPooled)}}},draw:function(){if(!this.active){return}if(this.timeGraph!=null){this.timeGraph.draw()}if(this.entityGraph!=null){this.entityGraph.draw()}if(this.memGraph!=null){this.memGraph.draw()}if(this.poolGraph!=null){this.poolGraph.draw()}}});pc.CanvasLineGraph=pc.Base.extend("pc.CanvasLineGraph",{height:0,width:0,ctx:null,data:null,maxY:0,x:0,y:0,labels:null,graphName:null,bgCanvas:null,graphCanvas:null,message:null,cursor:0,init:function(i,d,j,b,e,g,f,c,h){this._super();this.ctx=i;this.message=j;this.graphName=d;this.maxY=b;this.x=g;this.y=f;this.width=c;this.height=h;this.labels=e;this.graphX=this.x+this.graphLeftMargin;this.graphY=this.y+20;this.cursor=0;this.graphCanvas=document.createElement("canvas");this.bgCanvas=document.createElement("canvas");this.resize(g,f,c,h)},resize:function(c,e,d,b){if(this.width>d){this.data=this.data.slice(this.width-d,d)}this.width=d;this.height=b;this.x=c;this.y=e;this.graphHeight=this.height-40;this.graphWidth=this.width-(this.graphLeftMargin+this.graphRightMargin);this.graphX=this.graphLeftMargin;this.graphY=20;this.bgCanvas.width=this.width;this.bgCanvas.height=this.height;this.graphCanvas.width=Math.max(this.graphWidth,1);this.graphCanvas.height=Math.max(this.graphHeight,1);this.resizeDataArray(this.graphWidth,this.labels.length);this.renderBackground()},resizeDataArray:function(b,d){var e=0;if(b<=0){return}if(this.data==null){this.data=[]}else{if(b>this.data.length){e=this.data.length-1}else{this.data.splice(0,b-this.data.length);if(this.cursor>this.data.length-1){this.cursor=this.data.length-1}return}}for(var c=e;c<b;c++){this.data.push(new Array(d))}},_totalAdded:0,linesSinceLastPeak:0,lastPeak:0,_total:0,addLine2:function(c,b){if(!this.data){return}this._totalAdded++;this._total=c+b;this.checkMaxRange(this._total);this.data[this.cursor][0]=c;this.data[this.cursor][1]=b;this._updateGraph(this._total)},addLine1:function(b){if(!this.data){return}this._totalAdded++;this._total=b;this.checkMaxRange(this._total);this.data[this.cursor][0]=b;this._updateGraph(b)},checkMaxRange:function(b){if(b>this.maxY){this.maxY=b*1.4;if(this.maxY<this.height/this.gridLineInc){this.maxY=this.height/this.gridLineInc}this.renderBackground();this.renderGraph(true)}},_updateGraph:function(b){this.linesSinceLastPeak++;if(this.linesSinceLastPeak>this.width*1.5){this.linesSinceLastPeak++;this.maxY=b*1.4;if(this.maxY<this.height/this.gridLineInc){this.maxY=this.height/this.gridLineInc}this.lastPeak=b*1.4;this.renderBackground();this.linesSinceLastPeak=0}if(b>this.lastPeak){this.lastPeak=b*1.4}this.cursor++;if(this.cursor>this.data.length-1){this.cursor=0}},margin:20,linePixelSize:0,yline:0,unit:0,gridY:0,i:0,n:0,graphLeftMargin:30,graphRightMargin:15,graphHeight:0,graphWidth:0,graphX:0,graphY:0,gridLineInc:15,renderBackground:function(){var d=this.bgCanvas.getContext("2d");d.fillStyle="#000";d.fillRect(0,0,this.width,this.height);d.fillStyle="#aaa";d.font="11px sans-serif";d.fillText(this.graphName,this.graphX,this.graphY-6);d.strokeStyle="#111";d.strokeRect(this.graphX+0.5,this.graphY+0.5,this.graphWidth,this.graphHeight);this.unit=(this.graphHeight)/this.maxY;var h=(this.graphHeight+this.gridLineInc)/this.gridLineInc;var g=this.maxY/h;var i=0;var c=0;for(this.gridY=this.graphHeight+this.graphY;this.gridY>this.graphY+1;this.gridY-=this.gridLineInc){c++;d.textAlign="right";(c%2==0)?d.fillStyle="#111":d.fillStyle="#000";var f=this.gridLineInc;if(this.gridY-f<this.graphY){f=(this.gridY-this.graphY);d.fillRect(this.graphX+1,this.graphY+1,this.graphWidth-2,f-1)}else{d.fillRect(this.graphX+1,this.gridY-f-1,this.graphWidth-2,f)}i=Math.round(g*c);d.fillStyle="#777";d.fillText(""+i,this.graphX-5,this.gridY)}d.globalAlpha=1;d.textAlign="left";var e=this.height-13;var b=this.graphLeftMargin+3;for(this.n=0;this.n<this.labels.length;this.n++){d.fillStyle=this.labels[this.n].color;d.fillRect(b,e,5,5);d.fillStyle="#888";d.fillText(this.labels[this.n].name,b+8,e+6);b+=d.measureText(this.labels[this.n].name).width+18}this.renderGraph(true)},renderGraph:function(f){if(!this.data){return}var e=this.graphCanvas.getContext("2d");if(f){e.fillStyle="#000";e.fillRect(0,0,this.graphWidth,this.graphHeight)}else{if(this._totalAdded>this.graphWidth){e.drawImage(this.graphCanvas,-1,0)}}var b=0;if(f){b=this.data.length-1;this.dx=1}else{if(this._totalAdded<this.graphWidth){this.dx=this.cursor}else{this.dx=this.graphWidth-1}b=this.dx+1}if(b==0){return}var d=this.cursor-1;if(d<0){d=this.data.length-1}for(;this.dx<b;this.dx++){if(d>this.data.length-1){d=0}e.fillStyle="#000";e.fillRect(this.dx,0,1,this.graphHeight);this.yline=this.graphHeight;for(this.i=0;this.i<this.data[d].length;this.i++){this.linePixelSize=(this.data[d][this.i]*this.unit);e.strokeStyle=this.labels[this.i].color;e.beginPath();e.moveTo(this.dx,this.yline);var c=this.yline-this.linePixelSize;if(c<0){c=0}e.lineTo(this.dx,c);e.closePath();e.stroke();this.yline-=this.linePixelSize}d++}},draw:function(){this.ctx.save();this.ctx.drawImage(this.bgCanvas,this.x,this.y);this.renderGraph(false);this.ctx.globalAlpha=0.4;this.ctx.drawImage(this.graphCanvas,this.x+this.graphX,this.y+this.graphY);if(this.message){this.ctx.font="13px sans-serif";this.ctx.fillStyle="#333";this.ctx.textAlign="center";this.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2-9)}this.ctx.restore()}});pc.Device=pc.Base.extend("pc.Device",{},{canvasId:null,canvas:null,canvasWidth:0,canvasHeight:0,loader:null,timer:null,ctx:null,started:false,fps:0,currentFPS:0,tick:0,running:true,scale:1,xmlParser:null,debugPanel:null,showDebug:true,devMode:true,enablePooling:true,soundEnabled:true,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,screen:null,pixelRatio:1,isiPhone:false,isiPhone4:false,isiPad:false,isAndroid:false,isTouch:false,isiOS:false,isiPod:false,requestAnimFrame:null,input:null,gameClass:null,game:null,elapsed:0,lastFrame:0,now:Date.now(),boot:function(c,b){if(this.devMode){this.info("Playcraft Engine v"+pc.VERSION+" starting")}this.canvasId=c;this.gameClass=b;this.fps=60;this.tick=1000/this.fps;this.debugPanel=new pc.DebugPanel();this.input=new pc.Input();this.loader=new pc.Loader();this.isAppMobi=(typeof AppMobi!="undefined");this.pixelRatio=gamecore.Device.pixelRatio;this.isiPhone=gamecore.Device.isiPhone;this.isiPhone4=gamecore.Device.isiPhone4;this.isiPad=gamecore.Device.isiPad;this.isAndroid=gamecore.Device.isAndroid;this.isTouch=gamecore.Device.isTouch;this.isiOS=(this.isiPhone||this.isiPad);this.device=gamecore.Device;this.requestAnimFrame=gamecore.Device.requestAnimFrame;this.requestAnimFrame=(function(){var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(f,e){window.setTimeout(f,1000/60,Date.now())};return function(f,e){d.apply(window,[f,e])}})();window.onresize=this.onResize.bind(this);this.onReady()},canPlay:function(b){return gamecore.Device.canPlay(b)},_calcScreenSize:function(){if(this.isAppMobi){if(this.screen!=null){this.screen.release()}this.screen=pc.Dim.create(document.body.offsetWidth,document.body.offsetHeight);this.canvas.width=this.screen.x;this.canvas.height=this.screen.y;this.canvas.innerWidth=this.screen.x;this.canvas.innerHeight=this.screen.y;this.canvasWidth=this.screen.x;this.canvasHeight=this.screen.y}else{if(this.isiPad||this.isiPhone){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight}else{if(this.panelElement){this.canvas.width=this.panelElement.offsetWidth;this.canvas.height=this.panelElement.offsetHeight}}this.canvasWidth=this.canvas.width;this.canvasHeight=this.canvas.height;this.screen=pc.Dim.create(this.canvasWidth,this.canvasHeight)}},onReady:function(){if(this.isiOS){this.showDebug=false;this.soundEnabled=false}if(this.started){return}this.game=eval("new "+this.gameClass+"()");if(!this.game){throw"Invalid game class"}this.canvas=document.getElementById(this.canvasId);if(!this.canvas){throw"Abort! Could not attach to a canvas element using the id ["+this.canvasId+']. Add a canvas element to your HTML, such as <canvas id="pcGameCanvas"></canvas>'}this.input._onReady();this.ctx=this.canvas.getContext("2d");this.panelElement=this.canvas.parentNode;this.onResize();if(this.showDebug){this.debugPanel.onReady()}this.lastFrame=Date.now();this.game.onReady();this.requestAnimFrame(this.cycle.bind(this));this.started=true},startTime:0,cycle:function(b){if(this.running!==false){this.now=Date.now();this.elapsed=this.now-this.lastFrame;this.lastDrawMS=0;this.currentFPS=Math.round(1000/this.elapsed);this.elementsDrawn=0;this.startTime=Date.now();if(this.elapsed<200){this.running=this.game.process()}this.lastProcessMS=(Date.now()-this.startTime)-this.lastDrawMS;pc.device.input.process();if(this.showDebug){this.debugPanel.update(this.elapsed);this.debugPanel.draw(this.ctx)}this.lastFrame=this.now;this.requestAnimFrame(this.cycle.bind(this))}},resize:function(b,c){this.canvas.width=b;this.canvas.height=c;this.canvasWidth=this.canvas.width;this.canvasHeight=this.canvas.height;this.game.onResize(this.canvasWidth,this.canvasHeight);this.debugPanel.onResize(this.canvasWidth,this.canvasHeight)},onResize:function(){if(this.canvas==null){return}this._calcScreenSize();var b=false;if(typeof window.orientation!=="undefined"&&window.orientation!=0){b=true}if(b){}this.canvasWidth=this.canvas.width;this.canvasHeight=this.canvas.height;this.game.onResize(this.canvasWidth,this.canvasHeight);this.debugPanel.onResize()},isOnScreen:function(b,e,c,d){return pc.Math.isRectColliding(b,e,c,d,0,0,this.canvasWidth,this.canvasHeight)},parseXML:function(b){if(window.DOMParser){if(!this.xmlParser){this.xmlParser=new DOMParser()}return this.xmlParser.parseFromString(b,"text/xml")}else{var c=new ActiveXObject("Microsoft.XMLDOM");c.loadXML(b);return c}}});pc.device=new pc.Device();pc.Sound=pc.Base.extend("pc.Sound",{},{sounds:[],src:null,name:null,numLoaded:0,loaded:false,errored:false,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(d,j,c,b,h,g){this._super();this.name=d;this.channels=b;var f=false;for(var e=0;e<c.length;e++){if(pc.device.canPlay(c[e])){this.src=pc.device.loader.makeUrl(j+"."+c[e]);f=true;break}}if(f){if(pc.device.loader.started){this.load(h,g)}}else{this.errored=true}},pause:function(){if(!this.canPlay()){return}for(var c=0,b=this.sounds.length;c<b;c++){this.sounds[c].pause()}},stop:function(){if(!this.canPlay()){return}this.pause()},setVolume:function(d){if(!this.canPlay()){return}for(var c=0,b=this.sounds.length;c<b;c++){this.sounds[c].volume=d}},getDuration:function(){if(!this.canPlay()){return -1}return this.sounds[0].duration},setPlaybackRate:function(d){if(!this.canPlay()){return}for(var c=0,b=this.sounds.length;c<b;c++){this.sounds[c].playbackRate=d}},setPlayPosition:function(d){if(!this.canPlay()){return}for(var c=0,b=this.sounds.length;c<b;c++){this.sounds[c].currentTime=d}},load:function(d,c){this.onLoadCallback=d;this.onErrorCallback=c;if(this.loaded&&d){this.onLoadCallback(this);return}for(var b=0;b<this.channels;b++){var e=new Audio();e.preload="auto";e.addEventListener("canplaythrough",this.onLoad.bind(this),false);e.addEventListener("error",this.onError.bind(this),false);e.onerror=this.onError.bind(this);e.onload=this.onLoad.bind(this);e.src=this.src;e.load();this.sounds.push(e);if(pc.device.isAppMobi){this.onLoad(null)}}},reload:function(){this.loaded=false;this.errored=false;this.load()},onLoad:function(b){this.numLoaded++;if(!pc.device.isAppMobi){b.target.removeEventListener("canplaythrough",this.onLoad.bind(this),false)}if(this.numLoaded==this.channels){this.loaded=true;this.errored=false;if(this.onLoadCallback){this.onLoadCallback(this)}}},onError:function(){this.errored=true;this.loaded=false;if(this.onErrorCallback){this.onErrorCallback(this)}},play:function(c){if(!this.canPlay()){return null}for(var d=0,b=this.sounds.length;d<b;d++){if(this.sounds[d].paused||this.sounds[d].ended){if(c){this.sounds[d].loop=true}this.sounds[d].play();return this.sounds[d]}}this.warn(this.name+" - all channels are in use");return null},canPlay:function(){return(this.loaded&&pc.device.soundEnabled&&!this.errored)}});pc.Layer=pc.Base.extend("pc.Layer",{},{name:null,paused:false,active:false,scene:null,zIndex:0,originTrack:null,originTrackXRatio:1,originTrackYRatio:1,origin:null,init:function(b,c){this._super();this.name=b;this.origin=pc.Point.create(0,0);this._worldPos=pc.Point.create(0,0);this._screenPos=pc.Point.create(0,0);this.zIndex=pc.checked(c,0);this.originTrack=null;this.originTrackXRatio=0;this.originTrackYRatio=0},toString:function(){return""+this.name+" (origin: "+this.origin+", zIndex: "+this.zIndex+")"},release:function(){this.origin.release()},isActive:function(){if(this.scene!=null){if(!this.scene.active){return false}}return this.active},setActive:function(){this.scene.setLayerActive(this)},setInactive:function(){this.scene.setLayerInactive(this)},setZIndex:function(b){this.zIndex=b;if(this.scene){this.scene.sortLayers()}},_worldPos:null,worldPos:function(b){this._worldPos.x=b.x+this.origin.x;this._worldPos.y=b.y+this.origin.y;return this._worldPos},screenX:function(b){return b+this.scene.viewPort.x-this.origin.x},screenY:function(b){return b+this.scene.viewPort.y-this.origin.y},getScreenRect:function(){return this.scene.getScreenRect()},draw:function(){},setOriginTrack:function(b,d,c){this.originTrack=b;this.originTrackXRatio=pc.checked(d,1);this.originTrackYRatio=pc.checked(c,1)},setOrigin:function(b,c){if(this.origin.x==Math.round(b)&&this.origin.y==Math.round(c)){return false}this.origin.x=Math.round(b);this.origin.y=Math.round(c);return true},process:function(){if(this.originTrack){this.setOrigin(this.originTrack.origin.x*this.originTrackXRatio,this.originTrack.origin.y*this.originTrackYRatio)}},pause:function(){this.paused=true},resume:function(){this.paused=false},onResize:function(c,b){},onAddedToScene:function(){},onRemovedFromScene:function(){},onAction:function(b,d,e,c){}});pc.EntityLayer=pc.Layer.extend("pc.EntityLayer",{loadFromTMX:function(F,E,b){var G=E.getAttribute("name");var s=new pc.EntityLayer(G);F.addLayer(s);var g=E.getElementsByTagName("object");for(var C=0;C<g.length;C++){var k=g[C];var v=null;var m=parseInt(k.getAttribute("x"));var l=parseInt(k.getAttribute("y"));var o=parseInt(k.getAttribute("width"));var D=parseInt(k.getAttribute("height"));var c=null;var q=k.getElementsByTagName("polygon");if(q.length>0){var f=q[0].getAttribute("points");var B=[];var I=f.split(" ");for(var z=0;z<I.length;z++){var A=I[z].split(",");B.push([parseInt(A[0]),(parseInt(A[1]))])}c=pc.Poly.create(m,l,B)}else{c=pc.Dim.create(o,D)}var e={};var u=k.getElementsByTagName("properties");if(u.length){var d=u[0].getElementsByTagName("property");for(var r=0;r<d.length;r++){var H=d[r].getAttribute("name");var t=d[r].getAttribute("value");e[H]=t;if(H==="entity"){v=t}}}if(v){b.createEntity(s,v,m,l,0,c,e)}else{this.warn('Entity loaded from map with no "entity" type property set. x='+m+" y="+l)}}}},{worldSize:null,entityManager:null,systemManager:null,init:function(b,e,d,c){this._super(b);this.entityFactory=c;this.systemManager=new pc.SystemManager(this);this.entityManager=new pc.EntityManager(this);this.worldSize=pc.Dim.create(pc.checked(e,10000),pc.checked(d,10000))},setOrigin:function(b,d){var c=this._super(b,d);if(c){this.systemManager.onOriginChange(b,d)}return c},getEntityManager:function(){return this.entityManager},getSystemManager:function(){return this.systemManager},addSystem:function(b){this.systemManager.add(b,this.entityManager)},getSystemsByComponentType:function(b){return this.systemManager.getByComponentType(b)},removeSystem:function(b){this.systemManager.remove(b)},process:function(){this._super();this.systemManager.processAll();this.entityManager.cleanup()},onResize:function(c,b){this.systemManager.onResize(c,b)}});pc.TileSet=pc.Base.extend("pc.TileSet",{},{tileSpriteSheet:null,props:null,init:function(b){this.tileSpriteSheet=pc.checked(b,null);if(this.tileSpriteSheet){this.props=new Array(b.totalFrames);for(var c=0;c<this.props.length;c++){this.props[c]=new pc.Hashmap()}}},drawTile:function(c,d,b,e){this.tileSpriteSheet.drawFrame(c,d%this.tileSpriteSheet.framesWide,pc.Math.floor(d/this.tileSpriteSheet.framesWide),b,e)},addProperty:function(d,b,c){this.props[d].put(b,c)},hasProperty:function(c,b){return this.props[c].hasKey(b)},getProperties:function(b){return this.props[b]},getTileWidth:function(){return this.tileSpriteSheet.tileWidth},getTileHeight:function(){return this.tileSpriteSheet.tileHeight}});pc.TileMap=pc.Base.extend("pc.TileMap",{EMPTY_TILE:-1},{tiles:null,tilesWide:0,tilesHigh:0,tileWidth:0,tileHeight:0,tileSet:null,init:function(e,f,b,g,d,c){this.tiles=c;this.tilesWide=pc.Math.round(f);this.tilesHigh=pc.Math.round(b);this.tileWidth=Math.round(pc.checked(g,e.tileSpriteSheet.frameWidth));this.tileHeight=Math.round(pc.checked(d,e.tileSpriteSheet.frameHeight));this.tileSet=e},tileHasProperty:function(d,b,c){var e=this.getTile(d,b);if(e>=0){return this.tileSet.hasProperty(e,c)}return false},generate:function(d){this.tiles=new Array(this.tilesHigh);var b=pc.checked(d,this.Class.EMPTY_TILE);for(var c=0;c<this.tilesHigh;c++){this.tiles[c]=new Array(this.tilesWide);for(var e=0;e<this.tilesWide;e++){this.tiles[c][e]=b}}},paint:function(b,i,c,d,f){for(var e=i;e<i+d;e++){for(var g=b;g<b+c;g++){this.tiles[e][g]=f}}},isOnMap:function(b,c){return(b>=0&&b<this.tilesWide&&c>=0&&c<this.tilesHigh)},clear:function(c,b,d,e){this.paint(c,b,d,e,this.Class.EMPTY_TILE)},setTile:function(c,b,d){this.tiles[b][c]=d},getTile:function(c,b){if(!this.isOnMap(c,b)){return -1}return this.tiles[b][c]},drawTile:function(d,c,b,e){this.tileSet.drawTile(pc.device.ctx,this.tiles[c][d],b,e)},loadFromTMX:function(p,l,k){this.tileWidth=l;this.tileHeight=k;this.tilesWide=parseInt(p.getAttribute("width"));this.tilesHigh=parseInt(p.getAttribute("height"));var f=p.getElementsByTagName("data")[0];if(f.getAttribute("compression")){this.error("map: "+name+": TMX map compression not supported, use base64 encoding");return}if(f.getAttribute("encoding")=="base64"){var d="";for(var b=0;b<f.childNodes.length;b++){d+=f.childNodes[b].nodeValue}d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");var o=pc.Base64.decode(d);var m=[];for(var e=0;e<o.length/4;e++){m[e]=0;for(var c=3;c>=0;--c){m[e]+=o.charCodeAt((e*4)+c)<<(c<<3)}}}this.tiles=new Array(this.tilesHigh);for(var g=0;g<this.tilesHigh;g++){this.tiles[g]=new Array(this.tilesWide);for(var h=0;h<this.tilesWide;h++){this.tiles[g][h]=m[g*this.tilesWide+h]-1}}}});pc.TileLayer=pc.Layer.extend("pc.TileLayer",{loadFromTMX:function(g,f,h,b,d){var c=f.getAttribute("name");var e=new pc.TileLayer(c,true,null,d);e.tileMap.loadFromTMX(f,h,b);g.addLayer(e)}},{tileMap:null,debugShowGrid:false,prerenders:null,usePrerendering:true,prerenderSize:512,init:function(c,e,b,d){this._super(c);if(pc.valid(b)){this.tileMap=b}else{this.tileMap=new pc.TileMap(d)}this.usePrerendering=pc.checked(e,true);if(this.tileMap&&this.tileMap.tileWidth>256){this.usePrerendering=false}},setTileMap:function(b){this.tileMap=b;if(this.usePrerendering){this.prerender()}},prerender:function(){var e=this.tileMap.tilesWide*this.tileMap.tileWidth;var q=this.tileMap.tilesHigh*this.tileMap.tileHeight;var m=Math.ceil(e/this.prerenderSize);var j=Math.ceil(q/this.prerenderSize);this.prerenders=[];for(var c=0;c<j;c++){this.prerenders[c]=[];for(var d=0;d<m;d++){var g=(k==m-1)?e-k*this.prerenderSize:this.prerenderSize;var l=(i==j-1)?q-i*this.prerenderSize:this.prerenderSize;var t=g/this.tileMap.tileWidth+1;var h=l/this.tileMap.tileHeight+1;var p=(d*this.prerenderSize)%this.tileMap.tileWidth,o=(c*this.prerenderSize)%this.tileMap.tileHeight;var s=Math.floor(d*this.prerenderSize/this.tileMap.tileWidth),r=Math.floor(c*this.prerenderSize/this.tileMap.tileHeight);var f=document.createElement("canvas");f.width=g;f.height=l;var n=f.getContext("2d");for(var k=0;k<t;k++){for(var i=0;i<h;i++){if(k+s<this.tileMap.tilesWide&&i+r<this.tileMap.tilesHigh){var b=this.tileMap.getTile(k+s,i+r);if(b>=0){this.tileMap.tileSet.drawTile(n,b,(k*this.tileMap.tileWidth)-p,(i*this.tileMap.tileHeight)-o)}}}}this.prerenders[c][d]=f}}},draw:function(){this._super();if(!this.tileMap||!this.tileMap.tilesWide){return}if(this.usePrerendering){this.drawPrerendered()}else{this.drawTiled()}},drawTiled:function(){var g=Math.floor(this.origin.x/this.tileMap.tileWidth);if(g<0){g=0}var f=Math.floor(this.origin.y/this.tileMap.tileHeight);if(f<0){f=0}var h=(Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-g)+2;if(g+h>=this.tileMap.tilesWide-1){h=this.tileMap.tilesWide-1-g}var b=(Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-f)+2;if(f+b>=this.tileMap.tilesHigh-1){b=this.tileMap.tilesHigh-1-f}for(var l=f,k=f+b;l<k+1;l++){var e=this.screenY(l*this.tileMap.tileHeight);for(var m=g,j=g+h;m<j;m++){var i=this.tileMap.tiles[l][m];if(i>=0){this.tileMap.tileSet.drawTile(pc.device.ctx,i,this.screenX(m*this.tileMap.tileWidth),e)}if(this.debugShowGrid){pc.device.ctx.save();pc.device.ctx.strokeStyle="#222222";pc.device.ctx.strokeRect(this.screenX(m*this.tileMap.tileWidth),this.screenY(l*this.tileMap.tileHeight),this.tileMap.tileWidth,this.tileMap.tileHeight);pc.device.ctx.restore()}}}},drawPrerendered:function(){if(!this.prerenders){this.prerender()}var g=-(this.origin.x)+this.scene.viewPort.x;var e=-(this.origin.y)+this.scene.viewPort.y;var d=Math.max(Math.floor(this.origin.x/this.prerenderSize),0);var c=Math.max(Math.floor(this.origin.y/this.prerenderSize),0);var h=d+Math.ceil((this.origin.x+this.scene.viewPort.w)/this.prerenderSize);var f=c+Math.ceil((this.origin.y+this.scene.viewPort.h)/this.prerenderSize);h=Math.min(h,this.prerenders[0].length);f=Math.min(f,this.prerenders.length);for(var i=c;i<f;i++){for(var b=d;b<h;b++){pc.device.ctx.drawImage(this.prerenders[i%this.prerenders.length][b%this.prerenders[0].length],g+(b*this.prerenderSize),e+(i*this.prerenderSize))}}}});pc.IsoTileLayer=pc.TileLayer.extend("IsoTileLayer",{loadFromTMX:function(g,f,h,b,d){var c=f.getAttribute("name");var e=new pc.IsoTileLayer(c,true,null,d);e.tileMap.loadFromTMX(f,h,b);g.addLayer(e)}},{init:function(c,e,b,d){this._super(c);this.tileMap=pc.checked(b,new pc.TileMap(d));this.usePrerendering=false},drawTiled:function(){var l=this.tileMap.tiles[0].length;if(l<0){l=0}var j=this.tileMap.tiles.length;if(j<0){j=0}var b=this.scene.viewPort.w;var c=this.scene.viewPort.h;var g=this.tileMap.tileWidth;var k=this.tileMap.tileHeight;var f=this.scene.viewPort.w/2-g/2;var i,h,e=0.5;for(h=j-1;h>=0;h--){for(i=l-1;i>=0;i--){var d=this.tileMap.tiles[h][i];if(i<h){this.tileMap.tileSet.drawTile(pc.device.ctx,d,f+g*(i-h)*e,k*(h+i)*e)}else{if(i>h){this.tileMap.tileSet.drawTile(pc.device.ctx,d,f-g*(h-i)*e,k*(i+h)*e)}else{this.tileMap.tileSet.drawTile(pc.device.ctx,d,f,k*h)}}}}}});pc.HexTileLayer=pc.TileLayer.extend("pc.HexTileLayer",{},{_hexSide:0,_halfHexSide:0,_yInc:0,init:function(c,b,d){this._super(c,false,b,d);this._hexSide=this.tileMap.tileHeight/Math.sqrt(3);this._halfHexSide=this._hexSide/2;this._yInc=this.tileMap.tileHeight-this._halfHexSide},_tileXY:null,getTileXYAtScreenPoint:function(d){if(!this._tileXY){this._tileXY=pc.Point.create(0,0)}var c=this.worldPos(d);var b=Math.round(c.y/this._yInc);if(!(b%2)){c.x+=Math.floor(this.tileMap.tileWidth/2);console.log("offset row")}this._tileXY.x=Math.floor(c.x/this.tileMap.tileWidth);this._tileXY.y=Math.floor(b);console.log("world="+c+" tileXY="+this._tileXY);return this._tileXY},drawTiled:function(){var h=Math.floor(this.origin.x/this.tileMap.tileWidth);if(h<0){h=0}var f=Math.floor(this.origin.y/this.tileMap.tileHeight);if(f<0){f=0}var i=(Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-h);if(h+i>=this.tileMap.tilesWide-1){i=this.tileMap.tilesWide-1-h}var b=(Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-f);if(f+b>=this.tileMap.tilesHigh-1){b=this.tileMap.tilesHigh-1-f}for(var j=f,n=b+f;j<n+1;j++){var e=j*this._yInc;for(var k=h,m=i+h;k<m;k++){var g=k*this.tileMap.tileWidth;if(j%2){g+=this.tileMap.tileWidth/2}var l=this.tileMap.tiles[j][k];if(l>=0){this.tileMap.drawTile(k,j,this.screenX(g),this.screenY(e))}}}}});pc.Entity=pc.Pooled.extend("pc.Entity",{create:function(b){var c=this._super();if(!b){throw"Entity requires a valid layer to be placed on"}if(!b.Class.isA){throw"Entity requires a valid layer to be placed on"}if(!b.Class.isA("pc.EntityLayer")){throw"Entities can only be placed on pc.EntityLayer objects"}c.config(b);return c}},{layer:null,tags:[],active:true,_componentCache:null,init:function(b){this._super();this.tags=[];this.layer=null;this.active=true;this._componentCache=new pc.Hashmap();if(pc.valid(b)){this.config(b)}},config:function(b){this.layer=b;this.active=true;b.entityManager.add(this)},release:function(){this.tags.length=0;this.active=false;this._componentCache.clear();this._super()},addTag:function(b){this.layer.entityManager.addTag(this,b)},hasTag:function(b){for(var c=0;c<this.tags.length;c++){if(this.tags[c].toLowerCase()===b.toLowerCase()){return true}}return false},removeTag:function(b){this.layer.entityManager.removeTag(this,b)},addComponent:function(b){return this.layer.entityManager.addComponent(this,b)},removeComponent:function(b){this.layer.entityManager.removeComponent(this,b)},removeComponentByType:function(b){this.removeComponent(this._componentCache.get(b))},getComponent:function(b){return this._componentCache.get(b)},getAllComponents:function(){return this._componentCache},getComponentTypes:function(){return this._componentCache.keys()},hasComponentOfType:function(b){return this._componentCache.hasKey(b)},remove:function(){this.layer.entityManager.remove(this)},_handleComponentRemoved:function(b){this._componentCache.remove(b.getType())},_handleComponentAdded:function(b){this._componentCache.put(b.getType(),b)}});pc.EntityFactory=pc.Base.extend("pc.EntityFactory",{},{createEntity:function(f,g,b,h,e,c,d){}});pc.Sprite=pc.Pooled.extend("pc.Sprite",{create:function(b){var c=this._super();c.config(b);return c}},{currentFrame:0,currentAnim:null,spriteSheet:null,animSpeedOffset:0,currentAnimName:null,alpha:1,scaleX:1,scaleY:1,active:true,hold:false,loopCount:0,compositeOperation:null,_acDelta:0,init:function(b){this._super();this.config(b)},config:function(b){this.spriteSheet=pc.checked(b,null);if(this.spriteSheet){this.reset()}},reset:function(){this.currentFrame=0;this.alpha=1;this.loopCount=0;this.scaleX=1;this.scaleY=1;this.active=true;this.hold=false;if(this.spriteSheet.animations.size()>0){this.currentAnim=this.spriteSheet.animations.get(this.spriteSheet.animations.keys()[0]);this.currentFrame=0}else{this.currentAnim=null}},setSpriteSheet:function(b){this.spriteSheet=b;this.reset()},setScale:function(c,b){this.scaleX=c;this.scaleY=b},setCompositeOperation:function(b){this.compositeOperation=b},draw:function(c,b,e,d){if(this.alpha!=1){this.spriteSheet.alpha=this.alpha}if(this.compositeOperation!=null){this.spriteSheet.setCompositeOperation(this.compositeOperation)}if(this.scaleX!=1||this.scaleY!=1){this.spriteSheet.setScale(this.scaleX,this.scaleY)}this.spriteSheet.draw(c,this,b,e,d);if(this.scaleX!=1||this.scaleY!=1){this.spriteSheet.setScale(1,1)}if(this.alpha!=1){this.spriteSheet.alpha=1}if(this.compositeOperation!=null){this.spriteSheet.setCompositeOperation("source-over")}},drawFrame:function(c,e,d,b,g,f){if(this.alpha!=1){this.spriteSheet.alpha=this.alpha}if(this.scaleX!=1||this.scaleY!=1){this.spriteSheet.setScale(this.scaleX,this.scaleY)}if(this.compositeOperation!=null){this.spriteSheet.setCompositeOperation(this.compositeOperation)}this.spriteSheet.drawFrame(c,e,d,b,g,f);if(this.scaleX!=1||this.scaleY!=1){this.spriteSheet.setScale(1,1)}if(this.alpha!=1){this.spriteSheet.alpha=1}if(this.compositeOperation!=null){this.spriteSheet.setCompositeOperation("source-over")}},update:function(b){if(this.currentAnim==null||!this.active||this.hold){return}this.spriteSheet.update(this,b)},setAnimation:function(b,e,d){var c=pc.checked(d,true);if(!c){if(this.currentAnim.name===b){return}}this.currentAnim=this.spriteSheet.animations.get(b);this.currentFrame=0;this.loopCount=0;this.active=true;this.held=false;this.animSpeedOffset=pc.checked(e,0);this.currentAnimName=b},setAnimationSpeedOffset:function(b){this.animSpeedOffset=b},setCurrentFrame:function(b){this.currentFrame=b},getAnimation:function(){return this.currentAnimName},setAlpha:function(b){this.alpha=b},addAlpha:function(b){this.alpha+=b;if(this.alpha>1){this.alpha=1}},subAlpha:function(b){this.alpha-=b;if(this.alpha<0){this.alpha=0}}});pc.SpriteSheet=pc.Base.extend("pc.SpriteSheet",{},{image:null,frameWidth:0,frameHeight:0,framesWide:1,framesHigh:1,scaleX:1,scaleY:1,sourceX:0,sourceY:0,alpha:1,useRotation:false,compositeOperation:null,totalFrames:0,animations:null,frameOffsetX:0,frameOffsetY:0,_frameXPos:null,_frameYPos:null,init:function(b){this._super();if(pc.checked(b.image)){this.image=b.image}else{throw"No image supplied"}if(!this.image.width||!this.image.height){throw"Invalid image (zero width or height)"}if(!pc.valid(b.frameWidth)){if(pc.valid(b.framesWide)&&b.framesWide>0){this.frameWidth=Math.floor(this.image.width/b.framesWide)}else{this.frameWidth=this.image.width}}else{this.frameWidth=b.frameWidth}if(!pc.valid(b.frameHeight)){if(pc.valid(b.framesHigh)&&b.framesHigh>0){this.frameHeight=Math.floor(this.image.height/b.framesHigh)}else{this.frameHeight=this.image.height}}else{this.frameHeight=b.frameHeight}this.framesWide=Math.floor(pc.checked(b.framesWide,this.image.width/this.frameWidth));this.framesHigh=Math.floor(pc.checked(b.framesHigh,this.image.height/this.frameHeight));this.scaleX=pc.checked(b.scaleX,1);this.scaleY=pc.checked(b.scaleY,1);this.sourceX=pc.checked(b.sourceX,0);this.sourceY=pc.checked(b.sourceY,0);this.frameOffsetX=pc.checked(b.frameOffsetX,0);this.frameOffsetY=pc.checked(b.frameOffsetY,0);this.alpha=pc.checked(b.alpha,1);this.useRotation=pc.checked(b.useRotation,true);this.totalFrames=this.framesWide*this.framesHigh;this.animations=new pc.Hashtable();this._frameXPos=[];for(var d=0;d<this.framesWide;d++){this._frameXPos.push(d*this.frameWidth)}this._frameYPos=[];for(var c=0;c<this.framesHigh;c++){this._frameYPos.push(c*this.frameHeight)}},addAnimation:function(b){if(!pc.valid(b.name)){throw"Animation requires a name for reference"}b.frameX=pc.checked(b.frameX,0);b.frameY=pc.checked(b.frameY,0);b.directions=pc.checked(b.directions,1);b.time=pc.checked(b.time,1000);b.loops=pc.checked(b.loops,0);b.holdOnEnd=pc.checked(b.holdOnEnd,false);b.dirAcross=pc.checked(b.dirAcross,false);b.scaleX=pc.checked(b.scaleX,1);b.scaleY=pc.checked(b.scaleY,1);b.offsetX=pc.checked(b.offsetX,0);b.offsetY=pc.checked(b.offsetY,0);b.framesWide=pc.checked(b.framesWide,this.framesWide);b.framesHigh=pc.checked(b.framesHigh,this.framesHigh);b.frameCount=pc.checked(b.frameCount,this.framesWide*this.framesHigh);if(b.frameCount==0){b.frameCount=pc.checked(b.frameCount,this.framesWide*this.framesHigh)}if(!pc.valid(b.frames)){var c=b.frameX+(b.frameY*b.framesWide);b.frames=[];for(var d=c;d<c+b.frameCount;d++){b.frames.push([d%b.framesWide,Math.floor(d/b.framesWide)])}}b.frameRate=(b.time/b.frames.length);b.degreesPerDir=(360/b.directions);this.animations.put(b.name,b)},setAnimation:function(d,b,c){d.currentAnim=this.animations.get(b);if(d.currentAnim==null){this.warn("attempt to set unknown animation ["+b+"]")}d.currentFrame=0;d.held=false;d.animSpeedOffset=pc.checked(c,0)},hasAnimation:function(b){return(this.animations.get(b)!=null)},setScale:function(c,b){this.scaleX=c;this.scaleY=b},setCompositeOperation:function(b){this.compositeOperation=b},dirTmp:0,draw:function(c,g,b,h,d){if(!this.image.loaded||g==null||!g.active){return}if(this.scaleX!=1||this.scaleY!=1){this.image.setScale(this.scaleX,this.scaleY)}if(g.alpha!=1){this.image.alpha=g.alpha}if(this.compositeOperation!=null){this.image.setCompositeOperation(this.compositeOperation)}if(g.currentAnim==null){if(this.scaleX!=1||this.scaleY!=1){this.image.setScale(this.scaleX,this.scaleY)}this.image.draw(c,this.sourceX,this.sourceY,Math.round(b+this.frameOffsetX),Math.round(h+this.frameOffsetY),this.frameWidth+this.frameOffsetX,this.frameHeight+this.frameOffsetY,this.useRotation?d:0)}else{var f=0;var e=0;if(g.currentAnim.scaleX!=1||g.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1){this.image.setScale(g.currentAnim.scaleX*this.scaleX,g.currentAnim.scaleY*this.scaleY)}if(this.useRotation){f=g.currentAnim.frames[g.currentFrame][0];e=g.currentAnim.frames[g.currentFrame][1];this.image.draw(c,this.sourceX+this._frameXPos[f],this.sourceY+this._frameYPos[e],g.currentAnim.offsetX+pc.Math.round(b)+this.frameOffsetX,g.currentAnim.offsetY+pc.Math.round(h)+this.frameOffsetY,this.frameWidth,this.frameHeight,d)}else{this.dirTmp=Math.round(d/g.currentAnim.degreesPerDir);if(this.dirTmp>g.currentAnim.directions-1){this.dirTmp=0}f=g.currentAnim.frames[g.currentFrame][1]+this.dirTmp;e=g.currentAnim.frames[g.currentFrame][0];if(g.currentAnim.directions==1){e=g.currentAnim.frames[g.currentFrame][1];f=g.currentAnim.frames[g.currentFrame][0]}this.image.draw(c,this.sourceX+this._frameXPos[f],this.sourceY+this._frameYPos[e],g.currentAnim.offsetX+pc.Math.round(b)+this.frameOffsetX,g.currentAnim.offsetY+pc.Math.round(h)+this.frameOffsetY,this.frameWidth,this.frameHeight);if(g.currentAnim.scaleX!=1||g.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1){this.image.setScale(g.currentAnim.scaleX*this.scaleX,g.currentAnim.scaleY*this.scaleY)}}}if(this.image.scaleX!=1||this.image.scaleY!=1){this.image.setScale(1,1)}if(g.alpha!=1){this.image.alpha=1}if(this.compositeOperation!=null){this.image.setCompositeOperation("source-over")}},drawFrame:function(c,e,d,b,g,f){if(!this.image.loaded){return}if(this.alpha<1){c.globalAlpha=this.alpha}if(this.scaleX!=1||this.scaleY!=1){this.image.setScale(this.scaleX,this.scaleY)}if(this.compositeOperation!=null){this.image.setCompositeOperation(this.compositeOperation)}this.image.draw(c,this.sourceX+this._frameXPos[e],this.sourceY+this._frameYPos[d],pc.Math.round(b)+this.frameOffsetX,pc.Math.round(g)+this.frameOffsetY,this.frameWidth,this.frameHeight,f);if(this.image.scaleX!=1||this.image.scaleY!=1){this.image.setScale(1,1)}if(this.alpha<1){c.globalAlpha=1}if(this.compositeOperation!=null){this.image.setCompositeOperation("source-over")}},drawAllFrames:function(c,b,f){for(var d=0;d<this.framesHigh;d++){for(var e=0;e<this.framesWide;e++){this.drawFrame(c,e,d,b+(e*this.frameWidth),f+(d*this.frameHeight))}}},update:function(b,c){if(b.currentAnim==null||!b.active||b.held){return}if(b.currentAnim.frames.length<=1){return}if(b._acDelta>(b.currentAnim.frameRate+b.animSpeedOffset)){b.currentFrame++;if(b.currentFrame>=b.currentAnim.frames.length){b.loopCount++;if(b.currentAnim.loops){if(b.loopCount>=b.currentAnim.loops){if(b.currentAnim.holdOnEnd){b.held=true;if(b.currentFrame){b.currentFrame--}}else{b.active=false}}}if(!b.held){b.currentFrame=0}}b._acDelta-=b.currentAnim.frameRate}else{b._acDelta+=c}},reset:function(){this.image=null;this.animations=null}});pc.Math=pc.Base("pc.Math",{RADIAN_TO_DEGREE:(180/Math.PI),DEGREE_TO_RADIAN:(Math.PI/180),PI:Math.PI,round:Math.round,random:Math.random,floor:Math.floor,sqr:function(b){return b*b},rand:function(c,b){return pc.Math.round((pc.Math.random()*(b-c))+c)},randFloat:function(c,b){return(pc.Math.random()*(b-c))+c},rotate:function(d,c){var b=d+c;while(b>359){b-=360}while(b<0){b=360+b}return b},angleDiff:function(d,c,b){if(!b){var e=d-c;if(e<0){e+=360}return e}else{if(c<d){c+=360}return c-d}},isClockwise:function(c,b){if(c>b){return(Math.abs(c-b))<(b+(360-c))}else{return(c+(360-b))<(Math.abs(b-c))}},isFacingRight:function(b){if(b>270||b<90){return true}return false},radToDeg:function(b){return(b*pc.Math.RADIAN_TO_DEGREE)},degToRad:function(b){return b*pc.Math.DEGREE_TO_RADIAN},angleFromVector:function(b,d){var c=pc.Math.radToDeg(Math.atan2(d,b));if(c<0){c+=360}return c},vectorFromAngle:function(d){var c=Math.cos(pc.Math.degToRad(d));var b=Math.sin(pc.Math.degToRad(d));return pc.Point.create(c,b)},isPointInRect:function(b,g,e,d,f,c){return b>=e&&b<=(e+f)&&g>=d&&g<=(d+c)},isRectInRect:function(b,j,c,e,g,f,i,d){if(!pc.Math.isPointInRect(b,j,g,f,i,d)){return false}if(!pc.Math.isPointInRect(b+c,j,g,f,i,d)){return false}if(!pc.Math.isPointInRect(b,j+e,g,f,i,d)){return false}return pc.Math.isPointInRect(b+c,j+e,g,f,i,d)},isRectColliding:function(b,j,c,e,g,f,i,d){return !(j+e<f||j>f+d||b+c<g||b>g+i)},limit:function(c,b,d){if(c<b){return b}if(c>d){return d}return c},limitAdd:function(c,e,b,d){if(c+e<b){return b}if(c+e>d){return d}return c+e}},{});pc.Rect=pc.Pooled("pc.Rect",{create:function(b,f,c,e){var d=this._super();d.x=b;d.y=f;d.w=c;d.h=e;return d}},{x:0,y:0,w:0,h:0,containsRect:function(b,j,c,e,g,f,i,d){if(!pc.Math.isPointInRect(b,j,g,f,i,d)){return false}if(!pc.Math.isPointInRect(b+c,j,g,f,i,d)){return false}if(!pc.Math.isPointInRect(b,j+e,g,f,i,d)){return false}return pc.Math.isPointInRect(b+c,j+e,g,f,i,d)},containsPoint:function(b){return b.x>=this.x&&b.x<=(this.x+this.w)&&b.y>=this.y&&b.y<=(this.y+this.h)},overlaps:function(d,b,e,j,f){var k=e;var g=j;if(pc.valid(f)&&f!=0){var l=Math.sin(pc.Math.degToRad(f));var i=Math.cos(pc.Math.degToRad(f));if(l<0){l=-l}if(i<0){i=-i}k=j*l+e*i;g=j*i+e*l}return !(this.y+this.h<b||this.y>b+g||this.x+this.w<d||this.x>d+k)},toString:function(){return this.x+" x "+this.y+" by "+this.w+" x "+this.h}});pc.Point=pc.Pooled("pc.Point",{create:function(b,d){var c=this._super();c.x=b;c.y=d;return c}},{x:0,y:0,equals:function(b){return(this.x==b.x&&this.y==b.y)},match:function(b){this.x=b.x;this.y=b.y},set:function(b){this.match(b)},setXY:function(b,c){this.x=b;this.y=c;return this},add:function(b,c){this.x+=b;this.y+=c;return this},subtract:function(b,c){this.x-=b;this.y-=c;return this},dirTo:function(b){return Math.atan2(b.y-this.y,b.x-this.x)*180/Math.PI},moveInDir:function(b,c){this.x+=c*Math.cos(pc.Math.degToRad(b));this.y+=c*Math.sin(pc.Math.degToRad(b));return this},moveTowards:function(c,b){this.moveInDir(this.dirTo(c),b)},distance:function(b){return Math.sqrt((b.x-this.x)*(b.x-this.x)+(b.y-this.y)*(b.y-this.y))},toString:function(){return this.x+"x"+this.y}});pc.Poly=pc.Pooled("pc.Poly",{create:function(b,e,c){var d=this._super();d.x=b;d.y=e;d.points=c;return d}},{x:0,y:0,points:null,_boundingRect:null,init:function(b,d,c){this.x=b;this.y=d;this.points=c;this._boundingRect=pc.Rect.create(0,0,0,0)},getBoundingRect:function(){}});pc.Dim=pc.Point;pc.Vector=pc.Point;pc.Image=pc.Base.extend("pc.Image",{},{width:0,height:0,image:null,src:null,name:null,loaded:false,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(b,e,d,c){this._super();this.name=b;this.src=pc.device.loader.makeUrl(e);this.image=new Image();this.onLoadCallback=d;this.onErrorCallback=c;this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.scaleX=1;this.scaleY=1;this.alpha=1;if(pc.device.loader.started){this.load()}},setAlpha:function(b){this.alpha=b},setScale:function(c,b){this.scaleX=c;this.scaleY=b},setCompositeOperation:function(b){this.compositeOperation=b},load:function(c,b){this.onLoadCallback=c;this.onErrorCallback=b;if(this.loaded&&c){this.onLoadCallback(this)}this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.image.src=this.src},reload:function(){this.loaded=false;this.load()},draw:function(m,i,h,j,g,b,l,f){if(this.compositeOperation!=null){m.globalCompositeOperation=this.compositeOperation}if(arguments.length==3){m.save();if(this.alpha!=1){m.globalAlpha=this.alpha}m.translate(i+(this.width/2),h+(this.height/2));m.scale(this.scaleX,this.scaleY);m.drawImage(this.image,0,0,this.width,this.height,(-this.width/2),(-this.height/2),this.width,this.height);m.restore()}else{if(pc.valid(f)){m.save();if(this.alpha!=1){m.globalAlpha=this.alpha}if(this.scaleX<0||this.scaleY<0){var d=this.scaleY==1?0:this.scaleY;var k=this.scaleX==1?0:this.scaleX;m.translate((j+(b/2)*k),(g+(l/2)*d))}else{m.translate(j+(b/2),g+(l/2))}m.rotate(f*(Math.PI/180));m.drawImage(this.image,i,h,b,l,(-b/2),(-l/2),b,l);m.restore()}else{m.save();if(this.alpha!=1){m.globalAlpha=this.alpha}if(this.scaleX<0||this.scaleY<0){var e=this.scaleY==1?0:this.scaleY;var c=this.scaleX==1?0:this.scaleX;m.translate(j+(-(b/2)*c),g+(-(l/2)*e))}else{m.translate(j,g)}m.scale(this.scaleX,this.scaleY);m.drawImage(this.image,i,h,b,l,0,0,b,l);m.restore()}}if(this.compositeOperation!=null){m.globalCompositeOperation="source-over"}pc.device.elementsDrawn++},_onLoad:function(){this.loaded=true;this.width=this.image.width;this.height=this.image.height;if(this.onLoadCallback){this.onLoadCallback(this)}},_onError:function(){if(this.onErrorCallback){this.onErrorCallback(this)}},expand:function(c,b){this.image.width=this.width+c;this.image.height=this.height+b;this.width=this.image.width;this.height=this.image.height},resize:function(o,l){var n=this.width*o;var f=this.height*l;var m=document.createElement("canvas");m.width=this.width;m.height=this.height;var r=document.createElement("canvas");r.width=n;r.height=f;var p=r.getContext("2d");var e=p.getImageData(0,0,n,f);var k=m.getContext("2d");k.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);var q=k.getImageData(0,0,this.width,this.height);for(var g=0;g<f;g++){for(var h=0;h<n;h++){var c=(Math.floor(g/l)*this.width+Math.floor(h/o))*4;var d=(g*n+h)*4;for(var b=0;b<4;b++){e.data[d+b]=q.data[c+b]}}}p.putImageData(e,0,0);this.image=r;return this}});pc.CanvasImage=pc.Base.extend("pc.CanvasImage",{},{width:0,height:0,canvas:null,loaded:true,scaleX:1,scaleY:1,init:function(b){this.canvas=b;this.width=b.width;this.height=b.height},draw:function(d,h,f,c,g,e,b){if(e==undefined||b==undefined||e==0||b==0){d.drawImage(this.canvas,h,f)}else{d.drawImage(this.canvas,h,f,e,b,c*this.scaleX,g*this.scaleY,e*this.scaleX,b*this.scaleY)}},setScale:function(c,b){this.scaleX=c;this.scaleY=b}});pc.ImageTools=pc.Base.extend("pc.ImageTools",{rotate:function(e,k,g,j){var b=document.createElement("canvas");b.width=k*j;b.height=g;var l=b.getContext("2d");var f=k/2;var c=g/2;for(var i=0;i<j;i++){l.save();l.translate(i*k+(k/2),g/2);l.rotate(((360/j)*i)*(Math.PI/180));l.drawImage(e,-(k/2),-(g/2));l.restore()}return new pc.CanvasImage(b)}},{});pc.Scene=pc.Base.extend("pc.Scene",{},{name:null,layersByName:null,layers:null,activeLayers:null,paused:false,active:false,viewPort:null,viewPortCenter:null,init:function(b){this._super();this.active=false;this.name=b;this.layersByName=new pc.Hashtable();this.layers=new pc.LinkedList();this.activeLayers=new pc.LinkedList();this.viewPort=pc.Rect.create(0,0,0,0);this.viewPortCenter=pc.Point.create(0,0);this.setViewPort(0,0,pc.device.canvasWidth,pc.device.canvasHeight);if(pc.device.started){this.onReady()}},onReady:function(){var b=this.layers.first;while(b){b.obj.onReady();b=b.next()}},onActivated:function(){},onDeactivated:function(){},onResize:function(d,b){this.setViewPort(this.viewPort.x,this.viewPort.y,d,b);var c=this.layers.first;while(c){c.obj.onResize(d,b);c=c.next()}},setViewPort:function(c,e,d,b){this.viewPort.x=c;this.viewPort.y=e;this.viewPort.w=d;this.viewPort.h=b;this.viewPortCenter.x=this.viewPort.w/2;this.viewPortCenter.y=this.viewPort.h/2},getScreenRect:function(){return this.viewPort},sortLayers:function(){this.activeLayers.sort(function(d,c){return d.zIndex-c.zIndex})},onAction:function(b,c,d){},isActive:function(){return this.active},get:function(b){return this.layersByName.get(b)},addLayer:function(b){if(!pc.valid(b)){throw"Error: invalid layer"}if(!pc.valid(b.name)){throw"Error: trying to add a layer that has no name (forget to call this._super in your layer init?)"}this.layersByName.put(b.name,b);this.layers.add(b);this.activeLayers.add(b);b.active=true;b.scene=this;b.onAddedToScene();this.sortLayers();return b},removeLayer:function(b){this.layersByName.remove(b.name);this.layers.remove(b);this.activeLayers.remove(b);b.active=false;b.scene=null;b.onRemovedFromScene()},setLayerActive:function(b){this.activeLayers.add(b);this.sortLayers();b.active=true},setLayerInactive:function(b){this.activeLayers.remove(b);b.active=false},toggleLayerActive:function(b){if(b.active){this.setLayerInactive(b)}else{this.setLayerActive(b)}},getFirstActiveLayer:function(){return this.activeLayers.first},getFirstLayer:function(){return this.layers.first},startTime:0,process:function(){var b=this.activeLayers.first;while(b){if(!b.obj.paused){b.obj.process();this.startTime=Date.now();b.obj.draw();pc.device.lastDrawMS+=(Date.now()-this.startTime)}b=b.next()}},pause:function(){this.paused=true;var b=this.activeLayers.first;while(b){b.obj.pause();b=b.next()}},resume:function(){this.paused=false;var b=this.activeLayers.first;while(b){b.obj.resume();b=b.next()}},reset:function(){var b=this.layers.first;while(b){b.obj.reset();b=b.next()}this.layers.clear();this.activeLayers.clear()},entitiesUnderXY:function(b,e){var d=[];var c=this.layers.first;while(c){d.push(c.obj.entitiesUnderXY(b,e));c=c.next()}},loadFromTMX:function(r,d){var l=pc.device.parseXML(r.data);var j=l.getElementsByTagName("map")[0];var c=parseInt(j.getAttribute("tilewidth"));var n=parseInt(j.getAttribute("tileheight"));var A=l.getElementsByTagName("tileset")[0];var q=A.getAttribute("name");var z=A.getAttribute("width");var B=A.getAttribute("height");var s=pc.device.loader.get(q);pc.assert(s,"Unable to locate tile image resource: "+q+". It must match the tileset name in tiled.");var h=pc.device.loader.get(q).resource;var o=new pc.SpriteSheet({image:h,frameWidth:c,frameHeight:n});var C=new pc.TileSet(o);var D=l.getElementsByTagName("tile");for(var t=0;t<D.length;t++){var F=D[t];var x=parseInt(F.getAttribute("id"));var w=F.getElementsByTagName("properties")[0];var g=w.getElementsByTagName("property");for(var E=0;E<g.length;E++){var f=g[E];var G=f.getAttribute("name");var v=f.getAttribute("value");C.addProperty(x,G,v)}}var k=l.getElementsByTagName("layer");for(var u=0;u<k.length;u++){switch(j.getAttribute("orientation")){case"isometric":pc.IsoTileLayer.loadFromTMX(this,k[u],c,n,C);break;default:pc.TileLayer.loadFromTMX(this,k[u],c,n,C);break}}var e=l.getElementsByTagName("objectgroup");for(var y=0;y<e.length;y++){pc.EntityLayer.loadFromTMX(this,e[y],d)}}});pc.Game=pc.Base.extend("pc.Game",{},{scenes:null,activeScenes:null,paused:false,init:function(c,b){this._super();this.scenes=new pc.LinkedList();this.activeScenes=new pc.LinkedList();if(pc.device.devMode){pc.device.input.bindAction(this,"physics debug","F9");pc.device.input.bindAction(this,"pool dump","F10");pc.device.input.bindAction(this,"toggle sound","F11")}},process:function(){if(this.paused){return true}var b=this.getFirstActiveScene();while(b){b.object().process();b=b.next()}return true},stopAllSounds:function(){var b=pc.device.loader.getAllSounds();for(var c=0;c<b.length;c++){if(pc.device.soundEnabled){b[c].stop()}}},onAction:function(b){if(b==="toggle sound"){this.stopAllSounds();pc.device.soundEnabled=!pc.device.soundEnabled}if(b==="pool dump"){console.log(pc.Pool.getStats())}if(b==="physics debug"){var g=this.getFirstScene();while(g){var e=g.object().getFirstActiveLayer();while(e){var c=e.object();if(c.Class.isA("pc.EntityLayer")){var f=c.systemManager.systems.first;while(f){var d=f.object();if(d.Class.isA("pc.systems.Physics")){d.setDebug(!d.debug)}f=f.next()}}e=e.next()}g=g.next()}}},addScene:function(c,b){this.scenes.add(c);this.onSceneAdded(c);if(pc.checked(b,true)){this.activateScene(c)}},onSceneAdded:function(b){},removeScene:function(b){this.scenes.remove(b);this.activeScenes.remove(b);this.onSceneRemoved(b)},onSceneRemoved:function(b){},activateScene:function(b){if(b.active){return}this.activeScenes.add(b);b.active=true;this.onSceneActivated(b);b.onActivated()},onSceneActivated:function(b){},deactivateScene:function(b){if(!b.active){return}this.activeScenes.remove(b);b.active=false;this.onSceneDeactivated(b);b.onDeactivated()},onSceneDeactivated:function(b){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){this.paused=true;var b=this.getFirstScene();while(b){b.object().pause();b=b.next()}},isActive:function(){return !this.paused},resume:function(){this.paused=false;var b=this.getFirstScene();while(b){b.object().resume();b=b.next()}},togglePauseResume:function(){if(pc.device.game.paused){pc.device.game.resume()}else{pc.device.game.pause()}},reset:function(){var b=this.getFirstScene();while(b){b.obj.reset();b=b.next()}this.scenes.clear();this.activeScenes.clear();this.onReady()},onReady:function(){},onResize:function(d,b){var c=this.getFirstActiveScene();while(c){c.obj.onResize(d,b);c=c.next()}},getScreenRect:function(){return pc.Rect.create(0,0,pc.device.canvasWidth,pc.device.canvasHeight)}});pc.Loader=pc.Base.extend("pc.Loader",{},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},resources:new pc.Hashtable(),loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",started:false,finished:false,_noCacheString:"",init:function(){this._super()},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(b){this.baseUrl=b},setListener:function(b,c){this.loadingListener=b;this.loadedListener=c},add:function(b){b.name=b.name.toLowerCase();this.resources.put(b.name.toLowerCase(),{resource:b,state:this.State.QUEUED});this.info("Adding resource "+b.src+" to the queue.")},get:function(b){var c=this.resources.get(b.toLowerCase());if(!c){throw"Attempting to get a resource that hasn't been added: "+b}if(c.state<this.State.READY){throw"Attempting to get a resource that hasn't been loaded yet (calling before onLoaded?)"}return c},getAllSounds:function(){var b=[];var e=this.resources.keys();for(var d=0;d<e.length;d++){var c=this.resources.get(e[d]).resource;if(c.Class.isA("pc.Sound")){b.push(c)}}return b},getAllImages:function(){var b=[];var e=this.resources.keys();for(var d=0;d<e.length;d++){var c=this.resources.get(e[d]);if(c.isA("pc.Image")){b.push(c)}}return b},start:function(b,f){this.setListener(b,f);this.progress=0;this.errored=0;var e=this.resources.keys();for(var d=0;d<e.length;d++){var c=this.resources.get(e[d]);if(c.state==this.State.QUEUED){c.resource.load(this._onLoad.bind(this),this._onError.bind(this));c.state=this.State.LOADING;this.totalBeingLoaded++}}this.info("Started loading "+this.totalBeingLoaded+" resource(s).");this._checkAllDone()},makeUrl:function(b){return this.baseUrl+b+this._noCacheString},_onLoad:function(c){var b=this.resources.get(c.name);if(b==null){this.error("Unable to get resource ["+c.name+"] - Please make sure you are using all lowercase.")}else{b.state=this.State.READY;this.progress++;if(this.loadingListener!=null){this.loadingListener(Math.round((this.progress/this.totalBeingLoaded)*100))}this.info(c.name+" loaded ("+Math.round((this.progress/this.totalBeingLoaded)*100)+"% done)")}this._checkAllDone()},_onError:function(c){var b=this.resources.get(c.name);b.state=this.State.FAILED;this.progress++;this.errored++;if(this.loadingListener!=null){this.loadingListener(this.progress/this.totalBeingLoaded)}this.warn(c.name+" ("+c.src+") failed.");this._checkAllDone()},_checkAllDone:function(){if(this.progress>=this.totalBeingLoaded){this.finished=true;this.loadedListener(this.progress,this.errored);this.progress=0;this.errored=0;this.totalBeingLoaded=0}}});pc.DataResource=pc.Base.extend("pc.DataResource",{},{data:null,request:null,src:null,name:null,loaded:false,onLoadCallback:null,onErrorCallback:null,init:function(b,e,d,c){this._super();this.src=pc.device.loader.makeUrl(e);this.name=b;this.onLoadCallback=d;this.onErrorCallback=c;this.request=new XMLHttpRequest();this.request.onreadystatechange=this.onReadyStateChange.bind(this);this.request.onload=this.onReadyStateChange.bind(this);this.request.onloadend=this.onReadyStateChange.bind(this);this.load()},load:function(c,b){this.onLoadCallback=c;this.onErrorCallback=b;this.request.open("get",this.src);this.request.send(null)},reload:function(){this.loaded=false;this.load()},onReadyStateChange:function(){if(this.loaded){return}if(this.request.readyState==4){if(this.request.status==200){this.loaded=true;this.data=this.request.responseText;if(this.onLoadCallback){this.onLoadCallback(this)}}else{if(this.request.status==404){this.warn("resource "+this.src+" error "+this.request.status);if(this.onErrorCallback){this.onErrorCallback(this)}}}}}});pc.components={};pc.components.Component=pc.Pooled.extend("pc.components.Component",{create:function(){return this._super()}},{_entity:null,_type:null,active:true,init:function(b){this._super();this._type=b;this.active=true},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}});pc.components.Physics=pc.components.Component.extend("pc.components.Physics",{create:function(b){var c=this._super();c.config(b);return c}},{maxSpeed:null,bounce:0.5,faceVel:false,density:0,mass:-1,friction:0,linearDamping:0,linearVelocity:null,angularDamping:0,fixedRotation:false,bullet:false,collisionGroup:0,collisionCategory:0,collisionMask:0,sensorOnly:false,immovable:false,centerOfMass:null,centered:true,gravity:null,shapes:null,force:0,turn:0,torque:0,_body:null,_fixtures:null,_lastSpatialPos:null,_lastSpatialDim:null,_lastSpatialDir:0,init:function(b){this._super("physics");this.centerOfMass=pc.Point.create(0,0);this.margin={x:0,y:0};this.linearVelocity=pc.Dim.create(0,0);if(pc.valid(b)){this.config(b)}this._velReturn=pc.Dim.create(0,0);this.gravity={}},config:function(c){this._body=null;if(this._fixtures){this._fixtures.length=0}else{this._fixtures=[]}this.collisionGroup=pc.checked(c.collisionGroup,0);this.collisionCategory=pc.checked(c.collisionCategory,0);this.collisionMask=pc.checked(c.collisionMask,0);this.sensorOnly=pc.checked(c.sensorOnly,false);this.centered=pc.checked(c.centered,true);if(!pc.valid(c.shapes)&&!Array.isArray(c.shapes)){c.shapes=[{}];c.shapes[0].shape=pc.CollisionShape.RECT}for(var d=0;d<c.shapes.length;d++){var b=c.shapes[d];if(!b.offset){b.offset={}}b.offset.x=pc.checked(b.offset.x,0);b.offset.y=pc.checked(b.offset.y,0);b.offset.w=pc.checked(b.offset.w,0);b.offset.h=pc.checked(b.offset.h,0);b.type=pc.checked(b.type,0);b.shape=pc.checked(b.shape,pc.CollisionShape.RECT);b.sensorOnly=pc.checked(b.sensorOnly,this.sensorOnly);b.collisionGroup=pc.checked(b.collisionGroup,this.collisionGroup);b.collisionCategory=pc.checked(b.collisionCategory,this.collisionCategory);b.collisionMask=pc.checked(b.collisionMask,this.collisionMask)}this.shapes=c.shapes;if(c.linearVelocity){this.linearVelocity.x=pc.checked(c.linearVelocity.x,0);this.linearVelocity.y=pc.checked(c.linearVelocity.y,0)}else{this.linearVelocity.x=0;this.linearVelocity.y=0}if(!this.maxSpeed){this.maxSpeed={}}if(c.maxSpeed){this.maxSpeed.x=pc.checked(c.maxSpeed.x,0);this.maxSpeed.y=pc.checked(c.maxSpeed.y,0)}else{this.maxSpeed.x=0;this.maxSpeed.y=0}if(c.gravity){this.gravity.x=c.gravity.x;this.gravity.y=c.gravity.y}else{this.gravity.x=undefined;this.gravity.y=undefined}this.mass=pc.checked(c.mass,-1);this.fixedRotation=pc.checked(c.fixedRotation,false);this.thrust=pc.checked(c.thrust,0);this.bounce=pc.checked(c.bounce,0.5);this.faceVel=pc.checked(c.faceVel,0);this.shape=pc.checked(c.shape,pc.CollisionShape.RECT);this.immovable=pc.checked(c.immovable,false);this.density=pc.checked(c.density,1);this.friction=pc.checked(c.friction,0.2);this.linearDamping=pc.checked(c.linearDamping,0);this.angularDamping=pc.checked(c.angularDamping,0);this.bullet=pc.checked(c.bullet,false);this.torque=pc.checked(c.torque,0);this.impulse=pc.checked(c.impulse,0);this.turn=pc.checked(c.turn,0);this.force=pc.checked(c.force,0);if(pc.valid(c.centerOfMass)){this.centerOfMass.x=pc.checked(c.centerOfMass.x);this.centerOfMass.y=pc.checked(c.centerOfMass.y)}},applyTurn:function(b){if(this._body){this._body.SetAngularVelocity(pc.Math.degToRad(b));this._body.SetAwake(true)}else{this._pendingDir=b}},clearGravity:function(){this.setGravity()},setGravity:function(c,b){this.gravity.x=c;this.gravity.y=b;if(this._body){if(this.gravity.x!=undefined||this._body._pc_gravityX!=undefined){this._body._pc_gravityX=this.gravity.x}if(this.gravity.y!=undefined||this._body._pc_gravityY!=undefined){this._body._pc_gravityY=this.gravity.y}}},setDir:function(b){if(this._body){this._body.SetAngle(pc.Math.degToRad(b));this._body.SetAwake(true)}else{this.dir=b}},getDir:function(){if(this._body){return pc.Math.radToDeg(this._body.GetAngle())}return 0},applyForce:function(c,b){if(this._body){var d=this._body.GetAngle();if(pc.valid(b)){d=pc.Math.degToRad(b)}this._body.ApplyForce(Box2D.Common.Math.b2Vec2.Get(Math.cos(d)*c,Math.sin(d)*c),this._body.GetWorldCenter())}else{this.force=c}},applyImpulse:function(c,b){if(this._body){var d=this._body.GetAngle();if(pc.valid(b)){d=pc.Math.degToRad(b)}this._body.ApplyImpulse(Box2D.Common.Math.b2Vec2.Get(Math.cos(d)*c,Math.sin(d)*c),this._body.GetWorldCenter())}else{this.impulse=c}},applyTorque:function(b){if(this._body){this._body.ApplyTorque(pc.Math.degToRad(b))}else{this.torque=b}},setCenterOfMass:function(b,d){if(this._body){var c=new Box2D.Collision.Shapes.b2MassData();c.center=Box2D.Common.Math.b2Vec2.Get(pc.systems.Physics.toP(b),pc.systems.Physics.toP(d));this._body.SetMassData(c)}else{this.centerOfMass.x=b;this.centerOfMass.y=d}},getSpeed:function(){if(this._body){return this._body.GetLinearVelocity().Length()/pc.systems.Physics.SCALE}return 0},setLinearVelocity:function(b,c){if(this._body){this._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(b*pc.systems.Physics.SCALE,c*pc.systems.Physics.SCALE));this._body.SetAwake(true)}else{this.linearVelocity.x=b;this.linearVelocity.y=c}},_velReturn:null,getLinearVelocity:function(){if(this._body){var b=this._body.GetLinearVelocity();this._velReturn.setXY(pc.systems.Physics.fromP(b.x),pc.systems.Physics.fromP(b.y))}return this._velReturn},getVelocityAngle:function(){return pc.Math.angleFromVector(this._body.GetLinearVelocity().x,this._body.GetLinearVelocity().y)},setAngularVelocity:function(b){if(this._body){this._body.SetAngularVelocity(b);this._body.SetAwake(true)}},setLinearDamping:function(b){if(this._body){this._body.SetLinearDamping(a);this._body.SetAwake(true)}},setFriction:function(b){if(this._body){this._body.SetFriction(b);this._body.SetAwake(true)}},setCollisionCategory:function(e){if(!this._fixtures.length){return}this.collisionCategory=e;for(var b=0;b<this._fixtures.length;b++){var d=this._fixtures[b].GetFilterData();d.collisionCategory=e;this._fixtures[b].SetFilterData(d);this._fixtures[b].GetFilterData().categoryBits=e}},setCollisionGroup:function(c){if(!this._fixtures.length){return}this.collisionGroup=c;for(var b=0;b<this._fixtures.length;b++){var d=this._fixtures[b].GetFilterData();d.groupIndex=c;this._fixtures[b].SetFilterData(d)}},setCollisionMask:function(b){if(!this._fixtures.length){return}this.collisionMask=b;for(var c=0;c<this._fixtures.length;c++){var d=this._fixtures[c].GetFilterData();d.maskBits=b;this._fixtures[c].SetFilterData(d)}},setIsSensor:function(c,b){if(!this._fixtures.length){return}this._fixtures[b].isSensor=c}});pc.components.Alpha=pc.components.Component.extend("pc.components.Alpha",{create:function(b){var c=this._super();c.config(b);return c}},{level:1,init:function(){this._super("alpha")},config:function(b){this.level=pc.checked(b.level,1)},setAlpha:function(b){this.level=b;this._fix(this.level)},addAlpha:function(b){this.level+=b;this._fix(this.level)},subAlpha:function(b){this.level-=b;this._fix(this.level)},_fix:function(b){if(b>1){return}if(b<0){return}this.level=b}});pc.JointType={WELD:0,REVOLUTE:1,DISTANCE:2};pc.components.Joint=pc.components.Component.extend("pc.components.Joint",{create:function(b){var c=this._super();c.config(b);return c}},{attachTo:null,offset:null,attachmentOffset:null,distance:0,type:0,frequency:0,dampingRatio:0,angle:0,lowerAngleLimit:0,upperAngleLimit:0,enableLimit:false,maxMotorTorque:0,enableMotor:0,motorSpeed:0,_joint:null,init:function(b){this._super("joint");this.offset=pc.Point.create(0,0);this.attachmentOffset=pc.Point.create(0,0);if(pc.valid(b)){this.config(b)}},config:function(b){this.attachTo=pc.checked(b.attachedTo,null);if(b.offset){this.offset.setXY(pc.checked(b.offset.x,0),pc.checked(b.offset.y,0))}if(b.attachmentOffset){this.attachmentOffset.setXY(pc.checked(b.attachmentOffset.x,0),pc.checked(b.attachmentOffset.y,0))}this.distance=pc.checked(b.distance,0);this.type=pc.checked(b.type,pc.JointType.WELD);this.dampingRatio=pc.checked(b.dampingRatio,0);this.lowerAngleLimit=pc.checked(b.lowerAngleLimit,0);this.upperAngleLimit=pc.checked(b.upperAngleLimit,359);this.enableLimit=pc.checked(b.enableLimit,false);this.maxMotorTorque=pc.checked(b.maxMotorTorque,100);this.enableMotor=pc.checked(b.enableMotor,false);this.motorSpeed=pc.checked(b.motorSpeed,0);this.angle=pc.checked(b.angle,0);this._joint=null},getAngle:function(){return pc.Math.radToDeg(this._joint.GetJointAngle())},getSpeed:function(){return this._joint.GetJointSpeed()},setMotorSpeed:function(b){this.motorSpeed=b;this._joint.SetMotorSpeed(b)},getMotorTorque:function(){return this._joint.GetMotorTorque()},isLimitEnabled:function(){return this.enableLimit},isMotorEnabled:function(){return this.enableMotor},setMaxMotorTorque:function(b){this.maxMotorTorque=b;this._joint.SetMaxMotorTorque(b)},getMaxMotorTorque:function(){return this.maxMotorTorque}});pc.components.Expiry=pc.components.Component.extend("pc.components.Expiry",{create:function(b){var c=this._super();c.config(b);return c}},{lifetime:0,init:function(){this._super("expiry")},config:function(b){this.lifetime=pc.checked(b.lifetime,1000)},decrease:function(b){this.lifetime-=b},hasExpired:function(){return this.lifetime<=0}});pc.components.OriginShifter=pc.components.Component.extend("pc.components.OriginShifter",{create:function(b){var c=this._super();c.config(b);return c}},{ratio:1,_offsetX:0,_offsetY:0,init:function(b){this._super("originshifter");if(pc.valid(b)){this.config(b)}},config:function(b){this.ratio=pc.checked(b.ratio,1)}});pc.components.Spatial=pc.components.Component.extend("pc.components.Spatial",{create:function(b){var c=this._super();c.config(b);return c}},{lastMove:null,pos:null,dim:null,scaleX:0,scaleY:0,dir:0,_centerPos:null,_screenRect:null,init:function(b){this._super("spatial");this.pos=pc.Point.create(0,0);this.dim=pc.Dim.create(0,0);this._screenRect=pc.Rect.create(0,0,0,0);this._centerPos=pc.Point.create(0,0);this._unscaledPos=pc.Point.create(0,0);this._unscaledDim=pc.Point.create(0,0);this.lastMove=pc.Dim.create(0,0);this.scaleX=1;this.scaleY=1;if(pc.valid(b)){this.config(b)}},config:function(b){this.pos.x=pc.checked(b.x,0);this.pos.y=pc.checked(b.y,0);this.dim.x=pc.checked(b.w,0);this.dim.y=pc.checked(b.h,0);this.dir=pc.checked(b.dir,0);this.scaleX=pc.checked(b.scaleX,1);this.scaleY=pc.checked(b.scaleY,1);this._centerPos.x=0;this._centerPos.y=0;this._screenRect.x=0;this._screenRect.y=0;this._screenRect.w=0;this._screenRect.h=0;this.lastMove.x=0;this.lastMove.y=0},getPos:function(){return this.pos},getDim:function(){return this.dim},addScale:function(b,c){this.pos.x-=Math.abs((this.dim.x-(this.dim.x*b))/2);this.pos.y-=Math.abs((this.dim.y-(this.dim.y*c))/2);this.dim.x*=(b);this.dim.y*=(c);this.scaleX+=b;this.scaleY+=c},_unscaledPos:null,getUnscaledPos:function(){this._unscaledPos.x=this.pos.x/this.scaleX;this._unscaledPos.y=this.pos.y/this.scaleY;return this._unscaledPos},_unscaledDim:null,getUnscaledDim:function(){this._unscaledDim.x=this.dim.x/this.scaleX;this._unscaledDim.y=this.dim.y/this.scaleY;return this._unscaledDim},subtractScale:function(b,c){this.addScale(-b,-c)},setDir:function(b){this.dir=b},getDir:function(){return this.dir},getCenterPos:function(){this._centerPos.x=this.pos.x+(this.dim.x/2);this._centerPos.y=this.pos.y+(this.dim.y/2);return this._centerPos},getScreenRect:function(){if(this._entity&&this._entity.layer){this._screenRect.x=this._entity.layer.screenX(this.pos.x);this._screenRect.y=this._entity.layer.screenY(this.pos.y);this._screenRect.w=this.dim.x;this._screenRect.h=this.dim.y;return this._screenRect}return null},toString:function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z+" dir: "+this.dir}});pc.components.Overlay=pc.components.Component.extend("pc.components.Overlay",{create:function(b){var c=this._super();c.config(b);return c}},{lifetime:0,sprite:null,init:function(b){this._super("overlay");this.sprite=pc.Sprite.create();if(pc.valid(b)){this.config(b)}},config:function(e){this.lifetime=pc.checked(e.lifetime,1000);var d=pc.checked(e.spriteSheet,null);if(d==null){throw this.getUniqueId()+": no spritesheet specified"}this.sprite.setSpriteSheet(d);var b=pc.checked(e.animationStart,null);var c=pc.checked(e.animationStartDelay,0);if(b!=null){this.sprite.setAnimation(b,c)}},decrease:function(b){this.lifetime-=b},hasExpired:function(){return this.lifetime<=0}});pc.components.Clip=pc.components.Component.extend("pc.components.Clip",{create:function(b){var c=this._super();c.config(b);return c}},{clipEntity:null,x:0,y:0,w:0,h:0,init:function(){this._super("clip")},config:function(b){this.clipEntity=pc.checked(b.clipEntity,null);this.x=pc.checked(b.x,0);this.y=pc.checked(b.y,0);this.w=pc.checked(b.w,0);this.h=pc.checked(b.h,0)}});pc.components.Activator=pc.components.Component.extend("pc.components.Activator",{create:function(b){var c=this._super();c.config(b);return c}},{tag:null,layer:null,range:0,stayActive:false,_cacheLayer:null,init:function(){this._super("activator")},config:function(b){if(!b.tag){throw"Activator requires an entity to track against"}this.tag=b.tag;this.layer=pc.checked(b.layer,null);this.range=pc.checked(b.range,300);this.stayActive=pc.checked(b.stayActive,false)}});pc.components.Input=pc.components.Component.extend("pc.components.Input",{create:function(b){var c=this._super();c.config(b);return c}},{target:null,states:null,actions:null,_bound:false,init:function(b){this._super("input")},config:function(b){if(!b.states&&!b.actions){throw"Input requires at least an action or state set"}this.states=b.states;this.actions=b.actions;this.target=b.target}});pc.components.Fade=pc.components.Component.extend("pc.components.Fade",{create:function(b){var c=this._super();c.config(b);return c}},{startDelay:0,fadeInTime:0,fadeOutTime:0,holdTime:0,startTime:0,timeLimit:0,state:0,loops:1,loopsSoFar:0,init:function(){this._super("fade")},config:function(b){this.startDelay=pc.checked(b.startDelay,0);this.fadeInTime=pc.checked(b.fadeInTime,0);this.fadeOutTime=pc.checked(b.fadeOutTime,0);this.holdTime=pc.checked(b.holdTime,0);this.loops=pc.checked(b.loops,1);this.timeLimit=0;this.state=0;this.loopsSoFar=0}});pc.components.Spin=pc.components.Component.extend("pc.components.Spin",{create:function(b){var c=this._super();c.config(b);return c}},{rate:0,max:0,clockwise:true,spinSoFar:0,spinning:true,init:function(b){this._super("spin");if(pc.valid(b)){this.config(b)}},config:function(b){this.rate=pc.checked(b.rate,15);this.max=pc.checked(b.max,0);this.clockwise=pc.checked(b.clockwise,true);this.spinSoFar=0;this.spinning=true}});pc.components.Scale=pc.components.Component.extend("pc.components.Scale",{create:function(b){var c=this._super();c.config(b);return c}},{x:1,y:1,growX:0,growY:0,maxX:0,maxY:0,scaledXSoFar:0,scaledYSoFar:0,scaling:true,_bound:false,init:function(b){this._super("scale");if(pc.valid(b)){this.config(b)}},config:function(b){this.x=pc.checked(b.x,1);this.y=pc.checked(b.y,1);this.growX=pc.checked(b.growX,0);this.growY=pc.checked(b.growY,0);this.maxX=pc.checked(b.maxX,0);this.maxY=pc.checked(b.maxY,0);this.scaledXSoFar=0;this.scaledYSoFar=0}});pc.components.Rect=pc.components.Component.extend("pc.components.Rect",{create:function(b){var c=this._super();c.config(b);return c}},{color:null,lineColor:null,lineWidth:0,cornerRadius:0,init:function(b){this._super("rect");this.color=pc.Color.create("#ffffff");this.lineColor=pc.Color.create("#888888");if(pc.valid(b)){this.config(b)}},config:function(b){if(!b.color){this.color.set("#ffffff")}else{this.color.set(pc.checked(b.color,"#ffffff"))}if(!b.lineColor){this.lineColor.set("#ffffff")}else{this.lineColor.set(pc.checked(b.lineColor,"#888888"))}this.lineWidth=pc.checked(b.lineWidth,0);this.cornerRadius=pc.checked(b.cornerRadius,0)}});pc.components.Poly=pc.components.Component.extend("pc.components.Poly",{create:function(b){var c=this._super();c.config(b);return c}},{color:null,lineColor:null,lineWidth:0,points:[],init:function(b){this._super("poly");this.color=pc.Color.create("#ffffff");this.lineColor=null;if(pc.valid(b)){this.config(b)}},config:function(b){if(!b.color){this.color.set("#ffffff")}else{this.color.set(pc.checked(b.color,"#ffffff"))}if(pc.valid(b.lineColor)){if(this.lineColor==null){this.lineColor=pc.Color.create(b.lineColor)}else{this.lineColor.set(pc.checked(b.lineColor,"#888888"))}}this.lineWidth=pc.checked(b.lineWidth,0);if(b.points.length<3){throw"Invalid polygon, requires at least 3 points"}this.points=b.points}});pc.components.Circle=pc.components.Component.extend("pc.components.Circle",{create:function(b){var c=this._super();c.config(b);return c}},{color:null,lineColor:null,lineWidth:0,init:function(){this._super("circle")},config:function(b){if(b.color){if(this.color==null){this.color=pc.Color.create(b.color)}else{this.color.set(b.color)}}else{this.color=null}if(b.lineColor){if(this.lineColor==null){this.lineColor=pc.Color.create(b.lineColor)}else{this.lineColor.set(b.lineColor)}}else{this.lineColor=null}this.lineWidth=pc.checked(b.lineWidth,0)}});pc.components.Text=pc.components.Component.extend("pc.components.Text",{create:function(b){var c=this._super();c.config(b);return c}},{color:null,strokeColor:null,font:null,fontHeight:0,text:null,lineWidth:0,offset:null,_fontCache:null,init:function(b){this._super("text");this.color=pc.Color.create("#ffffff");this.strokeColor=pc.Color.create("#888888");this.text=[];this.font="Calibri";this.fontHeight=20;this.offset=pc.Dim.create(0,0);this._fontCache="";if(pc.valid(b)){this.config(b)}},config:function(b){this.color.set(pc.checked(b.color,"#ffffff"));this.strokeColor.set(pc.checked(b.strokeColor,"#888888"));this.lineWidth=pc.checked(b.lineWidth,0);this.text=pc.checked(b.text,[""]);this.font=pc.checked(b.font,"Arial");this.fontHeight=pc.checked(b.fontHeight,20);if(pc.valid(b.offset)){this.offset.x=pc.checked(b.offset.x);this.offset.y=pc.checked(b.offset.y)}this._updateFont()},setHeight:function(b){this.fontHeight=b;this._updateFont()},setFont:function(b){this.font=b;this._updateFont()},_updateFont:function(){this._fontCache=""+this.fontHeight+"px "+this.font}});pc.components.Sprite=pc.components.Component.extend("pc.components.Sprite",{create:function(b){var c=this._super();c.config(b);return c}},{sprite:null,offset:null,init:function(b){this._super("sprite");this.sprite=pc.Sprite.create();this.offset=pc.Point.create(0,0);if(pc.valid(b)){this.config(b)}},config:function(e){var d=pc.checked(e.spriteSheet,null);if(d==null){throw this.getUniqueId()+": no spritesheet specified"}this.sprite.setSpriteSheet(d);if(pc.valid(e.offset)){this.offset.x=pc.checked(e.offset.x,0);this.offset.y=pc.checked(e.offset.y,0)}else{this.offset.x=0;this.offset.y=0}var b=pc.checked(e.animationStart,null);var c=pc.checked(e.animationStartDelay,0);if(b!=null){this.sprite.setAnimation(b,c)}this.sprite.currentFrame=pc.checked(e.currentFrame,0)}});pc.components.Layout=pc.components.Component.extend("pc.components.Layout",{create:function(b){var c=this._super();c.config(b);return c}},{vertical:null,horizontal:null,margin:null,init:function(){this._super("layout");this.margin={}},config:function(b){if(pc.checked(b.margin)){this.margin.left=pc.checked(b.margin.left,0);this.margin.right=pc.checked(b.margin.right,0);this.margin.top=pc.checked(b.margin.top,0);this.margin.bottom=pc.checked(b.margin.bottom,0)}else{this.margin.left=0;this.margin.right=0;this.margin.top=0;this.margin.bottom=0}this.horizontal=pc.checked(b.horizontal,"left");this.vertical=pc.checked(b.vertical,"top")}});pc.components.ParticleEmitter=pc.components.Component.extend("pc.components.ParticleEmitter",{create:function(b){var c=this._super();c.config(b);return c}},{active:true,emitting:true,growXMin:0,growXMax:0,growYMin:0,growYMax:0,scaleXMin:0,scaleXMax:0,scaleYMin:0,scaleYMax:0,fadeInTime:0,fadeOutTime:0,angleMin:0,angleMax:0,thrustMin:0,thrustMax:0,thrustTime:0,spinMin:0,spinMax:0,rangeX:1,rangeY:1,burst:1,delay:25,spriteSheet:null,lifeMin:0,lifeMax:0,rotateSprite:false,offsetX:null,offsetY:null,compositeOperation:null,relativeAngle:true,shots:0,alphaMin:1,alphaMax:1,alphaDelay:0,_particles:null,_lastEmitTime:0,_shotCount:0,init:function(b){this._super("emitter");if(pc.valid(b)){this.config(b)}},reset:function(){this._shotCount=0;this._lastEmitTime=0},config:function(b){this._lastEmitTime=0;this._shotCount=0;this.active=pc.checked(b.active,true);this.emitting=pc.checked(b.emitting,true);this.growXMin=pc.checked(b.growXMin,0);this.growXMax=pc.checked(b.growXMax,this.growXMin);this.growYMin=pc.checked(b.growYMin,0);this.growYMax=pc.checked(b.growYMax,this.growYMin);this.scaleXMin=pc.checked(b.scaleXMin,1);this.scaleYMin=pc.checked(b.scaleYMin,1);this.scaleXMax=pc.checked(b.scaleXMax,1);this.scaleYMax=pc.checked(b.scaleYMax,1);this.compositeOperation=pc.checked(b.compositeOperation,null);this.alphaMin=pc.checked(b.alphaMin,1);this.alphaMax=pc.checked(b.alphaMax,this.alphaMin);this.alphaDelay=pc.checked(b.alphaDelay,50);this.shots=pc.checked(b.shots,0);this.relativeAngle=pc.checked(b.relativeAngle,true);this.rangeX=pc.checked(b.rangeX,1);this.rangeY=pc.checked(b.rangeY,1);this.fadeInTime=pc.checked(b.fadeInTime,0);this.fadeOutTime=pc.checked(b.fadeOutTime,0);this.angleMin=pc.checked(b.angleMin,0);this.angleMax=pc.checked(b.angleMax,359);this.thrustMin=pc.checked(b.thrustMin,1);this.thrustMax=pc.checked(b.thrustMax,this.thrustMin);this.thrustTime=pc.checked(b.thrustTime,100);this.burst=pc.checked(b.burst,1);this.delay=pc.checked(b.delay,25);this.lifeMin=pc.checked(b.lifeMin,100);this.lifeMax=pc.checked(b.lifeMin,this.lifeMin);this.rotateSprite=pc.checked(b.rotateSprite,false);this.spinMin=pc.checked(b.spinMin,0);this.spinMax=pc.checked(b.spinMax,this.spinMin);this.offsetX=pc.checked(b.offsetX,0);this.offsetY=pc.checked(b.offsetY,0);this.gravityX=pc.checked(b.gravityX,0);this.gravityY=pc.checked(b.gravityY,0);this.maxVelX=pc.checked(b.maxVelX,50);this.maxVelY=pc.checked(b.maxVelY,50);if(!pc.valid(b.spriteSheet)){throw"A spritesheet is required for the emitter"}else{this.spriteSheet=b.spriteSheet}if(!Array.isArray(this._particles)){this._particles=new pc.LinkedList()}else{this._particles.clear()}},onBeforeRemoved:function(){var b=this._particles.first;while(b){b.obj.release();b=b.next()}}});pc.systems={};pc.systems.System=pc.Base.extend("pc.System",{},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(b,c){this._super();this.delay=pc.checked(c,0);if(!b instanceof Array){throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system."}this.componentTypes=b},processAll:function(){},onResize:function(){},onOriginChange:function(b,c){},onAddedToLayer:function(b){},onRemovedFromLayer:function(b){}});pc.EntityManager=pc.Base.extend("pc.EntityManager",{},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(b){this.layer=b;this.entitiesByTag=new pc.HashList();this.entities=new pc.LinkedList();this.componentsByEntity=new pc.Hashmap();this.componentsByEntityPlusType=new pc.Hashmap();this.entitySuicides=new pc.LinkedList()},cleanup:function(){var b=this.entitySuicides.first;while(b){this._doRemoveEntity(b.object());b=b.next()}this.entitySuicides.clear()},add:function(c,b){this.entities.add(c);if(b!=undefined){this.entitiesByTag.add(b,c)}var f=c.getAllComponents();if(f!=null){var e=f.values();for(var d=0;d<e.length;d++){this._addToComponentMap(c,e[d])}}this.layer.systemManager._handleEntityAdded(c)},remove:function(b){if(!this.entitySuicides.has(b)){this.entitySuicides.add(b);b.active=false}},removeComponent:function(b,c){this._removeFromComponentMap(b,c);this.layer.systemManager._handleComponentRemoved(b,c);b._handleComponentRemoved(c);c._entity=null},addTag:function(c,b){if(c.tags.indexOf(b.toLowerCase())!=-1){return}this.entitiesByTag.add(b.toLowerCase(),c);c.tags.push(b.toLowerCase())},removeTag:function(c,b){this.entitiesByTag.remove(b.toLowerCase(),c);pc.Tools.arrayRemove(c.tags,b.toLowerCase())},getTagged:function(b){return this.entitiesByTag.get(b.toLowerCase())},activate:function(b){if(b.active){return}this.layer.systemManager._handleEntityAdded(b);b.active=true},deactivate:function(b){if(!b.active){return}this.layer.systemManager._handleEntityRemoved(b);b.active=false},_doRemoveEntity:function(b){this.entities.remove(b);var f=b.getAllComponents();if(f!=null){var e=f.values();for(var d=0;d<e.length;d++){this._removeFromComponentMap(b,e[d])}}for(var c=0;c<b.tags.length;c++){this.entitiesByTag.remove(b.tags[c],b)}this.layer.systemManager._handleEntityRemoved(b);b.release()},addComponent:function(b,c){this._addToComponentMap(b,c);b._handleComponentAdded(c);this.layer.systemManager._handleComponentAdded(b,c);c._entity=b;return c},getComponent:function(b,c){return this.componentsByEntityPlusType.get(b.objectId+":"+c)},getComponents:function(b){return this.componentsByEntity.get(b.objectId)},hasComponentOfType:function(b,c){return this.componentsByEntityPlusType.containsKey(b.objectId+":"+c)},_addToComponentMap:function(b,c){if(this.componentsByEntityPlusType.get(b.objectId+":"+c.getType())){throw ("adding component "+c.getType()+" to entity "+b+" when it already has one of that type")}this.componentsByEntityPlusType.put(b.objectId+":"+c.getType(),c);this.componentsByEntity.put(b.objectId,c)},_removeFromComponentMap:function(b,c){c.onBeforeRemoved();this.componentsByEntityPlusType.remove(b.objectId+":"+c.getType());this.componentsByEntity.remove(b.objectId);c.release()}});pc.SystemManager=pc.Base.extend("pc.SystemManager",{},{systems:null,systemsByComponentType:null,layer:null,init:function(b){this.systems=new pc.LinkedList();this.systemsByComponentType=new pc.Hashtable();this.layer=b},add:function(e){e.layer=this.layer;e.systemManager=this;this.systems.add(e);if(!pc.valid(e.componentTypes)){throw"Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)"}for(var c=0;c<e.componentTypes.length;c++){var d=e.componentTypes[c].toLowerCase();var f=this.systemsByComponentType.get(d);if(f==null){f=new pc.LinkedList();this.systemsByComponentType.put(d,f)}if(!f.has(e)){f.add(e)}}var b=this.layer.entityManager.entities.first;while(b){this._handleEntityAdded(b.object());b=b.next()}e.onAddedToLayer(this.layer)},remove:function(c){c.onRemovedFromLayer(c.layer);this.systems.remove(c);for(var b=0;b<c.componentTypes;b++){var d=this.systemsByComponentType.get(c.componentTypes[b].toLowerCase());assert(d!=null,"Oops, trying to remove a system and it's not in the by type list");c.systemManager=null;d.remove(c)}},getByComponentType:function(b){return this.systemsByComponentType.get(b)},onOriginChange:function(b,d){var c=this.systems.first;while(c){c.object().onOriginChange(b,d);c=c.next()}},_handleEntityAdded:function(c){var b=c.getComponentTypes();for(var d=0;d<b.length;d++){var f=this.systemsByComponentType.get(b[d].toLowerCase());if(f){var e=f.first;while(e){e.obj.add(c);e=e.next()}}}},_handleEntityRemoved:function(c){var g=c.getAllComponents();if(g==null){return}var b=g.keys();for(var d=0;d<b.length;d++){var f=this.systemsByComponentType.get(b[d].toLowerCase());if(f){var e=f.first;while(e){e.obj.remove(c);e=e.next()}}}},_handleComponentAdded:function(b,c){var e=this.systemsByComponentType.get(c.getType());if(e==null){return}var d=e.first;while(d){d.obj.add(b);d.obj.onComponentAdded(b,c);d=d.next()}},_handleComponentRemoved:function(b,c){var e=this.systemsByComponentType.get(c.getType());if(e==null){return}var d=e.first;while(d){d.obj.removeIfNotMatched(b);d.obj.onComponentRemoved(b,c);d=d.next()}},processAll:function(){var b=this.systems.first;while(b){if(b.obj.delay==0||(pc.device.now-b.obj._lastRun>b.obj.delay)){b.obj.processAll();if(b.obj.delay!=0){b.obj._lastRun=pc.device.now}}b=b.next()}},onResize:function(d,b){var c=this.systems.first;while(c){c.obj.onResize(d,b);c=c.next()}}});pc.systems.EntitySystem=pc.systems.System.extend("pc.systems.EntitySystem",{},{entities:null,suicides:null,init:function(b,c){this._super(b,c);this.entities=new pc.LinkedList();this.suicides=new pc.LinkedList()},addIfMatched:function(b){for(var c=0;c<this.componentTypes.length;c++){if(b.hasComponentOfType(this.componentTypes[c])){this.entities.add(b);this.onEntityAdded(b);return}}},add:function(b){if(this.entities.has(b)){return}this.entities.add(b);this.onEntityAdded(b)},remove:function(b){if(this.entities.remove(b)){this.onEntityRemoved(b)}},removeIfNotMatched:function(b){for(var c=0;c<this.componentTypes.length;c++){if(b.hasComponentOfType(this.componentTypes[c])){return}}this.remove(b)},processAll:function(){var b=this.entities.first;while(b){this.process(b.obj);b=b.next()}b=this.suicides.first;while(b){this.remove(b.obj);b=b.next()}this.suicides.clear()},process:function(b){},suicide:function(b){this.suicides.add(b)},onEntityAdded:function(b){},onEntityRemoved:function(b){},onComponentAdded:function(b,c){},onComponentRemoved:function(b,c){}});pc.CollisionShape={RECT:0,CIRCLE:1,POLY:2};pc.BodyType={ENTITY:0,TILE:1};pc.systems.Physics=pc.systems.EntitySystem.extend("pc.systems.Physics",{SCALE:0.1,toP:function(b){return b*this.SCALE},fromP:function(b){return b/this.SCALE}},{world:null,gravity:null,debug:false,debugDraw:null,init:function(b){this._super(["physics"]);if(b&&b.gravity){this.gravity=pc.Point.create(pc.checked(b.gravity.x,0),pc.checked(b.gravity.y,0))}else{this.gravity=pc.Point.create(0,0)}var e=new Box2D.Common.Math.b2Vec2(this.gravity.x*this.Class.SCALE,this.gravity.y*this.Class.SCALE);this.world=new Box2D.Dynamics.b2World(e,true);if(b&&pc.valid(b.tileCollisionMap)){pc.assert(pc.valid(b.tileCollisionMap.tileMap),"A tileMap is required for a tileCollisionMap");this.addTileCollisionMap(b.tileCollisionMap.tileMap,pc.checked(b.tileCollisionMap.collisionGroup,0),pc.checked(b.tileCollisionMap.collisionCategory,0),pc.checked(b.tileCollisionMap.collisionMask,0))}var d=new Box2D.Dynamics.b2ContactListener;d.BeginContact=this._beginContactListener.bind(this);d.EndContact=this._endContactListener.bind(this);d.PostSolve=this._postSolveListener.bind(this);this.world.SetContactListener(d);var c=Box2D.Dynamics.b2DebugDraw;this.debugDraw=new c();this.debugDraw.SetSprite(pc.device.ctx);this.debugDraw.SetDrawScale(this.Class.SCALE*100);this.debugDraw.SetFillAlpha(0.3);this.debugDraw.SetLineThickness(1);this.debugDraw.SetFlags(c.e_shapeBit|c.e_jointBit|c.e_centerOfMassBit);if(b&&b.debug==true){this.debug=b.debug;this.setDebug(b.debug)}},_beginContactListener:function(b){this.onCollisionStart(b.GetFixtureA().GetBody()._pc_bodyType,b.GetFixtureB().GetBody()._pc_bodyType,b.GetFixtureA().GetBody().GetUserData(),b.GetFixtureB().GetBody().GetUserData(),b.GetFixtureA()._pc_type,b.GetFixtureB()._pc_type,b)},_endContactListener:function(b){this.onCollisionEnd(b.GetFixtureA().GetBody()._pc_bodyType,b.GetFixtureB().GetBody()._pc_bodyType,b.GetFixtureA().GetBody().GetUserData(),b.GetFixtureB().GetBody().GetUserData(),b.GetFixtureA()._pc_type,b.GetFixtureB()._pc_type,b)},_postSolveListener:function(b,d){var c=d.normalImpulses[0];this.onCollision(b.GetFixtureA().GetBody()._pc_bodyType,b.GetFixtureB().GetBody()._pc_bodyType,b.GetFixtureA().GetBody().GetUserData(),b.GetFixtureB().GetBody().GetUserData(),c,b.GetFixtureA()._pc_type,b.GetFixtureB()._pc_type,b)},process:function(m){if(!m.active){return}var A=m.getComponent("spatial");var J=m.getComponent("physics");if(!J.active){return}var n=m.getComponent("joint");if(!J._body){var d=new Box2D.Dynamics.b2BodyDef();d.type=J.immovable?Box2D.Dynamics.b2BodyDef.b2_staticBody:d.type=Box2D.Dynamics.b2BodyDef.b2_dynamicBody;if(J.centered){d.position.x=this.Class.toP(A.pos.x+(A.dim.x/2));d.position.y=this.Class.toP(A.pos.y+(A.dim.y/2))}else{d.position.x=this.Class.toP(A.pos.x);d.position.y=this.Class.toP(A.pos.y)}d.linearDamping=J.linearDamping;d.angularDamping=J.angularDamping;d.isBullet=J.bullet;d.fixedRotation=J.fixedRotation;J._body=this.world.CreateBody(d);J._body.SetAngle(pc.Math.degToRad(A.dir));J._body.SetUserData(m);J._body._pc_bodyType=pc.BodyType.ENTITY;if(J.linearVelocity){J._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(J.linearVelocity.x*pc.systems.Physics.SCALE,J.linearVelocity.y*pc.systems.Physics.SCALE))}if(J.gravity){J.setGravity(J.gravity.x,J.gravity.y)}pc.assert(J.shapes.length,"You must specify at least one shape for a physics entity");for(var z=0;z<J.shapes.length;z++){var b=J.shapes[z];var l=(A.dim.x+b.offset.w)*this.Class.SCALE;var B=(A.dim.y+b.offset.h)*this.Class.SCALE;var I=l/2;var c=B/2;var G=(b.offset.x*this.Class.SCALE)/2;var D=(b.offset.y*this.Class.SCALE)/2;pc.assert(I>0&&c>0,"Physics requires a spatial size minimum of 1");var K=new Box2D.Dynamics.b2FixtureDef();K.density=J.density;K.friction=J.friction;K.restitution=J.bounce;switch(b.shape){case pc.CollisionShape.CIRCLE:K.shape=new Box2D.Collision.Shapes.b2CircleShape(l/2);K.shape.SetLocalPosition(Box2D.Common.Math.b2Vec2.Get(b.offset.x*this.Class.SCALE,b.offset.y*this.Class.SCALE));break;case pc.CollisionShape.POLY:K.shape=new Box2D.Collision.Shapes.b2PolygonShape;var v=[];for(var r=0;r<b.points.length;r++){v.push(Box2D.Common.Math.b2Vec2.Get((b.offset.x+b.points[r][0])*this.Class.SCALE,(b.offset.y+b.points[r][1])*this.Class.SCALE))}K.shape.SetAsArray(v,v.length);break;default:K.shape=new Box2D.Collision.Shapes.b2PolygonShape;v=[];v.push(Box2D.Common.Math.b2Vec2.Get(-(I)+G,-(c)+D));v.push(Box2D.Common.Math.b2Vec2.Get(I,-(c)+D));v.push(Box2D.Common.Math.b2Vec2.Get(I,c));v.push(Box2D.Common.Math.b2Vec2.Get(-(I)+G,c));K.shape.SetAsArray(v,v.length);break}K.filter.groupIndex=b.collisionGroup;K.filter.categoryBits=b.collisionCategory;K.filter.maskBits=b.collisionMask;K.isSensor=b.sensorOnly;var E=J._body.CreateFixture(K);E._pc_type=b.type;J._fixtures.push(E)}if(J.centerOfMass.x!=0||J.centerOfMass.y!=0||J.mass!=-1){var L=new Box2D.Collision.Shapes.b2MassData();L.center=Box2D.Common.Math.b2Vec2.Get(J.centerOfMass.x*pc.systems.Physics.SCALE,J.centerOfMass.y*pc.systems.Physics.SCALE);if(J.mass!=-1){L.mass=J.mass}L.I=1;J._body.SetMassData(L)}else{L=new Box2D.Collision.Shapes.b2MassData();L.mass=1;L.I=1;J._body.SetMassData(L)}if(J.torque){J.applyTorque(J.torque)}if(J.turn){J.applyTurn(J.turn)}if(J.force){J.applyForce(J.force)}if(J.impulse){J.applyImpulse(J.impulse)}J._lastSpatialPos=pc.Point.create(A.pos.x,A.pos.y);J._lastSpatialDim=pc.Dim.create(A.dim.x,A.dim.y);J._lastSpatialDir=A.dir}if(n){if(!n._joint){var j=n.attachTo.getComponent("physics");if(j._body){var o=null;switch(n.type){case pc.JointType.WELD:o=new Box2D.Dynamics.Joints.b2WeldJointDef;o.bodyA=j._body;o.bodyB=J._body;o.collideConnected=false;o.localAnchorA.Set(n.offset.x*this.Class.SCALE,n.offset.y*this.Class.SCALE);o.localAnchorB.Set(n.attachmentOffset.x*this.Class.SCALE,n.attachmentOffset.y*this.Class.SCALE);j._body.SetAwake(true);var u=j._body.GetPosition();J._body.SetPosition({x:u.x+(n.offset.x*this.Class.SCALE),y:u.y+(n.offset.y*this.Class.SCALE)});break;case pc.JointType.DISTANCE:o=new Box2D.Dynamics.Joints.b2DistanceJointDef;o.bodyA=j._body;o.bodyB=J._body;o.frequency=n.frequency;o.dampingRatio=n.dampingRatio;o.collideConnected=false;o.length=n.distance;o.localAnchorA.Set(n.offset.x*this.Class.SCALE,n.offset.y*this.Class.SCALE);o.localAnchorB.Set(n.attachmentOffset.x*this.Class.SCALE,n.attachmentOffset.y*this.Class.SCALE);j._body.SetAwake(true);u=j._body.GetPosition();J._body.SetPosition({x:u.x+(n.offset.x*this.Class.SCALE),y:u.y+(n.offset.y*this.Class.SCALE)});break;case pc.JointType.REVOLUTE:o=new Box2D.Dynamics.Joints.b2RevoluteJointDef;o.bodyA=j._body;o.bodyB=J._body;o.collideConnected=false;o.referenceAngle=n.angle;o.localAnchorA.Set(n.offset.x*this.Class.SCALE,n.offset.y*this.Class.SCALE);o.localAnchorB.Set(n.attachmentOffset.x*this.Class.SCALE,n.attachmentOffset.y*this.Class.SCALE);j._body.SetAwake(true);if(n.enableLimit){o.enableLimit=n.enableLimit;o.lowerAngle=pc.Math.degToRad(n.lowerAngleLimit);o.upperAngle=pc.Math.degToRad(n.upperAngleLimit)}if(n.enableMotor){o.enableMotor=n.enableMotor;o.motorSpeed=pc.Math.degToRad(n.motorSpeed);o.maxMotorTorque=n.maxMotorTorque}var C=j._body.GetPosition();J._body.SetPosition({x:C.x+this.Class.toP(n.offset.x),y:C.y+this.Class.toP(n.offset.y)});break}if(!o){throw"Invalid attachment config"}n._joint=this.world.CreateJoint(o)}}}var s=J._body.GetPosition();var t=Math.round(pc.Math.radToDeg(J._body.GetAngle()));if(J._lastSpatialPos.x!=A.pos.x||J._lastSpatialPos.y!=A.pos.y){var k=J._lastSpatialPos.x!=A.pos.x?this.Class.toP(A.pos.x+(A.dim.x/2)):s.x;var g=J._lastSpatialPos.y!=A.pos.y?this.Class.toP(A.pos.y+(A.dim.y/2)):s.y;J._body.SetPosition(Box2D.Common.Math.b2Vec2.Get(k,g))}if(J._lastSpatialDir!=A.dir){J._body.SetAngle(pc.Math.degToRad(A.dir));t=Math.round(pc.Math.radToDeg(J._body.GetAngle()))}A.pos.x=Math.round(this.Class.fromP(s.x)-(A.dim.x/2));A.pos.y=Math.round(this.Class.fromP(s.y)-(A.dim.y/2));A.dir=t;J._lastSpatialPos.x=A.pos.x;J._lastSpatialPos.y=A.pos.y;J._lastSpatialDir=t;if(J.maxSpeed.x>0||J.maxSpeed.y>0){var e=J._body.GetLinearVelocity();if(e.x!=0||e.y!=0){var H=this.Class.toP(J.maxSpeed.x);if(e.x>0&&e.x>H){J._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(H,e.y))}if(e.x<0&&e.x<-H){J._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(-H,e.y))}var F=this.Class.toP(J.maxSpeed.y);if(e.y>0&&e.y>F){J._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(e.x,F))}if(e.y<0&&e.y<-F){J._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(e.x,-F))}}}},onOriginChange:function(b,c){this.debugDraw.SetOrigin(b,c)},processAll:function(){this.world.Step(0.08,10,10);this.world.DrawDebugData();this.world.ClearForces();this._super()},onAddedToLayer:function(c){var b=new Box2D.Collision.b2AABB();b.lowerBound.Set(0,0);b.upperBound.Set(this.Class.toP(c.worldSize.x),this.Class.toP(c.worldSize.y))},setDebug:function(b){if(b){this.world.SetDebugDraw(this.debugDraw)}else{this.world.SetDebugDraw(null)}this.debug=b},getEntitiesInArea:function(c){var b=new Box2D.Collision.b2AABB(),d=[];b.lowerBound.Set(c.x,c.y);b.upperBound.Set(c.w,c.h);this.world.QueryAABB(function(e){d.push(e.GetBody().GetUserData());return true},b);return d},createStaticBody:function(m,k,n,f,e,l,j){var i=this.Class.toP(n/2);var d=this.Class.toP(f/2);var b=new Box2D.Dynamics.b2FixtureDef();var c=new Box2D.Dynamics.b2BodyDef();c.type=Box2D.Dynamics.b2BodyDef.b2_staticBody;b.shape=new Box2D.Collision.Shapes.b2PolygonShape;var o=[];o.push(Box2D.Common.Math.b2Vec2.Get(-i,-d));o.push(Box2D.Common.Math.b2Vec2.Get(i,-d));o.push(Box2D.Common.Math.b2Vec2.Get(i,d));o.push(Box2D.Common.Math.b2Vec2.Get(-i,d));b.shape.SetAsArray(o,o.length);b.filter.groupIndex=e;b.filter.categoryBits=l;b.filter.maskBits=j;c.position.x=this.Class.toP(m)+i;c.position.y=this.Class.toP(k)+d;var g=this.world.CreateBody(c);g._pc_bodyType=pc.BodyType.TILE;g.CreateFixture(b)},addTileCollisionMap:function(g,i,h,f){for(var c=0;c<g.tilesHigh;c++){var b=0;var e=0;for(var d=0;d<g.tilesWide;d++){if(g.tiles[c][d]>=0){e+=g.tileWidth}else{if(e>0){this.createStaticBody(b,c*g.tileHeight,e,g.tileHeight,i,h,f);e=0}b=((d+1)*g.tileWidth)}}}},onCollisionStart:function(c,h,g,e,f,d,b){},onCollision:function(c,i,h,e,g,f,d,b){},onCollisionEnd:function(c,h,g,e,f,d,b){},onEntityAdded:function(b){},onEntityRemoved:function(c){var d=c.getComponent("physics");if(d._body){this.world.DestroyBody(d._body);var b=c.getComponent("attachment");if(b){this.world.DestroyJoint(b._joint)}}}});pc.systems.Effects=pc.systems.EntitySystem.extend("pc.systems.Effects",{FadeState:{NOT_STARTED:0,DELAYING:1,FADING_IN:2,HOLDING:3,FADING_OUT:4,DONE:5}},{init:function(){this._super(["fade","spin","scale"])},processAll:function(){var g=this.entities.first;while(g){var f=g.obj;if(f.active){var c=f.getComponent("fade");if(c&&c.active){var e=f.getComponent("alpha");if(!e){e=f.addComponent(pc.components.Alpha.create({}))}if(c.state!=this.Class.FadeState.DONE){if(!this._fade(e,c)){f.removeComponent(c)}}}var b=f.getComponent("spin");if(b&&b.spinning&&b.active){var h=f.getComponent("spatial");var k=b.rate/pc.device.elapsed;if(b.max>0&&b.spinSoFar+k>=b.max){b.spinning=false;k=(b.max-b.spinSoFar)}b.spinSoFar+=k;h.setDir(pc.Math.rotate(h.getDir(),b.clockwise?k:-k))}var d=f.getComponent("scale");if(d&&d.scaling&&d.active){h=f.getComponent("spatial");if(!d._bound&&(d.x!=1||d.y!=1)){h.addScale(d.x,d.y);d._bound=true;if(d.growX==0&&d.growY==0){d.scaling=false}}var j=d.growX/pc.device.elapsed;var i=d.growY/pc.device.elapsed;if(d.maxX!=0&&(d.scaledXSoFar>0&&d.scaledXSoFar+j>=d.maxX)){j=(d.maxX-d.scaledXSoFar)}if(d.maxY!=0&&(d.scaledYSoFar>0&&d.scaledYSoFar+i>=d.maxY)){i=(d.maxY-d.scaledYSoFar)}if(j!=0&&i!=0){d.scaledXSoFar+=j;d.scaledYSoFar+=i;h.addScale(j,i)}if((d.maxX!=0&&d.scaledXSoFar>=d.maxX)&&(d.maxY!=0&&d.scaledYSoFar>=d.maxY)){d.scaling=false}d._bound=true}}g=g.next()}},_fade:function(d,c){var b=pc.device.now-c.startTime;switch(c.state){case this.Class.FadeState.NOT_STARTED:c.startTime=pc.device.now;if(c.startDelay>0){c.state=this.Class.FadeState.DELAYING;c.timeLimit=c.startDelay;d.setAlpha(0)}else{if(c.fadeInTime>0){c.state=this.Class.FadeState.FADING_IN;c.timeLimit=c.fadeInTime;d.setAlpha(0)}else{if(c.holdTime>0){c.state=this.Class.FadeState.HOLDING;c.timeLimit=c.holdTime}else{if(c.fadeOutTime>0){c.state=this.Class.FadeState.FADING_OUT;c.timeLimit=c.fadeOutTime}}}}break;case this.Class.FadeState.DELAYING:if(b>c.timeLimit){c.timeLimit=c.fadeInTime;c.startTime=pc.device.now;c.state=this.Class.FadeState.FADING_IN}break;case this.Class.FadeState.FADING_IN:d.addAlpha((pc.device.elapsed*(100/c.timeLimit))/100);if(b>c.timeLimit){c.timeLimit=c.holdTime;c.startTime=pc.device.now;c.state=this.Class.FadeState.HOLDING}break;case this.Class.FadeState.HOLDING:if(b>c.timeLimit){c.timeLimit=c.fadeOutTime;c.startTime=pc.device.now;c.state=this.Class.FadeState.FADING_OUT}break;case this.Class.FadeState.FADING_OUT:if(b>c.timeLimit){c.loopsSoFar++;if(c.loops>1||c.loops==0){c.startTime=pc.device.now;c.timeLimit=c.fadeInTime;c.state=this.Class.FadeState.FADING_IN;if(c.timeLimit>0){d.setAlpha(0)}}if(c.loopsSoFar>=c.loops&&c.loops){c.state=this.Class.FadeState.DONE;if(c.timeLimit>0){d.setAlpha(0)}return false}}else{d.subAlpha((pc.device.elapsed*(100/c.timeLimit))/100)}break}return true}});pc.systems.Particles=pc.systems.EntitySystem.extend("pc.systems.Particles",{},{init:function(){this._super(["emitter"])},_drawStartTime:0,process:function(h){if(!h.active){return}var e=h.getComponent("emitter");if(!e.active){return}var d=h.getComponent("spatial");if(!d){d=h.addComponent(new pc.components.Spatial({}))}if(e){if(!e.active){return}if(e.emitting&&Date.now()-e._lastEmitTime>e.delay&&(e.shots==0||e._shotCount<e.shots)){for(var j=0;j<e.burst;j++){var f=0;if(e.spriteSheet.animations.size()==0){f=pc.Math.rand(0,(e.spriteSheet.framesHigh*e.spriteSheet.framesWide)-1)}e._particles.add(pc._Particle.create(d.pos.x+e.offsetX+pc.Math.rand(-(e.rangeX/2),e.rangeX/2),d.pos.y+e.offsetY+pc.Math.rand(-(e.rangeY/2),e.rangeY/2),pc.Math.rotate(e.relativeAngle?d.dir:0,pc.Math.rand(e.angleMin,e.angleMax)),pc.Math.randFloat(e.thrustMin,e.thrustMax),pc.Math.randFloat(e.lifeMin,e.lifeMax),pc.Math.randFloat(e.spinMin,e.spinMax),pc.Math.randFloat(e.growXMin,e.growXMax),pc.Math.randFloat(e.growYMin,e.growYMax),pc.Math.randFloat(e.scaleXMin,e.scaleXMax),pc.Math.randFloat(e.scaleYMin,e.scaleYMax),e.fadeInTime,e.fadeOutTime,e.alphaMin,e.alphaMax,e.spriteSheet,e.compositeOperation,f))}e._lastEmitTime=Date.now();e._shotCount++}var i=e._particles.first;while(i){var c=i.obj;if(pc.device.now-c.start>e.thrustTime){c.thrust=0}var l=c.thrust*Math.cos(pc.Math.degToRad(c.dir));var k=c.thrust*Math.sin(pc.Math.degToRad(c.dir));c.velX+=(l*(pc.device.elapsed/1000))+e.gravityX;c.velY+=(k*(pc.device.elapsed/1000))+e.gravityY;c.velX=pc.Math.limit(c.velX,-e.maxVelX,e.maxVelX);c.velY=pc.Math.limit(c.velY,-e.maxVelY,e.maxVelY);c.x+=c.velX;c.y+=c.velY;if(c.spin){c.rotation=pc.Math.rotate(c.rotation,c.spin*(pc.device.elapsed/1000))}if(c.growXRate!=0||c.growYRate!=0){c.scaleX+=c.growXRate*(pc.device.elapsed/1000);c.scaleY+=c.growYRate*(pc.device.elapsed/1000)}if(c.fadeState==0){c.sprite.addAlpha((pc.device.elapsed*(100/c.fadeInTime))/100);if(pc.device.now-c.fadeStateStart>c.fadeInTime){c.fadeState++;c.fadeStateStart=pc.device.now}}if(c.fadeState==1){if(pc.device.now-c.fadeStateStart>c.holdTime){c.fadeState++;c.fadeStateStart=pc.device.now}}if(c.fadeState==2){if(c.fadeOutTime>0){var g=(pc.device.elapsed*(100/c.fadeOutTime))/100;c.sprite.subAlpha(g)}}if(c.alphaMin!=1||c.alphaMax!=1){if(pc.device.now-c.lastAlpha>e.alphaDelay){c.sprite.setAlpha(pc.Math.rand(c.alphaMin,c.alphaMax));c.lastAlpha=pc.device.now}}this.drawStartTime=Date.now();if(c.scaleX!=1||c.scaleY!=1){e.spriteSheet.setScale(c.scaleX,c.scaleY)}if(!c.sprite.currentAnim){c.sprite.drawFrame(pc.device.ctx,c.frame%e.spriteSheet.framesWide,Math.floor(c.frame/e.spriteSheet.framesWide),c.x-h.layer.origin.x-h.layer.scene.viewPort.x,c.y-h.layer.origin.y-h.layer.scene.viewPort.y,e.rotateSprite?c.rotation:c.dir);pc.device.lastDrawMS+=(Date.now()-this.drawStartTime)}else{c.sprite.draw(pc.device.ctx,c.x-h.layer.origin.x-h.layer.scene.viewPort.x,c.y-h.layer.origin.y-h.layer.scene.viewPort.y,c.dir);pc.device.lastDrawMS+=(Date.now()-this.drawStartTime);c.sprite.update(pc.device.elapsed)}if(c.scaleX!=1||c.scaleY!=1){e.spriteSheet.setScale(1,1)}i=i.next();if(pc.device.now-c.start>c.lifetime){c.release();e._particles.remove(c)}}if(e.shots!=0){if(e._particles.first==null&&e._shotCount>=e.shots){e.active=false}}}}});pc._Particle=pc.Pooled.extend("pc._Particle",{create:function(d,c,i,m,k,f,t,h,q,p,b,l,o,r,s,e,g){var j=this._super();j.x=d;j.y=c;j.dir=i;j.thrust=m;j.frame=g;j.lifetime=k;j.spin=f;j.growXRate=t;j.growYRate=h;j.scaleX=q;j.scaleY=p;if(j.sprite==null){j.sprite=pc.Sprite.create(s)}else{j.sprite.setSpriteSheet(s)}j.start=pc.device.now;j.fadeStart=0;j.velX=0;j.velY=0;j.rotation=0;j.alphaMin=o;j.alphaMax=r;j.lastAlpha=pc.device.now;j.fadeInTime=b;j.fadeOutTime=l;j.holdTime=j.lifetime-(j.fadeInTime+j.fadeOutTime);if(e){j.sprite.setCompositeOperation(e)}else{j.sprite.setCompositeOperation("source-over")}j.fadeState=1;j.fadeStateStart=pc.device.now;if(j.fadeInTime>0){j.fadeState=0;j.sprite.setAlpha(0)}else{j.sprite.setAlpha(1)}return j}},{x:0,y:0,dir:0,rotation:0,thrust:0,sprite:null,start:0,frame:0,fadeStart:0,velX:0,velY:0,spin:0,growXRate:0,growYRate:0,scaleX:1,scaleY:1,fadeInTime:0,fadeOutTime:0,fadeStateStart:0,holdTime:0,fadeState:1,alphaMin:1,alphaMax:1,lastAlpha:0});pc.systems.Input=pc.systems.EntitySystem.extend("pc.systems.Input",{},{init:function(){this._super(["input"])},process:function(d){var c=d.getComponent("input");if(!c.active){return}if(!c._bound){var e=d.getComponent("spatial");var j=d;if(c.target){j=c.target}if(c.states){for(var f=0;f<c.states.length;f++){var h=c.states[f][1];for(var b=0;b<h.length;b++){var g=e;if(pc.valid(c.states[f][2])&&c.states[f][2]==false){g=null}pc.device.input.bindState(j,c.states[f][0],h[b],g)}}}if(c.actions){j=this;for(f=0;f<c.actions.length;f++){h=c.actions[f][1];for(b=0;b<h.length;b++){g=e;if(pc.valid(c.actions[f][2])&&c.actions[f][2]==false){g=null}pc.device.input.bindAction(j,c.actions[f][0],h[b],g)}}}c._bound=true}},onAction:function(b,d,e,c){},isInputState:function(b,c){if(b.getComponent("input")._bound){return pc.device.input.isInputState(b,c)}return false}});pc.systems.Expiration=pc.systems.EntitySystem.extend("pc.systems.Expiration",{},{init:function(){this._super(["expiry"])},process:function(b){var d=b.getComponent("expiry");if(!d.active){return}d.decrease(pc.device.elapsed);if(d.hasExpired()){b.remove()}}});pc.systems.Activation=pc.systems.EntitySystem.extend("pc.systems.Activation",{},{init:function(b){this._super(["activator"],b)},onEntityAdded:function(b){b.active=false},process:function(c){var b=c.getComponent("activator");if(!b.active){return}if(c.active&&b.stayActive){return}if(!b._cacheLayer){if(b.layer){b._cacheLayer=c.layer.scene.get(b.layer)}else{b._cacheLayer=c.layer}}var h=b._cacheLayer.getEntityManager().getTagged(b.tag);if(!h){return}var g=h.first;while(g){var f=c.getComponent("spatial");var d=g.object().getComponent("spatial");var i=f.getCenterPos().distance(d.getCenterPos());if(!c.active){if(i<b.range){c.active=true}}else{if(i>=b.range){c.active=false}}g=g.next()}}});pc.systems.Render=pc.systems.EntitySystem.extend("pc.systems.Render",{},{init:function(){this._super(["sprite","overlay","rect","text","poly","circle"])},processAll:function(){var n=Date.now();var q=this.entities.first;while(q){var l=q.obj;if(l.active){var e=l.getComponent("spatial");var f=l.getComponent("alpha");var y=l.getComponent("clip");var E=l.layer.screenX(e.pos.x);var D=l.layer.screenY(e.pos.y);var h=e.getUnscaledPos();var z=e.getUnscaledDim();var r=pc.device.ctx;r.save();if(e.scaleX!=1||e.scaleY!=1){E=l.layer.screenX(h.x);D=l.layer.screenY(h.y);r.scale(e.scaleX,e.scaleY)}if(l.layer.scene.viewPort.overlaps(E,D,e.dim.x,e.dim.y,0,e.dir)){if(y&&y.active){r.beginPath();if(y.clipEntity){var v=y.clipEntity.getComponent("spatial");r.rect(l.layer.screenX(v.pos.x)+y.x,l.layer.screenY(v.pos.y)+y.y,v.dim.x+y.w,v.dim.y+y.h)}else{r.rect(l.layer.screenX(e.pos.x)+y.x,l.layer.screenY(e.pos.y)+y.y,y.w,y.h)}r.closePath();r.clip()}var C=l.getComponent("originshifter");if(C&&C.active){var t=e.pos.x-C._offsetX;var s=e.pos.y-C._offsetY;C._offsetX=(this.layer.origin.x*C.ratio);C._offsetY=(this.layer.origin.y*C.ratio);e.pos.x=t+C._offsetX;e.pos.y=s+C._offsetY}var w=l.getComponent("sprite");if(w&&w.active){w.sprite.update(pc.device.elapsed);if(f&&f.level!=1&&f.level!=0){w.sprite.alpha=f.level}if(e.scaleX!=1||e.scaleY!=1){w.sprite.setScale(e.scaleX,e.scaleY)}w.sprite.draw(r,E+w.offset.x,D+w.offset.y,e.dir);if(e.scaleX!=1||e.scaleY!=1){w.sprite.setScale(1,1)}}var x=l.getComponent("overlay");if(x&&x.active){x.sprite.update(pc.device.elapsed);if(f){x.sprite.alpha=f.level}x.sprite.draw(r,E,D,e.dir);x.decrease(pc.device.elapsed);if(x.hasExpired()){l.removeComponent(x)}}var b=q.obj.getComponent("rect");if(b&&b.active){r.save();if(f){r.globalAlpha=f.level}r.translate((E+(z.x/2)),(D+(z.y/2)));r.rotate(e.dir*(Math.PI/180));if(b.cornerRadius>0){var k=-z.x/2;var j=-z.y/2;r.beginPath();r.moveTo((-z.x/2)+b.cornerRadius,-z.y);r.lineTo(E+z.x-b.cornerRadius,D);r.quadraticCurveTo(E+z.x,D,E+z.x,D+b.cornerRadius);r.lineTo(E+z.x,D+z.y-b.cornerRadius);r.quadraticCurveTo(E+z.x,D+z.y,E+z.x-b.cornerRadius,D+z.y);r.lineTo(E+b.cornerRadius,D+z.y);r.quadraticCurveTo(E,D+z.y,E,D+z.y-b.cornerRadius);r.lineTo(E,D+b.cornerRadius);r.quadraticCurveTo(E,D,E+b.cornerRadius,D);r.closePath();if(b.color){r.fillStyle=b.color.color;r.fill()}if(b.lineColor&&b.lineWidth){r.lineWidth=b.lineWidth;r.strokeStyle=b.lineColor.color;r.stroke()}}else{if(b.color){r.fillStyle=b.color.color;r.fillRect(-z.x/2,-z.y/2,z.x,z.y)}if(b.lineColor&&b.lineWidth){r.lineWidth=b.lineWidth;r.strokeStyle=b.lineColor.color;r.strokeRect(-z.x/2,-z.y/2,z.x,z.y)}}if(f){r.globalAlpha=1}r.restore();pc.device.elementsDrawn++}var d=q.obj.getComponent("circle");if(d&&d.active){r.save();r.lineWidth=d.lineWidth;if(f){r.globalAlpha=f.level}r.translate((E+(e.dim.x/2)),(D+(e.dim.y/2)));r.rotate(e.dir*(Math.PI/180));r.beginPath();r.arc(0,0,e.dim.x/2,0,pc.Math.PI*2,true);r.closePath();if(d.color){r.fillStyle=d.color.color;r.fill()}if(d.lineColor){r.lineWidth=d.lineWidth;r.strokeStyle=d.lineColor.color;r.stroke()}if(f){r.globalAlpha=1}r.restore();pc.device.elementsDrawn++}var g=q.obj.getComponent("poly");if(g&&g.active){r.save();if(f){r.globalAlpha=f.level}var A=e.dim.x/2;var c=e.dim.y/2;r.translate((E+A),(D+c));r.rotate(e.dir*(Math.PI/180));r.beginPath();r.moveTo(g.points[0][0]-A,g.points[0][1]-c);for(var o=1;o<g.points.length;o++){r.lineTo(g.points[o][0]-A,g.points[o][1]-c)}r.closePath();if(g.color){r.fillStyle=g.color.color;r.fill()}if(g.lineColor){r.lineWidth=g.lineWidth;r.strokeStyle=g.lineColor.color;r.stroke()}if(f){r.globalAlpha=1}r.restore();pc.device.elementsDrawn++}var m=l.getComponent("text");if(m&&m.active){r.save();var B=0;if(f){r.globalAlpha=f.level}A=e.dim.x/2;c=e.dim.y/2;r.font=m._fontCache;r.lineWidth=m.lineWidth;r.translate((E+A),(D+c));r.rotate(e.dir*(Math.PI/180));for(var u=0;u<m.text.length;u++){if(m.color){r.fillStyle=m.color.color;r.fillText(m.text[u],m.offset.x-A,B+e.dim.y+m.offset.y-c)}if(m.strokeColor&&m.lineWidth){r.strokeStyle=m.strokeColor.color;r.strokeText(m.text[u],m.offset.x-A,B+e.dim.y+m.offset.y-c)}B+=(m.fontHeight*1.1)}if(f){r.globalAlpha=1}pc.device.elementsDrawn++;r.restore()}r.restore()}}q=q.next()}pc.device.lastDrawMS+=(Date.now()-n)}});pc.systems.Layout=pc.systems.EntitySystem.extend("pc.systems.Layout",{},{margin:null,init:function(b){this._super(["layout"]);this.margin={};if(pc.checked(b)&&pc.checked(b.margin)){this.margin.left=pc.checked(b.margin.left,0);this.margin.right=pc.checked(b.margin.right,0);this.margin.top=pc.checked(b.margin.top,0);this.margin.bottom=pc.checked(b.margin.bottom,0)}else{this.margin.left=0;this.margin.right=0;this.margin.top=0;this.margin.bottom=0}},_getAnchorLocation:function(b,c){if(b==="left"){if(c==="top"){return"top-left"}if(c==="middle"){return"middle-left"}if(c==="bottom"){return"bottom-left"}}if(b==="center"){if(c==="top"){return"top-center"}if(c==="middle"){return"middle-center"}if(c==="bottom"){return"bottom-center"}}if(b==="right"){if(c==="top"){return"top-right"}if(c==="middle"){return"middle-right"}if(c==="bottom"){return"bottom-right"}}return null},doLayout:function(){var p=new pc.HashList();var j=this.entities.first;while(j){var e=j.obj;var n=e.getComponent("spatial");if(!n){e.addComponent(pc.components.Spatial({}))}var k=e.getComponent("layout");var m=this._getAnchorLocation(k.horizontal,k.vertical);p.add(m,j.obj);j=j.next()}var b=p.hashtable.keys();for(var g=0;g<b.length;g++){var f=b[g];var o=p.get(b[g]);var h=this._getEntityDimensions(o);var d=this.margin.left;var c=this.margin.top;switch(f){case"top-left":break;case"middle-left":c+=(this.layer.getScreenRect().h/2)-(h.y/2);break;case"bottom-left":c=this.layer.getScreenRect().h-h.y-this.margin.bottom;break;case"top-center":d+=this.layer.getScreenRect().w/2-(h.x/2);break;case"middle-center":d+=this.layer.getScreenRect().w/2-(h.x/2);c+=(this.layer.getScreenRect().h/2)-(h.y/2);break;case"bottom-center":d=this.layer.getScreenRect().w/2-(h.x/2)-this.margin.bottom;c+=this.layer.getScreenRect().h-h.y;break;case"top-right":d+=this.layer.getScreenRect().w-h.x;break;case"middle-right":d+=this.layer.getScreenRect().w-h.x;c+=(this.layer.getScreenRect().h/2)-(h.y/2);break;case"bottom-right":d+=this.layer.getScreenRect().w-h.x;c=this.layer.getScreenRect().h-h.y-this.margin.bottom;break}var l=o.first;while(l){e=l.obj;n=e.getComponent("spatial");k=e.getComponent("layout");c+=k.margin.top;switch(f){case"top-left":case"middle-left":case"bottom-left":d=k.margin.left+this.margin.left;break;case"top-center":case"middle-center":case"bottom-center":d=k.margin.left+(this.layer.getScreenRect().w/2)-(n.dim.x/2);break;case"top-right":case"middle-right":case"bottom-right":d=this.layer.getScreenRect().w-n.dim.x-k.margin.right-this.margin.right;break}n.pos.x=d;n.pos.y=c;c+=n.dim.y+k.margin.bottom;l=l.next()}}},_entityDim:null,_getEntityDimensions:function(e){if(!this._entityDim){this._entityDim=new pc.Dim()}this._entityDim.x=0;this._entityDim.y=0;var b=e.first;while(b){var d=b.obj.getComponent("spatial");var c=b.obj.getComponent("layout");if(d){this._entityDim.x+=c.margin.left+d.dim.x+c.margin.right;this._entityDim.y+=c.margin.top+d.dim.y+c.margin.bottom}b=b.nextLinked}return this._entityDim},onResize:function(c,b){this.doLayout()},onEntityAdded:function(b){this._super();this.doLayout()},onEntityRemoved:function(b){this._super();this.doLayout()},onComponentAdded:function(b,c){this._super();this.doLayout()}});